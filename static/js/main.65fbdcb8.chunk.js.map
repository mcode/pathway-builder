{"version":3,"sources":["camino-logo-dark.png","components/Graph/Graph.module.scss","components/ActionButton/ActionButton.module.scss","utils/ConfigManager.js","components/BuildCriteriaProvider.tsx","styles/theme.tsx","components/ThemeProvider.tsx","components/Header/Header.tsx","components/Navigation/styles.tsx","utils/useRefState.ts","components/CurrentPathwayProvider.tsx","utils/nodeUtils.ts","utils/cpg.ts","utils/builder.ts","components/elements/ExportMenu/ExportMenu.tsx","components/Navigation/Navigation.tsx","components/Services/Services.tsx","components/PathwaysProvider.tsx","components/Sidebar/styles.tsx","components/CurrentNodeProvider.tsx","components/elements/DropDown/DropDown.tsx","components/SnackbarProvider.tsx","components/Sidebar/DeleteSnackbar.tsx","components/Sidebar/ConnectNodeButton.tsx","components/Sidebar/Sidebar.tsx","components/Sidebar/SidebarHeader.tsx","components/Sidebar/SidebarButton.tsx","engine/cql-to-elm.ts","components/Sidebar/ActionNodeEditor.tsx","components/CriteriaProvider.tsx","components/Sidebar/BranchTransition.tsx","components/Sidebar/OutlinedDiv.tsx","components/Sidebar/DeleteModal.tsx","components/Sidebar/TransitionEditor.tsx","visualization/layout.ts","components/ExpandedNode/ExpandedNode.tsx","components/Node/Node.tsx","components/Arrow/styles.tsx","components/Arrow/Arrow.tsx","components/Graph/Graph.tsx","components/Builder/styles.tsx","components/Builder/Builder.tsx","components/BuilderRoute.tsx","components/UserProvider.tsx","components/Tabs/styles.tsx","components/Tabs/Tabs.tsx","components/elements/Loading/Loading.tsx","components/PathwaysList/styles.tsx","components/PathwaysList/PathwayModal.tsx","components/ConfirmedDeletionButton/styles.tsx","components/ActionButton/ActionButton.tsx","components/ConfirmedDeletionButton/ConfirmedDeletionButton.tsx","components/PathwaysList/PathwaysTable.tsx","components/PathwaysList/PathwaysList.tsx","components/CriteriaList/styles.tsx","components/CriteriaList/CriteriaTable.tsx","components/CriteriaList/ImportCriteriaModal.tsx","components/CriteriaList/CriteriaList.tsx","components/App.tsx","index.js","components/Node/Node.module.scss","components/ExpandedNode/ExpandedNode.module.scss","components/Header/Header.module.scss","components/elements/Loading/Loading.module.scss"],"names":["module","exports","config","this","global","CONFIG","name","defaultValue","parts","split","context","value","i","conf","BuildCriteriaContext","createContext","BuildCriteriaProvider","memo","children","useState","buildCriteriaNodeId","setBuildCriteriaNodeId","updateBuildCriteriaNodeId","useCallback","id","Provider","useBuildCriteriaContext","useContext","variables","spacing","globalPadding","colors","white","black","red","blue","blueLighter","gray","grayMedium","grayBlue","grayLight","grayLighter","grayDark","grayVeryDark","green","typography","fontFamily","join","materialUiOverridesBase","MuiButton","root","borderRadius","height","backgroundColor","color","contained","label","fontWeight","iconSizeMedium","fontSize","iconSizeSmall","MuiTableHead","MuiTableCell","head","padding","borderBottom","MuiFormControl","margin","MuiFormLabel","fontStyle","MuiInputBase","input","transitionDelay","transitionProperty","MuiTooltip","tooltip","arrow","MuiOutlinedInput","MuiSelect","icon","MuiPaper","rounded","MuiDialogTitle","MuiDialogContent","MuiDialogActions","MuiCard","overflow","MuiIconButton","materialUiOverridesDark","borderColor","notchedOutline","MuiMenuItem","paletteBase","primary","main","secondary","error","common","background","default","text","grey","800","lightTheme","createMuiTheme","palette","overrides","darkTheme","deepmerge","projectorTheme","getTheme","theme","useProjector","ThemeContext","ThemeProvider","setUseProjector","muiTheme","toggleTheme","currentUseProjector","anchorEl","setAnchorEl","openMenu","event","currentTarget","closeMenu","handleToggleTheme","className","styles","header","to","homeLink","onClick","src","logo","alt","aria-controls","aria-haspopup","faCog","Menu","keepMounted","open","Boolean","onClose","MenuItem","makeStyles","display","alignItems","justifyContent","backButton","width","navigationIcons","cursor","pathwayName","marginLeft","index","useRefState","initialValue","state","setState","stateRef","useRef","useEffect","current","CurrentPathwayContext","CurrentPathwayProvider","pathway","pathwayRef","_setPathway","setPathway","useCurrentPathwayContext","isActionNode","node","undefined","action","isBranchNode","nodeTypeIsUndefined","resourceNameConversion","MedicationRequest","ServiceRequest","CarePlan","nodeTypeOptions","findParents","childNodeKey","parents","Object","keys","nodes","forEach","parentNodeKey","transitions","transition","push","willOrphanChild","transitionCount","nodeKey","canDeleteNode","canDeleteAllTransitions","redirect","pathwayId","history","url","encodeURIComponent","location","pathname","LIBRARY_DRAFT","R4","LibraryStatusKind","_draft","PLANDEFINITION_DRAFT","PlanDefinitionStatusKind","ACTIVITYDEFINITION_DRAFT","ActivityDefinitionStatusKind","BUNDLE_TRANSACTION","BundleTypeKind","_transaction","BUNDLE_PUT","Bundle_RequestMethodKind","_put","CONDITION_APPLICABILITY","PlanDefinition_ConditionKindKind","_applicability","EXPRESSION_CQL","ExpressionLanguageKind","_textCql","createAction","description","definition","title","code","coding","system","definitionCanonical","createPlanDefinition","type","libraryId","planDefinition","resourceType","meta","profile","extension","valueCode","version","substring","status","experimental","publisher","library","createBundleEntry","resource","fullUrl","request","method","toCPG","bundle","entry","uuidv4","content","elm","contentType","data","btoa","JSON","stringify","navigational","preconditions","createLibrary","cpgStrategy","key","cpgRecommendation","cpgStrategyAction","map","parent","find","condition","kind","expression","language","cql","cpgActivityDefinition","activityId","date","Date","toISOString","productCodeableConcept","medicationCodeableConcept","createActivityDefinition","cpgRecommendationAction","downloadPathway","cpg","pathwayString","exportPathway","pathwayBlob","Blob","window","URL","createObjectURL","a","document","createElement","href","download","click","revokeObjectURL","identifier","schemaIdentifier","usings","def","localIdentifier","uri","localId","locator","statements","operand","dataType","includes","valueSets","codes","codeSystems","pathwayToExport","precondition","mergeElm","elmStatement","produce","getElmStatement","draftElmStatement","draftPathway","setNavigationalElm","additionalElm","using","include","path","valueSet","codesystem","defaultStatementNames","createNode","shortid","generate","addNode","setNodeType","nodeType","setNodeAction","makeNodeAction","makeNodeBranch","console","addTransition","startNodeKey","endNodeKey","getNodeType","getContentAnchorEl","anchorOrigin","vertical","horizontal","alert","Navigation","useStyles","useHistory","handleGoBack","IconButton","aria-label","faChevronLeft","faEllipsisH","useGetService","result","setResult","fetch","headers","Accept","getObject","then","response","json","listOfFiles","f","options","typedFetch","listOfPromises","Promise","all","list","payload","catch","PathwaysContext","PathwaysProvider","pathways","pathwaysRef","setPathways","service","get","servicePayload","addPathway","currentPathways","deletePathway","filter","updatePathway","newPathway","findIndex","slice","usePathwaysContext","flexDirection","minWidth","overflowY","float","formControl","divider","headerLabelStart","displayText","sidebarHeader","sidebarHeaderGroup","sidebarHeaderButton","headerLabelGroup","headerLabel","headerLabelText","marginBottom","editIcon","sidebarButtonGroup","sidebarButtonGroupExtraMargin","sidebarButton","marginRight","sidebarButtonText","outlinedDiv","outlinedDivError","toggleSidebar","cancelButton","alignSelf","marginTop","buildCriteriaContainer","saveButton","transitionContainer","dividerHeader","textTransform","lineHeight","paddingLeft","dialogCloseButton","dialogContent","dialogContentText","alertIcon","connectDropdown","flexWrap","alignContent","connectText","cancelButtonDropdown","border","CurrentNodeContext","CurrentNodeProvider","currentNode","currentNodeRef","_setCurrentNode","setCurrentNode","useCurrentNodeContext","onChange","handleSetSelected","FormControl","variant","fullWidth","InputLabel","htmlFor","Select","MenuProps","transformOrigin","displayEmpty","option","SnackbarContext","SnackbarProvider","openSnackbar","setOpenSnackbar","snackbarText","setSnackbarText","handleCloseSnackbar","useSnackbarContext","Snackbar","autoHideDuration","message","Fragment","Button","size","faTimes","setOpen","rootNode","connectableNodes","ancestorNodes","getAncestorNodes","rootNodeKey","currNodeKey","ancestors","previousNodes","currNode","length","some","concat","rootNodeConnectsToNode","nodeIsAncestor","getConnectableNodes","optionsAvailable","connectToNode","target","showDropdown","buttonName","buttonIcon","faLevelDownAlt","buttonText","disabled","hasTooltip","tooltipTitle","headerElement","isExpanded","setIsExpanded","sidebarContainerElement","changeNodeType","selectNodeType","addPathwayNode","newNode","resize","style","innerHeight","clientHeight","addEventListener","removeEventListener","ref","isTransition","faPlus","displayTransitions","faChevronRight","showInput","setShowInput","openTooltip","setOpenTooltip","openDelete","setOpenDelete","inputRef","nodeLabel","goToParentNode","redirectToNode","changeNodeLabel","setNodeLabel","handleShowInput","deleteNode","filterTransition","removeNode","deleteTransition","removeTransition","openDeleteModal","closeDeleteModal","handleOpenTooltip","handleCloseTooltip","handleKeyPress","deleteNodeDisabled","deleteTransitionDisabled","deleteDisabled","titleText","Input","onBlur","onKeyPress","autoFocus","onFocus","select","clsx","faEdit","Tooltip","placement","onOpen","faTrashAlt","onDelete","extraMargin","ConditionalTooltip","startIcon","codeSystemOptions","addActionCQL","currentNodeKey","body","convertBasicCQL","cqlId","replace","codesystemStatement","returnStatement","retrieveStatement","defineStatement","escape","createCQL","setActionNodeElm","changeCode","draftAction","resetDisplay","changeDescription","changeTitle","selectCodeSystem","codeSystem","validateFunction","setActionResourceDisplay","onEnter","e","changeNodeTypeEnabled","TextField","inputProps","faCheckCircle","CriteriaContext","jsonToCriteria","rawElm","parse","modified","now","CriteriaProvider","criteria","setCriteria","newCriteria","jsonCriterion","criterion","addCriteria","file","reader","FileReader","onload","currentCriteria","readAsText","deleteCriteria","useCriteriaContext","criteriaOptions","useMemo","c","criteriaAvailable","useCriteriaSelected","setUseCriteriaSelected","criteriaDescription","criteriaIsValid","criteriaDisplayIsValid","hasCriteria","displayCriteria","buildCriteriaSelected","setBuildCriteriaSelected","criteriaName","setCriteriaName","transitionRef","handleUseCriteria","transitionId","selectCriteriaSource","criteriaSource","criteriaLabel","foundTransition","setTransitionCondition","setCriteriaDisplay","criteriaDisplay","handleCriteriaName","handleBuildCriteria","handleBuildCriteriaCancel","faThList","faTools","FormControlLabel","Box","control","Checkbox","faSave","InputComponent","OutlinedDiv","multiline","InputLabelProps","shrink","InputProps","inputComponent","classes","Dialog","aria-labelledby","maxWidth","DialogTitle","disableTypography","DialogContent","faExclamationCircle","DialogActions","transitionKey","transitionNode","Card","raised","graphLayoutProvider","layout","nodeDimensions","nodeKeys","g","dagre","graphlib","Graph","setGraph","setDefaultEdgeLabel","nodeDimension","setNode","setEdge","nodeCoordinates","startNodeShift","x","y","edges","edge","edgeName","v","w","start","end","points","p","layoutDagre","rank","NaN","horizontalPosition","canMove","initializeNodes","graph","assignRankToChildren","assignHorizontalPositionToNode","assignHorizontalPositionToNodesInRank","coordinates","NODE_HEIGHT","produceCoordinates","hPos","isNaN","hasOverlap","direction","Math","ceil","NODE_WIDTH","parentsOnHigherRank","parentKey","floor","splice","childNode","spreadChildrenEvenly","sum","reduce","b","nodesInRank","nodesOverlap","otherNode","nodesEqual","child","indexOf","assignRankToNode","err","layoutCustom","ExpandedNode","actionNode","ExpandedNodeMemo","ExpandedNodeField","descTitle","desc","returnElements","rel","faExternalLinkAlt","externalLink","renderAction","branch","infoTable","Node","forwardRef","pathwayNode","xCoordinate","yCoordinate","expanded","hasMetadata","setHasMetadata","onClickHandler","top","left","isActionable","topLevelClasses","expandedNodeClass","actionable","childActionable","childNotActionable","expandedNode","NodeIcon","faPlay","faPrescriptionBottleAlt","faSyringe","faBookMedical","faMicroscope","StatusIcon","faTimesCircle","stroke","strokeWidth","currentArrow","arrowhead","fill","currentArrowhead","ArrowPath","arrowheadId","widthOffset","pointsWithOffset","remainder","pathString","acc","point","arr","d","markerEnd","Arrow","isCurrentArrow","edgeNameNoWhitespace","markerWidth","markerHeight","refX","refY","orient","graphContainerWidth","interactive","nodeRefs","getGraphLayout","nodeElement","clientWidth","Array","from","graphLayout","setLayout","maxHeight","values","max","minX","min","toAdd","curr","lastSelectedNode","setExpanded","toggleExpanded","prevState","parentWidth","GraphMemo","useParams","position","xmlns","zIndex","toggleButtonCss","graphHeader","graphHeaderText","toggleButton","darken","toggleIcon","transform","useTheme","showCriteriaBuilder","setShowCriteriaBuilder","graphContainerElement","setGraphContainerElement","setGraphContainerWidth","toggleShowCriteria","handleGraphContainerElement","reactNode","ResizeSensor","faProjectDiagram","nodeId","decodeURIComponent","pathwayIndex","UserContext","UserProvider","user","setUser","tabs","tab","component","faSpinner","spin","createPathwayButton","pathwayList","pathwaysListButton","editPathway","createNewPathwayMeta","pathwayNameRef","pathwayDescRef","closeModal","handleCreateNewPathway","preventDefault","Start","createNewPathway","handleUpdatePathway","newEditPathway","draftEditPathway","metaDescription","onSubmit","required","container","paper","mozBackgroundClip","webkitBackgroundVlip","backgroundClip","whiteSpace","buttons","minHeight","LargeActionButton","largeActionButton","largeDecline","toUpperCase","SmallActionButton","accept","decline","smallActionButton","data-testid","faCheck","MediumActionButton","mediumActionButton","deleteId","deleteMethod","deleteType","deleteName","onAcceptHandler","onDeclineHandler","ClickAwayListener","onClickAway","Popover","editablePathway","setEditablePathway","openEditPathwayModal","closeEditPathwayModal","deletion","TableContainer","Table","TableHead","TableRow","TableCell","TableBody","scope","Link","RouterLink","underline","align","faFileDownload","openNewPathwayModal","closeNewPathwayModal","buttonRow","buildCriteriaButton","criteriaList","editButton","chooseFileInput","inputButton","fileName","datetime","moment","fromNow","setFileName","importFileRef","selectFile","files","handleChooseFile","faFileImport","openImportModal","closeImportModal","enableMapSet","ReactDOM","render","getElementById"],"mappings":"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","file":"static/js/main.65fbdcb8.chunk.js","sourcesContent":["module.exports = __webpack_public_path__ + \"static/media/camino-logo-dark.c8fc712a.png\";","// extracted by mini-css-extract-plugin\nmodule.exports = {\"root\":\"Graph_root__1SJOc\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"selectButton\":\"ActionButton_selectButton___qB5R\",\"accept\":\"ActionButton_accept__28b2D\",\"decline\":\"ActionButton_decline__zz-vG\",\"smallActionButton\":\"ActionButton_smallActionButton__1bPWu\",\"largeActionButton\":\"ActionButton_largeActionButton__blRdA\",\"largeDecline\":\"ActionButton_largeDecline__wz9Zw\",\"mediumActionButton\":\"ActionButton_mediumActionButton__3EpOp\"};","export class ConfigManager {\n  constructor(config = {}) {\n    this.config = global.CONFIG ? { ...global.CONFIG, ...config } : { ...config };\n  }\n\n  get(name, defaultValue) {\n    const parts = name.split('.');\n    let context = this.config;\n    let value = null;\n    for (const i in parts) {\n      const part = parts[i];\n      value = context[part];\n      context = value;\n    }\n    return value || defaultValue;\n  }\n\n  add(conf) {\n    if (conf) {\n      this.config = {\n        ...this.config,\n        ...conf\n      };\n    }\n  }\n}\n\nconst config = new ConfigManager();\nexport default config;\n","import React, {\n  createContext,\n  FC,\n  ReactNode,\n  memo,\n  useState,\n  useCallback,\n  useContext\n} from 'react';\n\ninterface BuildCriteriaContextInterface {\n  buildCriteriaNodeId: string;\n  updateBuildCriteriaNodeId: (id: string) => void;\n}\n\nexport const BuildCriteriaContext = createContext<BuildCriteriaContextInterface>(\n  {} as BuildCriteriaContextInterface\n);\n\ninterface BuildCriteriaProviderProps {\n  children: ReactNode;\n}\n\nexport const BuildCriteriaProvider: FC<BuildCriteriaProviderProps> = memo(({ children }) => {\n  const [buildCriteriaNodeId, setBuildCriteriaNodeId] = useState<string>('');\n\n  const updateBuildCriteriaNodeId = useCallback(\n    (id: string) => {\n      setBuildCriteriaNodeId(id);\n    },\n    [setBuildCriteriaNodeId]\n  );\n\n  return (\n    <BuildCriteriaContext.Provider value={{ buildCriteriaNodeId, updateBuildCriteriaNodeId }}>\n      {children}\n    </BuildCriteriaContext.Provider>\n  );\n});\n\nexport const useBuildCriteriaContext = (): BuildCriteriaContextInterface =>\n  useContext(BuildCriteriaContext);\n","import { createMuiTheme } from '@material-ui/core/styles';\nimport deepmerge from 'deepmerge';\n\ndeclare module '@material-ui/core/styles/createMuiTheme' {\n  interface Theme {\n    variables: {\n      spacing: {\n        globalPadding: string;\n      };\n    };\n  }\n  // allow configuration using `createMuiTheme`\n  interface ThemeOptions {\n    variables?: {\n      spacing?: {\n        globalPadding?: string;\n      };\n    };\n  }\n}\n\ndeclare module '@material-ui/core/styles/createPalette' {\n  interface CommonColors {\n    blue: string;\n    blueLighter: string;\n    red: string;\n    gray: string;\n    grayMedium: string;\n    grayBlue: string;\n    grayLighter: string;\n    grayDark: string;\n    grayVeryDark: string;\n    green: string;\n  }\n}\n\nconst variables = {\n  spacing: {\n    globalPadding: '2em'\n  }\n};\n\nconst colors = {\n  white: '#fff',\n  black: '#222',\n  red: '#d95d77',\n  blue: '#5d89a1',\n  blueLighter: '#9ad2f0',\n  gray: '#4a4a4a',\n  grayMedium: '#bbbdc0',\n  grayBlue: '#cbd5df',\n  grayLight: '#6c6c6c',\n  grayLighter: '#eaeef2',\n  grayDark: '#444',\n  grayVeryDark: '#3a3a3a',\n  green: '#2fa874'\n};\n\nconst typography = {\n  fontFamily: [\n    'Open Sans',\n    '-apple-system',\n    'BlinkMacSystemFont',\n    'Segoe UI',\n    'Roboto',\n    'Oxygen',\n    'Ubuntu',\n    'Cantarell',\n    'Fira Sans',\n    'Droid Sans',\n    'Helvetica Neue',\n    'sans-serif'\n  ].join(',')\n};\n\nconst materialUiOverridesBase = {\n  MuiButton: {\n    root: {\n      borderRadius: 0,\n      height: '38px',\n      '&$disabled': {\n        backgroundColor: colors.grayMedium,\n        color: colors.white\n      }\n    },\n    contained: {\n      '&$disabled': {\n        backgroundColor: colors.grayMedium,\n        color: colors.white\n      }\n    },\n    label: {\n      fontWeight: 600\n    },\n    iconSizeMedium: {\n      '& > *:first-child': {\n        fontSize: 14\n      }\n    },\n    iconSizeSmall: {\n      '& > *:first-child': {\n        fontSize: 14\n      }\n    }\n  },\n  MuiTableHead: {\n    root: {\n      backgroundColor: colors.grayLighter\n    }\n  },\n  MuiTableCell: {\n    root: {\n      fontSize: '1em'\n    },\n    head: {\n      padding: '5px 16px',\n      borderBottom: 'none'\n    }\n  },\n  MuiFormControl: {\n    root: {\n      margin: '10px 0'\n    }\n  },\n  MuiFormLabel: {\n    root: {\n      fontStyle: 'italic',\n      '&.Mui-error': {\n        color: colors.white\n      }\n    }\n  },\n  MuiInputBase: {\n    root: {\n      fontWeight: 600\n    },\n    input: {\n      '&::selection': {\n        color: colors.white,\n        backgroundColor: colors.grayDark\n      },\n      '&:-webkit-autofill': {\n        transitionDelay: '9999s',\n        transitionProperty: 'background-color, color'\n      }\n    }\n  },\n  MuiTooltip: {\n    tooltip: {\n      fontSize: 14,\n      backgroundColor: colors.black\n    },\n    arrow: {\n      color: colors.black\n    }\n  },\n  MuiOutlinedInput: {\n    root: {\n      borderRadius: '0'\n    }\n  },\n  MuiSelect: {\n    icon: {\n      fontSize: '2em'\n    }\n  },\n  MuiPaper: {\n    rounded: {\n      borderRadius: '0'\n    }\n  },\n  MuiDialogTitle: {\n    root: {\n      padding: '1em'\n    }\n  },\n  MuiDialogContent: {\n    root: {\n      padding: '0 4em'\n    }\n  },\n  MuiDialogActions: {\n    root: {\n      padding: '2em 4em'\n    }\n  },\n  MuiCard: {\n    root: {\n      overflow: 'visible'\n    }\n  },\n  MuiIconButton: {\n    root: {\n      '&:disabled': {\n        color: colors.grayLight\n      }\n    }\n  }\n};\n\nconst materialUiOverridesDark = {\n  MuiFormControl: {\n    root: {\n      '&:hover': {\n        borderColor: colors.white\n      }\n    }\n  },\n  MuiFormLabel: {\n    root: {\n      color: colors.white,\n      '&$focused': {\n        color: colors.white\n      }\n    }\n  },\n  MuiInputBase: {\n    root: {\n      color: colors.white,\n      '&:hover': {\n        borderColor: colors.white,\n        backgroundColor: colors.grayDark\n      }\n    }\n  },\n  MuiTooltip: {\n    tooltip: {\n      fontSize: 14\n    }\n  },\n  MuiOutlinedInput: {\n    root: {\n      '&:hover': {\n        borderColor: colors.white\n      },\n      '&:hover $notchedOutline': {\n        borderColor: colors.white\n      },\n      '&$focused $notchedOutline': {\n        borderColor: colors.white\n      }\n    },\n    notchedOutline: {\n      borderColor: colors.white\n    }\n  },\n  MuiSelect: {\n    icon: {\n      color: colors.white\n    }\n  },\n  MuiMenuItem: {\n    root: {\n      color: colors.grayDark\n    }\n  }\n};\n\nconst paletteBase = {\n  primary: {\n    main: colors.blue\n  },\n  secondary: {\n    main: colors.red\n  },\n  error: {\n    main: colors.red\n  },\n  common: colors,\n  background: {\n    default: colors.grayLighter\n  },\n  text: {\n    primary: colors.gray,\n    secondary: colors.gray\n  },\n  grey: {\n    800: colors.gray\n  }\n};\n\nconst lightTheme = createMuiTheme({\n  typography: { ...typography },\n  palette: { ...paletteBase },\n  overrides: { ...materialUiOverridesBase },\n  variables: { ...variables }\n});\n\nconst darkTheme = createMuiTheme({\n  typography: { ...typography },\n  palette: deepmerge(paletteBase, {\n    text: {\n      primary: colors.white,\n      secondary: colors.white\n    }\n  }),\n  overrides: deepmerge(materialUiOverridesBase, materialUiOverridesDark),\n  variables: { ...variables }\n});\n\nconst projectorTheme = createMuiTheme({\n  typography: { ...typography },\n  palette: deepmerge(paletteBase, {\n    background: {\n      default: colors.grayBlue\n    },\n    text: {\n      primary: colors.black,\n      secondary: colors.black\n    }\n  }),\n  overrides: { ...materialUiOverridesBase },\n  variables: { ...variables }\n});\n\nexport default lightTheme;\nexport { lightTheme, darkTheme, projectorTheme };\n","import React, {\n  FC,\n  memo,\n  createContext,\n  useState,\n  useCallback,\n  useContext,\n  ReactNode\n} from 'react';\nimport { ThemeProvider as MuiThemeProvider, Theme } from '@material-ui/core/styles';\nimport { lightTheme, darkTheme, projectorTheme } from '../styles/theme';\n\ninterface ThemeProviderProps {\n  theme: string;\n  children: ReactNode;\n}\n\ninterface ThemeContextInterface {\n  toggleTheme: () => void;\n  useProjector: boolean;\n}\n\nconst getTheme = ({ theme, useProjector }: { theme: string; useProjector: boolean }): Theme => {\n  if (useProjector) {\n    switch (theme) {\n      case 'dark':\n        // TODO: replace with dark projector theme\n        return darkTheme;\n\n      default:\n        return projectorTheme;\n    }\n  }\n\n  switch (theme) {\n    case 'dark':\n      return darkTheme;\n\n    default:\n      return lightTheme;\n  }\n};\n\nexport const ThemeContext = createContext({} as ThemeContextInterface);\nexport const useThemeToggle = (): (() => void) => {\n  const { toggleTheme } = useContext(ThemeContext);\n  return toggleTheme;\n};\nexport const useTheme = (theme: string): Theme => {\n  const { useProjector } = useContext(ThemeContext);\n  return getTheme({ theme, useProjector });\n};\n\nconst ThemeProvider: FC<ThemeProviderProps> = memo(({ theme = 'light', children }) => {\n  const [useProjector, setUseProjector] = useState(false);\n  const muiTheme = getTheme({ theme, useProjector });\n\n  const toggleTheme = useCallback(() => {\n    setUseProjector(currentUseProjector => !currentUseProjector);\n  }, []);\n\n  return (\n    <MuiThemeProvider theme={muiTheme}>\n      <ThemeContext.Provider value={{ useProjector, toggleTheme }}>\n        {children}\n      </ThemeContext.Provider>\n    </MuiThemeProvider>\n  );\n});\n\nexport default ThemeProvider;\n","import React, { FC, memo, useCallback, useState, MouseEvent } from 'react';\nimport { Link } from 'react-router-dom';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport { faCog } from '@fortawesome/free-solid-svg-icons';\nimport Menu from '@material-ui/core/Menu';\nimport MenuItem from '@material-ui/core/MenuItem';\n\nimport { useBuildCriteriaContext } from 'components/BuildCriteriaProvider';\nimport { useThemeToggle } from '../ThemeProvider';\n\nimport logo from 'camino-logo-dark.png';\nimport styles from './Header.module.scss';\n\nconst Header: FC = () => {\n  const { updateBuildCriteriaNodeId } = useBuildCriteriaContext();\n  const [anchorEl, setAnchorEl] = useState<null | HTMLElement>(null);\n  const toggleTheme = useThemeToggle();\n\n  const openMenu = useCallback((event: MouseEvent<HTMLButtonElement>): void => {\n    setAnchorEl(event.currentTarget);\n  }, []);\n\n  const closeMenu = useCallback((): void => {\n    setAnchorEl(null);\n  }, []);\n\n  const handleToggleTheme = useCallback((): void => {\n    toggleTheme();\n    closeMenu();\n  }, [toggleTheme, closeMenu]);\n\n  return (\n    <header className={styles.header}>\n      <Link to=\"/\" className={styles.homeLink} onClick={(): void => updateBuildCriteriaNodeId('')}>\n        <img src={logo} alt=\"logo\" className={styles.logo} />\n      </Link>\n\n      <button onClick={openMenu} aria-controls=\"options-menu\" aria-haspopup=\"true\">\n        <FontAwesomeIcon icon={faCog} />\n      </button>\n\n      <Menu\n        id=\"options-menu\"\n        anchorEl={anchorEl}\n        keepMounted\n        open={Boolean(anchorEl)}\n        onClose={closeMenu}\n      >\n        <MenuItem onClick={handleToggleTheme}>Toggle Theme</MenuItem>\n      </Menu>\n    </header>\n  );\n};\n\nexport default memo(Header);\n","import { makeStyles, Theme as AugmentedTheme } from '@material-ui/core/styles';\n\nexport default makeStyles(\n  (theme: AugmentedTheme) => ({\n    root: {\n      display: 'flex',\n      alignItems: 'center',\n      padding: '2em',\n      backgroundColor: theme.palette.background.default,\n      color: theme.palette.text.primary,\n      height: '6em',\n      justifyContent: 'space-between'\n    },\n    backButton: {\n      height: '45px',\n      width: '45px'\n    },\n    navigationIcons: {\n      fontSize: '20px',\n      color: theme.palette.common.gray,\n      cursor: 'pointer'\n    },\n    pathwayName: {\n      fontSize: '1.4em',\n      marginLeft: '1.5em'\n    }\n  }),\n  { name: 'Navigation', index: 1 }\n);\n","import { useEffect, useRef, useState, MutableRefObject } from 'react';\n\nfunction useRefState<T>(initialValue: T): [T, MutableRefObject<T>, Function] {\n  const [state, setState] = useState<T>(initialValue);\n  const stateRef = useRef(state);\n  useEffect(() => {\n    stateRef.current = state;\n  }, [state]);\n  return [state, stateRef, setState];\n}\n\nexport default useRefState;\n","import React, {\n  ReactNode,\n  createContext,\n  useContext,\n  FC,\n  memo,\n  useCallback,\n  MutableRefObject\n} from 'react';\nimport { Pathway } from 'pathways-model';\nimport useRefState from 'utils/useRefState';\n\ninterface CurrentPathwayContextInterface {\n  pathway: Pathway | null;\n  pathwayRef: MutableRefObject<Pathway | null>;\n  setPathway: (value: Pathway) => void;\n}\n\nexport const CurrentPathwayContext = createContext<CurrentPathwayContextInterface>(\n  {} as CurrentPathwayContextInterface\n);\n\ninterface CurrentPathwayProviderProps {\n  children: ReactNode;\n}\n\nexport const CurrentPathwayProvider: FC<CurrentPathwayProviderProps> = memo(({ children }) => {\n  const [pathway, pathwayRef, _setPathway] = useRefState<Pathway | null>(null);\n\n  const setPathway = useCallback(\n    (value: Pathway) => {\n      _setPathway(value);\n    },\n    [_setPathway]\n  );\n\n  return (\n    <CurrentPathwayContext.Provider value={{ pathway, pathwayRef, setPathway }}>\n      {children}\n    </CurrentPathwayContext.Provider>\n  );\n});\n\nexport const useCurrentPathwayContext = (): CurrentPathwayContextInterface =>\n  useContext(CurrentPathwayContext);\n","import { PathwayNode, ActionNode, Pathway, Transition } from 'pathways-model';\nimport { History } from 'history';\n\nexport function isActionNode(node: PathwayNode): node is ActionNode {\n  const { action } = node as ActionNode;\n  return action !== undefined;\n}\n\nexport function isBranchNode(node: PathwayNode): boolean {\n  const { action, label, nodeTypeIsUndefined } = node as ActionNode;\n  return action === undefined && label !== 'Start' && !nodeTypeIsUndefined;\n}\n\ntype ConversionResource = {\n  [key: string]: string;\n};\nexport const resourceNameConversion: ConversionResource = {\n  MedicationRequest: 'Medication',\n  ServiceRequest: 'Procedure',\n  CarePlan: 'Regimen'\n};\n\nexport const nodeTypeOptions = [\n  { label: 'Medication', value: 'MedicationRequest' },\n  { label: 'Procedure', value: 'ServiceRequest' },\n  { label: 'Regimen', value: 'CarePlan' },\n  { label: 'Observation', value: 'Observation' }\n];\n\nexport function findParents(pathway: Pathway, childNodeKey: string): string[] {\n  const parents: string[] = [];\n  Object.keys(pathway.nodes).forEach(parentNodeKey => {\n    for (const transition of pathway.nodes[parentNodeKey].transitions) {\n      if (transition.transition === childNodeKey) {\n        parents.push(parentNodeKey);\n        break;\n      }\n    }\n  });\n  return parents;\n}\n\nexport function willOrphanChild(pathway: Pathway, childNodeKey: string): boolean {\n  // Count the number of transitions into the node\n  let transitionCount = 0;\n  Object.keys(pathway.nodes).forEach(nodeKey => {\n    pathway.nodes[nodeKey].transitions.forEach(transition => {\n      if (transition.transition === childNodeKey) transitionCount += 1;\n    });\n  });\n\n  return transitionCount >= 2 ? false : true;\n}\n\nexport function canDeleteNode(pathway: Pathway, transitions: Transition[]): boolean {\n  let canDeleteAllTransitions = true;\n  transitions.forEach(transition => {\n    if (willOrphanChild(pathway, transition.transition)) canDeleteAllTransitions = false;\n  });\n  return canDeleteAllTransitions;\n}\n\nexport function redirect(\n  pathwayId: string,\n  nodeKey: string,\n  history: History<History.PoorMansUnknown>\n): void {\n  const url = `/builder/${encodeURIComponent(pathwayId)}/node/${encodeURIComponent(nodeKey)}`;\n  if (url !== history.location.pathname) {\n    history.push(url);\n  }\n}\n\nconst getAncestorNodes = (\n  pathway: Pathway,\n  rootNodeKey: string,\n  currNodeKey: string\n): Array<PathwayNode> => {\n  let ancestors: Array<PathwayNode> = [];\n  let previousNodes: Array<PathwayNode> = [];\n  const currNode = pathway.nodes[currNodeKey];\n\n  currNode.transitions.forEach(transition => {\n    if (transition.transition === rootNodeKey) ancestors.push(currNode);\n    else {\n      previousNodes = getAncestorNodes(pathway, rootNodeKey, transition.transition);\n      if (previousNodes?.length) {\n        if (!ancestors.some(node => node.key === currNode.key)) ancestors.push(currNode);\n        ancestors = ancestors.concat(previousNodes);\n      }\n    }\n  });\n\n  return ancestors;\n};\n\nexport const getConnectableNodes = (\n  pathway: Pathway,\n  rootNode: PathwayNode\n): Array<{ label: string; value: string }> => {\n  const connectableNodes: Array<{ label: string; value: string }> = [];\n  const ancestorNodes = getAncestorNodes(pathway, rootNode.key ?? '', 'Start');\n  ancestorNodes.push(rootNode);\n\n  Object.keys(pathway.nodes).forEach(nodeKey => {\n    const node = pathway.nodes[nodeKey];\n    const rootNodeConnectsToNode = rootNode.transitions.some(\n      transition => transition.transition === nodeKey\n    );\n    const nodeIsAncestor = ancestorNodes.some(node => node.key === nodeKey);\n    if (!rootNodeConnectsToNode && !nodeIsAncestor && node.key)\n      connectableNodes.push({ label: node.label, value: node.key });\n  });\n\n  return connectableNodes;\n};\n","import { Action, Pathway } from 'pathways-model';\nimport {\n  ActivityDefinition,\n  PlanDefinition,\n  PlanDefinitionAction,\n  Bundle,\n  BundleEntry,\n  Library\n} from 'fhir-objects';\nimport { v4 as uuidv4 } from 'uuid';\nimport { isActionNode, findParents, isBranchNode } from './nodeUtils';\nimport { R4 } from '@ahryman40k/ts-fhir-types';\n\nconst LIBRARY_DRAFT = R4.LibraryStatusKind._draft;\nconst PLANDEFINITION_DRAFT = R4.PlanDefinitionStatusKind._draft;\nconst ACTIVITYDEFINITION_DRAFT = R4.ActivityDefinitionStatusKind._draft;\nconst BUNDLE_TRANSACTION = R4.BundleTypeKind._transaction;\nconst BUNDLE_PUT = R4.Bundle_RequestMethodKind._put;\nconst CONDITION_APPLICABILITY = R4.PlanDefinition_ConditionKindKind._applicability; // eslint-disable-line\nconst EXPRESSION_CQL = R4.ExpressionLanguageKind._textCql;\n\nexport function createActivityDefinition(action: Action): ActivityDefinition {\n  const activityId = uuidv4();\n  const kind =\n    action.resource.resourceType === 'Procedure' ? 'ServiceRequest' : action.resource.resourceType;\n\n  const activityDefinition: ActivityDefinition = {\n    id: activityId,\n    resourceType: 'ActivityDefinition',\n    meta: {\n      profile: ['http://hl7.org/fhir/uv/cpg/StructureDefinition/cpg-publishableactivity']\n    },\n    extension: [\n      {\n        url: 'http://hl7.org/fhir/uv/cpg/StructureDefinition/cpg-knowledgeCapability',\n        valueCode: 'publishable'\n      }\n    ],\n    url: `urn:uuid:${activityId}`,\n    version: '1.0',\n    name: `AD${activityId.substring(0, 7)}`,\n    title: `ActivityDefinition: ${activityId}`,\n    status: ACTIVITYDEFINITION_DRAFT,\n    experimental: true,\n    date: new Date().toISOString(),\n    publisher: 'Logged in user',\n    description: action.description,\n    kind: kind,\n    productCodeableConcept:\n      action.resource.resourceType === 'MedicationRequest'\n        ? action.resource.medicationCodeableConcept\n        : action.resource.code\n  };\n\n  return activityDefinition;\n}\n\nfunction createAction(id: string, description: string, definition: string): PlanDefinitionAction {\n  const cpgAction: PlanDefinitionAction = {\n    id: id,\n    title: `Action: ${id}`,\n    description: description,\n    code: [\n      {\n        coding: [\n          {\n            system: 'http://hl7.org/fhir/uv/cpg/CodeSystem/cpg-common-process',\n            code: 'guideline-based-care',\n            display: 'Guideline-based Care'\n          }\n        ]\n      }\n    ],\n    definitionCanonical: `http://pathway.com/${definition}`\n  };\n  return cpgAction;\n}\n\nexport function createPlanDefinition(\n  id: string,\n  title: string,\n  description: string,\n  type: 'strategy' | 'recommendation',\n  libraryId?: string\n): PlanDefinition {\n  const planDefinition: PlanDefinition = {\n    id: id,\n    resourceType: 'PlanDefinition',\n    meta: {\n      profile: [`http://hl7.org/fhir/uv/cpg/StructureDefinition/cpg-${type}definition`]\n    },\n    extension: [\n      {\n        url: 'http://hl7.org/fhir/uv/cpg/StructureDefinition/cpg-knowledgeCapability',\n        valueCode: 'executable'\n      }\n    ],\n    url: `urn:uuid:${id}`,\n    version: '1.0',\n    name: `PD${id.substring(0, 7)}`,\n    title: title,\n    type: {\n      coding: [\n        {\n          system: 'http://terminology.hl7.org/CodeSystem/plan-definition-type',\n          code: type === 'strategy' ? 'workflow-definition' : 'eca-rule',\n          display: type === 'strategy' ? 'Workflow Definition' : 'ECA Rule'\n        }\n      ]\n    },\n    status: PLANDEFINITION_DRAFT,\n    experimental: true,\n    publisher: 'Logged in user',\n    description: description,\n    action: []\n  };\n\n  if (type === 'strategy' && libraryId) {\n    planDefinition.library = [libraryId];\n  }\n\n  return planDefinition;\n}\n\nfunction createBundleEntry(resource: PlanDefinition | ActivityDefinition | Library): BundleEntry {\n  return {\n    fullUrl: `http://pathway.com/${resource.id}`,\n    resource: resource,\n    request: {\n      method: BUNDLE_PUT,\n      url: `/${resource.resourceType}/${resource.id}`\n    }\n  };\n}\n\nfunction createLibrary(pathway: Pathway): Library {\n  const libraryId = uuidv4();\n\n  const library: Library = {\n    id: libraryId,\n    resourceType: 'Library',\n    meta: {\n      profile: ['http://hl7.org/fhir/uv/cpg/StructureDefinition/cpg-executablelibrary']\n    },\n    extension: [\n      {\n        url: 'http://hl7.org/fhir/uv/cpg/StructureDefinition/cpg-knowledgeCapability',\n        valueCode: 'executable'\n      }\n    ],\n    url: `urn:uuid:${libraryId}`,\n    version: '1.0',\n    name: `LIB${libraryId.substring(0, 7)}`,\n    title: `Library for ${pathway.name}`,\n    status: LIBRARY_DRAFT,\n    experimental: true,\n    type: {\n      coding: [\n        {\n          system: 'http://terminology.hl7.org/CodeSystem/library-type',\n          code: 'logic-library',\n          display: 'Logic Library'\n        }\n      ]\n    },\n    publisher: 'Logged in user',\n    description: `ELM library for pathway: ${pathway.name}`,\n    content: []\n  };\n\n  if (pathway.elm) {\n    library.content.push(\n      {\n        id: 'navigational',\n        contentType: 'application/elm+json',\n        data: btoa(JSON.stringify(pathway.elm.navigational)),\n        title: 'ELM for navigating the pathway'\n      },\n      {\n        id: 'precondition',\n        contentType: 'application/elm+json',\n        data: btoa(JSON.stringify(pathway.elm.preconditions)),\n        title: 'ELM for pathway preconditions'\n      }\n    );\n  }\n\n  return library;\n}\n\nexport function toCPG(pathway: Pathway): Bundle {\n  const bundle: Bundle = {\n    id: pathway.id,\n    resourceType: 'Bundle',\n    type: BUNDLE_TRANSACTION,\n    entry: []\n  };\n  const library = createLibrary(pathway);\n  const cpgStrategy = createPlanDefinition(\n    uuidv4(),\n    pathway.name,\n    pathway.description ?? `Pathway For: ${pathway.name}`,\n    'strategy',\n    library.id\n  );\n\n  Object.keys(pathway.nodes).forEach(key => {\n    const node = pathway.nodes[key];\n    if (isActionNode(node) && node.key) {\n      const description = `Represents an action for ${node.label}`;\n      const cpgRecommendation = createPlanDefinition(\n        uuidv4(),\n        node.label,\n        description,\n        'recommendation'\n      );\n      const cpgStrategyAction = createAction(node.key, node.label, cpgRecommendation.id);\n      const parents = findParents(pathway, node.key).map(key => pathway.nodes[key]);\n      parents.forEach(parent => {\n        const transition = parent.transitions.find(\n          transition => transition.transition === node.key\n        );\n        if (isBranchNode(parent) && transition?.condition) {\n          const condition = {\n            kind: CONDITION_APPLICABILITY,\n            expression: {\n              language: EXPRESSION_CQL,\n              expression: transition.condition.cql\n            }\n          };\n          cpgStrategyAction.condition = cpgStrategyAction.condition || [];\n          cpgStrategyAction.condition?.push(condition);\n        }\n      });\n      node.action.forEach(action => {\n        const cpgActivityDefinition = createActivityDefinition(action);\n        const cpgRecommendationAction = createAction(\n          action.id ?? uuidv4(),\n          action.description,\n          cpgActivityDefinition.id\n        );\n        cpgRecommendation.action.push(cpgRecommendationAction);\n        bundle.entry.push(createBundleEntry(cpgActivityDefinition));\n      });\n      cpgStrategy.action.push(cpgStrategyAction);\n      bundle.entry.push(createBundleEntry(cpgRecommendation));\n    }\n  });\n  bundle.entry.push(createBundleEntry(library));\n  bundle.entry.push(createBundleEntry(cpgStrategy));\n\n  return bundle;\n}\n","import {\n  Pathway,\n  Precondition,\n  PathwayNode,\n  Transition,\n  Action,\n  ActionNode,\n  BranchNode\n} from 'pathways-model';\nimport { ElmLibrary, ElmStatement } from 'elm-model';\nimport shortid from 'shortid';\nimport { MedicationRequest, ServiceRequest } from 'fhir-objects';\nimport produce from 'immer';\nimport { toCPG } from './cpg';\n\nexport function createNewPathway(name: string, description?: string, pathwayId?: string): Pathway {\n  return {\n    id: pathwayId ?? shortid.generate(),\n    name: name,\n    description: description ?? '',\n    library: '',\n    preconditions: [],\n    nodes: {\n      Start: {\n        key: 'Start',\n        label: 'Start',\n        transitions: []\n      }\n    }\n  };\n}\n\nexport function downloadPathway(pathway: Pathway, cpg = false): void {\n  const pathwayString = exportPathway(pathway, cpg);\n  // Create blob from pathwayString to save to file system\n  const pathwayBlob = new Blob([pathwayString], {\n    type: 'application/json'\n  });\n  // Temporarily create hidden <a> tag to download pathwayBlob\n  // File name is set to <pathway-name>.json\n  const url = window.URL.createObjectURL(pathwayBlob);\n  const a = document.createElement('a');\n  a.href = url;\n  a.download = `${pathway.name}.json`;\n  a.click();\n  window.URL.revokeObjectURL(url);\n}\n\nexport function exportPathway(pathway: Pathway, cpg: boolean): string {\n  if (cpg) return JSON.stringify(toCPG(pathway), undefined, 2);\n\n  const elm: ElmLibrary = {\n    library: {\n      identifier: {\n        id: pathway.id,\n        version: '1.0.0'\n      },\n      schemaIdentifier: {\n        id: 'urn:hl7-org:elm',\n        version: 'r1'\n      },\n      usings: {\n        def: [\n          {\n            localIdentifier: 'System',\n            uri: 'urn:hl7-org:elm-types:r1'\n          },\n          {\n            localId: '1',\n            locator: '3:1-3:26',\n            localIdentifier: 'FHIR',\n            uri: 'http://hl7.org/fhir',\n            version: '4.0.0'\n          }\n        ]\n      },\n      statements: {\n        def: [\n          {\n            locator: '13:1-13:15',\n            name: 'Patient',\n            context: 'Patient',\n            expression: {\n              type: 'SingletonFrom',\n              operand: {\n                locator: '13:1-13:15',\n                dataType: '{http://hl7.org/fhir}Patient',\n                type: 'Retrieve'\n              }\n            }\n          }\n        ]\n      },\n      includes: { def: [] },\n      valueSets: { def: [] },\n      codes: { def: [] },\n      codeSystems: { def: [] }\n    }\n  };\n\n  const pathwayToExport: Pathway = {\n    ...pathway,\n    // Strip id from each precondition\n    preconditions: pathway.preconditions.map((precondition: Precondition) => ({\n      ...precondition,\n      id: undefined\n    })),\n    nodes: { ...pathway.nodes }\n  };\n\n  Object.keys(pathwayToExport.nodes).forEach((nodeKey: string) => {\n    const node = pathway.nodes[nodeKey];\n    if ('elm' in node && node.elm && node.key) {\n      mergeElm(elm, node.elm);\n      const elmStatement = produce(getElmStatement(node.elm), (draftElmStatement: ElmStatement) => {\n        // state.key is defined due to if statement above\n        // eslint-disable-next-line\n        draftElmStatement.name = node.key!;\n      });\n      elm.library.statements.def.push(elmStatement);\n    }\n\n    pathwayToExport.nodes[nodeKey] = {\n      ...pathwayToExport.nodes[nodeKey],\n      // Strip key from each node\n      key: undefined,\n      elm: undefined,\n      // Strip id from each node.transition\n      transitions: node.transitions.map((transition: Transition) => {\n        if (transition.condition?.elm) {\n          // Add tranistion.condition.elm to elm\n          mergeElm(elm, transition.condition.elm);\n          const elmStatement = produce(\n            getElmStatement(transition.condition.elm),\n            (draftElmStatement: ElmStatement) => {\n              draftElmStatement.name = transition.condition?.description ?? 'Unknown';\n            }\n          );\n          elm.library.statements.def.push(elmStatement);\n        }\n        return {\n          ...transition,\n          id: undefined,\n          condition: transition.condition ? { ...transition.condition, elm: undefined } : undefined\n        };\n      }),\n      // Strip id from each node.action\n      action:\n        (node as ActionNode).action == null\n          ? undefined\n          : (node as ActionNode).action.map((action: Action) => ({\n              ...action,\n              id: undefined\n            }))\n    };\n  });\n\n  return JSON.stringify(setNavigationalElm(pathwayToExport, elm), undefined, 2);\n}\n\nfunction mergeElm(elm: ElmLibrary, additionalElm: ElmLibrary): void {\n  // Merge usings\n  additionalElm.library.usings?.def.forEach(using => {\n    // Check if it is in ELM\n    if (!elm.library.usings?.def.find(def => def.uri === using.uri))\n      elm.library.usings?.def.push(using);\n  });\n\n  // Merge includes\n  additionalElm.library.includes?.def.forEach(include => {\n    if (!elm.library.includes?.def.find(def => def.path === include.path))\n      elm.library.includes?.def.push(include);\n  });\n\n  // Merge valueSets\n  additionalElm.library.valueSets?.def.forEach(valueSet => {\n    if (!elm.library.valueSets?.def.find(def => def.id === valueSet.id))\n      elm.library.valueSets?.def.push(valueSet);\n  });\n  // Merge codes\n  additionalElm.library.codes?.def.forEach(code => {\n    if (!elm.library.codes?.def.find(def => def.name === code.name))\n      elm.library.codes?.def.push(code);\n  });\n  // Merge codesystems\n  additionalElm.library.codeSystems?.def.forEach(codesystem => {\n    if (!elm.library.codeSystems?.def.find(def => def.name === codesystem.name))\n      elm.library.codeSystems?.def.push(codesystem);\n  });\n\n  // TODO: merge concepts\n}\n\nfunction getElmStatement(elm: ElmLibrary): ElmStatement {\n  const defaultStatementNames = [\n    'Patient',\n    'MeetsInclusionCriteria',\n    'InPopulation',\n    'Recommendation',\n    'Rationale',\n    'Errors'\n  ];\n  const elmStatement = elm.library.statements.def.find(\n    def => !defaultStatementNames.includes(def.name)\n  );\n\n  // elmStatement type is ElmStatement | undefined but criteria\n  // provider validates such a statement exists in the elm\n  return elmStatement as ElmStatement;\n}\n\n// TODO: possibly add more precondition methods\nexport function addPrecondition(\n  pathway: Pathway,\n  elementName: string,\n  expected: string,\n  cql: string\n): string {\n  const id = shortid.generate();\n  const precondition: Precondition = {\n    id: id,\n    elementName: elementName,\n    expected: expected,\n    cql: cql\n  };\n  pathway.preconditions.push(precondition);\n\n  return id;\n}\n\nexport function setNavigationalElm(pathway: Pathway, elm: object): Pathway {\n  return produce(pathway, (draftPathway: Pathway) => {\n    if (!draftPathway.elm) draftPathway.elm = {};\n    draftPathway.elm.navigational = elm;\n  });\n}\n\nexport function setPreconditionElm(pathway: Pathway, elm: object): Pathway {\n  return produce(pathway, (draftPathway: Pathway) => {\n    if (!draftPathway.elm) draftPathway.elm = {};\n    draftPathway.elm.preconditions = elm;\n  });\n}\n\nexport function createNode(key?: string): PathwayNode {\n  if (!key) key = shortid.generate();\n  const node: PathwayNode = {\n    key,\n    label: 'New Node',\n    transitions: [],\n    nodeTypeIsUndefined: true\n  };\n\n  return node;\n}\n\nexport function addNode(pathway: Pathway, node: PathwayNode): Pathway {\n  return produce(pathway, (draftPathway: Pathway) => {\n    draftPathway.nodes[node.key as string] = node;\n  });\n}\n\nexport function addActionNode(pathway: Pathway): Pathway {\n  const node = createNode();\n  const newPathway = addNode(pathway, node);\n\n  return makeNodeAction(newPathway, node.key as string);\n}\n\nexport function setNodeLabel(pathway: Pathway, key: string, label: string): Pathway {\n  return produce(pathway, (draftPathway: Pathway) => {\n    draftPathway.nodes[key].label = label;\n  });\n}\n\nexport function setNodeType(pathway: Pathway, nodeKey: string, nodeType: string): Pathway {\n  let action: Action;\n  let newPathway: Pathway;\n  switch (nodeType) {\n    case 'MedicationRequest':\n      newPathway = makeNodeAction(pathway, nodeKey);\n      action = {\n        type: 'create',\n        description: '',\n        id: shortid.generate(),\n        resource: {\n          resourceType: nodeType,\n          medicationCodeableConcept: {\n            coding: [\n              {\n                system: '',\n                code: '',\n                display: ''\n              }\n            ]\n          }\n        }\n      };\n      return setNodeAction(newPathway, nodeKey, [action]);\n    case 'ServiceRequest':\n      newPathway = makeNodeAction(pathway, nodeKey);\n      action = {\n        type: 'create',\n        description: '',\n        id: shortid.generate(),\n        resource: {\n          resourceType: nodeType,\n          code: {\n            coding: [\n              {\n                system: '',\n                code: '',\n                display: ''\n              }\n            ]\n          }\n        }\n      };\n      return setNodeAction(newPathway, nodeKey, [action]);\n    case 'CarePlan':\n      newPathway = makeNodeAction(pathway, nodeKey);\n      action = {\n        type: 'create',\n        description: '',\n        id: shortid.generate(),\n        resource: {\n          resourceType: nodeType,\n          title: ''\n        }\n      };\n      return setNodeAction(newPathway, nodeKey, [action]);\n    case 'Observation':\n      return makeNodeBranch(pathway, nodeKey);\n    default:\n      console.error('Unknown nodeType: ' + nodeType);\n      return pathway;\n  }\n}\n\nexport function setNodeCriteriaSource(\n  pathway: Pathway,\n  key: string,\n  criteriaSource: string\n): Pathway {\n  return produce(pathway, (draftPathway: Pathway) => {\n    (draftPathway.nodes[key] as BranchNode).criteriaSource = criteriaSource;\n  });\n}\n\nexport function setNodeAction(pathway: Pathway, key: string, action: Action[]): Pathway {\n  return produce(pathway, (draftPathway: Pathway) => {\n    (draftPathway.nodes[key] as ActionNode).action = action;\n  });\n}\n\nexport function setNodeMcodeCriteria(\n  pathway: Pathway,\n  key: string,\n  mcodeCriteria: string\n): Pathway {\n  return produce(pathway, (draftPathway: Pathway) => {\n    (draftPathway.nodes[key] as BranchNode).mcodeCriteria = mcodeCriteria;\n  });\n}\n\nexport function setNodeOtherCriteria(\n  pathway: Pathway,\n  key: string,\n  otherCriteria: string\n): Pathway {\n  return produce(pathway, (draftPathway: Pathway) => {\n    (draftPathway.nodes[key] as BranchNode).otherCriteria = otherCriteria;\n  });\n}\n\nexport function addTransition(pathway: Pathway, startNodeKey: string, endNodeKey: string): Pathway {\n  return produce(pathway, (draftPathway: Pathway) => {\n    const transition: Transition = {\n      id: shortid.generate(),\n      transition: endNodeKey\n    };\n\n    draftPathway.nodes[startNodeKey].transitions.push(transition);\n  });\n}\n\nexport function setTransitionCondition(\n  pathway: Pathway,\n  startNodeKey: string,\n  transitionId: string,\n  description: string,\n  elm: ElmLibrary,\n  criteriaLabel?: string\n): Pathway {\n  return produce(pathway, (draftPathway: Pathway) => {\n    const foundTransition = draftPathway.nodes[startNodeKey]?.transitions?.find(\n      (transition: Transition) => transition.id === transitionId\n    );\n\n    const cql = criteriaLabel ? criteriaLabel : getElmStatement(elm).name;\n\n    if (foundTransition)\n      foundTransition.condition = {\n        description: description,\n        cql: cql,\n        elm: elm\n      };\n  });\n}\n\nexport function setActionNodeElm(pathway: Pathway, nodeKey: string, elm: ElmLibrary): Pathway {\n  return produce(pathway, (draftPathway: Pathway) => {\n    (draftPathway.nodes[nodeKey] as ActionNode).elm = elm;\n    (draftPathway.nodes[nodeKey] as ActionNode).cql = getElmStatement(elm).name;\n  });\n}\n\n// TODO: possibly add more action methods\nexport function addAction(\n  pathway: Pathway,\n  key: string,\n  type: string,\n  description: string,\n  resource: MedicationRequest | ServiceRequest\n): string {\n  const id = shortid.generate();\n  const action = {\n    id: id,\n    type: type,\n    description: description,\n    resource: resource\n  };\n\n  const node = produce(pathway.nodes[key] as ActionNode, (draftState: ActionNode) => {\n    draftState.action.push(action);\n  });\n  pathway.nodes[key] = node;\n\n  return id;\n}\n\nexport function getNodeType(pathway: Pathway, key: string | undefined): string {\n  if (!key) {\n    return 'null';\n  }\n  const node = pathway.nodes[key];\n  if (!node || node.nodeTypeIsUndefined) {\n    return 'null';\n  } else if (!(node as ActionNode).action && key !== 'Start') {\n    return 'branch';\n  } else {\n    return 'action';\n  }\n}\n\n/*\nSet Element Functions\n*/\nexport function setPathwayName(pathway: Pathway, name: string): Pathway {\n  return produce(pathway, (draftPathway: Pathway) => {\n    draftPathway.name = name;\n  });\n}\n\nexport function setPathwayDescription(pathway: Pathway, description: string): Pathway {\n  return produce(pathway, (draftPathway: Pathway) => {\n    draftPathway.description = description;\n  });\n}\n\nexport function setLibrary(pathway: Pathway, library: string): Pathway {\n  return produce(pathway, (draftPathway: Pathway) => {\n    draftPathway.library = library;\n  });\n}\n\nexport function setTransition(\n  pathway: Pathway,\n  startNodeKey: string,\n  endNodeKey: string,\n  transitionId: string\n): Pathway {\n  return produce(pathway, (draftPathway: Pathway) => {\n    const transition = draftPathway.nodes[startNodeKey]?.transitions?.find(\n      (transition: Transition) => transition.id === transitionId\n    );\n    if (transition) transition.transition = endNodeKey;\n  });\n}\n\nexport function setTransitionConditionDescription(\n  pathway: Pathway,\n  startNodeKey: string,\n  transitionId: string,\n  description: string\n): Pathway {\n  return produce(pathway, (draftPathway: Pathway) => {\n    const foundTransition = draftPathway.nodes[startNodeKey]?.transitions?.find(\n      (transition: Transition) => transition.id === transitionId\n    );\n\n    if (foundTransition?.condition) {\n      foundTransition.condition.description = description;\n    } else if (foundTransition) {\n      foundTransition.condition = {\n        description: description,\n        cql: ''\n      };\n    }\n  });\n}\n\nexport function setTransitionConditionElm(\n  pathway: Pathway,\n  startNodeKey: string,\n  transitionId: string,\n  elm: ElmLibrary\n): Pathway {\n  return produce(pathway, (draftPathway: Pathway) => {\n    const foundTransition = draftPathway.nodes[startNodeKey]?.transitions?.find(\n      (transition: Transition) => transition.id === transitionId\n    );\n\n    if (foundTransition?.condition) {\n      foundTransition.condition.elm = elm;\n      foundTransition.condition.cql = getElmStatement(elm).name;\n    }\n  });\n}\n\nexport function setActionType(\n  pathway: Pathway,\n  nodeKey: string,\n  actionId: string,\n  type: string\n): Pathway {\n  return produce(pathway, (draftPathway: Pathway) => {\n    if ((draftPathway.nodes[nodeKey] as ActionNode).action) {\n      const action = (draftPathway.nodes[nodeKey] as ActionNode).action.find(\n        (action: Action) => action.id === actionId\n      );\n      if (action) action.type = type;\n    }\n  });\n}\n\nexport function setActionDescription(\n  pathway: Pathway,\n  nodeKey: string,\n  actionId: string,\n  description: string\n): Pathway {\n  return produce(pathway, (draftPathway: Pathway) => {\n    const node = (draftPathway.nodes[nodeKey] as ActionNode).action;\n\n    if (node) {\n      const action = node.find((action: Action) => action.id === actionId);\n      if (action) {\n        action.description = description;\n      }\n    }\n  });\n}\n\nexport function setActionResource(\n  pathway: Pathway,\n  nodeKey: string,\n  actionId: string,\n  resource: MedicationRequest | ServiceRequest\n): Pathway {\n  return produce(pathway, (draftPathway: Pathway) => {\n    if ((draftPathway.nodes[nodeKey] as ActionNode).action) {\n      const action = (draftPathway.nodes[nodeKey] as ActionNode).action.find(\n        (action: Action) => action.id === actionId\n      );\n      if (action) action.resource = resource;\n    }\n  });\n}\n\nexport function setActionResourceDisplay(action: Action, display: string): Action {\n  return produce(action, (draftAction: Action) => {\n    if (draftAction.resource.medicationCodeableConcept) {\n      draftAction.resource.medicationCodeableConcept.coding[0].display = display;\n    } else if (draftAction.resource.title) {\n      draftAction.resource.description = display;\n    } else {\n      draftAction.resource.code.coding[0].display = display;\n    }\n  });\n}\n\nexport function makeNodeAction(pathway: Pathway, nodeKey: string): Pathway {\n  return produce(pathway, (draftPathway: Pathway) => {\n    const node = draftPathway.nodes[nodeKey] as ActionNode;\n\n    if (node.cql === undefined && node.action === undefined) {\n      node.cql = '';\n      node.action = [];\n      node.nodeTypeIsUndefined = undefined;\n    }\n\n    node.transitions.forEach(transition => {\n      delete transition.condition;\n    });\n  });\n}\n\nexport function makeNodeBranch(pathway: Pathway, nodeKey: string): Pathway {\n  return produce(pathway, (draftPathway: Pathway) => {\n    const node = draftPathway.nodes[nodeKey] as ActionNode;\n\n    if (\n      node.cql !== undefined ||\n      node.elm !== undefined ||\n      node.action !== undefined ||\n      node.nodeTypeIsUndefined !== undefined\n    ) {\n      delete node.cql;\n      delete node.elm;\n      delete node.action;\n      delete node.nodeTypeIsUndefined;\n    }\n  });\n}\n\nexport function createCQL(action: Action, nodeKey: string): string {\n  const resource = action.resource;\n  // CQl identifier cannot start with a number or contain '-'\n  const cqlId = `cql${shortid.generate().replace(/-/g, 'a')}`;\n  let cql = `library ${cqlId} version '1'\\nusing FHIR version '4.0.0'\\n`;\n\n  const codesystemStatement = (system: string): string => `codesystem \"${system}\": '${system}'\\n`;\n\n  const returnStatement = (resourceType: string): string =>\n    `return Tuple{ resourceType: '${resourceType}', id: R.id.value, status: R.status.value}`;\n\n  const retrieveStatement = (resourceType: string): string => `[${resourceType}: \"${cqlId} code\"]`;\n\n  const defineStatement = (): string => `define \"${nodeKey}\":`;\n\n  if (resource.resourceType === 'MedicationRequest') {\n    const coding = resource.medicationCodeableConcept.coding[0];\n\n    cql += codesystemStatement(coding.system);\n\n    // eslint-disable-next-line\n    cql += `code \"${cqlId} code\": '${escape(coding.code)}' from \"${coding.system}\" display '${\n      coding.display\n    }'\\n`;\n    cql += `${defineStatement()}\n      ${retrieveStatement('MedicationRequest')} R ${returnStatement('MedicationRequest')}`;\n  } else if (resource.resourceType === 'ServiceRequest') {\n    const coding = resource.code.coding[0];\n\n    cql += codesystemStatement(coding.system);\n\n    // eslint-disable-next-line\n    cql += `code \"${cqlId} code\": '${escape(coding.code)}' from \"${coding.system}\" display '${\n      coding.display\n    }'\\n`;\n    cql += `${defineStatement()}\n      if exists ${retrieveStatement('Procedure')} \n      then ${retrieveStatement('Procedure')} R ${returnStatement('Procedure')} \n      else ${retrieveStatement('ServiceRequest')} R ${returnStatement('ServiceRequest')}`;\n  } else if (resource.resourceType === 'CarePlan') {\n    cql += `${defineStatement()}\n      [CarePlan] R where R.title.value = '${escape(resource.title)}' ${returnStatement(\n      'CarePlan'\n    )}`;\n  } else {\n    console.error(\n      'Auto generating CQL for action - unsupported resource type: ' + resource.resourceType\n    );\n  }\n\n  return cql;\n}\n\n/*\nRemove Element Function\n*/\nexport function removePathwayDescription(pathway: Pathway): Pathway {\n  return produce(pathway, (draftPathway: Pathway) => {\n    delete draftPathway.description;\n  });\n}\n\nexport function removePrecondition(pathway: Pathway, id: string): Pathway {\n  return produce(pathway, (draftPathway: Pathway) => {\n    const preconditions = draftPathway.preconditions.filter(\n      (precondition: Precondition) => precondition.id !== id\n    );\n    draftPathway.preconditions = preconditions;\n  });\n}\n\nexport function removeNavigationalElm(pathway: Pathway): Pathway {\n  return produce(pathway, (draftPathway: Pathway) => {\n    delete draftPathway.elm?.navigational;\n  });\n}\n\nexport function removePreconditionElm(pathway: Pathway): Pathway {\n  return produce(pathway, (draftPathway: Pathway) => {\n    delete draftPathway.elm?.preconditions;\n  });\n}\n\nexport function removeNode(pathway: Pathway, key: string): Pathway {\n  return produce(pathway, (draftPathway: Pathway) => {\n    delete draftPathway.nodes[key];\n\n    Object.keys(draftPathway.nodes).forEach((nodeKey: string) => {\n      const node = draftPathway.nodes[nodeKey];\n      node.transitions.forEach((transition: Transition) => {\n        if (transition.transition === key)\n          draftPathway.nodes[nodeKey].transitions = draftPathway.nodes[nodeKey].transitions.filter(\n            (filterTransition: Transition) => transition.id !== filterTransition.id\n          );\n      });\n    });\n  });\n}\n\nexport function removeTransitionCondition(\n  pathway: Pathway,\n  nodeKey: string,\n  transitionId: string\n): Pathway {\n  return produce(pathway, (draftPathway: Pathway) => {\n    const transition = draftPathway.nodes[nodeKey].transitions.find(\n      (transition: Transition) => transition.id === transitionId\n    );\n    if (transition) delete transition.condition;\n  });\n}\n\nexport function removeTransition(\n  pathway: Pathway,\n  parentNodeKey: string,\n  childNodeKey: string\n): Pathway {\n  return produce(pathway, (draftPathway: Pathway) => {\n    const transitions = draftPathway.nodes[parentNodeKey].transitions.filter(\n      (transition: Transition) => transition.transition !== childNodeKey\n    );\n    draftPathway.nodes[parentNodeKey].transitions = transitions;\n  });\n}\n\nexport function removeAction(pathway: Pathway, nodeKey: string, actionId: string): Pathway {\n  return produce(pathway, (draftPathway: Pathway) => {\n    if ((draftPathway.nodes[nodeKey] as ActionNode).action) {\n      const actions = (draftPathway.nodes[nodeKey] as ActionNode).action.filter(\n        (action: Action) => action.id !== actionId\n      );\n      (draftPathway.nodes[nodeKey] as ActionNode).action = actions;\n    }\n  });\n}\n","import React, { FC, memo } from 'react';\nimport { Menu, MenuItem } from '@material-ui/core';\nimport { useCurrentPathwayContext } from 'components/CurrentPathwayProvider';\nimport { downloadPathway } from 'utils/builder';\n\ninterface ExportMenuPropsInterface {\n  anchorEl: HTMLElement | null;\n  closeMenu: () => void;\n}\n\nconst ExportMenu: FC<ExportMenuPropsInterface> = ({ anchorEl, closeMenu }) => {\n  const { pathway } = useCurrentPathwayContext();\n\n  return (\n    <Menu\n      id=\"pathway-options-menu\"\n      anchorEl={anchorEl}\n      getContentAnchorEl={null}\n      anchorOrigin={{ vertical: 'bottom', horizontal: 'left' }}\n      keepMounted\n      open={Boolean(anchorEl)}\n      onClose={closeMenu}\n    >\n      <MenuItem\n        onClick={(): void => {\n          if (pathway) downloadPathway(pathway);\n          else alert('No pathway to download!');\n          closeMenu();\n        }}\n      >\n        Export Pathway\n      </MenuItem>\n      <MenuItem\n        onClick={(): void => {\n          if (pathway) downloadPathway(pathway, true);\n          else alert('No pathway to download!');\n          closeMenu();\n        }}\n      >\n        Export to CPG\n      </MenuItem>\n    </Menu>\n  );\n};\n\nexport default memo(ExportMenu);\n","import React, { FC, useCallback, useState, MouseEvent } from 'react';\nimport { useHistory } from 'react-router-dom';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport { faChevronLeft, faEllipsisH } from '@fortawesome/free-solid-svg-icons';\nimport { IconButton } from '@material-ui/core';\n\nimport { useBuildCriteriaContext } from 'components/BuildCriteriaProvider';\nimport useStyles from './styles';\nimport { useCurrentPathwayContext } from 'components/CurrentPathwayProvider';\nimport ExportMenu from 'components/elements/ExportMenu';\n\nconst Navigation: FC = () => {\n  const { updateBuildCriteriaNodeId } = useBuildCriteriaContext();\n  const [anchorEl, setAnchorEl] = useState<null | HTMLElement>(null);\n  const { pathway } = useCurrentPathwayContext();\n  const styles = useStyles();\n  const history = useHistory();\n\n  const openMenu = useCallback((event: MouseEvent<HTMLButtonElement>): void => {\n    setAnchorEl(event.currentTarget);\n  }, []);\n\n  const closeMenu = useCallback((): void => {\n    setAnchorEl(null);\n  }, []);\n\n  const handleGoBack = useCallback((): void => {\n    updateBuildCriteriaNodeId('');\n    history.push('/');\n  }, [history, updateBuildCriteriaNodeId]);\n\n  return (\n    <nav className={styles.root}>\n      <div>\n        <IconButton className={styles.backButton} onClick={handleGoBack} aria-label=\"go back\">\n          <FontAwesomeIcon icon={faChevronLeft} className={styles.navigationIcons} />\n        </IconButton>\n\n        <span className={styles.pathwayName}>{pathway?.name}</span>\n      </div>\n      <IconButton onClick={openMenu} aria-controls=\"pathway-options-menu\" aria-haspopup=\"true\">\n        <FontAwesomeIcon icon={faEllipsisH} className={styles.navigationIcons} />\n      </IconButton>\n      <ExportMenu anchorEl={anchorEl} closeMenu={closeMenu} />\n    </nav>\n  );\n};\n\nexport default Navigation;\n","import { useState, useEffect } from 'react';\nimport { Service } from 'pathways-objects';\n\nfunction getObject(url: string): Promise<Response> {\n  return fetch(url, {\n    headers: {\n      Accept: 'application/json'\n    }\n  });\n}\n\nfunction typedFetch<T>(url: string, options?: object): Promise<T> {\n  return fetch(url, options).then(response => response.json() as Promise<T>);\n}\n\nfunction useGetService<T>(url: string): Service<Array<T>> {\n  const [result, setResult] = useState<Service<Array<T>>>({\n    status: 'loading'\n  });\n\n  useEffect(() => {\n    getObject(url)\n      .then(response => response.json() as Promise<string[]>)\n      .then(listOfFiles => listOfFiles.map(f => typedFetch<T>(url + '/' + f)))\n      .then(listOfPromises => Promise.all(listOfPromises))\n      .then(list => setResult({ status: 'loaded', payload: list }))\n      .catch(error => setResult({ status: 'error', error }));\n  }, [url]);\n\n  return result;\n}\n\nexport default useGetService;\n","import React, {\n  FC,\n  memo,\n  createContext,\n  useCallback,\n  useContext,\n  useEffect,\n  ReactNode\n} from 'react';\nimport { Pathway } from 'pathways-model';\nimport { ServiceLoaded } from 'pathways-objects';\nimport config from 'utils/ConfigManager';\nimport useGetService from './Services';\nimport useRefState from 'utils/useRefState';\n\ninterface PathwaysContextInterface {\n  pathways: Pathway[];\n  status: string;\n  addPathway: (pathway: Pathway) => void;\n  deletePathway: (id: string) => void;\n  updatePathway: (pathway: Pathway) => void;\n}\n\nexport const PathwaysContext = createContext<PathwaysContextInterface>(\n  {} as PathwaysContextInterface\n);\n\ninterface PathwaysProviderProps {\n  children: ReactNode;\n}\n\nexport const PathwaysProvider: FC<PathwaysProviderProps> = memo(function PathwaysProvider({\n  children\n}) {\n  const [pathways, pathwaysRef, setPathways] = useRefState<Pathway[]>([]);\n  const service = useGetService<Pathway>(config.get('demoPathwaysService'));\n  const servicePayload = (service as ServiceLoaded<Pathway[]>).payload;\n\n  const addPathway = useCallback(\n    (pathway: Pathway) => {\n      setPathways((currentPathways: Pathway[]) => [...currentPathways, pathway]);\n    },\n    [setPathways]\n  );\n\n  const deletePathway = useCallback(\n    (id: string) => {\n      setPathways((currentPathways: Pathway[]) =>\n        currentPathways.filter(pathway => pathway.id !== id)\n      );\n    },\n    [setPathways]\n  );\n\n  const updatePathway = useCallback(\n    (newPathway: Pathway) => {\n      const index = pathwaysRef.current.findIndex(pathway => pathway.id === newPathway.id);\n      setPathways((currentPathways: Pathway[]) => [\n        ...currentPathways.slice(0, index),\n        newPathway,\n        ...currentPathways.slice(index + 1)\n      ]);\n    },\n    [pathwaysRef, setPathways]\n  );\n\n  useEffect(() => {\n    if (servicePayload) setPathways(servicePayload);\n  }, [servicePayload, setPathways]);\n\n  switch (service.status) {\n    case 'error':\n      return <div>Error loading pathways</div>;\n\n    default:\n      return (\n        <PathwaysContext.Provider\n          value={{\n            pathways,\n            addPathway,\n            deletePathway,\n            updatePathway,\n            status: service.status\n          }}\n        >\n          {children}\n        </PathwaysContext.Provider>\n      );\n  }\n});\n\nexport const usePathwaysContext = (): PathwaysContextInterface => useContext(PathwaysContext);\n","import { makeStyles, Theme as AugmentedTheme } from '@material-ui/core/styles';\n\nexport default makeStyles(\n  (theme: AugmentedTheme) => ({\n    root: {\n      display: 'flex',\n      flexDirection: 'column',\n      padding: theme.variables.spacing.globalPadding,\n      color: theme.palette.text.primary,\n      backgroundColor: theme.palette.common.gray,\n      width: '33%',\n      minWidth: '550px',\n      overflowY: 'scroll',\n      float: 'left'\n    },\n    formControl: {\n      margin: theme.spacing(1, 0),\n      minWidth: 375\n    },\n    divider: {\n      width: '100%'\n    },\n    headerLabelStart: {\n      cursor: 'default'\n    },\n    displayText: {\n      margin: '0 0 5px 0',\n      fontWeight: 900,\n      fontSize: '1em'\n    },\n    sidebarHeader: {\n      display: 'flex',\n      justifyContent: 'space-between'\n    },\n    sidebarHeaderGroup: {\n      display: 'flex',\n      alignItems: 'center'\n    },\n    sidebarHeaderButton: {\n      height: '45px',\n      width: '45px',\n      color: theme.palette.text.primary\n    },\n    headerLabelGroup: {\n      display: 'flex',\n      cursor: 'pointer',\n      height: '60px'\n    },\n    headerLabel: {\n      display: 'flex',\n      alignItems: 'center',\n      fontSize: '1.6em',\n      fontWeight: 700,\n      margin: '0 5px'\n    },\n    headerLabelText: {\n      marginBottom: '5px'\n    },\n    editIcon: {\n      fontSize: '0.6em',\n      marginLeft: '10px'\n    },\n    sidebarButtonGroup: {\n      display: 'flex',\n      margin: '10px 0'\n    },\n    sidebarButtonGroupExtraMargin: {\n      display: 'flex',\n      margin: '20px 0 10px 0'\n    },\n    sidebarButton: {\n      minWidth: 180,\n      marginRight: '20px'\n    },\n    sidebarButtonText: {\n      fontStyle: 'italic'\n    },\n    outlinedDiv: {\n      display: 'flex',\n      flexDirection: 'column',\n      alignItems: 'flex-start',\n      '& div': {\n        width: '100%'\n      }\n    },\n    outlinedDivError: {\n      borderColor: `${theme.palette.error.main} !important`,\n      '&:hover': {\n        borderColor: `${theme.palette.error.main} !important`\n      }\n    },\n    toggleSidebar: {\n      display: 'inline-flex',\n      alignItems: 'center',\n      justifyContent: 'center',\n      float: 'left',\n      width: '50px',\n      minWidth: '50px',\n      height: '50px',\n      fontSize: '2em',\n      backgroundColor: theme.palette.primary.main,\n      color: theme.palette.text.primary,\n      '&:hover': {\n        cursor: 'pointer'\n      }\n    },\n    cancelButton: {\n      alignSelf: 'flex-end',\n      marginTop: '5px',\n      padding: '5px 15px',\n      fontSize: '1em'\n    },\n    buildCriteriaContainer: {\n      display: 'flex',\n      justifyContent: 'space-between'\n    },\n    saveButton: {\n      marginLeft: '1em'\n    },\n    transitionContainer: {\n      backgroundColor: theme.palette.common.grayVeryDark,\n      padding: '5px 15px',\n      margin: '15px 0'\n    },\n    dividerHeader: {\n      width: '100%',\n      textTransform: 'uppercase',\n      borderBottom: '1px solid ' + theme.palette.common.blueLighter,\n      color: theme.palette.common.blueLighter,\n      lineHeight: '0.1em',\n      margin: '10px 0 20px',\n      fontWeight: 800,\n      paddingLeft: '15px',\n      '& span': {\n        background: theme.palette.common.gray,\n        padding: '0 10px'\n      }\n    },\n    dialogCloseButton: {\n      float: 'right',\n      width: '45px'\n    },\n    dialogContent: {\n      color: theme.palette.common.black,\n      fontSize: '16px',\n      display: 'flex',\n      marginTop: '-25px'\n    },\n    dialogContentText: {\n      paddingLeft: '10px',\n      lineHeight: '40px'\n    },\n    alertIcon: {\n      color: theme.palette.common.red,\n      fontSize: '40px'\n    },\n    connectDropdown: {\n      margin: 'auto',\n      display: 'flex',\n      flexDirection: 'column',\n      flexWrap: 'nowrap',\n      alignContent: 'center'\n    },\n    connectText: {\n      display: 'flex',\n      flexDirection: 'row',\n      alignItems: 'center',\n      fontSize: '0.95em',\n      fontStyle: 'italic'\n    },\n    cancelButtonDropdown: {\n      marginLeft: 'auto',\n      border: 'none',\n      alignSelf: 'center',\n      color: theme.palette.common.blueLighter,\n      fontSize: '1em',\n      fontStyle: 'italic',\n      textTransform: 'none'\n    }\n  }),\n  { name: 'Sidebar', index: 1 }\n);\n","import React, {\n  MutableRefObject,\n  createContext,\n  useCallback,\n  memo,\n  ReactNode,\n  FC,\n  useContext\n} from 'react';\nimport { PathwayNode } from 'pathways-model';\nimport useRefState from 'utils/useRefState';\n\ninterface CurrentNodeContextInterface {\n  currentNode: PathwayNode | null;\n  currentNodeRef: MutableRefObject<PathwayNode | null>;\n  setCurrentNode: (value: PathwayNode) => void;\n}\n\nexport const CurrentNodeContext = createContext<CurrentNodeContextInterface>(\n  {} as CurrentNodeContextInterface\n);\n\ninterface CurrentNodeProviderProps {\n  children: ReactNode;\n}\n\nexport const CurrentNodeProvider: FC<CurrentNodeProviderProps> = memo(({ children }) => {\n  const [currentNode, currentNodeRef, _setCurrentNode] = useRefState<PathwayNode | null>(null);\n\n  const setCurrentNode = useCallback(\n    (value: PathwayNode) => {\n      _setCurrentNode(value);\n    },\n    [_setCurrentNode]\n  );\n\n  return (\n    <CurrentNodeContext.Provider value={{ currentNode, currentNodeRef, setCurrentNode }}>\n      {children}\n    </CurrentNodeContext.Provider>\n  );\n});\n\nexport const useCurrentNodeContext = (): CurrentNodeContextInterface =>\n  useContext(CurrentNodeContext);\n","import React, { FC, memo, useCallback, ChangeEvent } from 'react';\nimport { InputLabel, FormControl, Select, MenuItem } from '@material-ui/core';\n\ninterface Option {\n  label: string;\n  value: string;\n}\n\ninterface DropDownProps {\n  id: string;\n  label: string;\n  options: Array<Option>;\n  value?: string;\n  onChange: Function | null;\n}\n\nconst DropDown: FC<DropDownProps> = ({ id, label, options, value, onChange }: DropDownProps) => {\n  const handleSetSelected = useCallback(\n    (event: ChangeEvent<{ value: unknown }>): void => {\n      if (onChange) onChange(event);\n    },\n    [onChange]\n  );\n\n  return (\n    <FormControl variant=\"outlined\" fullWidth>\n      <InputLabel id={id} htmlFor={`${id}-select`}>\n        {label}\n      </InputLabel>\n\n      <Select\n        id={`${id}-select`}\n        value={value || ''}\n        onChange={handleSetSelected}\n        label={label}\n        error={value == null || value === ''}\n        MenuProps={{\n          getContentAnchorEl: null,\n          anchorOrigin: {\n            vertical: 'bottom',\n            horizontal: 'center'\n          },\n          transformOrigin: {\n            vertical: 'top',\n            horizontal: 'center'\n          }\n        }}\n        displayEmpty\n      >\n        {options.map(option => (\n          <MenuItem key={option.value} value={option.value}>\n            {option.label}\n          </MenuItem>\n        ))}\n      </Select>\n    </FormControl>\n  );\n};\n\nexport default memo(DropDown);\n","import React, {\n  FC,\n  createContext,\n  useState,\n  memo,\n  ReactNode,\n  useContext,\n  useCallback\n} from 'react';\n\ninterface SnackbarContextInterface {\n  snackbarText: string;\n  openSnackbar: boolean;\n  handleCloseSnackbar: () => void;\n  setSnackbarText: (value: string) => void;\n  setOpenSnackbar: (value: boolean) => void;\n}\n\nexport const SnackbarContext = createContext<SnackbarContextInterface>(\n  {} as SnackbarContextInterface\n);\n\ninterface SnackbarProviderProps {\n  children: ReactNode;\n}\n\nexport const SnackbarProvider: FC<SnackbarProviderProps> = memo(({ children }) => {\n  const [openSnackbar, setOpenSnackbar] = useState<boolean>(false);\n  const [snackbarText, setSnackbarText] = useState<string>('Deleted Successfully');\n\n  const handleCloseSnackbar = useCallback(() => {\n    setOpenSnackbar(false);\n  }, [setOpenSnackbar]);\n\n  return (\n    <SnackbarContext.Provider\n      value={{ snackbarText, openSnackbar, handleCloseSnackbar, setSnackbarText, setOpenSnackbar }}\n    >\n      {children}\n    </SnackbarContext.Provider>\n  );\n});\n\nexport const useSnackbarContext = (): SnackbarContextInterface => useContext(SnackbarContext);\n","import React, { FC, memo } from 'react';\nimport { Snackbar, Button, IconButton } from '@material-ui/core';\nimport { useSnackbarContext } from 'components/SnackbarProvider';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport { faTimes } from '@fortawesome/free-solid-svg-icons';\n\nconst DeleteSnackbar: FC = () => {\n  const { snackbarText, openSnackbar, handleCloseSnackbar } = useSnackbarContext();\n\n  return (\n    <Snackbar\n      anchorOrigin={{\n        vertical: 'bottom',\n        horizontal: 'right'\n      }}\n      open={openSnackbar}\n      autoHideDuration={10000}\n      onClose={handleCloseSnackbar}\n      message={snackbarText}\n      action={\n        <React.Fragment>\n          <Button color=\"secondary\" size=\"small\" onClick={handleCloseSnackbar}>\n            UNDO\n          </Button>\n          <IconButton size=\"small\" aria-label=\"close\" color=\"inherit\" onClick={handleCloseSnackbar}>\n            <FontAwesomeIcon icon={faTimes} />\n          </IconButton>\n        </React.Fragment>\n      }\n    />\n  );\n};\n\nexport default memo(DeleteSnackbar);\n","import React, { useState, memo, useCallback, ChangeEvent, FC } from 'react';\nimport { SidebarButton } from 'components/Sidebar';\nimport DropDown from 'components/elements/DropDown';\nimport useStyles from './styles';\nimport { addTransition } from 'utils/builder';\nimport { usePathwaysContext } from 'components/PathwaysProvider';\nimport { getConnectableNodes } from 'utils/nodeUtils';\nimport { useCurrentPathwayContext } from 'components/CurrentPathwayProvider';\nimport { useCurrentNodeContext } from 'components/CurrentNodeProvider';\n\nimport { faLevelDownAlt } from '@fortawesome/free-solid-svg-icons';\nimport { Button } from '@material-ui/core';\n\nconst ConnectNodeButton: FC = () => {\n  const { pathway, pathwayRef } = useCurrentPathwayContext();\n  const { currentNode, currentNodeRef } = useCurrentNodeContext();\n  const { updatePathway } = usePathwaysContext();\n\n  const styles = useStyles();\n  const [open, setOpen] = useState(false);\n\n  const options: Array<{ label: string; value: string }> =\n    currentNode && pathway ? getConnectableNodes(pathway, currentNode) : [];\n  const optionsAvailable = options.length > 0;\n\n  const connectToNode = useCallback(\n    (event: ChangeEvent<{ value: string }>): void => {\n      const nodeKey = event?.target.value;\n      if (pathwayRef.current && currentNodeRef.current?.key)\n        updatePathway(addTransition(pathwayRef.current, currentNodeRef.current.key, nodeKey));\n      setOpen(false);\n    },\n    [updatePathway, currentNodeRef, pathwayRef]\n  );\n\n  const showDropdown = useCallback(() => {\n    setOpen(!open);\n  }, [open]);\n\n  return (\n    <div>\n      {!open && (\n        <SidebarButton\n          buttonName=\"Connect Node\"\n          buttonIcon={faLevelDownAlt}\n          buttonText=\"Create a transition to an existing node in the pathway.\"\n          onClick={showDropdown}\n          disabled={!optionsAvailable}\n          hasTooltip={!optionsAvailable}\n          tooltipTitle=\"There are no possible nodes to connect to.\"\n        />\n      )}\n      {open && optionsAvailable && (\n        <div className={styles.connectDropdown}>\n          <DropDown\n            id=\"transitions\"\n            label=\"Node To Connect To\"\n            options={options}\n            onChange={connectToNode}\n          />\n          <div className={styles.connectText}>\n            Select node from list to add transition.\n            <Button\n              className={styles.cancelButtonDropdown}\n              size=\"small\"\n              variant=\"text\"\n              onClick={showDropdown}\n            >\n              Cancel\n            </Button>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default memo(ConnectNodeButton);\n","import React, {\n  FC,\n  memo,\n  useCallback,\n  useState,\n  useEffect,\n  useRef,\n  RefObject,\n  ChangeEvent\n} from 'react';\nimport { useHistory } from 'react-router-dom';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport { faChevronLeft, faChevronRight, faPlus } from '@fortawesome/free-solid-svg-icons';\nimport {\n  SidebarHeader,\n  ActionNodeEditor,\n  SidebarButton,\n  TransitionEditor,\n  BranchTransition\n} from 'components/Sidebar';\nimport { setNodeType, addTransition, createNode, addNode, getNodeType } from 'utils/builder';\nimport { usePathwaysContext } from 'components/PathwaysProvider';\nimport useStyles from './styles';\nimport { useCurrentPathwayContext } from 'components/CurrentPathwayProvider';\nimport { useCurrentNodeContext } from 'components/CurrentNodeProvider';\nimport { isBranchNode, redirect } from 'utils/nodeUtils';\nimport { nodeTypeOptions } from 'utils/nodeUtils';\nimport DropDown from 'components/elements/DropDown';\nimport DeleteSnackbar from './DeleteSnackbar';\nimport ConnectNodeButton from 'components/Sidebar/ConnectNodeButton';\n\ninterface SidebarProps {\n  headerElement: RefObject<HTMLDivElement>;\n}\n\nconst Sidebar: FC<SidebarProps> = ({ headerElement }) => {\n  const { updatePathway } = usePathwaysContext();\n  const { pathway, pathwayRef } = useCurrentPathwayContext();\n  const { currentNode, currentNodeRef } = useCurrentNodeContext();\n  const [isExpanded, setIsExpanded] = useState<boolean>(true);\n  const styles = useStyles();\n  const history = useHistory();\n  const sidebarContainerElement = useRef<HTMLDivElement>(null);\n\n  const toggleSidebar = useCallback((): void => {\n    setIsExpanded(!isExpanded);\n  }, [isExpanded]);\n\n  const changeNodeType = useCallback(\n    (nodeType: string): void => {\n      if (currentNodeRef.current?.key && pathwayRef.current)\n        updatePathway(setNodeType(pathwayRef.current, currentNodeRef.current.key, nodeType));\n    },\n    [pathwayRef, updatePathway, currentNodeRef]\n  );\n\n  const selectNodeType = useCallback(\n    (event: ChangeEvent<{ value: string }>): void => {\n      changeNodeType(event?.target.value || '');\n    },\n    [changeNodeType]\n  );\n\n  const addPathwayNode = useCallback((): void => {\n    if (!currentNodeRef.current?.key || !pathwayRef.current) return;\n\n    const newNode = createNode();\n    let newPathway = addNode(pathwayRef.current, newNode);\n    newPathway = addTransition(newPathway, currentNodeRef.current.key, newNode.key as string);\n    updatePathway(newPathway);\n    if (!isBranchNode(currentNodeRef.current) && newNode.key)\n      redirect(pathwayRef.current.id, newNode.key, history);\n  }, [pathwayRef, updatePathway, currentNodeRef, history]);\n\n  // Set the height of the sidebar container\n  useEffect(() => {\n    const resize = (): void => {\n      if (sidebarContainerElement?.current && headerElement?.current)\n        sidebarContainerElement.current.style.height =\n          window.innerHeight - headerElement.current.clientHeight + 'px';\n    };\n    resize();\n    window.addEventListener('resize', resize);\n    return (): void => window.removeEventListener('resize', resize);\n  }, [isExpanded, headerElement]);\n\n  if (!pathway) return <div>Error: No pathway</div>;\n  if (!currentNode) return <div>Error: No current node</div>;\n\n  if (currentNode.key === 'Start') {\n    return (\n      <>\n        {isExpanded && (\n          <div className={styles.root} ref={sidebarContainerElement}>\n            <SidebarHeader node={currentNode} isTransition={false} />\n            <h5 className={styles.dividerHeader}>\n              <></>{' '}\n            </h5>\n            <SidebarButton\n              buttonName=\"Add Node\"\n              buttonIcon={faPlus}\n              buttonText=\"Add a new transition to a new node in the pathway.\"\n              onClick={addPathwayNode}\n            />\n          </div>\n        )}\n\n        <DeleteSnackbar />\n      </>\n    );\n  } else {\n    const nodeType = getNodeType(pathway, currentNode.key);\n    const displayTransitions =\n      currentNode.key !== undefined &&\n      (currentNode.key !== 'Start' || currentNode.transitions.length === 0);\n\n    return (\n      <>\n        {isExpanded && (\n          <div className={styles.root} ref={sidebarContainerElement}>\n            <SidebarHeader node={currentNode} isTransition={false} />\n\n            <h5 className={styles.dividerHeader}>\n              <span>Details</span>\n            </h5>\n\n            {nodeType === 'null' && (\n              <DropDown\n                id=\"nodeType\"\n                label=\"Node Type\"\n                options={nodeTypeOptions}\n                onChange={selectNodeType}\n                value=\"\"\n              />\n            )}\n\n            {nodeType === 'action' && <ActionNodeEditor changeNodeType={changeNodeType} />}\n\n            {nodeType === 'branch' && (\n              <DropDown\n                id=\"nodeType\"\n                label=\"Node Type\"\n                options={nodeTypeOptions}\n                onChange={selectNodeType}\n                value=\"Observation\"\n              />\n            )}\n\n            <h5 className={styles.dividerHeader}>\n              <span>Transitions</span>\n            </h5>\n\n            {currentNode?.transitions.map(transition => {\n              return (\n                <TransitionEditor key={transition.id} transition={transition}>\n                  {nodeType === 'branch' && (\n                    <BranchTransition key={transition.id} transition={transition} />\n                  )}\n                </TransitionEditor>\n              );\n            })}\n\n            {displayTransitions && (\n              <>\n                <SidebarButton\n                  buttonName=\"Add New Node\"\n                  buttonIcon={faPlus}\n                  buttonText=\"Add a new transition to a new node in the pathway.\"\n                  onClick={addPathwayNode}\n                />\n                <ConnectNodeButton />\n              </>\n            )}\n          </div>\n        )}\n        <div className={styles.toggleSidebar} onClick={toggleSidebar}>\n          <FontAwesomeIcon icon={isExpanded ? faChevronLeft : faChevronRight} />\n        </div>\n        <DeleteSnackbar />\n      </>\n    );\n  }\n};\n\nexport default memo(Sidebar);\n","import React, { FC, memo, useCallback, useRef, useState, KeyboardEvent, FocusEvent } from 'react';\nimport clsx from 'clsx';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport {\n  faEdit,\n  faChevronLeft,\n  faChevronRight,\n  faTrashAlt\n} from '@fortawesome/free-solid-svg-icons';\nimport { IconButton, FormControl, Input, Tooltip } from '@material-ui/core';\n\nimport { PathwayNode } from 'pathways-model';\nimport { setNodeLabel, removeNode, removeTransition } from 'utils/builder';\nimport { usePathwaysContext } from 'components/PathwaysProvider';\nimport useStyles from './styles';\nimport { useCurrentPathwayContext } from 'components/CurrentPathwayProvider';\nimport { useHistory } from 'react-router-dom';\nimport { canDeleteNode, redirect, findParents, willOrphanChild } from 'utils/nodeUtils';\nimport { DeleteModal } from '.';\nimport { useCurrentNodeContext } from 'components/CurrentNodeProvider';\nimport { useSnackbarContext } from 'components/SnackbarProvider';\n\ninterface SidebarHeaderProps {\n  node: PathwayNode;\n  isTransition?: boolean;\n}\n\nconst SidebarHeader: FC<SidebarHeaderProps> = ({ node, isTransition = false }) => {\n  const { updatePathway } = usePathwaysContext();\n  const [showInput, setShowInput] = useState<boolean>(false);\n  const [openTooltip, setOpenTooltip] = useState<boolean>(false);\n  const [openDelete, setOpenDelete] = useState<boolean>(false);\n  const { currentNodeRef } = useCurrentNodeContext();\n  const { setSnackbarText, setOpenSnackbar } = useSnackbarContext();\n  const { pathway, pathwayRef } = useCurrentPathwayContext();\n  const inputRef = useRef<HTMLInputElement>(null);\n  const nodeLabel = node?.label || '';\n  const styles = useStyles();\n  const history = useHistory();\n\n  const goToParentNode = useCallback(() => {\n    if (!pathwayRef.current || !node.key) return;\n    const parents = findParents(pathwayRef.current, node.key);\n    redirect(pathwayRef.current.id, parents[0], history);\n  }, [history, pathwayRef, node.key]);\n\n  const redirectToNode = useCallback(() => {\n    if (!pathwayRef.current || !node.key) return;\n    redirect(pathwayRef.current.id, node.key, history);\n  }, [history, pathwayRef, node.key]);\n\n  const changeNodeLabel = useCallback(() => {\n    const label = inputRef.current?.value ?? '';\n    if (node.key && pathwayRef.current)\n      updatePathway(setNodeLabel(pathwayRef.current, node.key, label));\n    setShowInput(false);\n  }, [pathwayRef, updatePathway, node.key]);\n\n  const handleShowInput = useCallback(() => {\n    setShowInput(true);\n  }, []);\n\n  const deleteNode = useCallback(() => {\n    if (node.key && pathwayRef.current && canDeleteNode(pathwayRef.current, node.transitions)) {\n      const parents = findParents(pathwayRef.current, node.key);\n      updatePathway(removeNode(pathwayRef.current, node.key));\n      redirect(pathwayRef.current.id, parents[0], history);\n      setOpenDelete(false);\n      setSnackbarText(`${node.label} node deleted successfully`);\n      setOpenSnackbar(true);\n    }\n  }, [\n    pathwayRef,\n    updatePathway,\n    setSnackbarText,\n    setOpenSnackbar,\n    node.key,\n    node.label,\n    node.transitions,\n    history\n  ]);\n\n  const deleteTransition = useCallback(() => {\n    if (\n      node.key &&\n      currentNodeRef.current?.key &&\n      pathwayRef.current &&\n      !willOrphanChild(pathwayRef.current, node.key)\n    ) {\n      updatePathway(removeTransition(pathwayRef.current, currentNodeRef.current.key, node.key));\n      setOpenDelete(false);\n      setSnackbarText(\n        `Transition from ${currentNodeRef.current.label} to ${node.label} deleted successfully`\n      );\n      setOpenSnackbar(true);\n    }\n  }, [pathwayRef, currentNodeRef, updatePathway, setSnackbarText, setOpenSnackbar, node]);\n\n  const openDeleteModal = useCallback((): void => {\n    setOpenDelete(true);\n  }, []);\n\n  const closeDeleteModal = useCallback((): void => {\n    setOpenDelete(false);\n  }, []);\n\n  const handleOpenTooltip = useCallback((): void => {\n    setOpenTooltip(true);\n  }, []);\n\n  const handleCloseTooltip = useCallback((): void => {\n    setOpenTooltip(false);\n  }, []);\n\n  const handleKeyPress = useCallback(\n    (event: KeyboardEvent<HTMLDivElement>): void => {\n      if (event.key === 'Enter') changeNodeLabel();\n    },\n    [changeNodeLabel]\n  );\n\n  const deleteNodeDisabled = pathway ? !canDeleteNode(pathway, node.transitions) : true;\n  const deleteTransitionDisabled = pathway && node.key ? willOrphanChild(pathway, node.key) : true;\n  const deleteDisabled = isTransition ? deleteTransitionDisabled : deleteNodeDisabled;\n  const titleText = isTransition\n    ? 'Deleting this transition would result in an orphaned node. To delete, first add the child node as a transition to another node, or delete it directly.'\n    : 'Deleting this node would result in an orphaned descendent node. To delete, first add another transition to the would-be orphaned node from another node, or delete it directly.';\n\n  return (\n    <div className={styles.sidebarHeader}>\n      <div className={styles.sidebarHeaderGroup}>\n        {node.key !== 'Start' && !isTransition && (\n          <IconButton\n            className={styles.sidebarHeaderButton}\n            onClick={goToParentNode}\n            aria-label=\"go to parent node\"\n          >\n            <FontAwesomeIcon icon={faChevronLeft} />\n          </IconButton>\n        )}\n\n        <div className={styles.headerLabelGroup} onClick={handleShowInput}>\n          {showInput && node.key !== 'Start' ? (\n            <FormControl className={styles.formControl} fullWidth>\n              <Input\n                className={styles.headerLabel}\n                type=\"text\"\n                inputRef={inputRef}\n                onBlur={changeNodeLabel}\n                onKeyPress={handleKeyPress}\n                defaultValue={nodeLabel}\n                autoFocus\n                onFocus={(event: FocusEvent<HTMLInputElement>): void => event.target.select()}\n              />\n            </FormControl>\n          ) : (\n            <div\n              className={clsx(\n                styles.headerLabel,\n                styles.headerLabelText,\n                node.key === 'Start' && styles.headerLabelStart\n              )}\n            >\n              {nodeLabel}\n              {node.key !== 'Start' && (\n                <FontAwesomeIcon className={styles.editIcon} icon={faEdit} />\n              )}\n            </div>\n          )}\n        </div>\n      </div>\n\n      <div className={styles.sidebarHeaderGroup}>\n        {node.key !== 'Start' && (\n          <Tooltip\n            placement=\"top\"\n            open={deleteDisabled ? openTooltip : false}\n            onClose={handleCloseTooltip}\n            onOpen={handleOpenTooltip}\n            title={titleText}\n            arrow\n          >\n            <span>\n              <IconButton\n                className={styles.sidebarHeaderButton}\n                onClick={openDeleteModal}\n                aria-label={isTransition ? 'delete transition' : 'delete node'}\n                disabled={deleteDisabled}\n              >\n                <FontAwesomeIcon icon={faTrashAlt} />\n              </IconButton>\n            </span>\n          </Tooltip>\n        )}\n\n        {isTransition && (\n          <IconButton\n            className={styles.sidebarHeaderButton}\n            onClick={redirectToNode}\n            aria-label={'go to transition node'}\n          >\n            <FontAwesomeIcon icon={faChevronRight} />\n          </IconButton>\n        )}\n      </div>\n\n      <DeleteModal\n        nodeLabel={node.label}\n        isTransition={isTransition}\n        open={openDelete}\n        onDelete={isTransition ? deleteTransition : deleteNode}\n        onClose={closeDeleteModal}\n      />\n    </div>\n  );\n};\n\nexport default memo(SidebarHeader);\n","import React, { FC, memo } from 'react';\nimport { Button, Tooltip } from '@material-ui/core';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport { IconDefinition } from '@fortawesome/fontawesome-svg-core';\n\nimport useStyles from './styles';\n\ninterface SidebarButtonProps {\n  buttonName: string;\n  buttonIcon: IconDefinition;\n  buttonText: string;\n  extraMargin?: boolean;\n  onClick?: () => void;\n  hasTooltip?: boolean;\n  tooltipTitle?: string;\n  disabled?: boolean;\n}\n\nconst SidebarButton: FC<SidebarButtonProps> = ({\n  buttonName,\n  buttonIcon,\n  buttonText,\n  extraMargin = false,\n  onClick,\n  hasTooltip = false,\n  tooltipTitle = '',\n  disabled = false\n}) => {\n  const styles = useStyles();\n\n  const ConditionalTooltip: FC = ({ children }) =>\n    hasTooltip ? (\n      <Tooltip title={tooltipTitle} placement=\"top\">\n        <span>{children}</span>\n      </Tooltip>\n    ) : (\n      <>{children}</>\n    );\n\n  return (\n    <div className={extraMargin ? styles.sidebarButtonGroupExtraMargin : styles.sidebarButtonGroup}>\n      <ConditionalTooltip>\n        <Button\n          className={styles.sidebarButton}\n          variant=\"contained\"\n          color=\"primary\"\n          startIcon={<FontAwesomeIcon icon={buttonIcon} />}\n          onClick={onClick}\n          disabled={disabled}\n        >\n          {buttonName}\n        </Button>\n      </ConditionalTooltip>\n      <div className={styles.sidebarButtonText}>{buttonText}</div>\n    </div>\n  );\n};\n\nexport default memo(SidebarButton);\n","// External CQL -> ELM service\nimport { CqlObject } from './cql-extractor';\nimport config from 'utils/ConfigManager';\nimport {\n  extractJSONContent,\n  extractMultipartBoundary,\n  extractMultipartFileName\n} from 'utils/regexes';\n\nconst url = config.get('cqlToElmWebserviceUrl');\n\nexport interface ElmObject {\n  main: object;\n  libraries: {\n    [key: string]: object;\n  };\n}\n\n/**\n * Function that requests web_service to convert the cql into elm.\n * @param cql - cql file that is the input to the function.\n * @return The resulting elm translation of the cql file.\n */\nexport default function convertCQL(cql: CqlObject): Promise<ElmObject> {\n  // Connect to web service\n  const formdata = new FormData();\n  Object.keys(cql.libraries).forEach((key, i) => {\n    formdata.append(`${key}`, cql.libraries[key]);\n  });\n\n  formdata.append('main', cql.main);\n  return fetch(url, {\n    method: 'POST',\n    body: formdata\n  }).then(elm => {\n    const header = elm.headers.get('content-type');\n    let boundary = '';\n    if (header) {\n      // sample header= \"multipart/form-data;boundary=Boundary_1\"\n      const result = extractMultipartBoundary.exec(header);\n      boundary = result ? `--${result[1]}` : '';\n    }\n    const obj: ElmObject = { main: {}, libraries: {} };\n    return elm.text().then(text => {\n      const elms = text.split(boundary).reduce((oldArray, line, i) => {\n        const body = extractJSONContent.exec(line);\n        if (body) {\n          const elmName = extractMultipartFileName.exec(line);\n          if (elmName && elmName[1] === 'main') {\n            oldArray[elmName[1]] = JSON.parse(body[1]);\n          } else if (elmName) {\n            oldArray.libraries[elmName[1]] = JSON.parse(body[1]);\n          }\n        }\n        return oldArray;\n      }, obj);\n\n      return elms;\n    });\n  });\n}\n\nexport function convertBasicCQL(cql: string): Promise<object> {\n  // Connect to web service\n\n  return fetch(url, {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/cql',\n      Accept: 'application/elm+json'\n    },\n    body: cql\n  }).then(elm => elm.json());\n}\n","import React, { FC, memo, useCallback, ChangeEvent } from 'react';\nimport { SidebarButton } from '.';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport { faCheckCircle } from '@fortawesome/free-solid-svg-icons';\nimport {\n  setNodeAction,\n  createCQL,\n  setActionNodeElm,\n  setActionResourceDisplay\n} from 'utils/builder';\nimport DropDown from 'components/elements/DropDown';\nimport { ActionNode, Action } from 'pathways-model';\nimport { ElmLibrary } from 'elm-model';\nimport useStyles from './styles';\nimport { TextField } from '@material-ui/core';\nimport { convertBasicCQL } from 'engine/cql-to-elm';\nimport { usePathwaysContext } from 'components/PathwaysProvider';\nimport { useCurrentPathwayContext } from 'components/CurrentPathwayProvider';\nimport produce from 'immer';\nimport { useCurrentNodeContext } from 'components/CurrentNodeProvider';\nimport { nodeTypeOptions } from 'utils/nodeUtils';\n\nconst codeSystemOptions = [\n  { label: 'ICD-9-CM', value: 'http://hl7.org/fhir/sid/icd-9-cm' },\n  { label: 'ICD-10-CM', value: 'http://hl7.org/fhir/sid/icd-10-cm' },\n  { label: 'LOINC', value: 'http://loinc.org' },\n  { label: 'NCI', value: 'http://ncimeta.nci.nih.gov' },\n  { label: 'RXNORM', value: 'http://www.nlm.nih.gov/research/umls/rxnorm' },\n  { label: 'SNOMED', value: 'http://snomed.info/sct' }\n];\n\ninterface ActionNodeEditorProps {\n  changeNodeType: (event: string) => void;\n}\n\nconst ActionNodeEditor: FC<ActionNodeEditorProps> = ({ changeNodeType }) => {\n  const { updatePathway } = usePathwaysContext();\n  const { pathwayRef } = useCurrentPathwayContext();\n  const { currentNode, currentNodeRef } = useCurrentNodeContext();\n  const styles = useStyles();\n\n  const selectNodeType = useCallback(\n    (event: ChangeEvent<{ value: string }>): void => {\n      changeNodeType(event?.target.value || '');\n    },\n    [changeNodeType]\n  );\n\n  const addActionCQL = useCallback(\n    (action: Action, currentNodeKey: string): void => {\n      if (!pathwayRef.current) return;\n\n      const cql = createCQL(action, currentNodeKey);\n      convertBasicCQL(cql).then(elm => {\n        // Disable lint for no-null assertion since it is already checked above\n        // eslint-disable-next-line\n        updatePathway(setActionNodeElm(pathwayRef.current!, currentNodeKey, elm as ElmLibrary));\n      });\n    },\n    [pathwayRef, updatePathway]\n  );\n\n  const changeCode = useCallback(\n    (event: ChangeEvent<{ value: string }>): void => {\n      if (!currentNodeRef.current?.key || !pathwayRef.current) return;\n\n      const code = event?.target.value || '';\n      const action = produce(\n        (currentNodeRef.current as ActionNode).action[0],\n        (draftAction: Action) => {\n          if (draftAction.resource.medicationCodeableConcept) {\n            draftAction.resource.medicationCodeableConcept.coding[0].code = code;\n          } else {\n            draftAction.resource.code.coding[0].code = code;\n          }\n        }\n      );\n      updatePathway(\n        setNodeAction(pathwayRef.current, currentNodeRef.current.key, [resetDisplay(action)])\n      );\n    },\n    [currentNodeRef, pathwayRef, updatePathway]\n  );\n\n  const changeDescription = useCallback(\n    (event: ChangeEvent<{ value: string }>): void => {\n      if (!currentNodeRef.current?.key || !pathwayRef.current) return;\n\n      const description = event?.target.value || '';\n      const action = produce(\n        (currentNodeRef.current as ActionNode).action[0],\n        (draftAction: Action) => {\n          draftAction.description = description;\n        }\n      );\n      updatePathway(setNodeAction(pathwayRef.current, currentNodeRef.current.key, [action]));\n    },\n    [currentNodeRef, pathwayRef, updatePathway]\n  );\n\n  const changeTitle = useCallback(\n    (event: ChangeEvent<{ value: string }>): void => {\n      if (!currentNodeRef.current?.key || !pathwayRef.current) return;\n\n      const title = event?.target.value || '';\n      const action = produce(\n        (currentNodeRef.current as ActionNode).action[0],\n        (draftAction: Action) => {\n          draftAction.resource.title = title;\n        }\n      );\n      updatePathway(\n        setNodeAction(pathwayRef.current, currentNodeRef.current.key, [resetDisplay(action)])\n      );\n\n      addActionCQL(action, currentNodeRef.current.key);\n    },\n    [currentNodeRef, pathwayRef, updatePathway, addActionCQL]\n  );\n\n  const selectCodeSystem = useCallback(\n    (event: ChangeEvent<{ value: string }>): void => {\n      if (!currentNodeRef.current?.key || !pathwayRef.current) return;\n\n      const codeSystem = event?.target.value || '';\n      const action = produce(\n        (currentNodeRef.current as ActionNode).action[0],\n        (draftAction: Action) => {\n          if (draftAction.resource.medicationCodeableConcept) {\n            draftAction.resource.medicationCodeableConcept.coding[0].system = codeSystem;\n          } else {\n            draftAction.resource.code.coding[0].system = codeSystem;\n          }\n        }\n      );\n      updatePathway(\n        setNodeAction(pathwayRef.current, currentNodeRef.current.key, [resetDisplay(action)])\n      );\n    },\n    [currentNodeRef, pathwayRef, updatePathway]\n  );\n\n  const validateFunction = useCallback((): void => {\n    if (\n      currentNodeRef.current?.key &&\n      (currentNodeRef.current as ActionNode).action.length &&\n      pathwayRef.current\n    ) {\n      const action = setActionResourceDisplay(\n        (currentNodeRef.current as ActionNode).action[0],\n        'Example Text'\n      );\n      updatePathway(setNodeAction(pathwayRef.current, currentNodeRef.current.key, [action]));\n\n      addActionCQL(action, currentNodeRef.current.key);\n    } else {\n      console.error('No Actions -- Cannot Validate');\n    }\n  }, [currentNodeRef, pathwayRef, updatePathway, addActionCQL]);\n\n  const resetDisplay = (action: Action): Action => {\n    return produce(action, (draftAction: Action) => {\n      if (draftAction.resource.medicationCodeableConcept) {\n        draftAction.resource.medicationCodeableConcept.coding[0].display = '';\n      } else if (draftAction.resource.resourceType === 'CarePlan') {\n        draftAction.resource.description = '';\n      } else {\n        draftAction.resource.code.coding[0].display = ''; // TODO: actually validate\n      }\n    });\n  };\n\n  const onEnter = (e: React.KeyboardEvent<HTMLInputElement>): void => {\n    if (e.key === 'Enter') {\n      validateFunction();\n    }\n  };\n\n  // The node has a key and is not the start node\n  const changeNodeTypeEnabled = currentNode?.key !== undefined && currentNode.key !== 'Start';\n  const action = (currentNode as ActionNode).action;\n  const resource = action?.length > 0 && action[0].resource;\n  let system = '';\n  let code = '';\n  let display = '';\n  if (resource.resourceType === 'MedicationRequest' || resource.resourceType === 'ServiceRequest') {\n    system = resource.code\n      ? resource.code.coding[0].system\n      : resource.medicationCodeableConcept.coding[0].system;\n    code = resource.code\n      ? resource.code.coding[0].code\n      : resource.medicationCodeableConcept.coding[0].code;\n    display = resource.code\n      ? resource.code.coding[0].display\n      : resource.medicationCodeableConcept.coding[0].display;\n  } else {\n    display = resource.description;\n  }\n\n  return (\n    <>\n      {changeNodeTypeEnabled && (\n        <>\n          <DropDown\n            id=\"nodeType\"\n            label=\"Node Type\"\n            options={nodeTypeOptions}\n            onChange={selectNodeType}\n            value={resource.resourceType}\n          />\n\n          {(resource.resourceType === 'MedicationRequest' ||\n            resource.resourceType === 'ServiceRequest') && (\n            <>\n              <DropDown\n                id=\"codeSystem\"\n                label=\"Code System\"\n                options={codeSystemOptions}\n                onChange={selectCodeSystem}\n                value={system}\n              />\n              {system && (\n                <TextField\n                  id=\"code-input\"\n                  label=\"Code\"\n                  value={code}\n                  onChange={changeCode}\n                  variant=\"outlined\"\n                  error={code === ''}\n                  inputProps={{ onKeyPress: onEnter }}\n                />\n              )}\n              {code && (\n                <>\n                  {display ? (\n                    <div className={styles.displayText}>\n                      <FontAwesomeIcon icon={faCheckCircle} /> {display}\n                    </div>\n                  ) : (\n                    <SidebarButton\n                      buttonName=\"Validate\"\n                      buttonIcon={faCheckCircle}\n                      buttonText={display || 'Check validation of the input system and code'}\n                      onClick={validateFunction}\n                    />\n                  )}\n\n                  <TextField\n                    id=\"description-input\"\n                    label=\"Description\"\n                    value={action[0].description || ''}\n                    onChange={changeDescription}\n                    variant=\"outlined\"\n                    error={action[0].description === ''}\n                  />\n                </>\n              )}\n            </>\n          )}\n\n          {resource.resourceType === 'CarePlan' && (\n            <>\n              <TextField\n                id=\"title-input\"\n                label=\"Title\"\n                value={resource.title || ''}\n                onChange={changeTitle}\n                variant=\"outlined\"\n                error={resource.title == null}\n                inputProps={{ onKeyPress: onEnter }}\n              />\n              {resource.title && (\n                <TextField\n                  id=\"description-input\"\n                  label=\"Description\"\n                  value={action[0].description || ''}\n                  onChange={changeDescription}\n                  variant=\"outlined\"\n                  error={action[0].description === ''}\n                />\n              )}\n            </>\n          )}\n        </>\n      )}\n    </>\n  );\n};\n\nexport default memo(ActionNodeEditor);\n","import React, {\n  createContext,\n  ReactNode,\n  FC,\n  useState,\n  memo,\n  useContext,\n  useCallback,\n  useEffect\n} from 'react';\nimport shortid from 'shortid';\nimport { ElmStatement } from 'elm-model';\nimport config from 'utils/ConfigManager';\nimport useGetService from './Services';\nimport { ServiceLoaded } from 'pathways-objects';\n\ninterface Criteria {\n  id: string;\n  label: string;\n  version: string;\n  modified: number;\n  elm: object;\n}\n\ninterface CriteriaContextInterface {\n  criteria: Criteria[];\n  addCriteria: (file: File) => void;\n  deleteCriteria: (id: string) => void;\n}\n\nexport const CriteriaContext = createContext<CriteriaContextInterface>(\n  {} as CriteriaContextInterface\n);\n\ninterface CriteriaProviderProps {\n  children: ReactNode;\n}\n\nfunction jsonToCriteria(rawElm: string): Criteria | undefined {\n  const elm = JSON.parse(rawElm);\n  if (!elm.library?.identifier) {\n    alert('Please upload ELM file');\n    return;\n  }\n  const defaultStatementNames = [\n    'Patient',\n    'MeetsInclusionCriteria',\n    'InPopulation',\n    'Recommendation',\n    'Rationale',\n    'Errors'\n  ];\n  const elmStatements: ElmStatement[] = elm.library.statements.def;\n  const elmStatement = elmStatements.find(def => !defaultStatementNames.includes(def.name));\n  if (!elmStatement) {\n    alert('No elm statement found in that file');\n    return;\n  }\n  const newCriteria: Criteria = {\n    id: shortid.generate(),\n    label: elm.library.identifier.id,\n    version: elm.library.identifier.version,\n    modified: Date.now(),\n    elm: elm\n  };\n  return newCriteria;\n}\n\nexport const CriteriaProvider: FC<CriteriaProviderProps> = memo(({ children }) => {\n  const [criteria, setCriteria] = useState<Criteria[]>([]);\n  const service = useGetService<Criteria>(config.get('demoCriteria'));\n  const payload = (service as ServiceLoaded<Criteria[]>).payload;\n\n  useEffect(() => {\n    if (payload) {\n      const newCriteria: Criteria[] = [];\n      payload.forEach(jsonCriterion => {\n        const criterion = jsonToCriteria(JSON.stringify(jsonCriterion));\n        if (criterion) newCriteria.push(criterion);\n      });\n      setCriteria(newCriteria);\n    }\n  }, [payload]);\n\n  const addCriteria = useCallback((file: File) => {\n    const reader = new FileReader();\n    reader.onload = (event: ProgressEvent<FileReader>): void => {\n      if (event.target?.result) {\n        const rawElm = event.target.result as string;\n        const newCriteria = jsonToCriteria(rawElm);\n        if (newCriteria) setCriteria(currentCriteria => [...currentCriteria, newCriteria]);\n      } else alert('Unable to read that file');\n    };\n    reader.readAsText(file);\n  }, []);\n\n  const deleteCriteria = useCallback((id: string) => {\n    setCriteria(currentCriteria => currentCriteria.filter(criteria => criteria.id !== id));\n  }, []);\n\n  return (\n    <CriteriaContext.Provider\n      value={{\n        criteria,\n        addCriteria,\n        deleteCriteria\n      }}\n    >\n      {children}\n    </CriteriaContext.Provider>\n  );\n});\n\nexport const useCriteriaContext = (): CriteriaContextInterface => useContext(CriteriaContext);\n","import React, {\n  FC,\n  memo,\n  useState,\n  useCallback,\n  ChangeEvent,\n  useEffect,\n  useMemo,\n  useRef\n} from 'react';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport { faSave, faTools, faTrashAlt, faThList } from '@fortawesome/free-solid-svg-icons';\nimport DropDown from 'components/elements/DropDown';\nimport { Button, Checkbox, FormControlLabel, TextField, Box } from '@material-ui/core';\nimport {\n  removeTransitionCondition,\n  setTransitionCondition,\n  setTransitionConditionDescription\n} from 'utils/builder';\nimport { OutlinedDiv, SidebarButton } from '.';\nimport { Transition } from 'pathways-model';\nimport { useCriteriaContext } from 'components/CriteriaProvider';\nimport { usePathwaysContext } from 'components/PathwaysProvider';\nimport useStyles from './styles';\nimport { useCurrentPathwayContext } from 'components/CurrentPathwayProvider';\nimport { useCurrentNodeContext } from 'components/CurrentNodeProvider';\nimport { useBuildCriteriaContext } from 'components/BuildCriteriaProvider';\n\ninterface BranchTransitionProps {\n  transition: Transition;\n}\n\nconst BranchTransition: FC<BranchTransitionProps> = ({ transition }) => {\n  const { updatePathway } = usePathwaysContext();\n  const { criteria } = useCriteriaContext();\n  const { buildCriteriaNodeId, updateBuildCriteriaNodeId } = useBuildCriteriaContext();\n  const { pathwayRef } = useCurrentPathwayContext();\n  const { currentNodeRef } = useCurrentNodeContext();\n  const criteriaOptions = useMemo(() => criteria.map(c => ({ value: c.id, label: c.label })), [\n    criteria\n  ]);\n  const criteriaAvailable = criteriaOptions.length > 0;\n  const styles = useStyles();\n  const [useCriteriaSelected, setUseCriteriaSelected] = useState<boolean>(false);\n  const criteriaDescription = transition.condition?.description;\n  const criteriaIsValid = criteriaDescription != null;\n  const criteriaDisplayIsValid = criteriaDescription && criteriaDescription !== '';\n  const hasCriteria = transition.condition?.cql || transition.condition?.description;\n  const buttonText = hasCriteria ? 'DELETE' : 'CANCEL';\n  const icon = hasCriteria ? <FontAwesomeIcon icon={faTrashAlt} /> : null;\n  const displayCriteria =\n    criteriaAvailable &&\n    (useCriteriaSelected || transition.condition?.cql || transition.condition?.description);\n  const [buildCriteriaSelected, setBuildCriteriaSelected] = useState<boolean>(false);\n  const [criteriaName, setCriteriaName] = useState<string>('');\n  const transitionRef = useRef(transition);\n\n  const handleUseCriteria = useCallback((): void => {\n    if (hasCriteria && transition.id && currentNodeRef.current?.key && pathwayRef.current) {\n      // delete the transition criteria\n      updatePathway(\n        removeTransitionCondition(pathwayRef.current, currentNodeRef.current.key, transition.id)\n      );\n      setUseCriteriaSelected(false);\n    } else {\n      setUseCriteriaSelected(!useCriteriaSelected);\n    }\n  }, [useCriteriaSelected, currentNodeRef, pathwayRef, hasCriteria, transition.id, updatePathway]);\n\n  const selectCriteriaSource = useCallback(\n    (event: ChangeEvent<{ value: string }>): void => {\n      if (!currentNodeRef.current?.key || !transitionRef.current.id || !pathwayRef.current) return;\n\n      const criteriaSource = event?.target.value || '';\n      let elm = undefined;\n      criteria.forEach(c => {\n        if (c.id === criteriaSource) {\n          elm = c.elm;\n        }\n      });\n      if (!elm) return;\n      const newPathway = setTransitionCondition(\n        pathwayRef.current,\n        currentNodeRef.current.key,\n        transitionRef.current.id,\n        transitionRef.current.condition?.description || '',\n        elm,\n        criteriaSource\n      );\n\n      updatePathway(newPathway);\n    },\n    [currentNodeRef, updatePathway, pathwayRef, transitionRef, criteria]\n  );\n\n  const setCriteriaDisplay = useCallback(\n    (event: ChangeEvent<{ value: string }>): void => {\n      if (!currentNodeRef.current?.key || !transition.id || !pathwayRef.current) return;\n\n      const criteriaDisplay = event?.target.value || '';\n      updatePathway(\n        setTransitionConditionDescription(\n          pathwayRef.current,\n          currentNodeRef.current.key,\n          transition.id,\n          criteriaDisplay\n        )\n      );\n    },\n    [currentNodeRef, transition.id, updatePathway, pathwayRef]\n  );\n\n  const handleCriteriaName = useCallback(\n    (event: ChangeEvent<{ value: string }>): void => {\n      setCriteriaName(event?.target.value || '');\n    },\n    [setCriteriaName]\n  );\n\n  const handleBuildCriteria = useCallback((): void => {\n    updateBuildCriteriaNodeId(transition.id ?? '');\n    setBuildCriteriaSelected(!buildCriteriaSelected);\n  }, [buildCriteriaSelected, updateBuildCriteriaNodeId, transition]);\n\n  const handleBuildCriteriaCancel = useCallback((): void => {\n    if (buildCriteriaNodeId === transition.id) updateBuildCriteriaNodeId('');\n    setBuildCriteriaSelected(false);\n    setCriteriaName('');\n  }, [updateBuildCriteriaNodeId, setCriteriaName, buildCriteriaNodeId, transition]);\n\n  // Cancel current build criteria if clicked on another BranchTransition\n  useEffect(() => {\n    if (buildCriteriaNodeId !== '' && buildCriteriaNodeId !== transition.id) {\n      handleBuildCriteriaCancel();\n    }\n  }, [buildCriteriaNodeId, handleBuildCriteriaCancel, transition]);\n\n  return (\n    <>\n      {!displayCriteria && !buildCriteriaSelected && (\n        <SidebarButton\n          buttonName=\"Select Criteria\"\n          buttonIcon={faThList}\n          buttonText=\"Add previously built or imported criteria logic to branch node.\"\n          onClick={handleUseCriteria}\n          disabled={!criteriaAvailable}\n          hasTooltip={!criteriaAvailable}\n          tooltipTitle=\"No criteria to select. Add criteria to use.\"\n        />\n      )}\n\n      {displayCriteria && (\n        <OutlinedDiv label=\"Criteria Selector\" error={!criteriaIsValid || !criteriaDisplayIsValid}>\n          <>\n            <DropDown\n              id=\"Criteria\"\n              label=\"Criteria\"\n              options={criteriaOptions}\n              onChange={selectCriteriaSource}\n              value={transition.condition?.cql || undefined}\n            />\n\n            <TextField\n              label=\"Criteria Display\"\n              value={transition.condition?.description || ''}\n              variant=\"outlined\"\n              onChange={setCriteriaDisplay}\n              error={!criteriaDisplayIsValid}\n            />\n          </>\n\n          <Button\n            className={styles.cancelButton}\n            color=\"inherit\"\n            size=\"small\"\n            variant=\"outlined\"\n            startIcon={icon}\n            onClick={handleUseCriteria}\n          >\n            {buttonText}\n          </Button>\n        </OutlinedDiv>\n      )}\n\n      {!displayCriteria && !buildCriteriaSelected && (\n        <SidebarButton\n          buttonName=\"Build Criteria\"\n          buttonIcon={faTools}\n          buttonText=\"Create new criteria logic to add to branch node.\"\n          extraMargin\n          onClick={handleBuildCriteria}\n        />\n      )}\n\n      {buildCriteriaSelected && (\n        <OutlinedDiv label=\"Criteria Builder\" error={true}>\n          <TextField\n            error={criteriaName === ''}\n            label=\"Criteria Name\"\n            variant=\"outlined\"\n            onChange={handleCriteriaName}\n            fullWidth\n          />\n          <div className={styles.buildCriteriaContainer}>\n            <FormControlLabel\n              label={<Box fontStyle=\"italic\">Add to reusable criteria</Box>}\n              control={<Checkbox color=\"default\" />}\n            />\n            <Button\n              color=\"inherit\"\n              size=\"large\"\n              variant=\"outlined\"\n              onClick={handleBuildCriteriaCancel}\n            >\n              Cancel\n            </Button>\n            <Button\n              className={styles.saveButton}\n              color=\"inherit\"\n              size=\"large\"\n              variant=\"outlined\"\n              startIcon={<FontAwesomeIcon icon={faSave} />}\n              disabled\n            >\n              Save\n            </Button>\n          </div>\n        </OutlinedDiv>\n      )}\n    </>\n  );\n};\n\nexport default memo(BranchTransition);\n","import React, { FC, ReactNode } from 'react';\nimport clsx from 'clsx';\n\nimport TextField from '@material-ui/core/TextField';\nimport useStyles from './styles';\n\ninterface InputComponentProps {\n  children?: ReactNode;\n}\n\nconst InputComponent: FC<InputComponentProps> = ({ children }) => {\n  return <>{children}</>;\n};\n\ninterface OutlinedDivProps {\n  children: ReactNode;\n  label: string;\n  error: boolean;\n}\n\nconst OutlinedDiv: FC<OutlinedDivProps> = ({ children, label, error }) => {\n  const styles = useStyles();\n\n  return (\n    <TextField\n      variant=\"outlined\"\n      label={label}\n      multiline\n      InputLabelProps={{ shrink: true }}\n      InputProps={{\n        inputComponent: InputComponent,\n        classes: {\n          root: clsx(styles.outlinedDiv, error && styles.outlinedDivError),\n          notchedOutline: clsx(error && styles.outlinedDivError)\n        }\n      }}\n      inputProps={{ children }}\n      fullWidth\n    />\n  );\n};\n\n// This is not memoized since one of its props is children\nexport default OutlinedDiv;\n","import React, { FC, memo } from 'react';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport { faTimes, faExclamationCircle } from '@fortawesome/free-solid-svg-icons';\nimport {\n  Button,\n  Dialog,\n  DialogTitle,\n  DialogContent,\n  DialogActions,\n  IconButton\n} from '@material-ui/core';\n\nimport useStyles from './styles';\nimport { useCurrentNodeContext } from 'components/CurrentNodeProvider';\n\ninterface DeleteModalProps {\n  open: boolean;\n  nodeLabel: string;\n  isTransition: boolean;\n  onClose: () => void;\n  onDelete: () => void;\n}\n\nconst DeleteModal: FC<DeleteModalProps> = ({\n  open,\n  nodeLabel,\n  isTransition,\n  onClose,\n  onDelete\n}) => {\n  const styles = useStyles();\n  const { currentNode } = useCurrentNodeContext();\n\n  const text = isTransition ? (\n    <span>\n      Delete the transition from <strong>{currentNode?.label}</strong> to{' '}\n      <strong>{nodeLabel}</strong>? This will not delete either node, just the transition between\n      them.\n    </span>\n  ) : (\n    <span>\n      Delete the node <strong>{nodeLabel}</strong>? This will also remove any transitions to this\n      node.\n    </span>\n  );\n\n  return (\n    <>\n      <Dialog\n        open={open}\n        onClose={onClose}\n        aria-labelledby=\"create-pathway\"\n        fullWidth\n        maxWidth=\"md\"\n      >\n        <DialogTitle disableTypography>\n          <IconButton aria-label=\"close\" onClick={onClose} className={styles.dialogCloseButton}>\n            <FontAwesomeIcon icon={faTimes} />\n          </IconButton>\n        </DialogTitle>\n\n        <DialogContent className={styles.dialogContent}>\n          <FontAwesomeIcon icon={faExclamationCircle} className={styles.alertIcon} />\n          <p className={styles.dialogContentText}>{text}</p>\n        </DialogContent>\n\n        <DialogActions>\n          <Button variant=\"text\" color=\"primary\" onClick={onClose}>\n            Cancel\n          </Button>\n          <Button variant=\"contained\" color=\"secondary\" onClick={onDelete}>\n            Delete\n          </Button>\n        </DialogActions>\n      </Dialog>\n    </>\n  );\n};\n\nexport default memo(DeleteModal);\n","import React, { FC, ReactNode, memo } from 'react';\nimport SidebarHeader from './SidebarHeader';\nimport useStyles from './styles';\nimport { Card } from '@material-ui/core';\nimport { Transition } from 'pathways-model';\nimport { useCurrentPathwayContext } from 'components/CurrentPathwayProvider';\n\ninterface TransitionEditorProps {\n  transition: Transition;\n  children?: ReactNode;\n}\n\nconst TransitionEditor: FC<TransitionEditorProps> = ({ transition, children }) => {\n  const styles = useStyles();\n  const { pathway } = useCurrentPathwayContext();\n  const transitionKey = transition?.transition || '';\n  const transitionNode = pathway?.nodes[transitionKey];\n\n  return (\n    <Card raised className={styles.transitionContainer}>\n      {transitionNode && <SidebarHeader node={transitionNode} isTransition />}\n\n      {children}\n    </Card>\n  );\n};\n\nexport default memo(TransitionEditor);\n","/* eslint-disable guard-for-in */\n/* eslint-disable max-len */\n\nimport { Pathway, PathwayNode } from 'pathways-model';\nimport { Node, Nodes, Layout, NodeCoordinates, Edges, NodeDimensions } from 'graph-model';\n\nimport dagre from 'dagre';\n\nimport config from 'utils/ConfigManager';\nconst graphLayoutProvider = config.get('graphLayoutProvider', 'dagre');\n\n/**\n * Obtain the graph layout for the pathway as coordinates for every node\n *\n * @param pathway - JSON pathway\n */\nexport default function layout(pathway: Pathway, nodeDimensions: NodeDimensions): Layout {\n  return graphLayoutProvider === 'dagre'\n    ? layoutDagre(pathway, nodeDimensions)\n    : layoutCustom(pathway);\n}\n\n/**\n * Layout the pathway using the Dagre layout engine.\n * @see {@link https://github.com/dagrejs/dagre}\n */\nfunction layoutDagre(pathway: Pathway, nodeDimensions: NodeDimensions): Layout {\n  const START = 'Start';\n  const NODE_HEIGHT = 50;\n  const NODE_WIDTH_FACTOR = 10; // factor to convert label length => width, assume font size roughly 10\n  const nodeKeys = Object.keys(pathway.nodes);\n  const g = new dagre.graphlib.Graph();\n\n  g.setGraph({});\n  g.setDefaultEdgeLabel(() => ({})); // dagre requires a default edge label, we want it to just be empty\n\n  nodeKeys.forEach(nodeKey => {\n    const node: PathwayNode = pathway.nodes[nodeKey];\n    const nodeDimension = nodeDimensions[nodeKey];\n\n    if (nodeDimension) {\n      g.setNode(nodeKey, {\n        label: node.label,\n        width: nodeDimension.width,\n        height: nodeDimension.height\n      });\n    } else {\n      g.setNode(nodeKey, {\n        label: node.label,\n        width: node.label.length * NODE_WIDTH_FACTOR,\n        height: NODE_HEIGHT\n      });\n    }\n\n    node.transitions.forEach(transition => {\n      const label = transition.condition\n        ? {\n            label: transition.condition.description,\n            width: 25,\n            height: 20\n          }\n        : {};\n\n      g.setEdge(nodeKey, transition.transition, label);\n    });\n  });\n\n  dagre.layout(g);\n  const nodeCoordinates: NodeCoordinates = {};\n  const startNodeShift = g.node(START).x;\n\n  for (const nodeKey of nodeKeys) {\n    const node = g.node(nodeKey);\n    // dagre returns coordinates for the center of the node,\n    // our renderer expects coordinates for the corner of the node.\n    // further, our renderer expects the Start node to be centered at x: 0\n    nodeCoordinates[nodeKey] = {\n      x: node.x - startNodeShift - node.width / 2,\n      y: node.y - node.height / 2,\n      width: node.width\n    };\n  }\n\n  const edges: Edges = {};\n\n  g.edges().forEach(e => {\n    const edge = g.edge(e);\n    const edgeName = `${e.v}, ${e.w}`;\n    const label = edge.label ? { text: edge.label, x: edge.x - startNodeShift, y: edge.y } : null;\n\n    edges[edgeName] = {\n      label,\n      start: e.v,\n      end: e.w,\n      points: edge.points.map(p => {\n        return {\n          x: p.x - startNodeShift,\n          y: p.y\n        };\n      })\n    };\n  });\n\n  return { nodeCoordinates, edges };\n}\n\n/**\n * Layout the pathway using our homegrown layout algorithm.\n */\nfunction layoutCustom(pathway: Pathway): Layout {\n  const START = 'Start';\n  const NODE_WIDTH = 100;\n  const NODE_HEIGHT = 50;\n  const MIN_MARGIN_X = 10;\n  const MIN_MARGIN_Y = 50;\n  const nodes: Nodes = initializeNodes(pathway);\n  const graph: string[][] = [[START]];\n  const HORIZONTAL_OFFSET = NODE_WIDTH + MIN_MARGIN_X;\n  const VERTICAL_OFFSET = NODE_HEIGHT + MIN_MARGIN_Y;\n\n  // Set the rank for every node\n  let rank = 0;\n  do {\n    // Iterate over each node on the current level\n    for (const nodeKey of graph[rank]) {\n      // Assign all children to the next rank\n      assignRankToChildren(nodes[nodeKey], rank + 1);\n    }\n\n    rank++;\n\n    // To start rank = 0 and graph.length = 1. In each iteration children will be added\n    // to the next rank incrementing the length of graph. When there are no new children\n    // the graph.length will remain unchanged but the rank would have increased by one.\n    // Therefore we stop when the rank and graph length are the same.\n  } while (graph.length !== rank);\n\n  // Set the position of nodes within the rank\n  assignHorizontalPositionToNode(nodes[START], -1 * (NODE_WIDTH / 2));\n  for (rank = 1; rank < graph.length; rank++) {\n    assignHorizontalPositionToNodesInRank(rank);\n  }\n\n  return {\n    nodeCoordinates: produceCoordinates(),\n    edges: {}\n  };\n\n  /**\n   * Convert the Nodes into a Coordinates object\n   *\n   * @returns Coordinates for every node\n   */\n  function produceCoordinates(): NodeCoordinates {\n    const coordinates: NodeCoordinates = {};\n\n    for (const nodeKey in nodes) {\n      const node = nodes[nodeKey];\n      coordinates[nodeKey] = {\n        x: node.horizontalPosition,\n        y: node.rank * VERTICAL_OFFSET\n      };\n    }\n\n    return coordinates;\n  }\n\n  /**\n   * Set the horizontal position for child elements of a parent\n   *\n   * @param parent - the parent Node\n   * @param nodes - the Nodes\n   */\n  function spreadChildrenEvenly(parent: Node): void {\n    const children = parent.children.filter(\n      c => isNaN(nodes[c].horizontalPosition) || nodes[c].canMove\n    );\n    if (children.length === 0) return;\n    if (children.length === 1) {\n      assignHorizontalPositionToNode(nodes[children[0]], parent.horizontalPosition);\n      return;\n    }\n    if (children.length % 2 === 1) children.splice(Math.ceil(children.length / 2), 1); // Remove middle element if odd\n\n    // TODO: this does not consider if there are connections between the children which order to put them in\n    for (let i = 0; i < children.length / 2; i++) {\n      // Set the left child i from the center\n      let childNode = nodes[children[children.length / 2 - i - 1]];\n      assignHorizontalPositionToNode(\n        childNode,\n        parent.horizontalPosition - (i + 1) * HORIZONTAL_OFFSET\n      );\n      childNode.canMove = false;\n\n      // Set the right child i from the center\n      childNode = nodes[children[children.length / 2 + i]];\n      assignHorizontalPositionToNode(\n        childNode,\n        parent.horizontalPosition + (i + 1) * HORIZONTAL_OFFSET\n      );\n      childNode.canMove = false;\n    }\n  }\n\n  /**\n   * Assigns the node given by nodeKey the horizontal position hPos if it is not already set\n   * @param node - the node to set the horizontal position of\n   * @param hPos - the horizontal position for the node\n   */\n  function assignHorizontalPositionToNode(node: Node, hPos: number): void {\n    if (isNaN(node.horizontalPosition) || node.canMove) {\n      node.horizontalPosition = hPos;\n\n      // Check the new position is not on top of another node\n      let i = 1;\n      while (hasOverlap(node)) {\n        // Update Horizontal position of this node\n        // Alternate directions moving further and further away\n        const direction = i % 2 === 0 ? -1 : 1;\n        node.horizontalPosition = hPos + direction * Math.ceil(i / 2) * HORIZONTAL_OFFSET;\n        i += 1;\n      }\n    }\n  }\n\n  /**\n   * Assigns the horizontal position of all nodes on the current level\n   *\n   * @param rank - the level of the graph to assign node positions of\n   */\n  function assignHorizontalPositionToNodesInRank(rank: number): void {\n    for (const nodeKey of graph[rank]) {\n      const node = nodes[nodeKey];\n      if (!isNaN(node.horizontalPosition)) continue;\n      const parentsOnHigherRank = node.parents.filter(p => nodes[p].rank < node.rank);\n      if (parentsOnHigherRank.length === 1) {\n        const parentKey = node.parents[0];\n        const parent = nodes[parentKey];\n\n        if (parent.children.length % 2 === 1) {\n          // Odd number of children: one directly below, others to the side\n          const childNode = nodes[parent.children[Math.floor(parent.children.length / 2)]];\n          assignHorizontalPositionToNode(childNode, parent.horizontalPosition);\n        }\n        spreadChildrenEvenly(parent);\n      } else {\n        // Multiple Parents: Place the node at the average of parents on higher rank\n        // TODO: collect all parents to be next to each other\n        const sum = parentsOnHigherRank\n          .map(p => nodes[p].horizontalPosition)\n          .reduce((a, b) => a + b, 0);\n\n        assignHorizontalPositionToNode(node, sum / parentsOnHigherRank.length);\n      }\n    }\n  }\n\n  /**\n   * Determines if the node overlaps with any other nodes in the rank\n   *\n   * @param node - the node to check for overlap with\n   * @returns true if the node overlaps with any other node in the rank, false otherwise\n   */\n  function hasOverlap(node: Node): boolean {\n    const nodesInRank = graph[node.rank].map(name => nodes[name]);\n\n    for (const otherNode of nodesInRank) {\n      if (nodesOverlap(node, otherNode)) return true;\n    }\n\n    return false;\n  }\n\n  /**\n   * Helper function to determine if two nodes are in the same slot\n   *\n   * @param node - the first node\n   * @param otherNode - the second node\n   * @returns true if the nodes share same rank and position, false otherwise\n   */\n  function nodesOverlap(node: Node, otherNode: Node): boolean {\n    if (nodesEqual(node, otherNode)) return false;\n    else\n      return (\n        !isNaN(node.rank) &&\n        !isNaN(node.horizontalPosition) &&\n        !isNaN(otherNode.rank) &&\n        !isNaN(otherNode.horizontalPosition) &&\n        node.rank === otherNode.rank &&\n        node.horizontalPosition === otherNode.horizontalPosition\n      );\n  }\n\n  /**\n   * Determine if two nodes are the same\n   *\n   * @param node - the first node\n   * @param otherNode - the second node\n   * @returns true if the two nodes are the same (have the same label)\n   */\n  function nodesEqual(node: Node, otherNode: Node): boolean {\n    return node.label === otherNode.label;\n  }\n\n  /**\n   * Assigns the rank to every child of node. If the child has a lower rank the entire\n   * subtree rooted at that child will be shifted down by recursively assigning rank to\n   * the children.\n   *\n   * @param nodes - the Nodes\n   * @param graph - the graph as list of nodes by level\n   * @param node - the node to get children from\n   * @param rank - the rank to assign to the children\n   */\n  function assignRankToChildren(node: Node, rank: number): void {\n    node.children.forEach(child => {\n      const childNode = nodes[child];\n\n      // If the child is on a higher rank than the parent (node) move subtree rooted at child down\n      if (childNode.rank < node.rank) {\n        // Remove node from previous rank\n        graph[childNode.rank].splice(graph[childNode.rank].indexOf(child), 1);\n\n        // Move this node down\n        assignRankToNode(child, rank);\n\n        // Move all children of this child down\n        assignRankToChildren(childNode, rank + 1);\n      } else if (isNaN(childNode.rank)) assignRankToNode(child, rank);\n    });\n  }\n\n  /**\n   * Assigns the node labeled by nodeKey the rank by updating graph and nodes data structures\n   *\n   * @param nodes - the Nodes\n   * @param graph - the graph as list of nodes by level\n   * @param nodeKey - the name of the node to set the rank of\n   * @param rank - the new rank for the node\n   */\n  function assignRankToNode(nodeKey: string, rank: number): void {\n    try {\n      graph[rank].push(nodeKey);\n    } catch (err) {\n      graph[rank] = [nodeKey];\n    } finally {\n      nodes[nodeKey].rank = rank;\n    }\n  }\n\n  /**\n   * Initialize the Nodes data structure for the graph representation\n   *\n   * @param pathway - JSON Pathway\n   * @returns initial Nodes data structure with default values\n   */\n  function initializeNodes(pathway: Pathway): Nodes {\n    const nodes: Nodes = {};\n\n    // Iniitalize each node with default values\n    let nodeKey: string;\n    for (nodeKey in pathway.nodes) {\n      nodes[nodeKey] = {\n        label: nodeKey,\n        rank: NaN,\n        horizontalPosition: NaN,\n        children: [],\n        parents: [],\n        canMove: true\n      };\n    }\n\n    // Set the child and parent properties of each node\n    Object.keys(pathway.nodes).forEach(nodeKey => {\n      const node: PathwayNode = pathway.nodes[nodeKey];\n\n      node.transitions.forEach(transition => {\n        if (!nodes[nodeKey].children.includes(transition.transition))\n          nodes[nodeKey].children.push(transition.transition);\n        if (!nodes[transition.transition].parents.includes(nodeKey))\n          nodes[transition.transition].parents.push(nodeKey);\n      });\n    });\n\n    nodes[START].rank = 0;\n\n    return nodes;\n  }\n}\n","import React, { FC, ReactNode, ReactElement, memo } from 'react';\nimport { ActionNode } from 'pathways-model';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport styles from './ExpandedNode.module.scss';\nimport { isBranchNode, resourceNameConversion, isActionNode } from 'utils/nodeUtils';\nimport { faExternalLinkAlt } from '@fortawesome/free-solid-svg-icons';\nimport { MedicationRequest, ServiceRequest } from 'fhir-objects';\n\ninterface ExpandedNodeProps {\n  actionNode: ActionNode;\n}\n\nconst ExpandedNode: FC<ExpandedNodeProps> = memo(({ actionNode }) => {\n  return (\n    <>\n      <ExpandedNodeMemo actionNode={actionNode} />\n    </>\n  );\n});\n\ntype ExpandedNodeFieldProps = {\n  title: string;\n  description: ReactNode;\n};\n\nconst ExpandedNodeField: FC<ExpandedNodeFieldProps> = ({ title, description }) => {\n  if (!description) return null;\n\n  return (\n    <tr>\n      <td className={styles.descTitle}>{title}</td>\n      <td className={styles.desc}>{description}</td>\n    </tr>\n  );\n};\n\nfunction isMedicationRequest(\n  request: MedicationRequest | ServiceRequest\n): request is MedicationRequest {\n  return (request as MedicationRequest).medicationCodeableConcept !== undefined;\n}\n\nfunction renderAction(actionNode: ActionNode): ReactElement[] {\n  let returnElements: ReactElement[] = [];\n  if (actionNode.action[0]) {\n    const resource = actionNode.action[0].resource;\n    const coding = isMedicationRequest(resource)\n      ? resource?.medicationCodeableConcept?.coding\n      : resource?.code?.coding;\n\n    const resourceType = resourceNameConversion[resource.resourceType]\n      ? resourceNameConversion[resource.resourceType]\n      : resource.resourceType;\n    returnElements = [\n      <ExpandedNodeField\n        key=\"Description\"\n        title=\"Description\"\n        description={actionNode.action[0].description}\n      />,\n      <ExpandedNodeField key=\"Type\" title=\"Type\" description={resourceType} />,\n      <ExpandedNodeField\n        key=\"System\"\n        title=\"System\"\n        description={\n          coding &&\n          coding[0].system && (\n            <>\n              {coding[0].system}\n              <a href={coding[0].system} target=\"_blank\" rel=\"noopener noreferrer\">\n                <FontAwesomeIcon icon={faExternalLinkAlt} className={styles.externalLink} />\n              </a>\n            </>\n          )\n        }\n      />,\n      <ExpandedNodeField key=\"Code\" title=\"Code\" description={coding && coding[0].code} />,\n      <ExpandedNodeField key=\"Display\" title=\"Display\" description={coding && coding[0].display} />,\n      <ExpandedNodeField key=\"Title\" title=\"Title\" description={resource.title} />\n    ];\n  }\n\n  return returnElements;\n}\n\nfunction renderBranch(): ReactElement {\n  return <ExpandedNodeField key=\"Type\" title=\"Type\" description=\"Observation\" />;\n}\n\ninterface ExpandedNodeMemoProps {\n  actionNode: ActionNode;\n}\n\nconst ExpandedNodeMemo: FC<ExpandedNodeMemoProps> = memo(({ actionNode }) => {\n  const action = isActionNode(actionNode) && renderAction(actionNode);\n  const branch = isBranchNode(actionNode) && renderBranch();\n  return (\n    <div className=\"expandedNode\">\n      <table className={styles.infoTable}>\n        <tbody>{action || branch}</tbody>\n      </table>\n    </div>\n  );\n});\n\nexport default ExpandedNode;\n","import React, { FC, Ref, forwardRef, memo, useCallback, useState, useEffect } from 'react';\nimport { ActionNode, PathwayNode } from 'pathways-model';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\n\nimport styles from './Node.module.scss';\nimport ExpandedNode from 'components/ExpandedNode';\nimport { isActionNode } from 'utils/nodeUtils';\nimport { IconDefinition } from '@fortawesome/fontawesome-svg-core';\nimport {\n  faMicroscope,\n  faPlay,\n  faPrescriptionBottleAlt,\n  faSyringe,\n  faCheckCircle,\n  faTimesCircle,\n  faBookMedical\n} from '@fortawesome/free-solid-svg-icons';\nimport { useCurrentNodeContext } from 'components/CurrentNodeProvider';\n\ninterface NodeProps {\n  nodeKey: string;\n  pathwayNode: PathwayNode;\n  xCoordinate: number;\n  yCoordinate: number;\n  expanded?: boolean;\n  onClick?: (nodeKey: string) => void;\n  nodeType: string;\n}\n\nconst Node: FC<NodeProps & { ref: Ref<HTMLDivElement> }> = memo(\n  forwardRef<HTMLDivElement, NodeProps>(\n    (\n      { nodeKey, pathwayNode, xCoordinate, yCoordinate, expanded = false, onClick, nodeType },\n      ref\n    ) => {\n      const { currentNode } = useCurrentNodeContext();\n      const [hasMetadata, setHasMetadata] = useState<boolean>(\n        isActionNode(pathwayNode) ? pathwayNode.action.length > 0 : false\n      );\n\n      const onClickHandler = useCallback(() => {\n        if (onClick) onClick(nodeKey);\n      }, [onClick, nodeKey]);\n\n      useEffect(() => {\n        if (!hasMetadata && isActionNode(pathwayNode) && pathwayNode.action.length > 0) {\n          setHasMetadata(true);\n          if (!expanded) {\n            onClickHandler();\n          }\n        }\n      }, [hasMetadata, pathwayNode, setHasMetadata, onClickHandler, expanded]);\n\n      const { label } = pathwayNode;\n      const style = {\n        top: yCoordinate,\n        left: xCoordinate\n      };\n\n      const isCurrentNode = pathwayNode.key === currentNode?.key;\n\n      const isActionable = isCurrentNode;\n      const topLevelClasses = [styles.node];\n      let expandedNodeClass = '';\n      if (expanded) topLevelClasses.push('expanded');\n      if (isActionable) {\n        topLevelClasses.push(styles.actionable);\n        expandedNodeClass = styles.childActionable;\n      } else {\n        expandedNodeClass = styles.childNotActionable;\n      }\n\n      return (\n        <div className={topLevelClasses.join(' ')} style={style} ref={ref}>\n          <div className={`nodeTitle ${onClickHandler && 'clickable'}`} onClick={onClickHandler}>\n            <div className=\"iconAndLabel\">\n              <NodeIcon pathwayNode={pathwayNode} nodeType={nodeType} />\n              {label}\n            </div>\n            <StatusIcon status={null} />\n          </div>\n          {expanded && (\n            <div className={`${styles.expandedNode} ${expandedNodeClass}`}>\n              <ExpandedNode actionNode={pathwayNode as ActionNode} />\n            </div>\n          )}\n        </div>\n      );\n    }\n  )\n);\n\ninterface NodeIconProps {\n  pathwayNode: PathwayNode;\n  nodeType: string;\n}\n\nconst NodeIcon: FC<NodeIconProps> = ({ pathwayNode, nodeType }) => {\n  let icon: IconDefinition | undefined;\n  if (pathwayNode.label === 'Start') {\n    icon = faPlay;\n  } else if (nodeType === 'action') {\n    const actionNode = pathwayNode as ActionNode;\n    if (actionNode.action.length > 0) {\n      const resourceType = actionNode.action[0].resource.resourceType;\n      if (resourceType === 'MedicationRequest') icon = faPrescriptionBottleAlt;\n      else if (resourceType === 'ServiceRequest') icon = faSyringe;\n      else if (resourceType === 'CarePlan') icon = faBookMedical;\n    }\n  } else if (nodeType === 'branch') {\n    icon = faMicroscope;\n  }\n\n  return icon ? <FontAwesomeIcon icon={icon} className={styles.icon} /> : null;\n};\n\ninterface StatusIconProps {\n  status: boolean | null;\n}\n\nconst StatusIcon: FC<StatusIconProps> = ({ status }) => {\n  if (status == null) {\n    return null;\n  }\n  const icon = status ? faCheckCircle : faTimesCircle;\n  return (\n    <div className=\"statusIcon\">\n      <FontAwesomeIcon icon={icon} className={styles.icon} />\n    </div>\n  );\n};\n\nexport default Node;\n","import { makeStyles, Theme as AugmentedTheme } from '@material-ui/core/styles';\n\nexport default makeStyles(\n  (theme: AugmentedTheme) => ({\n    arrow: {\n      '& path': {\n        stroke: theme.palette.primary.main,\n        strokeWidth: 2\n      },\n      '& text': {\n        fontSize: '18px'\n      }\n    },\n    currentArrow: {\n      '& path': {\n        stroke: theme.palette.secondary.main\n      }\n    },\n    arrowhead: {\n      '& polygon': {\n        fill: theme.palette.primary.main\n      }\n    },\n    currentArrowhead: {\n      '& polygon': {\n        fill: theme.palette.secondary.main\n      }\n    }\n  }),\n  { name: 'Arrow', index: 1 }\n);\n","import React, { FC } from 'react';\nimport { Edge, Coordinate } from 'graph-model';\nimport { PathwayNode } from 'pathways-model';\nimport useStyles from './styles';\nimport clsx from 'clsx';\nimport { Tooltip } from '@material-ui/core';\n\ninterface ArrowProps {\n  edge: Edge;\n  edgeName: string;\n  widthOffset: number;\n  currentNode: PathwayNode;\n}\n\ninterface ArrowPathProps {\n  points: Coordinate[];\n  arrowheadId: string;\n  widthOffset: number;\n}\n\nconst Arrow: FC<ArrowProps> = ({ edge, edgeName, widthOffset, currentNode }) => {\n  const styles = useStyles();\n  const isCurrentArrow = edge.start === currentNode.key;\n  const edgeNameNoWhitespace = edgeName.replace(' ', '');\n  const arrowheadId = `arrowhead-${edgeNameNoWhitespace}`;\n\n  const { label } = edge;\n  return (\n    <svg className={clsx(styles.arrow, isCurrentArrow && styles.currentArrow)}>\n      <ArrowPath points={edge.points} arrowheadId={arrowheadId} widthOffset={widthOffset} />\n      {label ? (\n        label.text.length > 12 ? (\n          <Tooltip title={label.text} aria-label=\"tooltip\">\n            <text x={label.x + widthOffset} y={label.y}>\n              {label.text.substring(0, 11) + '...'}\n            </text>\n          </Tooltip>\n        ) : (\n          <text x={label.x + widthOffset} y={label.y}>\n            {label.text}\n          </text>\n        )\n      ) : null}\n      <defs>\n        <marker\n          id={arrowheadId}\n          className={clsx(isCurrentArrow ? styles.currentArrowhead : styles.arrowhead)}\n          markerWidth=\"10\"\n          markerHeight=\"7\"\n          refX=\"0\"\n          refY=\"3.5\"\n          orient=\"auto\"\n        >\n          <polygon points=\"0 0, 10 3.5, 0 7\" />\n        </marker>\n      </defs>\n    </svg>\n  );\n};\n\n// Returns path for arrow from edge points\nconst ArrowPath: FC<ArrowPathProps> = ({ points, arrowheadId, widthOffset }) => {\n  const pointsWithOffset = points.map(p => ({ x: p.x + widthOffset, y: p.y }));\n  const length = pointsWithOffset.length;\n  pointsWithOffset[length - 1].y -= 17.5;\n  let pathString = `M ${pointsWithOffset[0].x} ${pointsWithOffset[0].y} `;\n\n  /**\n   * The points to use in the Cubic command is determined by the length of points array\n   * If i % 3 is 0, use all points including the 1st point\n   * If i % 3 is 1, use all points except the 1st point\n   * If i % 3 is 2, use all points including the 1st point and reuse every 3rd point\n   * We need points to be a multiple of 3 because the Cubic command expects 3 points\n   */\n  const writeCommandString = (remainder: number): string => {\n    return pointsWithOffset.reduce((acc, point, i, arr) => {\n      return i % 3 !== remainder\n        ? acc\n        : `${acc} C ${point.x} ${point.y} ${arr[i + 1].x} ${arr[i + 1].y} ${arr[i + 2].x}\n        ${arr[i + 2].y}`;\n    }, pathString);\n  };\n\n  pathString = writeCommandString(length % 3);\n\n  return <path d={pathString} fill=\"transparent\" markerEnd={`url(#${arrowheadId})`} />;\n};\n\nexport default Arrow;\n","import React, { FC, useCallback, useEffect, useMemo, useRef, useState, memo } from 'react';\nimport { useParams, useHistory } from 'react-router-dom';\n\nimport graphLayout from 'visualization/layout';\nimport Node from 'components/Node';\nimport Arrow from 'components/Arrow';\nimport { useBuildCriteriaContext } from 'components/BuildCriteriaProvider';\nimport { Pathway, PathwayNode } from 'pathways-model';\nimport { Layout, NodeDimensions, NodeCoordinates, Edges } from 'graph-model';\nimport styles from './Graph.module.scss';\nimport { useCurrentPathwayContext } from 'components/CurrentPathwayProvider';\nimport { useCurrentNodeContext } from 'components/CurrentNodeProvider';\nimport { getNodeType } from 'utils/builder';\nimport { redirect } from 'utils/nodeUtils';\n\ninterface GraphProps {\n  graphContainerWidth: number;\n  interactive?: boolean;\n}\n\ninterface ExpandedNode {\n  [key: string]: boolean | string | null;\n}\n\nconst Graph: FC<GraphProps> = memo(function Graph({ graphContainerWidth, interactive = true }) {\n  const { pathway } = useCurrentPathwayContext();\n  const { currentNode } = useCurrentNodeContext();\n  const nodeRefs = useRef<{ [key: string]: HTMLDivElement }>({});\n\n  // Get the layout of the graph\n  const getGraphLayout = useCallback((): Layout => {\n    const nodeDimensions: NodeDimensions = {};\n\n    // Retrieve dimensions from nodeRefs\n    if (nodeRefs?.current) {\n      Object.keys(nodeRefs.current).forEach(key => {\n        const nodeElement = nodeRefs.current[key];\n        const width = nodeElement.clientWidth;\n        // nodeElement can have multiple children so calculate the sum to get the node height\n        const height = Array.from(nodeElement.children).reduce(\n          (acc, child) => acc + child.clientHeight,\n          0\n        );\n\n        nodeDimensions[key] = { width, height };\n      });\n    }\n\n    if (pathway) return graphLayout(pathway, nodeDimensions);\n    else return {} as Layout;\n  }, [pathway]);\n\n  const [layout, setLayout] = useState(getGraphLayout());\n  const { nodeCoordinates, edges } = layout;\n  const maxHeight = useMemo(() => {\n    return nodeCoordinates !== undefined\n      ? Object.values(nodeCoordinates)\n          .map(x => x.y)\n          .reduce((a, b) => Math.max(a, b))\n      : 0;\n  }, [nodeCoordinates]);\n\n  // If a node has a negative x value, shift nodes and edges to the right by that value\n  const minX =\n    nodeCoordinates !== undefined\n      ? Object.values(nodeCoordinates)\n          .map(x => x.x + graphContainerWidth / 2)\n          .reduce((a, b) => Math.min(a, b))\n      : 0;\n\n  if (minX < 0) {\n    const toAdd = minX * -1;\n    Object.keys(nodeCoordinates).forEach(key => {\n      const node = nodeCoordinates[key];\n      node.x += toAdd;\n    });\n\n    Object.keys(edges).forEach(key => {\n      const edge = edges[key];\n\n      edge.points.forEach(p => (p.x += toAdd));\n      if (edge.label) edge.label.x += toAdd;\n    });\n  }\n\n  // Find node that is farthest to the right\n  const maxWidth = useMemo(() => {\n    return nodeCoordinates !== undefined\n      ? Object.values(nodeCoordinates)\n          // Add width of the node to account for x coordinate starting at top left corner\n          .map(x => x.x + graphContainerWidth / 2 + (x.width ?? 0))\n          .reduce((a, b) => Math.max(a, b))\n      : 0;\n  }, [nodeCoordinates, graphContainerWidth]);\n\n  const [expanded, setExpanded] = useState<ExpandedNode>(() =>\n    Object.keys(layout).reduce(\n      (acc, curr: string) => {\n        acc[curr] = false;\n        return acc;\n      },\n      { lastSelectedNode: null } as ExpandedNode\n    )\n  );\n\n  const toggleExpanded = useCallback((key: string) => {\n    if (key === 'Start') {\n      setExpanded(prevState => ({\n        ...prevState,\n        lastSelectedNode: key\n      }));\n    } else {\n      setExpanded(prevState => ({\n        ...prevState,\n        [key]:\n          !prevState[key] || prevState.lastSelectedNode === key ? !prevState[key] : prevState[key],\n        lastSelectedNode: key\n      }));\n    }\n  }, []);\n\n  // Recalculate graph layout if a node is expanded\n  useEffect(() => {\n    setLayout(getGraphLayout());\n  }, [pathway, expanded, getGraphLayout]);\n\n  if (!pathway) return <div>Error: No pathway loaded</div>;\n  else if (!currentNode) return <div>Error: No node selected</div>;\n  else\n    return (\n      <GraphMemo\n        interactive={interactive}\n        maxHeight={maxHeight}\n        nodeCoordinates={nodeCoordinates}\n        edges={edges}\n        pathway={pathway}\n        nodeRefs={nodeRefs}\n        parentWidth={graphContainerWidth}\n        maxWidth={maxWidth}\n        expanded={expanded}\n        toggleExpanded={toggleExpanded}\n        currentNode={currentNode}\n      />\n    );\n});\n\ninterface GraphMemoProps {\n  interactive: boolean;\n  maxHeight: number;\n  nodeCoordinates: NodeCoordinates;\n  edges: Edges;\n  pathway: Pathway;\n  nodeRefs: React.MutableRefObject<{\n    [key: string]: HTMLDivElement;\n  }>;\n  parentWidth: number;\n  maxWidth: number;\n  expanded: ExpandedNode;\n  toggleExpanded: (key: string) => void;\n  currentNode: PathwayNode;\n}\n\nconst GraphMemo: FC<GraphMemoProps> = memo(function GraphMemo({\n  interactive,\n  maxHeight,\n  nodeCoordinates,\n  edges,\n  pathway,\n  nodeRefs,\n  parentWidth,\n  maxWidth,\n  expanded,\n  toggleExpanded,\n  currentNode\n}) {\n  const { id: pathwayId } = useParams();\n  const history = useHistory();\n  const { updateBuildCriteriaNodeId } = useBuildCriteriaContext();\n  const onClickHandler = useCallback(\n    (nodeKey: string) => {\n      if (interactive) {\n        redirect(pathwayId, nodeKey, history);\n        toggleExpanded(nodeKey);\n        updateBuildCriteriaNodeId('');\n      }\n    },\n    [toggleExpanded, updateBuildCriteriaNodeId, interactive, history, pathwayId]\n  );\n\n  return (\n    <div\n      id=\"graph-root\"\n      className={styles.root}\n      style={{\n        height: interactive ? maxHeight + 150 : 'inherit',\n        width: maxWidth + 'px',\n        position: 'relative',\n        marginRight: '5px'\n      }}\n    >\n      {nodeCoordinates !== undefined\n        ? Object.keys(nodeCoordinates).map(nodeKey => {\n            if (Object.keys(pathway.nodes).includes(nodeKey)) {\n              return (\n                <Node\n                  key={nodeKey}\n                  nodeKey={nodeKey}\n                  ref={(node: HTMLDivElement): void => {\n                    if (node) nodeRefs.current[nodeKey] = node;\n                    else delete nodeRefs.current[nodeKey];\n                  }}\n                  pathwayNode={pathway.nodes[nodeKey]}\n                  xCoordinate={nodeCoordinates[nodeKey].x + parentWidth / 2}\n                  yCoordinate={nodeCoordinates[nodeKey].y}\n                  expanded={Boolean(expanded[nodeKey])}\n                  onClick={onClickHandler}\n                  nodeType={getNodeType(pathway, nodeKey)}\n                />\n              );\n            } else return null;\n          })\n        : []}\n\n      <svg\n        xmlns=\"http://www.w3.org/2000/svg\"\n        style={{\n          width: maxWidth + 100,\n          height: maxHeight,\n          zIndex: 1,\n          top: 0,\n          left: 0,\n          overflow: 'visible'\n        }}\n      >\n        {edges !== undefined\n          ? Object.keys(edges).map(edgeName => {\n              const edge = edges[edgeName];\n              return (\n                <Arrow\n                  key={edgeName}\n                  edge={edge}\n                  edgeName={edgeName}\n                  widthOffset={parentWidth / 2}\n                  currentNode={currentNode}\n                />\n              );\n            })\n          : []}\n      </svg>\n    </div>\n  );\n});\n\nexport default Graph;\n","import { makeStyles, Theme as AugmentedTheme, darken } from '@material-ui/core/styles';\n\nconst toggleButtonCss = {\n  borderRadius: '0%',\n  marginLeft: '1px',\n  width: '50px',\n  height: '50px'\n};\n\nexport default makeStyles(\n  (theme: AugmentedTheme) => ({\n    display: {\n      display: 'flex'\n    },\n    graph: {\n      width: '100%',\n      height: '100%',\n      'overflow-y': 'scroll'\n    },\n    graphHeader: {\n      display: 'flex',\n      height: '50px',\n      backgroundColor: theme.palette.common.white,\n      marginLeft: '1px'\n    },\n    graphHeaderText: {\n      height: '50px',\n      display: 'flex',\n      width: '100%',\n      backgroundColor: theme.palette.primary.main,\n      alignItems: 'center',\n      color: theme.palette.common.white,\n      fontSize: '1.4em',\n      paddingLeft: '1.5em'\n    },\n    toggleButton: {\n      '&-on': {\n        ...toggleButtonCss,\n        backgroundColor: theme.palette.primary.main,\n        '&:hover': {\n          backgroundColor: darken(theme.palette.primary.main, 0.1)\n        }\n      },\n      '&-off': {\n        ...toggleButtonCss,\n        backgroundColor: theme.palette.text.primary,\n        '&:hover': {\n          backgroundColor: darken(theme.palette.text.primary, 0.1)\n        }\n      }\n    },\n    toggleIcon: {\n      transform: 'rotate(90deg) scaleY(-1)',\n      color: theme.palette.common.white\n    }\n  }),\n  { name: 'Builder', index: 1 }\n);\n","import React, { FC, useRef, useEffect, memo, useState, useCallback } from 'react';\nimport { ThemeProvider as MuiThemeProvider } from '@material-ui/core/styles';\nimport { useBuildCriteriaContext } from 'components/BuildCriteriaProvider';\n\nimport Header from 'components/Header';\nimport Navigation from 'components/Navigation';\nimport Sidebar from 'components/Sidebar';\nimport Graph from 'components/Graph';\nimport { useTheme } from 'components/ThemeProvider';\nimport useStyles from './styles';\nimport { IconButton } from '@material-ui/core';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport { faProjectDiagram } from '@fortawesome/free-solid-svg-icons';\nimport { useCurrentPathwayContext } from 'components/CurrentPathwayProvider';\nimport ResizeSensor from 'css-element-queries/src/ResizeSensor';\n\nconst Builder: FC = () => {\n  const styles = useStyles();\n  const { pathway } = useCurrentPathwayContext();\n  const { buildCriteriaNodeId } = useBuildCriteriaContext();\n  const headerElement = useRef<HTMLDivElement>(null);\n  const theme = useTheme('dark');\n  const [showCriteriaBuilder, setShowCriteriaBuilder] = useState<boolean>(true);\n  const [graphContainerElement, setGraphContainerElement] = useState<HTMLDivElement | null>(null);\n  const [graphContainerWidth, setGraphContainerWidth] = useState<number>(0);\n\n  const toggleShowCriteria = useCallback((): void => {\n    setShowCriteriaBuilder(!showCriteriaBuilder);\n  }, [showCriteriaBuilder]);\n\n  const handleGraphContainerElement = useCallback((reactNode: HTMLDivElement) => {\n    setGraphContainerElement(reactNode);\n    if (reactNode) {\n      setGraphContainerWidth(reactNode.clientWidth);\n    }\n  }, []);\n\n  // Recalculate graph layout if graph container size changes\n  useEffect(() => {\n    if (graphContainerElement) {\n      new ResizeSensor(graphContainerElement, function() {\n        setGraphContainerWidth(graphContainerElement.clientWidth);\n      });\n    }\n  }, [graphContainerElement]);\n\n  // Set the height of the graph container\n  useEffect(() => {\n    const resize = (): void => {\n      if (graphContainerElement && headerElement?.current)\n        graphContainerElement.style.height =\n          window.innerHeight - headerElement.current.clientHeight + 'px';\n    };\n    resize();\n    window.addEventListener('resize', resize);\n    return (): void => window.removeEventListener('resize', resize);\n  }, [pathway, headerElement, graphContainerElement]);\n\n  // Reset criteriaBuilderToggle to true if not currently building criteria\n  useEffect(() => {\n    if (!showCriteriaBuilder && buildCriteriaNodeId === '') setShowCriteriaBuilder(true);\n  }, [buildCriteriaNodeId, showCriteriaBuilder]);\n\n  return (\n    <>\n      <div ref={headerElement}>\n        <Header />\n        <Navigation />\n      </div>\n\n      {pathway && (\n        <div className={styles.display}>\n          <MuiThemeProvider theme={theme}>\n            <Sidebar headerElement={headerElement} />\n          </MuiThemeProvider>\n\n          <div ref={handleGraphContainerElement} className={styles.graph}>\n            {buildCriteriaNodeId !== '' && (\n              <div className={styles.graphHeader}>\n                <div className={styles.graphHeaderText}>\n                  <span>Criteria Builder</span>\n                </div>\n                <IconButton\n                  className={`${styles.toggleButton}-${showCriteriaBuilder ? 'on' : 'off'}`}\n                  onClick={toggleShowCriteria}\n                >\n                  <FontAwesomeIcon className={styles.toggleIcon} icon={faProjectDiagram} />\n                </IconButton>\n              </div>\n            )}\n            {buildCriteriaNodeId !== '' && showCriteriaBuilder ? (\n              // Empty section for authoring tool\n              <div />\n            ) : (\n              <Graph graphContainerWidth={graphContainerWidth} />\n            )}\n          </div>\n        </div>\n      )}\n    </>\n  );\n};\n\nexport default memo(Builder);\n","import React, { FC, memo, useMemo, useEffect } from 'react';\nimport { Redirect, useParams } from 'react-router-dom';\n\nimport Builder from 'components/Builder';\nimport { usePathwaysContext } from 'components/PathwaysProvider';\nimport { useCurrentPathwayContext } from './CurrentPathwayProvider';\nimport { useCurrentNodeContext } from './CurrentNodeProvider';\n\nconst BuilderRoute: FC = () => {\n  const { id, nodeId } = useParams();\n  const { pathways } = usePathwaysContext();\n  const { setPathway } = useCurrentPathwayContext();\n  const { setCurrentNode } = useCurrentNodeContext();\n  const pathwayId = decodeURIComponent(id);\n  const pathwayIndex = useMemo(() => pathways.findIndex(pathway => pathway.id === pathwayId), [\n    pathwayId,\n    pathways\n  ]);\n  const pathway = pathways[pathwayIndex];\n  const currentNode = pathway?.nodes?.[decodeURIComponent(nodeId)];\n\n  useEffect(() => {\n    setPathway(pathway);\n  }, [pathway, setPathway]);\n\n  useEffect(() => {\n    setCurrentNode(currentNode);\n  }, [currentNode, setCurrentNode]);\n\n  if (pathway == null) return null;\n  if (currentNode == null) return <Redirect to={`/builder/${id}/node/Start`} />;\n\n  return <Builder />;\n};\n\nexport default memo(BuilderRoute);\n","import React, { FC, createContext, useContext, useState, ReactNode } from 'react';\n\ninterface UserContextInterface {\n  user: string | null;\n  setUser: Function;\n}\n\nexport const UserContext = createContext<UserContextInterface>({} as UserContextInterface);\n\ninterface UserProviderProps {\n  children: ReactNode;\n}\n\nexport const UserProvider: FC<UserProviderProps> = ({ children }) => {\n  const [user, setUser] = useState<string | null>(null);\n  return <UserContext.Provider value={{ user, setUser }}>{children}</UserContext.Provider>;\n};\n\nexport const useUser = (): UserContextInterface => useContext(UserContext);\n","import { makeStyles, Theme as AugmentedTheme } from '@material-ui/core/styles';\n\nexport default makeStyles(\n  (theme: AugmentedTheme) => ({\n    root: {\n      display: 'flex',\n      flexDirection: 'column'\n    },\n    label: {\n      padding: `0.2em 2em`,\n      textTransform: 'none',\n      fontSize: '1.2em',\n      fontWeight: 100\n    }\n  }),\n  { name: 'Tabs', index: 1 }\n);\n","import React, { FC, memo, ReactNode } from 'react';\nimport { Tab as ReactTab, TabList, TabPanel, Tabs as ReactTabs } from 'react-tabs';\n\nimport { Button } from '@material-ui/core';\n\nimport useStyles from './styles';\nimport shortid from 'shortid';\n\ninterface Tab {\n  label: string;\n  component: ReactNode;\n}\n\ninterface TabsProp {\n  tabs: Tab[];\n}\n\nconst Tabs: FC<TabsProp> = ({ tabs }) => {\n  const styles = useStyles();\n\n  return (\n    <div className={styles.root}>\n      <ReactTabs>\n        <TabList>\n          {tabs.map(tab => (\n            <ReactTab key={shortid.generate()}>\n              <Button classes={{ label: styles.label }}>{tab.label}</Button>\n            </ReactTab>\n          ))}\n        </TabList>\n\n        {tabs.map(tab => (\n          <TabPanel key={shortid.generate()}>{tab.component}</TabPanel>\n        ))}\n      </ReactTabs>\n    </div>\n  );\n};\n\nexport default memo(Tabs);\n","import React, { FC, memo } from 'react';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport { faSpinner } from '@fortawesome/free-solid-svg-icons';\n\nimport styles from './Loading.module.scss';\n\nconst Loading: FC = () => {\n  return (\n    <div className={styles.root}>\n      <FontAwesomeIcon icon={faSpinner} className={styles.root} size=\"4x\" spin />\n    </div>\n  );\n};\n\nexport default memo(Loading);\n","import { makeStyles, Theme as AugmentedTheme } from '@material-ui/core/styles';\n\nexport default makeStyles(\n  (theme: AugmentedTheme) => ({\n    root: {\n      display: 'flex',\n      flexDirection: 'column',\n      padding: theme.variables.spacing.globalPadding\n    },\n    createPathwayButton: {\n      alignSelf: 'flex-end'\n    },\n    pathwayList: {\n      marginTop: '2em'\n    },\n    pathwaysListButton: {\n      marginRight: '1em'\n    },\n    dialogCloseButton: {\n      float: 'right',\n      width: '45px'\n    }\n  }),\n  { name: 'PathwaysList', index: 1 }\n);\n","import React, { FC, useCallback, useRef, memo, FormEvent } from 'react';\nimport { useHistory } from 'react-router-dom';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport { faPlus, faTimes } from '@fortawesome/free-solid-svg-icons';\nimport {\n  Button,\n  Dialog,\n  DialogTitle,\n  DialogContent,\n  DialogActions,\n  TextField,\n  IconButton\n} from '@material-ui/core';\nimport shortid from 'shortid';\nimport produce from 'immer';\n\nimport { usePathwaysContext } from 'components/PathwaysProvider';\nimport useStyles from './styles';\nimport { createNewPathway } from 'utils/builder';\nimport { Pathway } from 'pathways-model';\n\ninterface PathwayModalProps {\n  open: boolean;\n  onClose: () => void;\n  editPathway?: Pathway;\n}\n\nconst PathwayModal: FC<PathwayModalProps> = ({ open, onClose, editPathway }) => {\n  const createNewPathwayMeta = !editPathway;\n  const styles = useStyles();\n  const history = useHistory();\n  const pathwayNameRef = useRef<HTMLInputElement>(null);\n  const pathwayDescRef = useRef<HTMLInputElement>(null);\n  const { addPathway, updatePathway } = usePathwaysContext();\n\n  const closeModal = useCallback(\n    (pathwayId: string): void => {\n      history.push(`/builder/${encodeURIComponent(pathwayId)}/node/Start`);\n      onClose();\n    },\n    [history, onClose]\n  );\n\n  const handleCreateNewPathway = useCallback(\n    (event: FormEvent<HTMLFormElement>): void => {\n      event.preventDefault();\n      const pathwayId = shortid.generate();\n      const name: string = pathwayNameRef.current?.value ?? '';\n      const description: string = pathwayDescRef.current?.value ?? '';\n      addPathway(createNewPathway(name, description, pathwayId));\n      closeModal(pathwayId);\n    },\n    [addPathway, closeModal]\n  );\n\n  const handleUpdatePathway = useCallback(\n    (event: FormEvent<HTMLFormElement>): void => {\n      event.preventDefault();\n      if (\n        editPathway &&\n        (pathwayNameRef.current?.value !== editPathway.name ||\n          pathwayDescRef.current?.value !== editPathway.description)\n      ) {\n        const newEditPathway = produce(editPathway, (draftEditPathway: Pathway) => {\n          if (pathwayNameRef.current?.value) draftEditPathway.name = pathwayNameRef.current?.value;\n          draftEditPathway.description = pathwayDescRef.current?.value;\n        });\n        updatePathway(newEditPathway);\n      }\n      onClose();\n    },\n    [updatePathway, editPathway, onClose]\n  );\n\n  let name, description;\n  if (editPathway) {\n    name = editPathway.name;\n    const metaDescription = editPathway.description;\n    if (metaDescription && metaDescription !== '') description = metaDescription;\n  }\n\n  return (\n    <Dialog open={open} onClose={onClose} aria-labelledby=\"create-pathway\" fullWidth maxWidth=\"md\">\n      <DialogTitle disableTypography>\n        <IconButton aria-label=\"close\" onClick={onClose} className={styles.dialogCloseButton}>\n          <FontAwesomeIcon icon={faTimes} />\n        </IconButton>\n      </DialogTitle>\n\n      <form onSubmit={createNewPathwayMeta ? handleCreateNewPathway : handleUpdatePathway}>\n        <DialogContent>\n          <TextField\n            variant=\"outlined\"\n            autoFocus\n            label=\"Pathway Name\"\n            fullWidth\n            required={createNewPathwayMeta}\n            inputRef={pathwayNameRef}\n            defaultValue={createNewPathwayMeta ? undefined : name}\n          />\n\n          <TextField\n            variant=\"outlined\"\n            label=\"Pathway Description\"\n            fullWidth\n            inputRef={pathwayDescRef}\n            defaultValue={createNewPathwayMeta ? undefined : description}\n            multiline\n          />\n        </DialogContent>\n\n        <DialogActions>\n          <Button\n            variant=\"contained\"\n            color=\"primary\"\n            startIcon={createNewPathwayMeta && <FontAwesomeIcon icon={faPlus} />}\n            type=\"submit\"\n          >\n            {createNewPathwayMeta ? 'Create' : 'Save'}\n          </Button>\n        </DialogActions>\n      </form>\n    </Dialog>\n  );\n};\n\nexport default memo(PathwayModal);\n","import { makeStyles, Theme as AugmentedTheme } from '@material-ui/core/styles';\n\nexport default makeStyles(\n  (theme: AugmentedTheme) => ({\n    container: {\n      display: 'inline-block'\n    },\n    paper: {\n      display: 'flex',\n      flexDirection: 'row',\n      alignItems: 'center',\n      borderRadius: '10px',\n      border: '5px solid rgba(74, 74, 74, 0.5)',\n      backgroundColor: theme.palette.common.gray,\n      color: theme.palette.common.white,\n      padding: '0.5em',\n      mozBackgroundClip: 'padding' /* Firefox 3.6 */,\n      webkitBackgroundVlip: 'padding' /* Safari 4? Chrome 6? */,\n      backgroundClip: 'padding-box' /* Firefox 4, Safari 5, Opera 10, IE 9 */\n    },\n    displayText: {\n      marginRight: '4em',\n      whiteSpace: 'nowrap'\n    },\n    buttons: {\n      display: 'flex',\n      alignItems: 'center',\n      justifyContent: 'center',\n      minWidth: '2.5em',\n      minHeight: '2em',\n      cursor: 'pointer',\n      borderRadius: '15%',\n      marginRight: '0.5em'\n    }\n  }),\n  { name: 'ConfirmedDeletionButton' }\n);\n","import React, { FC, memo } from 'react';\nimport styles from './ActionButton.module.scss';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport { faTimes, faCheck } from '@fortawesome/free-solid-svg-icons';\n\ninterface ButtonProps {\n  type: 'accept' | 'decline';\n  onClick?: () => void;\n}\n\ninterface ActionButtonProps extends ButtonProps {\n  size: 'small' | 'large' | 'medium';\n}\n\nconst LargeActionButton: FC<ButtonProps> = ({ type, onClick }) => {\n  return (\n    <button\n      className={`${styles.largeActionButton} button ${type === 'decline' && styles.largeDecline}`}\n      type=\"button\"\n      onClick={onClick}\n    >\n      {type[0].toUpperCase() + type.slice(1)}\n    </button>\n  );\n};\n\nconst SmallActionButton: FC<ButtonProps> = ({ type, onClick }) => {\n  return (\n    <div\n      className={`${type === 'accept' ? styles.accept : styles.decline} ${\n        styles.smallActionButton\n      }`}\n      onClick={onClick}\n      data-testid={type}\n    >\n      <FontAwesomeIcon icon={type === 'accept' ? faCheck : faTimes} />\n    </div>\n  );\n};\n\nconst MediumActionButton: FC<ButtonProps> = ({ type, onClick }) => {\n  const buttonText = {\n    accept: 'Submit',\n    decline: 'Cancel'\n  };\n  return (\n    <div\n      className={`${type === 'accept' ? styles.accept : styles.decline} ${\n        styles.mediumActionButton\n      }`}\n      onClick={onClick}\n      data-testid={type}\n    >\n      <FontAwesomeIcon icon={type === 'accept' ? faCheck : faTimes} />\n      {buttonText[type]}\n    </div>\n  );\n};\n\nconst ActionButton: FC<ActionButtonProps> = ({ type, size, onClick }) => {\n  switch (size) {\n    case 'small':\n      return <SmallActionButton type={type} onClick={onClick} />;\n    case 'large':\n      return <LargeActionButton type={type} onClick={onClick} />;\n    case 'medium':\n      return <MediumActionButton type={type} onClick={onClick} />;\n  }\n};\n\nexport default memo(ActionButton);\n","import React, { FC, memo, useState, MouseEvent, useCallback } from 'react';\n\nimport { Button } from '@material-ui/core';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport { faTrashAlt } from '@fortawesome/free-solid-svg-icons';\nimport Popover from '@material-ui/core/Popover';\nimport ClickAwayListener from '@material-ui/core/ClickAwayListener';\nimport useStyles from './styles';\n\nimport ActionButton from 'components/ActionButton';\n\ninterface ConfirmedDeletionButtonProps {\n  deleteId: string;\n  deleteMethod: (id: string) => void;\n  deleteType?: string;\n  deleteName?: string;\n}\n\nconst ConfirmedDeletionButton: FC<ConfirmedDeletionButtonProps> = ({\n  deleteId,\n  deleteMethod,\n  deleteType,\n  deleteName\n}) => {\n  const styles = useStyles();\n  const [open, setOpen] = useState(false);\n  const [anchorEl, setAnchorEl] = useState<null | HTMLElement>(null);\n\n  const displayText =\n    'Are you sure' +\n    (deleteType && deleteMethod\n      ? ' that you would like to delete the ' + deleteName + ' ' + deleteType + ' ?'\n      : '?');\n\n  const onClickHandler = useCallback((event: MouseEvent<HTMLButtonElement>): void => {\n    setAnchorEl(event.currentTarget);\n    setOpen(true);\n  }, []);\n\n  const onAcceptHandler = useCallback((): void => {\n    deleteMethod(deleteId);\n    setOpen(false);\n    setAnchorEl(null);\n  }, [deleteId, deleteMethod]);\n\n  const onDeclineHandler = useCallback((): void => {\n    setOpen(false);\n    setAnchorEl(null);\n  }, []);\n\n  return (\n    <div className={styles.container}>\n      <ClickAwayListener onClickAway={onDeclineHandler}>\n        <Button\n          color=\"secondary\"\n          size=\"small\"\n          startIcon={<FontAwesomeIcon icon={faTrashAlt} />}\n          onClick={onClickHandler}\n        >\n          Delete\n        </Button>\n      </ClickAwayListener>\n      <Popover\n        classes={{ paper: styles.paper }}\n        open={open}\n        anchorEl={anchorEl}\n        anchorOrigin={{ vertical: 'bottom', horizontal: 'center' }}\n        transformOrigin={{ vertical: 'top', horizontal: 'center' }}\n      >\n        <div className={styles.displayText}> {displayText} </div>\n        <div className={styles.buttons}>\n          <ActionButton size=\"small\" type=\"accept\" onClick={onAcceptHandler} />\n          <ActionButton size=\"small\" type=\"decline\" onClick={onDeclineHandler} />\n        </div>\n      </Popover>\n    </div>\n  );\n};\n\nexport default memo(ConfirmedDeletionButton);\n","import React, { FC, memo, useState, useCallback, MouseEvent } from 'react';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport { faEdit, faFileDownload } from '@fortawesome/free-solid-svg-icons';\nimport {\n  Button,\n  Table,\n  TableBody,\n  TableCell,\n  TableContainer,\n  TableHead,\n  TableRow,\n  Link\n} from '@material-ui/core';\n\nimport { usePathwaysContext } from 'components/PathwaysProvider';\nimport PathwayModal from './PathwayModal';\n\nimport useStyles from './styles';\nimport { Pathway } from 'pathways-model';\nimport { Link as RouterLink } from 'react-router-dom';\nimport ConfirmedDeletionButton from 'components/ConfirmedDeletionButton';\nimport ExportMenu from 'components/elements/ExportMenu';\nimport { useCurrentPathwayContext } from 'components/CurrentPathwayProvider';\n\nconst PathwaysTable: FC = () => {\n  const styles = useStyles();\n  const { pathways, deletePathway } = usePathwaysContext();\n  const { setPathway } = useCurrentPathwayContext();\n  const [open, setOpen] = useState(false);\n  const [editablePathway, setEditablePathway] = useState<Pathway>();\n  const [anchorEl, setAnchorEl] = useState<null | HTMLElement>(null);\n\n  const openEditPathwayModal = useCallback((pathway: Pathway): void => {\n    setOpen(true);\n    setEditablePathway(pathway);\n  }, []);\n\n  const closeEditPathwayModal = useCallback((): void => {\n    setOpen(false);\n  }, []);\n\n  const openMenu = useCallback(\n    (event: MouseEvent<HTMLButtonElement>): void => {\n      setAnchorEl(event.currentTarget);\n      const pathway = pathways.filter(pathway => pathway.id === event.currentTarget.id);\n      if (pathway.length) setPathway(pathway[0]);\n    },\n    [pathways, setPathway]\n  );\n\n  const closeMenu = useCallback((): void => {\n    setAnchorEl(null);\n  }, []);\n\n  const deletion = useCallback(\n    (id: string): void => {\n      deletePathway(id);\n    },\n    [deletePathway]\n  );\n\n  return (\n    <div>\n      <TableContainer className={styles.pathwayList}>\n        <Table aria-label=\"pathway list\">\n          <TableHead>\n            <TableRow>\n              <TableCell>Pathway Name</TableCell>\n              <TableCell>Status</TableCell>\n              <TableCell>Last Updated</TableCell>\n              <TableCell></TableCell>\n            </TableRow>\n          </TableHead>\n\n          <TableBody>\n            {pathways.map(pathway => (\n              <TableRow key={pathway.id}>\n                <TableCell component=\"th\" scope=\"row\">\n                  <Link\n                    component={RouterLink}\n                    to={`/builder/${encodeURIComponent(pathway.id)}`}\n                    color=\"primary\"\n                    underline=\"none\"\n                  >\n                    {pathway.name}\n                  </Link>\n                </TableCell>\n\n                <TableCell>draft</TableCell>\n                <TableCell>2 days ago</TableCell>\n\n                <TableCell align=\"right\">\n                  <Button\n                    className={styles.pathwaysListButton}\n                    color=\"primary\"\n                    size=\"small\"\n                    startIcon={<FontAwesomeIcon icon={faEdit} />}\n                    onClick={(): void => openEditPathwayModal(pathway)}\n                  >\n                    Edit Info\n                  </Button>\n                  <Button\n                    id={pathway.id}\n                    className={styles.pathwaysListButton}\n                    color=\"primary\"\n                    size=\"small\"\n                    startIcon={<FontAwesomeIcon icon={faFileDownload} />}\n                    onClick={openMenu}\n                  >\n                    Export\n                  </Button>\n                  <ConfirmedDeletionButton\n                    deleteType=\"pathway\"\n                    deleteName={pathway.name}\n                    deleteId={pathway.id}\n                    deleteMethod={deletion}\n                  />\n                </TableCell>\n              </TableRow>\n            ))}\n          </TableBody>\n        </Table>\n      </TableContainer>\n      <ExportMenu anchorEl={anchorEl} closeMenu={closeMenu} />\n      <PathwayModal open={open} onClose={closeEditPathwayModal} editPathway={editablePathway} />\n    </div>\n  );\n};\n\nexport default memo(PathwaysTable);\n","import React, { FC, useCallback, useState, memo } from 'react';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport { faPlus } from '@fortawesome/free-solid-svg-icons';\nimport { Button } from '@material-ui/core';\n\nimport { usePathwaysContext } from 'components/PathwaysProvider';\nimport Loading from 'components/elements/Loading';\nimport PathwaysTable from './PathwaysTable';\nimport PathwayModal from './PathwayModal';\n\nimport useStyles from './styles';\n\nconst PathwaysList: FC = () => {\n  const styles = useStyles();\n  const [open, setOpen] = useState(false);\n  const { status } = usePathwaysContext();\n\n  const openNewPathwayModal = useCallback((): void => {\n    setOpen(true);\n  }, []);\n\n  const closeNewPathwayModal = useCallback((): void => {\n    setOpen(false);\n  }, []);\n\n  return (\n    <div className={styles.root}>\n      <Button\n        className={styles.createPathwayButton}\n        variant=\"contained\"\n        color=\"primary\"\n        startIcon={<FontAwesomeIcon icon={faPlus} />}\n        onClick={openNewPathwayModal}\n      >\n        Create Pathway\n      </Button>\n\n      <PathwayModal open={open} onClose={closeNewPathwayModal} />\n      {status === 'loading' ? <Loading /> : <PathwaysTable />}\n    </div>\n  );\n};\n\nexport default memo(PathwaysList);\n","import { makeStyles, Theme as AugmentedTheme } from '@material-ui/core/styles';\n\nexport default makeStyles(\n  (theme: AugmentedTheme) => ({\n    root: {\n      display: 'flex',\n      flexDirection: 'column',\n      padding: theme.variables.spacing.globalPadding\n    },\n    buttonRow: {\n      display: 'flex',\n      justifyContent: 'flex-end'\n    },\n    buildCriteriaButton: {\n      alignSelf: 'flex-end',\n      marginLeft: '20px'\n    },\n    criteriaList: {\n      marginTop: '2em'\n    },\n    editButton: {\n      marginRight: '1em'\n    },\n    dialogCloseButton: {\n      float: 'right',\n      width: '45px'\n    },\n    input: {\n      display: 'none'\n    },\n    chooseFileInput: {\n      display: 'flex',\n      alignItems: 'center'\n    },\n    inputButton: {\n      whiteSpace: 'nowrap',\n      marginRight: '1em'\n    },\n    fileName: {\n      fontStyle: 'italic'\n    }\n  }),\n  { name: 'CriteriaList', index: 1 }\n);\n","import React, { FC, memo, useCallback } from 'react';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport { faEdit } from '@fortawesome/free-solid-svg-icons';\nimport {\n  Button,\n  Table,\n  TableBody,\n  TableCell,\n  TableContainer,\n  TableHead,\n  TableRow\n} from '@material-ui/core';\nimport moment from 'moment';\n\nimport useStyles from './styles';\nimport { useCriteriaContext } from 'components/CriteriaProvider';\nimport ConfirmedDeletionButton from 'components/ConfirmedDeletionButton';\n\nconst CriteriaTable: FC = () => {\n  const styles = useStyles();\n  const { criteria, deleteCriteria } = useCriteriaContext();\n\n  const renderDate = (datetime: number): string => {\n    return moment(datetime).fromNow();\n  };\n\n  const deletion = useCallback(\n    (id: string): void => {\n      deleteCriteria(id);\n    },\n    [deleteCriteria]\n  );\n\n  return (\n    <TableContainer className={styles.criteriaList}>\n      <Table aria-label=\"criteria list\">\n        <TableHead>\n          <TableRow>\n            <TableCell>Criteria Name</TableCell>\n            <TableCell>Version</TableCell>\n            <TableCell>Added</TableCell>\n            <TableCell></TableCell>\n          </TableRow>\n        </TableHead>\n\n        <TableBody>\n          {criteria.map(c => (\n            <TableRow key={c.id}>\n              <TableCell component=\"th\" scope=\"row\">\n                {c.label}\n              </TableCell>\n              <TableCell>{c.version}</TableCell>\n              <TableCell>{renderDate(c.modified)}</TableCell>\n\n              <TableCell align=\"right\">\n                <Button\n                  className={styles.editButton}\n                  color=\"primary\"\n                  size=\"small\"\n                  startIcon={<FontAwesomeIcon icon={faEdit} />}\n                >\n                  Edit\n                </Button>\n                <ConfirmedDeletionButton\n                  deleteType=\"criterion\"\n                  deleteName={c.label}\n                  deleteId={c.id}\n                  deleteMethod={deletion}\n                />\n              </TableCell>\n            </TableRow>\n          ))}\n        </TableBody>\n      </Table>\n    </TableContainer>\n  );\n};\n\nexport default memo(CriteriaTable);\n","import React, { FC, useCallback, useRef, memo, FormEvent, useState } from 'react';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport { faFileImport, faTimes } from '@fortawesome/free-solid-svg-icons';\nimport {\n  Button,\n  Dialog,\n  DialogTitle,\n  DialogContent,\n  DialogActions,\n  Input,\n  IconButton\n} from '@material-ui/core';\n\nimport { useCriteriaContext } from 'components/CriteriaProvider';\nimport useStyles from './styles';\n\ninterface ImportCriteriaModalProps {\n  open: boolean;\n  onClose: () => void;\n}\n\nconst ImportCriteriaModal: FC<ImportCriteriaModalProps> = ({ open, onClose }) => {\n  const styles = useStyles();\n  const [fileName, setFileName] = useState<string>('');\n  const importFileRef = useRef<HTMLInputElement>(null);\n\n  const { addCriteria } = useCriteriaContext();\n\n  const selectFile = useCallback(\n    (event: FormEvent<HTMLFormElement>) => {\n      event.preventDefault();\n      const files = importFileRef?.current?.files;\n      if (files?.length) addCriteria(files[0]);\n      onClose();\n      setFileName('');\n    },\n    [addCriteria, onClose]\n  );\n\n  const handleChooseFile = useCallback(() => {\n    if (importFileRef?.current?.files?.[0]) setFileName(importFileRef.current.files[0].name);\n  }, [importFileRef]);\n\n  return (\n    <Dialog open={open} onClose={onClose} aria-labelledby=\"import-criteria\" fullWidth maxWidth=\"sm\">\n      <DialogTitle disableTypography>\n        <IconButton aria-label=\"close\" onClick={onClose} className={styles.dialogCloseButton}>\n          <FontAwesomeIcon icon={faTimes} />\n        </IconButton>\n      </DialogTitle>\n\n      <form onSubmit={selectFile}>\n        <DialogContent>\n          <div className={styles.chooseFileInput}>\n            <Input\n              id=\"choose-file-input\"\n              className={styles.input}\n              inputRef={importFileRef}\n              type=\"file\"\n              inputProps={{ accept: '.json' }}\n              onChange={handleChooseFile}\n            />\n\n            <label htmlFor=\"choose-file-input\">\n              <Button\n                className={styles.inputButton}\n                variant=\"contained\"\n                color=\"primary\"\n                component=\"span\"\n              >\n                Choose File\n              </Button>\n            </label>\n\n            <div className={styles.fileName}>\n              {fileName ? <span>{fileName}</span> : <span>Choose ELM file to import.</span>}\n            </div>\n          </div>\n        </DialogContent>\n\n        <DialogActions>\n          <Button\n            variant=\"contained\"\n            color=\"primary\"\n            startIcon={<FontAwesomeIcon icon={faFileImport} />}\n            type=\"submit\"\n          >\n            Import\n          </Button>\n        </DialogActions>\n      </form>\n    </Dialog>\n  );\n};\n\nexport default memo(ImportCriteriaModal);\n","import React, { FC, memo, useState, useCallback } from 'react';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport { faTools, faFileImport } from '@fortawesome/free-solid-svg-icons';\nimport { Button } from '@material-ui/core';\n\nimport { usePathwaysContext } from 'components/PathwaysProvider';\nimport Loading from 'components/elements/Loading';\nimport CriteriaTable from './CriteriaTable';\nimport ImportCriteriaModal from './ImportCriteriaModal';\n\nimport useStyles from './styles';\n\nconst CriteriaList: FC = () => {\n  const styles = useStyles();\n  const { status } = usePathwaysContext();\n\n  const [open, setOpen] = useState<boolean>(false);\n  const openImportModal = useCallback((): void => {\n    setOpen(true);\n  }, []);\n\n  const closeImportModal = useCallback((): void => {\n    setOpen(false);\n  }, []);\n\n  return (\n    <div className={styles.root}>\n      <div className={styles.buttonRow}>\n        <Button\n          className={styles.buildCriteriaButton}\n          variant=\"contained\"\n          color=\"primary\"\n          startIcon={<FontAwesomeIcon icon={faFileImport} />}\n          onClick={openImportModal}\n        >\n          Import Library\n        </Button>\n        <Button\n          className={styles.buildCriteriaButton}\n          variant=\"contained\"\n          color=\"primary\"\n          startIcon={<FontAwesomeIcon icon={faTools} />}\n        >\n          Build Criteria\n        </Button>\n      </div>\n\n      <ImportCriteriaModal open={open} onClose={closeImportModal} />\n\n      {status === 'loading' ? <Loading /> : <CriteriaTable />}\n    </div>\n  );\n};\n\nexport default memo(CriteriaList);\n","import React, { FC, memo } from 'react';\nimport { HashRouter as Router, Route, Switch } from 'react-router-dom';\n\nimport Header from 'components/Header';\n\nimport BuilderRoute from './BuilderRoute';\nimport ThemeProvider from './ThemeProvider';\nimport { PathwaysProvider } from './PathwaysProvider';\nimport { UserProvider } from './UserProvider';\nimport { CriteriaProvider } from './CriteriaProvider';\nimport Tabs from './Tabs';\nimport PathwaysList from './PathwaysList';\nimport CriteriaList from './CriteriaList';\nimport { CurrentPathwayProvider } from './CurrentPathwayProvider';\nimport { CurrentNodeProvider } from './CurrentNodeProvider';\nimport { BuildCriteriaProvider } from './BuildCriteriaProvider';\nimport { SnackbarProvider } from './SnackbarProvider';\n\nconst App: FC = () => {\n  return (\n    <ThemeProvider theme=\"light\">\n      <UserProvider>\n        <CurrentPathwayProvider>\n          <PathwaysProvider>\n            <CurrentNodeProvider>\n              <CriteriaProvider>\n                <SnackbarProvider>\n                  <BuildCriteriaProvider>\n                    <Router>\n                      <Switch>\n                        <Route path=\"/builder/:id/node/:nodeId\">\n                          <BuilderRoute />\n                        </Route>\n                        <Route path=\"/builder/:id\">\n                          <BuilderRoute />\n                        </Route>\n                        <Route path=\"/\">\n                          <Header />\n                          <Tabs\n                            tabs={[\n                              { label: 'Pathway', component: <PathwaysList /> },\n                              { label: 'Criteria', component: <CriteriaList /> }\n                            ]}\n                          />\n                        </Route>\n                      </Switch>\n                    </Router>\n                  </BuildCriteriaProvider>\n                </SnackbarProvider>\n              </CriteriaProvider>\n            </CurrentNodeProvider>\n          </PathwaysProvider>\n        </CurrentPathwayProvider>\n      </UserProvider>\n    </ThemeProvider>\n  );\n};\n\nexport default memo(App);\n","import 'react-app-polyfill/ie11';\nimport 'react-app-polyfill/stable';\nimport React from 'react';\nimport ReactDOM from 'react-dom';\nimport { enableMapSet } from 'immer';\n\nimport App from 'components/App';\n\nimport './styles/index.scss';\n\n// Enable use of immer produce on maps\nenableMapSet();\n\n// Enable why did you render for development mode\n// Will automatically track all memoized components\nif (process.env.NODE_ENV === 'development') {\n  const whyDidYouRender = require('@welldone-software/why-did-you-render');\n  whyDidYouRender(React, {\n    trackAllPureComponents: true\n  });\n}\n\nReactDOM.render(<App />, document.getElementById('root'));\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"node\":\"Node_node__38uoJ\",\"icon\":\"Node_icon__354W4\",\"actionable\":\"Node_actionable__bHXKd\",\"expandedNode\":\"Node_expandedNode__1ar-A\",\"childNotActionable\":\"Node_childNotActionable__1bfBq\",\"childActionable\":\"Node_childActionable__SwUjD\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"infoTable\":\"ExpandedNode_infoTable__3v2tx\",\"descTitle\":\"ExpandedNode_descTitle__15ki8\",\"desc\":\"ExpandedNode_desc__3Xdkf\",\"externalLink\":\"ExpandedNode_externalLink__1Mr1x\",\"defaultTextButton\":\"ExpandedNode_defaultTextButton__2Bvq6\",\"commentsForm\":\"ExpandedNode_commentsForm__3Q20Y\",\"footer\":\"ExpandedNode_footer__FOCYI\",\"comments\":\"ExpandedNode_comments__9q-JW\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"logo\":\"Header_logo__3T0lc\",\"homeLink\":\"Header_homeLink__2ew4r\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"root\":\"Loading_root__3b6qy\"};"],"sourceRoot":""}