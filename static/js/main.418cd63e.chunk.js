(this["webpackJsonppathway-builder"]=this["webpackJsonppathway-builder"]||[]).push([[0],{1055:function(e,t,n){e.exports=n.p+"static/media/camino-logo-dark.c8fc712a.png"},1083:function(e,t,n){e.exports=n(1491)},132:function(e,t,n){e.exports={selectButton:"ActionButton_selectButton___qB5R",accept:"ActionButton_accept__28b2D",decline:"ActionButton_decline__zz-vG",smallActionButton:"ActionButton_smallActionButton__1bPWu",largeActionButton:"ActionButton_largeActionButton__blRdA",largeDecline:"ActionButton_largeDecline__wz9Zw",mediumActionButton:"ActionButton_mediumActionButton__3EpOp"}},1490:function(e,t,n){},1491:function(e,t,n){"use strict";n.r(t);n(1084),n(1093);var a=n(34);Object(a.b)();var r=n(0),i=n.n(r),o=n(56),c=n.n(o),l=n(94),u=n(151),d=n(23),s=n(25),m=n(24),f=n(1063),b=n(1555),p=Object(r.createContext)({}),v=Object(r.memo)((function(e){var t=e.children,n=Object(r.useState)(""),a=Object(d.a)(n,2),o=a[0],c=a[1],l=Object(r.useState)(null),u=Object(d.a)(l,2),s=u[0],m=u[1],f=Object(r.useState)(!1),b=Object(d.a)(f,2),v=b[0],h=b[1],y=Object(r.useState)(""),g=Object(d.a)(y,2),E=g[0],C=g[1],O=Object(r.useCallback)((function(){c(""),m(null),h(!1),C("")}),[c,m,h,C]);return i.a.createElement(p.Provider,{value:{buildCriteriaSelected:v,setBuildCriteriaSelected:h,currentCriteriaNodeId:o,setCurrentCriteriaNodeId:c,currentCriteria:s,setCurrentCriteria:m,criteriaName:E,setCriteriaName:C,resetCurrentCriteria:O}},t)})),h=function(){return Object(r.useContext)(p)},y=n(1523),g=n(57),E=n(1062),C=n(261),O=n.n(C),j={spacing:{globalPadding:"2em"}},k={white:"#fff",black:"#222",red:"#d95d77",blue:"#5d89a1",blueLighter:"#9ad2f0",gray:"#4a4a4a",grayMedium:"#bbbdc0",grayBlue:"#cbd5df",grayLight:"#6c6c6c",grayLighter:"#eaeef2",grayDark:"#444",grayVeryDark:"#3a3a3a",green:"#2fa874"},x={fontFamily:["Open Sans","-apple-system","BlinkMacSystemFont","Segoe UI","Roboto","Oxygen","Ubuntu","Cantarell","Fira Sans","Droid Sans","Helvetica Neue","sans-serif"].join(",")},w={MuiButton:{root:{borderRadius:0,height:"38px","&$disabled":{backgroundColor:k.grayMedium,color:k.white}},contained:{"&$disabled":{backgroundColor:k.grayMedium,color:k.white}},label:{fontWeight:600},iconSizeMedium:{"& > *:first-child":{fontSize:14}},iconSizeSmall:{"& > *:first-child":{fontSize:14}}},MuiTableHead:{root:{backgroundColor:k.grayLighter}},MuiTableCell:{root:{fontSize:"1em"},head:{padding:"5px 16px",borderBottom:"none"}},MuiFormControl:{root:{margin:"10px 0"}},MuiFormLabel:{root:{fontStyle:"italic","&.Mui-error":{color:k.white},"&.Mui-disabled":{color:k.white}}},MuiInputBase:{root:{fontWeight:600},input:{"&::selection":{color:k.white,backgroundColor:k.grayDark},"&:-webkit-autofill":{transitionDelay:"9999s",transitionProperty:"background-color, color"},"&$disabled":{color:k.white,backgroundColor:k.grayDark}}},MuiTooltip:{tooltip:{fontSize:14,backgroundColor:k.black},arrow:{color:k.black}},MuiOutlinedInput:{root:{borderRadius:"0"}},MuiSelect:{icon:{fontSize:"2em"}},MuiPaper:{rounded:{borderRadius:"0"}},MuiDialogTitle:{root:{padding:"1em"}},MuiDialogContent:{root:{padding:"0 4em"}},MuiDialogActions:{root:{padding:"2em 4em"}},MuiCard:{root:{overflow:"visible"}},MuiIconButton:{root:{color:k.gray,"&:disabled":{color:k.grayMedium}}}},N={MuiFormControl:{root:{"&:hover":{borderColor:k.white}}},MuiFormLabel:{root:{color:k.white,"&$focused":{color:k.white}}},MuiInputBase:{root:{color:k.white,"&:hover":{borderColor:k.white,backgroundColor:k.grayDark}}},MuiTooltip:{tooltip:{fontSize:14}},MuiOutlinedInput:{root:{"&:hover":{borderColor:k.white},"&:hover $notchedOutline":{borderColor:k.white},"&$focused $notchedOutline":{borderColor:k.white},"&$disabled $notchedOutline":{borderColor:k.white}},notchedOutline:{borderColor:k.white}},MuiSelect:{icon:{color:k.white}},MuiMenuItem:{root:{color:k.grayDark}},MuiIconButton:{root:{color:k.white,"&:disabled":{color:k.grayLight}}}},S={primary:{main:k.blue},secondary:{main:k.red},error:{main:k.red},common:k,background:{default:k.grayLighter},text:{primary:k.gray,secondary:k.gray},grey:{800:k.gray}},T=Object(E.a)({typography:Object(g.a)({},x),palette:Object(g.a)({},S),overrides:Object(g.a)({},w),variables:Object(g.a)({},j)}),R=Object(E.a)({typography:Object(g.a)({},x),palette:O()(S,{text:{primary:k.white,secondary:k.white}}),overrides:O()(w,N),variables:Object(g.a)({},j)}),I=Object(E.a)({typography:Object(g.a)({},x),palette:O()(S,{background:{default:k.grayBlue},text:{primary:k.black,secondary:k.black}}),overrides:Object(g.a)({},w),variables:Object(g.a)({},j)}),P=function(e){var t=e.theme;if(e.useProjector)switch(t){case"dark":return R;default:return I}switch(t){case"dark":return R;default:return T}},D=Object(r.createContext)({}),B=Object(r.memo)((function(e){var t=e.theme,n=void 0===t?"light":t,a=e.children,o=Object(r.useState)(!1),c=Object(d.a)(o,2),l=c[0],u=c[1],s=P({theme:n,useProjector:l}),m=Object(r.useCallback)((function(){u((function(e){return!e}))}),[]);return i.a.createElement(y.a,{theme:s},i.a.createElement(D.Provider,{value:{useProjector:l,toggleTheme:m}},a))})),L=n(1055),M=n.n(L),A=n(262),F=n.n(A),q=Object(r.memo)((function(){var e=h().resetCurrentCriteria,t=Object(r.useState)(null),n=Object(d.a)(t,2),a=n[0],o=n[1],c=Object(r.useContext)(D).toggleTheme,u=Object(r.useCallback)((function(e){o(e.currentTarget)}),[]),p=Object(r.useCallback)((function(){o(null)}),[]),v=Object(r.useCallback)((function(){c(),p()}),[c,p]);return i.a.createElement("header",{className:F.a.header},i.a.createElement(l.b,{to:"/",className:F.a.homeLink,onClick:function(){return e()}},i.a.createElement("img",{src:M.a,alt:"logo",className:F.a.logo})),i.a.createElement("button",{onClick:u,"aria-controls":"options-menu","aria-haspopup":"true"},i.a.createElement(s.a,{icon:m.g})),i.a.createElement(f.a,{id:"options-menu",anchorEl:a,keepMounted:!0,open:Boolean(a),onClose:p},i.a.createElement(b.a,{onClick:v},"Toggle Theme")))})),z=n(1528),_=n(1529),W=n(1527),H=Object(W.a)((function(e){return{root:{display:"flex",alignItems:"center",padding:"2em",backgroundColor:e.palette.background.default,color:e.palette.text.primary,height:"6em",justifyContent:"space-between"},backButton:{height:"45px",width:"45px"},navigationIcons:{fontSize:"20px",cursor:"pointer"},pathwayName:{fontSize:"1.4em",marginLeft:"1.5em"}}}),{name:"Navigation",index:1}),G=n(1057);var U=function(e){var t=Object(G.a)(e),n=Object(d.a)(t,2),a=n[0],i=n[1],o=i.set,c=i.reset,l=i.undo,u=i.redo,s=i.canUndo,m=i.canRedo,f=Object(r.useRef)(a.present);return Object(r.useEffect)((function(){f.current=a.present}),[a]),[a.present,f,s,m,l,u,c,o]},K=n(66),J=n(181);function V(e){return fetch(e,{headers:{Accept:"application/json"}})}function $(e,t,n){return fetch(e,n).then((function(e){return t?e.text():e.json()}))}var Y=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=Object(r.useState)({status:"loading"}),a=Object(d.a)(n,2),i=a[0],o=a[1];return Object(r.useEffect)((function(){V(e).then((function(e){return e.json()})).then((function(n){return n.map((function(n){return $(e+"/"+n,t)}))})).then((function(e){return Promise.all(e)})).then((function(e){return o({status:"loaded",payload:e})})).catch((function(e){return o({status:"error",error:e})}))}),[e,t]),i};var Q=function(e){var t=Object(r.useState)(e),n=Object(d.a)(t,2),a=n[0],i=n[1],o=Object(r.useRef)(a);return Object(r.useEffect)((function(){o.current=a}),[a]),[a,o,i]},X=n(70),Z=n.n(X),ee=J.a.get("cqlToElmWebserviceUrl");function te(e){return fetch(ee,{method:"POST",headers:{"Content-Type":"application/cql",Accept:"application/elm+json"},body:e}).then((function(e){return e.json()}))}var ne=Object(r.createContext)({}),ae=["Patient","MeetsInclusionCriteria","InPopulation","Recommendation","Rationale","Errors"];function re(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=e.library.statements.def,r=a.filter((function(e){return!ae.includes(e.name)})),i=!!a.find((function(e){return e.resultTypeName}));if(i&&(r=r.filter((function(e){return"{urn:hl7-org:elm-types:r1}Boolean"===e.resultTypeName}))),!r)return alert("No elm statement found in that file"),[];var o=n?"Criteria Builder (".concat(e.library.identifier.id.substring(0,5),")"):e.library.identifier.id;return r.map((function(n){return{id:Z.a.generate(),label:"".concat(o,": ").concat(n.name),version:e.library.identifier.version,modified:Date.now(),elm:e,cql:t,statement:n.name}}))}function ie(e){return te(e).then((function(t){var n,a;return(null===(n=t.library)||void 0===n||null===(a=n.identifier)||void 0===a?void 0:a.id)?re(t,e):[]}))}var oe=Object(r.memo)((function(e){var t=e.children,n=Object(r.useState)([]),a=Object(d.a)(n,2),o=a[0],c=a[1],l=Y(J.a.get("demoCriteria"),!0).payload;Object(r.useEffect)((function(){if(l){var e=l.map((function(e){return ie(e)}));Promise.all(e).then((function(e){return e.flat()})).then((function(e){return c(e)}))}}),[l]);var u=Object(r.useCallback)((function(e){ie(e).then((function(t){t.length>0?c((function(n){return n.find((function(t){return t.cql===e}))?n:[].concat(Object(K.a)(n),Object(K.a)(t))})):alert("No valid criteria were found in the provided file")}))}),[]),s=Object(r.useCallback)((function(e){var t=new FileReader;t.onload=function(t){var n;if(null===(n=t.target)||void 0===n?void 0:n.result){var a=t.target.result;if(e.name.endsWith(".json")){var r=function(e){var t,n=JSON.parse(e);if(null===(t=n.library)||void 0===t?void 0:t.identifier)return re(n);alert("Please upload ELM file")}(a);r&&c((function(e){return[].concat(Object(K.a)(e),Object(K.a)(r))}))}else e.name.endsWith(".cql")&&u(a)}else alert("Unable to read that file")},t.readAsText(e)}),[u]),m=Object(r.useCallback)((function(e){c((function(t){return t.filter((function(t){return t.id!==e}))}))}),[]),f=Object(r.useCallback)((function(e){var t=re(e,void 0,!0);return c((function(e){return[].concat(Object(K.a)(e),Object(K.a)(t))})),t}),[]),b=Object(r.useCallback)((function(e,t,n){var a=function(e,t){return{id:Z.a.generate(),label:t,modified:Date.now(),builder:e,statement:t}}(e,t);if(n){var r=o.find((function(e){return e.id===n}));r&&(a.id=r.id,c((function(e){return[].concat(Object(K.a)(e.filter((function(e){return e.id!==r.id}))),[a])})))}else c((function(e){return[].concat(Object(K.a)(e),[a])}));return[a]}),[o]);return i.a.createElement(ne.Provider,{value:{criteria:o,addCriteria:s,addCqlCriteria:u,deleteCriteria:m,addElmCriteria:f,addBuilderCriteria:b}},t)})),ce=function(){return Object(r.useContext)(ne)},le=Object(r.createContext)({}),ue=Object(r.memo)((function(e){var t=e.children,n=Q([]),o=Object(d.a)(n,3),c=o[0],l=o[1],u=o[2],s=Y(J.a.get("demoPathwaysService")),m=s.payload,f=ce(),b=f.addCqlCriteria,p=f.criteria,v=Object(r.useCallback)((function(e){u((function(t){return[].concat(Object(K.a)(t),[e])}))}),[u]),h=Object(r.useCallback)((function(e){e.library.forEach((function(e){return b(e)}))}),[b]),y=Object(r.useCallback)((function(e){var t=new FileReader;t.onload=function(e){var t;if(null===(t=e.target)||void 0===t?void 0:t.result){var n=e.target.result,a=JSON.parse(n);u((function(e){return e.map((function(e){return e.id})).includes(a.id)?(alert("Pathway with that id already exists!"),e):(h(a),[].concat(Object(K.a)(e),[a]))}))}else alert("Unable to read that file")},t.readAsText(e)}),[h,u]),g=Object(r.useCallback)((function(e){u((function(t){return t.filter((function(t){return t.id!==e}))}))}),[u]),E=Object(r.useCallback)((function(e){var t=l.current.findIndex((function(t){return t.id===e.id}));u((function(n){return[].concat(Object(K.a)(n.slice(0,t)),[e],Object(K.a)(n.slice(t+1)))}))}),[l,u]);switch(Object(r.useEffect)((function(){m&&u(m)}),[m,u]),Object(r.useEffect)((function(){var e=p.map((function(e){return e.id}));c.forEach((function(t,n){return Object.entries(t.nodes).forEach((function(t){var r=Object(d.a)(t,2),i=r[0];r[1].transitions.forEach((function(t,r){var o=t.condition;if(o&&!e.includes(o.criteriaSource)){var c,l=o.cql.split("."),s=Object(d.a)(l,2),m=s[0],f=s[1],b=null===(c=p.find((function(e){var t;return(null===(t=e.elm)||void 0===t?void 0:t.library.identifier.id)===m&&e.statement===f})))||void 0===c?void 0:c.id;b&&u((function(e){return Object(a.a)(e,(function(e){var t=e[n].nodes[i].transitions[r].condition;t&&(t.criteriaSource=b)}))}))}}))}))}))}),[p,c,u]),s.status){case"error":return i.a.createElement("div",null,"Error loading pathways");default:return i.a.createElement(le.Provider,{value:{pathways:c,addPathway:v,addPathwayFromFile:y,deletePathway:g,updatePathway:E,status:s.status}},t)}})),de=function(){return Object(r.useContext)(le)},se=n(336),me=Object(r.createContext)({}),fe=Object(r.memo)((function(e){var t=e.children,n=U(null),a=Object(d.a)(n,8),o=a[0],c=a[1],l=a[2],u=a[3],s=a[4],m=a[5],f=a[6],b=a[7],p=de().updatePathway,v=Object(r.useCallback)((function(){s()}),[s]),h=Object(r.useCallback)((function(){m()}),[m]),y=Object(r.useCallback)((function(e){f(e)}),[f]),g=Object(r.useCallback)((function(e){b(e)}),[b]);return Object(r.useEffect)((function(){o&&p(o)}),[o,p]),i.a.createElement(me.Provider,{value:{pathway:o,pathwayRef:c,canUndoPathway:l,canRedoPathway:u,undoPathway:v,redoPathway:h,resetCurrentPathway:y,setCurrentPathway:g}},i.a.createElement(se.a,{keyName:"control+z,command+z",onKeyDown:v},i.a.createElement(se.a,{keyName:"control+y,command+y",onKeyDown:h},t)))})),be=function(){return Object(r.useContext)(me)},pe=n(116),ve=n(182),he=n(183),ye=n(1552);function ge(e){return e&&"null"!==e.type?e.type:"null"}function Ee(e){return"action"===e.type}function Ce(e){return"branch"===e.type}var Oe={MedicationRequest:"Medication",ServiceRequest:"Procedure",CarePlan:"Regimen"},je=[{label:"Medication",value:"MedicationRequest"},{label:"Procedure",value:"ServiceRequest"},{label:"Regimen",value:"CarePlan"},{label:"Observation",value:"Observation"},{label:"Pathway Reference",value:"Reference"}];function ke(e,t){var n=xe(e,t);return 1===n.length?n[0]:null}function xe(e,t){var n=[];return Object.keys(e).forEach((function(a){var r,i=Object(pe.a)(e[a].transitions);try{for(i.s();!(r=i.n()).done;){if(r.value.transition===t){n.push(a);break}}}catch(o){i.e(o)}finally{i.f()}})),n}function we(e){return JSON.parse(JSON.stringify(e))}function Ne(e,t){var n=function(e){return JSON.parse(JSON.stringify(e))}(e);return n.key=t,n}function Se(e,t){var n=0;return Object.keys(e.nodes).forEach((function(a){e.nodes[a].transitions.forEach((function(e){e.transition===t&&(n+=1)}))})),!(n>=2)}function Te(e,t){var n=!0;return t.forEach((function(t){Se(e,t.transition)&&(n=!1)})),n}function Re(e,t,n){var a="/builder/".concat(encodeURIComponent(e),"/node/").concat(encodeURIComponent(t));a!==n.location.pathname&&n.push(a)}var Ie=function(e){var t;switch(e.resource.resourceType){case"MedicationRequest":t=e.resource.medicationCodeableConcept;break;case"ServiceRequest":t=e.resource.code;break;case"CarePlan":t={coding:[{system:"FakeCarePlanSystem",code:e.resource.title,display:"Fake CodeableConcept for CarePlan"}],text:"Fake CodeableConcept for CarePlan"}}return t},Pe=n(154),De=n(207);function Be(e,t,n,a){var r=Object.entries(t).map((function(e){var t=Object(d.a)(e,2),n=t[0],a=t[1];return'include "'.concat(n,"\" version '").concat(a.version,"' called ").concat(n,"\n\n")})).join(""),i=Object.entries(n).map((function(e){var t=Object(d.a)(e,2),n=t[0],a=t[1];return'define "'.concat(n,'": ').concat(a,".").concat(n,"\n\n")}));Object.entries(a).forEach((function(e){var t=Object(d.a)(e,2),n=t[0],a=t[1];return i.push('define "'.concat(n,'": ').concat(a,"\n\n"))}));var o=i.join("");return"\nlibrary ".concat(e," version '1.0'\n\nusing FHIR version '4.0.1'\n\n").concat(r,"\n\ncontext Patient\n\n").concat(o,"\n")}var Le=Pe.R4.LibraryStatusKind._draft,Me=Pe.R4.PlanDefinitionStatusKind._draft,Ae=Pe.R4.ActivityDefinitionStatusKind._draft,Fe=Pe.R4.BundleTypeKind._transaction,qe=Pe.R4.Bundle_RequestMethodKind._put,ze=Pe.R4.PlanDefinition_ConditionKindKind._applicability,_e=Pe.R4.ExpressionLanguageKind._textCql,We=De.PlanDefinition_RelatedActionRelationshipKind._beforeStart,He=De.PlanDefinition_RelatedActionRelationshipKind._afterEnd,Ge=function(){function e(t,n,a){Object(ve.a)(this,e),this.pathway=void 0,this.pathways=void 0,this.bundle=void 0,this.criteria=void 0,this.nestedBranch=void 0,this.libraries=void 0,this.activityDefinitions=void 0;var r=we(t);r.nodes=$e(r.nodes),this.pathway=r,this.bundle={id:this.pathway.id,resourceType:"Bundle",type:Fe,entry:[]},this.criteria=a,this.nestedBranch=[],this.activityDefinitions={},this.libraries=[],this.pathways=n}return Object(he.a)(e,[{key:"export",value:function(){var e=this.createPlanDefinition(Object(ye.a)(),"Strategy".concat(this.pathway.name),"Strategy for ".concat(this.pathway.name),"strategy");return this._export(e,this.pathway),this.bundle.entry.push(Je(e)),this.bundle}},{key:"_export",value:function(e,t,n,a){var r=this,i=Ve(t.name,"Action for ".concat(t.name));(null===n||void 0===n?void 0:n.id)&&i.id&&(Ke(i,n.id,He),Ke(n,i.id,We),a&&(i.condition=a)),e.action.find((function(e){return e.id===t.name}))||function(){for(var n=r.createLibraries(t),a=n[0],o=Object(ye.a)(),c=r.createPlanDefinition(o,t.name,t.description,"recommendation",a.id),l=["Start"],u=[],d=function(){var a=l.shift(),o=t.nodes[a],d=ke(t.nodes,a);if(d&&!u.includes(d))return l.filter((function(e){return e!==d})),l.unshift(d),l.push(a),"continue";d&&r.convertNode(a,d,c,e,t,i,n),u.push(a),o.transitions.forEach((function(e){u.includes(e.transition)||l.includes(e.transition)||l.push(e.transition)}))};0!==l.length;)d();c.action.length&&(i.definitionCanonical=Ue("PlanDefinition",o),r.bundle.entry.push(Je(c))),e.action.push(i),n.forEach((function(e){var t=e.content[0].data;!r.libraries.find((function(e){return e===t}))&&t&&(r.bundle.entry.push(Je(e)),r.libraries.push(t))}))}()}},{key:"createActivityDefinition",value:function(e){var t=Object(ye.a)(),n=e.resource.resourceType,a=Ie(e),r=a.coding[0];if(this.activityDefinitions[r.system]&&this.activityDefinitions[r.system][r.code])return null;var i={id:t,resourceType:"ActivityDefinition",meta:{profile:["http://hl7.org/fhir/uv/cpg/StructureDefinition/cpg-publishableactivity"]},extension:[{url:"http://hl7.org/fhir/uv/cpg/StructureDefinition/cpg-knowledgeCapability",valueCode:"publishable"}],url:"urn:uuid:".concat(t),version:"1.0",name:"AD".concat(t.substring(0,7)),title:"ActivityDefinition: ".concat(t),status:Ae,experimental:!0,date:(new Date).toISOString(),publisher:"Logged in user",description:e.description,kind:n};switch(n){case"MedicationRequest":i.productCodeableConcept=a;break;case"ServiceRequest":case"CarePlan":i.code=a}return this.setActivityDefinitionId(r,t),i}},{key:"createPlanDefinition",value:function(e,t,n,a,r){var i={id:e,resourceType:"PlanDefinition",meta:{profile:["http://hl7.org/fhir/uv/cpg/StructureDefinition/cpg-".concat(a,"definition")]},extension:[{url:"http://hl7.org/fhir/uv/cpg/StructureDefinition/cpg-knowledgeCapability",valueCode:"executable"}],url:"urn:uuid:".concat(e),version:"1.0",name:"PD".concat(e.substring(0,7)),title:t,type:{coding:[{system:"http://terminology.hl7.org/CodeSystem/plan-definition-type",code:"strategy"===a?"workflow-definition":"eca-rule",display:"strategy"===a?"Workflow Definition":"ECA Rule"}]},status:Me,experimental:!0,publisher:"Logged in user",description:n,action:[]};return r&&(i.library=[r]),i}},{key:"createLibraries",value:function(e){var t=this,n=Object(ye.a)(),a="LIB".concat(n.substring(0,7)),r={id:n,resourceType:"Library",meta:{profile:["http://hl7.org/fhir/uv/cpg/StructureDefinition/cpg-executablelibrary"]},extension:[{url:"http://hl7.org/fhir/uv/cpg/StructureDefinition/cpg-knowledgeCapability",valueCode:"executable"}],url:"urn:uuid:".concat(n),version:"1.0",name:a,title:"Library for ".concat(e.name),status:Le,experimental:!0,type:{coding:[{system:"http://terminology.hl7.org/CodeSystem/library-type",code:"logic-library",display:"Logic Library"}]},publisher:"Logged in user",description:"CQL/ELM library for pathway: ".concat(e.name),content:[]},i={},o={},c={};for(var l in e.nodes){var u,s=e.nodes[l],m=Object(pe.a)(s.transitions);try{var f=function(){var e,n=u.value;if(null===(e=n.condition)||void 0===e?void 0:e.criteriaSource){var a=t.criteria.find((function(e){var t;return e.id===(null===(t=n.condition)||void 0===t?void 0:t.criteriaSource)}));if((null===a||void 0===a?void 0:a.elm)&&(null===a||void 0===a?void 0:a.cql)){var r=a.elm.library.identifier;i[r.id]={cql:a.cql,version:r.version},o[n.condition.cql]=r.id}else(null===a||void 0===a?void 0:a.builder)&&(c[a.statement]=a.builder.cql)}};for(m.s();!(u=m.n()).done;)f()}catch(v){m.e(v)}finally{m.f()}}var b=Object.entries(i).map((function(t){var n=Object(d.a)(t,2),a=n[0],r=n[1],i=Object(ye.a)();return{id:i,resourceType:"Library",url:"urn:uuid:".concat(i),version:r.version,name:a,title:a,status:Le,experimental:!0,type:{coding:[{system:"http://terminology.hl7.org/CodeSystem/library-type",code:"logic-library",display:"Logic Library"}]},publisher:"Logged in user",description:"CQL/ELM library for pathway: ".concat(e.name," / sublibrary ").concat(a),content:[{id:a,contentType:"text/cql",data:btoa(r.cql),title:"CQL for library ".concat(a)}]}})),p=Be(a,i,o,c);return r.content.push({id:"navigational-cql",contentType:"text/cql",data:btoa(p),title:"CQL for navigating the pathway"}),e.elm&&r.content.push({id:"navigational-elm",contentType:"application/elm+json",data:btoa(JSON.stringify(e.elm.navigational)),title:"ELM for navigating the pathway"},{id:"precondition",contentType:"application/elm+json",data:btoa(JSON.stringify(e.elm.preconditions)),title:"ELM for pathway preconditions"}),[r].concat(Object(K.a)(b))}},{key:"convertNode",value:function(e,t,n,a,r,i,o){var c=r.nodes[e],l=r.nodes[t],u="".concat(c.label," (Key: ").concat(e,") - Parent Node Key: ").concat(t);if(Ee(c)){var d=this.createActivityDefinition(c.action),s=Ve(e,"Action for ".concat(u),d?d.id:this.getActivityDefinitionId(c.action));Ce(l)&&(s.condition=this.createCondition(l,e,o));for(var m=l;Ce(m);){var f=ke(r.nodes,m.key);if(!f)break;m=r.nodes[f]}"Start"!==m.key&&Ke(s,m.key,He),function e(t,n){var a=[];return t[n].transitions.map((function(e){return e.transition})).forEach((function(n){Ee(t[n])?a.push(n):a.push.apply(a,Object(K.a)(e(t,n)))})),a}(r.nodes,e).forEach((function(e){return Ke(s,e,We)})),this.addActionToPlanDefinition(s,n,l.key),d&&this.bundle.entry.push(Je(d))}else if(Ce(c)){var b="Branch based on ".concat(u);if(Ce(l)){var p=Ve(e,b);p.condition=this.createCondition(l,e,o),this.nestedBranch.push(e),this.addActionToPlanDefinition(p,n,l.key)}}else if(function(e){return"reference"===e.type}(c)){var v=this.pathways.find((function(e){return e.id===c.referenceId}));if(v){var h=we(v);if(h.nodes=$e(h.nodes),Ce(l)){var y=this.createCondition(l,e,o);this._export(a,h,i,y)}else this._export(a,h,i)}}else if("start"!==c.type){var g="Error Exporting at Node ".concat(c.label,"\n").concat(c.label," Node does not have a node type. Please edit the node to have a node type and add applicable details and try again.");throw alert(g),console.error("".concat(g,"\n").concat(JSON.stringify(c,void 0,2))),g}}},{key:"createCondition",value:function(e,t,n){var a=n[0],r=function(e,t){return e.transitions.find((function(e){return e.transition===t}))}(e,t);if(r){var i=this.criteria.find((function(e){var t;return e.id===(null===(t=r.condition)||void 0===t?void 0:t.criteriaSource)}));return[{kind:ze,expression:{language:_e,expression:"".concat(a.name,".").concat(null===i||void 0===i?void 0:i.statement)}}]}return[]}},{key:"getActivityDefinitionId",value:function(e){var t=Ie(e).coding[0];return this.activityDefinitions[t.system][t.code]}},{key:"setActivityDefinitionId",value:function(e,t){this.activityDefinitions[e.system]||(this.activityDefinitions[e.system]={}),this.activityDefinitions[e.system][e.code]=t}},{key:"addActionToPlanDefinition",value:function(e,t,n){if(this.nestedBranch.includes(n)){var a,r=function e(t,n){var a,r=Object(pe.a)(t);try{for(r.s();!(a=r.n()).done;){var i=a.value;if(i.id===n)return i;if(i.action){var o=e(i.action,n);if(o)return o}}}catch(c){r.e(c)}finally{r.f()}return}(t.action,n);if(!r)return;(null===(a=r.action)||void 0===a?void 0:a.length)?r.action.push(e):r.action=[e]}else t.action.push(e)}}]),e}();function Ue(e,t){return"http://example.com/".concat(e,"/").concat(t)}function Ke(e,t,n){var a,r={actionId:t,relationship:n};(null===(a=e.relatedAction)||void 0===a?void 0:a.length)?e.relatedAction.push(r):e.relatedAction=[r]}function Je(e){return{fullUrl:Ue(e.resourceType,e.id),resource:e,request:{method:qe,url:"/".concat(e.resourceType,"/").concat(e.id)}}}function Ve(e,t,n){var a={id:e,title:"Action: ".concat(e),description:t,code:[{coding:[{system:"http://hl7.org/fhir/uv/cpg/CodeSystem/cpg-common-process",code:"guideline-based-care",display:"Guideline-based Care"}]}]};return n&&(a.definitionCanonical=Ue("ActivityDefinition",n)),a}function $e(e){var t=e;return Object.keys(e).forEach((function(n){var a=function(e,t){var n=[];return xe(e,t).forEach((function(a){e[a].transitions.forEach((function(e){e.transition===t&&n.push(e)}))})),n}(e,n);a.length>1&&(a.shift(),a.forEach((function(a){var r=function(e,t){var n={},a={},r=function(e){return e.transitions.map((function(e){return e.transition}))},i=t,o=Z.a.generate();a[i]=o,n[o]=Ne(e[i],o);for(var c=r(e[i]),l=[i];c.length;)i=c.shift(),l.includes(i)||(o=Z.a.generate(),a[i]=o,n[o]=Ne(e[i],o),c.push.apply(c,Object(K.a)(r(e[i]))),l.push(i));return Object.keys(n).forEach((function(e){n[e].transitions.forEach((function(e){return e.transition=a[e.transition]}))})),n}(e,n);r=$e(r),a&&(a.transition=r[Object.keys(r)[0]].key,Object.keys(r).forEach((function(e){return t[e]=r[e]})))})))})),t}var Ye=function(){function e(t,n){Object(ve.a)(this,e),this.pathway=void 0,this.criteria=void 0,this.pathway=we(t),this.criteria=n}return Object(he.a)(e,[{key:"export",value:function(){var e=this,t=Object(ye.a)(),n="LIB".concat(t.substring(0,7)),a={},r={},i={};for(var o in this.pathway.nodes){var c,l=this.pathway.nodes[o],u=Object(pe.a)(l.transitions);try{var d=function(){var t,o=c.value;if(null===(t=o.condition)||void 0===t?void 0:t.criteriaSource){var l=e.criteria.find((function(e){var t;return e.id===(null===(t=o.condition)||void 0===t?void 0:t.criteriaSource)}));if((null===l||void 0===l?void 0:l.elm)&&(null===l||void 0===l?void 0:l.cql)){var u=l.elm.library.identifier;a[u.id]={cql:l.cql,version:u.version},r[o.condition.cql]=u.id,o.condition.cql.startsWith(u.id)||(o.condition.cql="".concat(u.id,".").concat(o.condition.cql))}else(null===l||void 0===l?void 0:l.builder)&&(i[l.statement]=l.builder.cql,o.condition.cql="".concat(n,".").concat(o.condition.cql))}};for(u.s();!(c=u.n()).done;)d()}catch(b){u.e(b)}finally{u.f()}}var s=[];if(Object.keys(i).length>0){var m=Be(n,{},{},i);s.push(m)}if(Object.keys(a).length>0){var f=Object.values(a).map((function(e){return e.cql}));s.push.apply(s,Object(K.a)(f))}return this.pathway.library=s,this.pathway}}]),e}();function Qe(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=Xe(e,t,n,a),i=new Blob([r],{type:"application/json"}),o=window.URL.createObjectURL(i),c=document.createElement("a");c.href=o,c.download="".concat(e.name,".json"),c.click(),window.URL.revokeObjectURL(o)}function Xe(e,t,n,r){var i=function(e,t){return Object(a.a)(e,(function(e){e.elm||(e.elm={}),e.elm.navigational=t}))}(e,function(e){var t={library:{identifier:{id:e.id,version:"1.0.0"},schemaIdentifier:{id:"urn:hl7-org:elm",version:"r1"},usings:{def:[{localIdentifier:"System",uri:"urn:hl7-org:elm-types:r1"},{localId:"1",locator:"3:1-3:26",localIdentifier:"FHIR",uri:"http://hl7.org/fhir",version:"4.0.0"}]},statements:{def:[{locator:"13:1-13:15",name:"Patient",context:"Patient",expression:{type:"SingletonFrom",operand:{locator:"13:1-13:15",dataType:"{http://hl7.org/fhir}Patient",type:"Retrieve"}}}]},includes:{def:[]},valueSets:{def:[]},codes:{def:[]},codeSystems:{def:[]}}};return Object.keys(e.nodes).forEach((function(n){var r=e.nodes[n];if("elm"in r&&r.elm){Ze(t,r.elm);var i=Object(a.a)(et(r.elm),(function(e){e.name=r.key}));t.library.statements.def.push(i)}r.transitions.forEach((function(e){var n;if(null===(n=e.condition)||void 0===n?void 0:n.elm){Ze(t,e.condition.elm);var r=Object(a.a)(et(e.condition.elm),(function(t){var n,a;t.name=null!==(n=null===(a=e.condition)||void 0===a?void 0:a.description)&&void 0!==n?n:"Unknown"}));t.library.statements.def.push(r)}}))})),t}(e)),o=i;r?o=new Ge(i,t,n).export():o=new Ye(i,n).export();return JSON.stringify(o,void 0,2)}function Ze(e,t){var n,a,r,i,o;null===(n=t.library.usings)||void 0===n||n.def.forEach((function(t){var n,a;(null===(n=e.library.usings)||void 0===n?void 0:n.def.find((function(e){return e.uri===t.uri})))||null===(a=e.library.usings)||void 0===a||a.def.push(t)})),null===(a=t.library.includes)||void 0===a||a.def.forEach((function(t){var n,a;(null===(n=e.library.includes)||void 0===n?void 0:n.def.find((function(e){return e.path===t.path})))||null===(a=e.library.includes)||void 0===a||a.def.push(t)})),null===(r=t.library.valueSets)||void 0===r||r.def.forEach((function(t){var n,a;(null===(n=e.library.valueSets)||void 0===n?void 0:n.def.find((function(e){return e.id===t.id})))||null===(a=e.library.valueSets)||void 0===a||a.def.push(t)})),null===(i=t.library.codes)||void 0===i||i.def.forEach((function(t){var n,a;(null===(n=e.library.codes)||void 0===n?void 0:n.def.find((function(e){return e.name===t.name})))||null===(a=e.library.codes)||void 0===a||a.def.push(t)})),null===(o=t.library.codeSystems)||void 0===o||o.def.forEach((function(t){var n,a;(null===(n=e.library.codeSystems)||void 0===n?void 0:n.def.find((function(e){return e.name===t.name})))||null===(a=e.library.codeSystems)||void 0===a||a.def.push(t)}))}function et(e){var t=["Patient","MeetsInclusionCriteria","InPopulation","Recommendation","Rationale","Errors"];return e.library.statements.def.find((function(e){return!t.includes(e.name)}))}function tt(e,t,n){switch(n){case"MedicationRequest":return nt(it(e,t),t,{type:"create",description:"",id:Z.a.generate(),resource:{resourceType:n,medicationCodeableConcept:{coding:[{system:"",code:"",display:""}]}}});case"ServiceRequest":return nt(it(e,t),t,{type:"create",description:"",id:Z.a.generate(),resource:{resourceType:n,code:{coding:[{system:"",code:"",display:""}]}}});case"CarePlan":return nt(it(e,t),t,{type:"create",description:"",id:Z.a.generate(),resource:{resourceType:n,title:""}});case"Observation":return function(e,t){return Object(a.a)(e,(function(e){var n=e.nodes[t],a={key:n.key,label:n.label,transitions:n.transitions,type:"branch"};e.nodes[t]=a}))}(e,t);case"Reference":return function(e,t){return Object(a.a)(e,(function(e){var n=e.nodes[t],a={key:n.key,label:n.label,transitions:n.transitions,referenceId:"",referenceLabel:"",type:"reference"};e.nodes[t]=a}))}(e,t);default:return console.error("Unknown nodeType: "+n),e}}function nt(e,t,n){return Object(a.a)(e,(function(e){e.nodes[t].action=n}))}function at(e,t,n){return Object(a.a)(e,(function(e){var a={id:Z.a.generate(),transition:n};e.nodes[t].transitions.push(a)}))}function rt(e,t,n,r,i){return Object(a.a)(e,(function(e){var a,o,c=null===(a=e.nodes[t])||void 0===a||null===(o=a.transitions)||void 0===o?void 0:o.find((function(e){return e.id===n}));c&&(c.condition={description:r,cql:i.statement,elm:i.elm,criteriaSource:i.id})}))}function it(e,t){return Object(a.a)(e,(function(e){var n=e.nodes[t];n.type="action",void 0===n.cql&&void 0===n.action&&(n.cql=""),n.transitions.forEach((function(e){delete e.condition}))}))}var ot=Object(r.memo)((function(e){var t=e.anchorEl,n=e.closeMenu,a=be().pathway,r=de().pathways,o=ce().criteria;return i.a.createElement(f.a,{id:"pathway-options-menu",anchorEl:t,getContentAnchorEl:null,anchorOrigin:{vertical:"bottom",horizontal:"left"},keepMounted:!0,open:Boolean(t),onClose:n},i.a.createElement(b.a,{onClick:function(){a?Qe(a,r,o):alert("No pathway to download!"),n()}},"Export Pathway"),i.a.createElement(b.a,{onClick:function(){a?Qe(a,r,o,!0):alert("No pathway to download!"),n()}},"Export to CPG"))})),ct=function(){var e=h().resetCurrentCriteria,t=Object(r.useState)(null),n=Object(d.a)(t,2),a=n[0],o=n[1],c=be(),l=c.pathway,f=c.canUndoPathway,b=c.canRedoPathway,p=c.undoPathway,v=c.redoPathway,y=H(),g=Object(u.g)(),E=Object(r.useCallback)((function(e){o(e.currentTarget)}),[]),C=Object(r.useCallback)((function(){o(null)}),[]),O=Object(r.useCallback)((function(){e(),g.push("/")}),[g,e]);return i.a.createElement("nav",{className:y.root},i.a.createElement("div",null,i.a.createElement(z.a,{className:y.backButton,onClick:O,"aria-label":"go back"},i.a.createElement(s.a,{icon:m.e,className:y.navigationIcons})),i.a.createElement("span",{className:y.pathwayName},null===l||void 0===l?void 0:l.name)),i.a.createElement("div",null,i.a.createElement(_.a,{placement:"top",title:"Undo",arrow:!0},i.a.createElement("span",null,i.a.createElement(z.a,{onClick:p,disabled:!f,"aria-label":"undo"},i.a.createElement(s.a,{icon:m.B,className:y.navigationIcons})))),i.a.createElement(_.a,{placement:"top",title:"Redo",arrow:!0},i.a.createElement("span",null,i.a.createElement(z.a,{onClick:v,disabled:!b,"aria-label":"redo"},i.a.createElement(s.a,{icon:m.t,className:y.navigationIcons})))),i.a.createElement(z.a,{onClick:E,"aria-controls":"pathway-options-menu","aria-haspopup":"true"},i.a.createElement(s.a,{icon:m.i,className:y.navigationIcons})),i.a.createElement(ot,{anchorEl:a,closeMenu:C})))},lt=Object(W.a)((function(e){return{root:{display:"flex",flexDirection:"column",padding:e.variables.spacing.globalPadding,color:e.palette.text.primary,backgroundColor:e.palette.common.gray,width:"33%",minWidth:"550px",overflowY:"scroll"},formControl:{margin:e.spacing(1,0),minWidth:375},referenceDropdown:{display:"flex"},referenceChevron:{fontSize:"2em",marginLeft:"1em",lineHeight:"2.5em",cursor:"pointer","&:hover":{color:e.palette.common.grayLighter}},divider:{width:"100%"},headerLabelStart:{cursor:"default"},displayText:{margin:"0 0 5px 0",fontWeight:900,fontSize:"1em"},sidebarHeader:{display:"flex",justifyContent:"space-between"},sidebarHeaderGroup:{display:"flex",alignItems:"center"},sidebarHeaderButton:{height:"45px",width:"45px",color:e.palette.text.primary},headerLabelGroup:{display:"flex",cursor:"pointer",height:"60px"},headerLabel:{display:"flex",alignItems:"center",fontSize:"1.6em",fontWeight:700,margin:"0 5px"},headerLabelText:{marginBottom:"5px"},editIcon:{fontSize:"0.6em",marginLeft:"10px"},sidebarButtonGroup:{display:"flex",margin:"10px 0"},sidebarButtonGroupExtraMargin:{display:"flex",margin:"20px 0 10px 0"},sidebarButton:{minWidth:180,marginRight:"20px"},sidebarButtonText:{fontStyle:"italic"},outlinedDiv:{display:"flex",flexDirection:"column",alignItems:"flex-start"},outlinedDivError:{borderColor:"".concat(e.palette.error.main," !important"),"&:hover":{borderColor:"".concat(e.palette.error.main," !important")}},toggleSidebar:{display:"inline-flex",alignItems:"center",justifyContent:"center",float:"left",width:"50px",minWidth:"50px",height:"50px",fontSize:"2em",backgroundColor:e.palette.primary.main,color:e.palette.text.primary,"&:hover":{cursor:"pointer"}},cancelButton:{alignSelf:"flex-end",marginTop:"5px",padding:"5px 15px",fontSize:"1em"},editButton:{marginLeft:"1em",alignSelf:"flex-end",marginTop:"5px",padding:"5px 15px",fontSize:"1em",backgroundColor:e.palette.primary.main,borderColor:e.palette.primary.main,"&:hover":{backgroundColor:e.palette.primary.main,borderColor:e.palette.primary.main}},buildCriteriaContainer:{display:"flex",justifyContent:"flex-end"},buildCriteriaText:{marginTop:"0.5em",marginBottom:"1em"},saveButton:{marginLeft:"1em",backgroundColor:e.palette.error.main,borderColor:e.palette.error.main,"&:hover":{backgroundColor:e.palette.error.main}},transitionContainer:{backgroundColor:e.palette.common.grayVeryDark,padding:"5px 15px",margin:"15px 0"},dividerHeader:{width:"100%",textTransform:"uppercase",borderBottom:"1px solid "+e.palette.common.blueLighter,color:e.palette.common.blueLighter,lineHeight:"0.1em",margin:"10px 0 20px",fontWeight:800,paddingLeft:"15px","& span":{background:e.palette.common.gray,padding:"0 10px"}},dialogCloseButton:{float:"right",width:"45px"},dialogContent:{color:e.palette.common.black,fontSize:"16px",display:"flex",marginTop:"-25px"},dialogContentText:{paddingLeft:"10px",lineHeight:"40px"},alertIcon:{color:e.palette.common.red,fontSize:"40px"},connectDropdown:{margin:"auto",display:"flex",flexDirection:"column",flexWrap:"nowrap",alignContent:"center"},connectText:{display:"flex",flexDirection:"row",alignItems:"center",fontSize:"0.95em",fontStyle:"italic"},cancelButtonDropdown:{marginLeft:"auto",border:"none",alignSelf:"center",color:e.palette.common.blueLighter,fontSize:"1em",fontStyle:"italic",textTransform:"none"},criteriaText:{width:"100%"}}}),{name:"Sidebar",index:1}),ut=Object(r.createContext)({}),dt=Object(r.memo)((function(e){var t=e.children,n=Q(null),a=Object(d.a)(n,3),o=a[0],c=a[1],l=a[2],u=Object(r.useCallback)((function(e){l(e)}),[l]);return i.a.createElement(ut.Provider,{value:{currentNode:o,currentNodeRef:c,setCurrentNode:u}},t)})),st=function(){return Object(r.useContext)(ut)},mt=n(1556),ft=n(1532),bt=n(1558),pt=n(1550),vt=n(1549),ht=Object(r.memo)((function(e){var t=e.id,n=e.label,a=e.options,o=e.value,c=e.onChange,l=e.autocomplete,u=void 0===l||l,d=Object(r.useCallback)((function(e){c&&c(e.target.value||"")}),[c]),f=Object(r.useCallback)((function(e,t){c&&t&&c(t.value)}),[c]),p=function(e){return a.find((function(t){return t.value===e}))};return i.a.createElement(i.a.Fragment,null,u?i.a.createElement(vt.a,{fullWidth:!0,onChange:f,value:p(o)||null,popupIcon:i.a.createElement(s.a,{icon:m.b,style:{color:"white"}}),options:a,getOptionLabel:function(e){return e.label},renderOption:function(e){return i.a.createElement("div",{key:e.value,style:{color:"black"}},e.label)},renderInput:function(e){return i.a.createElement(mt.a,Object.assign({error:null==o||""===o},e,{variant:"outlined",label:n}))}}):i.a.createElement(ft.a,{variant:"outlined",fullWidth:!0},i.a.createElement(bt.a,{id:t,htmlFor:"".concat(t,"-select")},n),i.a.createElement(pt.a,{id:"".concat(t,"-select"),value:o||"",onChange:d,label:n,error:null==o||""===o,MenuProps:{getContentAnchorEl:null,anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"center"}},displayEmpty:!0},a.map((function(e){return i.a.createElement(b.a,{key:e.value,value:e.value},e.label)})))))})),yt=n(1559),gt=n(1534),Et=Object(r.createContext)({}),Ct=Object(r.memo)((function(e){var t=e.children,n=Object(r.useState)(!1),a=Object(d.a)(n,2),o=a[0],c=a[1],l=Object(r.useState)("Deleted Successfully"),u=Object(d.a)(l,2),s=u[0],m=u[1],f=Object(r.useCallback)((function(){c(!1)}),[c]);return i.a.createElement(Et.Provider,{value:{snackbarText:s,openSnackbar:o,handleCloseSnackbar:f,setSnackbarText:m,setOpenSnackbar:c}},t)})),Ot=function(){return Object(r.useContext)(Et)},jt=Object(r.memo)((function(){var e=be().undoPathway,t=Ot(),n=t.snackbarText,a=t.openSnackbar,o=t.handleCloseSnackbar,c=Object(r.useCallback)((function(){e(),o()}),[e,o]);return i.a.createElement(yt.a,{anchorOrigin:{vertical:"bottom",horizontal:"right"},open:a,autoHideDuration:1e4,onClose:o,message:n,action:i.a.createElement(i.a.Fragment,null,i.a.createElement(gt.a,{color:"secondary",size:"small",onClick:c},"UNDO"),i.a.createElement(z.a,{size:"small","aria-label":"close",color:"inherit",onClick:o},i.a.createElement(s.a,{icon:m.y})))})})),kt=Object(r.memo)((function(){var e=be(),t=e.pathway,n=e.pathwayRef,a=e.setCurrentPathway,o=st(),c=o.currentNode,l=o.currentNodeRef,u=lt(),s=Object(r.useState)(!1),f=Object(d.a)(s,2),b=f[0],p=f[1],v=c&&t?function(e,t){var n,a=[],r=function e(t,n,a){var r=[],i=[],o=t.nodes[a];return o.transitions.forEach((function(a){var c;a.transition===n?r.push(o):(null===(c=i=e(t,n,a.transition))||void 0===c?void 0:c.length)&&(r.some((function(e){return e.key===o.key}))||r.push(o),r=r.concat(i))})),r}(e,null!==(n=t.key)&&void 0!==n?n:"","Start");return r.push(t),Object.keys(e.nodes).forEach((function(n){var i=e.nodes[n],o=t.transitions.some((function(e){return e.transition===n})),c=r.some((function(e){return e.key===n}));o||c||!i.key||a.push({label:i.label,value:i.key})})),a}(t,c):[],h=v.length>0,y=Object(r.useCallback)((function(e){n.current&&l.current&&a(at(n.current,l.current.key,e)),p(!1)}),[a,l,n]),g=Object(r.useCallback)((function(){p(!b)}),[b]);return i.a.createElement("div",null,!b&&i.a.createElement(Tt,{buttonName:"Connect Node",buttonIcon:m.n,buttonText:"Create a transition to an existing node in the pathway.",onClick:g,disabled:!h,hasTooltip:!h,tooltipTitle:"There are no possible nodes to connect to."}),b&&h&&i.a.createElement("div",{className:u.connectDropdown},i.a.createElement(ht,{id:"transitions",label:"Node To Connect To",options:v,onChange:y}),i.a.createElement("div",{className:u.connectText},"Select node from list to add transition.",i.a.createElement(gt.a,{className:u.cancelButtonDropdown,size:"small",variant:"text",onClick:g},"Cancel"))))})),xt=Object(r.memo)((function(){var e=be(),t=e.pathway,n=e.pathwayRef,o=e.setCurrentPathway,c=st(),l=c.currentNode,f=c.currentNodeRef,b=Object(r.useState)(!0),p=Object(d.a)(b,2),v=p[0],h=p[1],y=lt(),g=Object(u.g)(),E=Object(r.useRef)(null),C=Object(r.useCallback)((function(){h(!v)}),[v]),O=Object(r.useCallback)((function(e){f.current&&n.current&&o(tt(n.current,f.current.key,e))}),[n,o,f]),j=Object(r.useCallback)((function(){if(f.current&&n.current){var e,t=(e||(e=Z.a.generate()),{key:e,label:"New Node",transitions:[],type:"null"}),r=function(e,t){return Object(a.a)(e,(function(e){e.nodes[t.key]=t}))}(n.current,t);r=at(r,f.current.key,t.key),o(r),Ce(f.current)||Re(n.current.id,t.key,g)}}),[n,o,f,g]);if(!t)return i.a.createElement("div",null,"Error: No pathway");if(!l)return i.a.createElement("div",null,"Error: No current node");if("start"===l.type)return i.a.createElement(i.a.Fragment,null,v&&i.a.createElement("div",{className:y.root,ref:E},i.a.createElement(St,{node:l,isTransition:!1}),i.a.createElement("h5",{className:y.dividerHeader},i.a.createElement(i.a.Fragment,null)," "),i.a.createElement(Tt,{buttonName:"Add Node",buttonIcon:m.q,buttonText:"Add a new transition to a new node in the pathway.",onClick:j})),i.a.createElement("div",{className:y.toggleSidebar,onClick:C},i.a.createElement(s.a,{icon:v?m.e:m.f})),i.a.createElement(jt,null));var k=ge(l),x="start"!==k||0===l.transitions.length;return i.a.createElement(i.a.Fragment,null,v&&i.a.createElement("div",{className:y.root,ref:E},i.a.createElement(St,{node:l,isTransition:!1}),i.a.createElement("h5",{className:y.dividerHeader},i.a.createElement("span",null,"Details")),"null"===k&&i.a.createElement(ht,{id:"nodeType",label:"Node Type",options:je,onChange:O,value:""}),"reference"===k&&i.a.createElement(Pt,{changeNodeType:O}),"action"===k&&i.a.createElement(It,{changeNodeType:O}),"branch"===k&&i.a.createElement(ht,{id:"nodeType",label:"Node Type",options:je,onChange:O,value:"Observation"}),i.a.createElement("h5",{className:y.dividerHeader},i.a.createElement("span",null,"Transitions")),null===l||void 0===l?void 0:l.transitions.map((function(e){return i.a.createElement(Vt,{key:e.id,transition:e},"branch"===k&&i.a.createElement(qt,{key:e.id,transition:e}))})),x&&i.a.createElement(i.a.Fragment,null,i.a.createElement(Tt,{buttonName:"Add New Node",buttonIcon:m.q,buttonText:"Add a new transition to a new node in the pathway.",onClick:j}),i.a.createElement(kt,null))),i.a.createElement("div",{className:y.toggleSidebar,onClick:C},i.a.createElement(s.a,{icon:v?m.e:m.f})),i.a.createElement(jt,null))})),wt=n(15),Nt=n(1530),St=Object(r.memo)((function(e){var t=e.node,n=e.isTransition,o=void 0!==n&&n,c=Object(r.useState)(!1),l=Object(d.a)(c,2),f=l[0],b=l[1],p=Object(r.useState)(!1),v=Object(d.a)(p,2),h=v[0],y=v[1],g=Object(r.useState)(!1),E=Object(d.a)(g,2),C=E[0],O=E[1],j=st().currentNodeRef,k=Ot(),x=k.setSnackbarText,w=k.setOpenSnackbar,N=be(),S=N.pathway,T=N.pathwayRef,R=N.setCurrentPathway,I=Object(r.useRef)(null),P=(null===t||void 0===t?void 0:t.label)||"",D=lt(),B=Object(u.g)(),L=Object(r.useCallback)((function(){if(T.current){var e=xe(T.current.nodes,t.key);Re(T.current.id,e[0],B)}}),[B,T,t.key]),M=Object(r.useCallback)((function(){T.current&&Re(T.current.id,t.key,B)}),[B,T,t.key]),A=Object(r.useCallback)((function(){var e,n,r=null!==(e=null===(n=I.current)||void 0===n?void 0:n.value)&&void 0!==e?e:"";T.current&&R(function(e,t,n){return Object(a.a)(e,(function(e){e.nodes[t].label=n}))}(T.current,t.key,r)),b(!1)}),[T,R,t.key]),F=Object(r.useCallback)((function(){b(!0)}),[]),q=Object(r.useCallback)((function(){if(T.current&&Te(T.current,t.transitions)){var e=xe(T.current.nodes,t.key);R(function(e,t){return Object(a.a)(e,(function(e){delete e.nodes[t],Object.keys(e.nodes).forEach((function(n){e.nodes[n].transitions.forEach((function(a){a.transition===t&&(e.nodes[n].transitions=e.nodes[n].transitions.filter((function(e){return a.id!==e.id})))}))}))}))}(T.current,t.key)),Re(T.current.id,e[0],B),O(!1),x("".concat(t.label," node deleted successfully")),w(!0)}}),[T,R,x,w,t.key,t.label,t.transitions,B]),W=Object(r.useCallback)((function(){j.current&&T.current&&!Se(T.current,t.key)&&(R(function(e,t,n){return Object(a.a)(e,(function(e){var a=e.nodes[t].transitions.filter((function(e){return e.transition!==n}));e.nodes[t].transitions=a}))}(T.current,j.current.key,t.key)),O(!1),x("Transition from ".concat(j.current.label," to ").concat(t.label," deleted successfully")),w(!0))}),[T,j,R,x,w,t]),H=Object(r.useCallback)((function(){O(!0)}),[]),G=Object(r.useCallback)((function(){O(!1)}),[]),U=Object(r.useCallback)((function(){y(!0)}),[]),K=Object(r.useCallback)((function(){y(!1)}),[]),J=Object(r.useCallback)((function(e){"Enter"===e.key&&A()}),[A]),V=!S||!Te(S,t.transitions),$=!S||Se(S,t.key),Y=o?$:V,Q=o?"Deleting this transition would result in an orphaned node. To delete, first add the child node as a transition to another node, or delete it directly.":"Deleting this node would result in an orphaned descendent node. To delete, first add another transition to the would-be orphaned node from another node, or delete it directly.";return i.a.createElement("div",{className:D.sidebarHeader},i.a.createElement("div",{className:D.sidebarHeaderGroup},"start"!==t.type&&!o&&i.a.createElement(z.a,{className:D.sidebarHeaderButton,onClick:L,"aria-label":"go to parent node"},i.a.createElement(s.a,{icon:m.e})),i.a.createElement("div",{className:D.headerLabelGroup,onClick:F},f&&"start"!==t.type?i.a.createElement(ft.a,{className:D.formControl,fullWidth:!0},i.a.createElement(Nt.a,{className:D.headerLabel,type:"text",inputRef:I,onBlur:A,onKeyPress:J,defaultValue:P,autoFocus:!0,onFocus:function(e){return e.target.select()}})):i.a.createElement("div",{className:Object(wt.a)(D.headerLabel,D.headerLabelText,"start"===t.type&&D.headerLabelStart)},P,"Start"!==t.key&&i.a.createElement(s.a,{className:D.editIcon,icon:m.h})))),i.a.createElement("div",{className:D.sidebarHeaderGroup},"start"!==t.type&&i.a.createElement(_.a,{placement:"top",open:!!Y&&h,onClose:K,onOpen:U,title:Q,arrow:!0},i.a.createElement("span",null,i.a.createElement(z.a,{className:D.sidebarHeaderButton,onClick:H,"aria-label":o?"delete transition":"delete node",disabled:Y},i.a.createElement(s.a,{icon:m.A})))),o&&i.a.createElement(z.a,{className:D.sidebarHeaderButton,onClick:M,"aria-label":"go to transition node"},i.a.createElement(s.a,{icon:m.f}))),i.a.createElement(Kt,{nodeLabel:t.label,isTransition:o,open:C,onDelete:o?W:q,onClose:G}))})),Tt=Object(r.memo)((function(e){var t=e.buttonName,n=e.buttonIcon,a=e.buttonText,r=e.extraMargin,o=void 0!==r&&r,c=e.onClick,l=e.hasTooltip,u=void 0!==l&&l,d=e.tooltipTitle,m=void 0===d?"":d,f=e.disabled,b=void 0!==f&&f,p=e.buttonColor,v=void 0===p?"primary":p,h=lt(),y=function(e){var t=e.children;return u?i.a.createElement(_.a,{title:m,placement:"top"},i.a.createElement("span",null,t)):i.a.createElement(i.a.Fragment,null,t)};return i.a.createElement("div",{className:o?h.sidebarButtonGroupExtraMargin:h.sidebarButtonGroup},i.a.createElement(y,null,i.a.createElement(gt.a,{className:h.sidebarButton,variant:"contained",color:v,startIcon:i.a.createElement(s.a,{icon:n}),onClick:c,disabled:b},t)),i.a.createElement("div",{className:h.sidebarButtonText},a))})),Rt=[{label:"ICD-9-CM",value:"http://hl7.org/fhir/sid/icd-9-cm"},{label:"ICD-10-CM",value:"http://hl7.org/fhir/sid/icd-10-cm"},{label:"LOINC",value:"http://loinc.org"},{label:"NCI",value:"http://ncimeta.nci.nih.gov"},{label:"RXNORM",value:"http://www.nlm.nih.gov/research/umls/rxnorm"},{label:"SNOMED",value:"http://snomed.info/sct"}],It=Object(r.memo)((function(e){var t=e.changeNodeType,n=be(),o=n.pathwayRef,c=n.setCurrentPathway,l=st(),u=l.currentNode,d=l.currentNodeRef,f=lt(),b=Object(r.useCallback)((function(e,t){o.current&&te(function(e,t){var n=e.resource,a="cql".concat(Z.a.generate().replace(/-/g,"a")),r="library ".concat(a," version '1'\nusing FHIR version '4.0.0'\n"),i=function(e){return'codesystem "'.concat(e,"\": '").concat(e,"'\n")},o=function(e){return"return Tuple{ resourceType: '".concat(e,"', id: R.id.value, status: R.status.value}")},c=function(e){return"[".concat(e,': "').concat(a,' code"]')},l=function(){return'define "'.concat(t,'":')};if("MedicationRequest"===n.resourceType){var u=n.medicationCodeableConcept.coding[0];r+=i(u.system),r+='code "'.concat(a," code\": '").concat(escape(u.code),"' from \"").concat(u.system,"\" display '").concat(u.display,"'\n"),r+="".concat(l(),"\n      ").concat(c("MedicationRequest")," R ").concat(o("MedicationRequest"))}else if("ServiceRequest"===n.resourceType){var d=n.code.coding[0];r+=i(d.system),r+='code "'.concat(a," code\": '").concat(escape(d.code),"' from \"").concat(d.system,"\" display '").concat(d.display,"'\n"),r+="".concat(l(),"\n      if exists ").concat(c("Procedure"),"\n      then ").concat(c("Procedure")," R ").concat(o("Procedure"),"\n      else ").concat(c("ServiceRequest")," R ").concat(o("ServiceRequest"))}else"CarePlan"===n.resourceType?r+="".concat(l(),"\n      [CarePlan] R where R.title.value = '").concat(escape(n.title),"' ").concat(o("CarePlan")):console.error("Auto generating CQL for action - unsupported resource type: "+n.resourceType);return r}(e,t)).then((function(e){c(function(e,t,n){return Object(a.a)(e,(function(e){e.nodes[t].elm=n,e.nodes[t].cql=et(n).name}))}(o.current,t,e))}))}),[o,c]),p=Object(r.useCallback)((function(e){var t=d.current;if(t.action&&o.current){var n=(null===e||void 0===e?void 0:e.target.value)||"",r=function(e,t){return Object(a.a)(e,(function(e){e.resource.medicationCodeableConcept?e.resource.medicationCodeableConcept.coding[0].code=t:e.resource.code.coding[0].code=t}))}(t.action,n);c(nt(o.current,t.key,E(r)))}}),[d,o,c]),v=Object(r.useCallback)((function(e){var t=d.current;if(t.action&&o.current){var n=(null===e||void 0===e?void 0:e.target.value)||"",r=function(e,t){return Object(a.a)(e,(function(e){e.description=t}))}(t.action,n);c(nt(o.current,t.key,r))}}),[d,o,c]),h=Object(r.useCallback)((function(e){var t=d.current;if(t.action&&o.current){var n=(null===e||void 0===e?void 0:e.target.value)||"",r=function(e,t){return Object(a.a)(e,(function(e){e.resource.title=t}))}(t.action,n);c(nt(o.current,t.key,E(r))),b(r,t.key)}}),[d,o,c,b]),y=Object(r.useCallback)((function(e){var t=d.current;if(t.action&&o.current){var n=function(e,t){return Object(a.a)(e,(function(e){e.resource.medicationCodeableConcept?e.resource.medicationCodeableConcept.coding[0].system=t:e.resource.code.coding[0].system=t}))}(t.action,e);c(nt(o.current,t.key,E(n)))}}),[d,o,c]),g=Object(r.useCallback)((function(){var e=d.current;if(e.action&&o.current){var t=function(e,t){return Object(a.a)(e,(function(e){e.resource.medicationCodeableConcept?e.resource.medicationCodeableConcept.coding[0].display=t:e.resource.title?e.resource.description=t:e.resource.code.coding[0].display=t}))}(e.action,"Example Text");c(nt(o.current,e.key,t)),b(t,e.key)}else console.error("No Actions -- Cannot Validate")}),[d,o,c,b]),E=function(e){return Object(a.a)(e,(function(e){e.resource.medicationCodeableConcept?e.resource.medicationCodeableConcept.coding[0].display="":"CarePlan"===e.resource.resourceType?e.resource.description="":e.resource.code.coding[0].display=""}))},C=function(e){"Enter"===e.key&&g()},O=u.action;if(!O)return i.a.createElement(i.a.Fragment,null);var j=(null===u||void 0===u?void 0:u.key)&&"start"!==u.type,k=O.resource,x="",w="",N="";return"MedicationRequest"===k.resourceType||"ServiceRequest"===k.resourceType?(x=k.code?k.code.coding[0].system:k.medicationCodeableConcept.coding[0].system,w=k.code?k.code.coding[0].code:k.medicationCodeableConcept.coding[0].code,N=k.code?k.code.coding[0].display:k.medicationCodeableConcept.coding[0].display):N=k.description,i.a.createElement(i.a.Fragment,null,j&&i.a.createElement(i.a.Fragment,null,i.a.createElement(ht,{id:"nodeType",label:"Node Type",options:je,onChange:t,value:k.resourceType}),("MedicationRequest"===k.resourceType||"ServiceRequest"===k.resourceType)&&i.a.createElement(i.a.Fragment,null,i.a.createElement(ht,{id:"codeSystem",label:"Code System",options:Rt,onChange:y,value:x}),x&&i.a.createElement(mt.a,{id:"code-input",label:"Code",value:w,onChange:p,variant:"outlined",error:""===w,inputProps:{onKeyPress:C}}),w&&i.a.createElement(i.a.Fragment,null,N?i.a.createElement("div",{className:f.displayText},i.a.createElement(s.a,{icon:m.d})," ",N):i.a.createElement(Tt,{buttonName:"Validate",buttonIcon:m.d,buttonText:N||"Check validation of the input system and code",onClick:g}),i.a.createElement(mt.a,{id:"description-input",label:"Description",value:O.description||"",onChange:v,variant:"outlined",error:""===O.description}))),"CarePlan"===k.resourceType&&i.a.createElement(i.a.Fragment,null,i.a.createElement(mt.a,{id:"title-input",label:"Title",value:k.title||"",onChange:h,variant:"outlined",error:null==k.title,inputProps:{onKeyPress:C}}),k.title&&i.a.createElement(mt.a,{id:"description-input",label:"Description",value:O.description||"",onChange:v,variant:"outlined",error:""===O.description}))))})),Pt=Object(r.memo)((function(e){var t=e.changeNodeType,n=st(),o=n.currentNode,c=n.currentNodeRef,l=de(),d=l.pathways,f=l.updatePathway,b=be(),p=b.pathwayRef,v=b.setCurrentPathway,h=Object(u.g)(),y=d.map((function(e){return{label:e.name,value:e.id}})),g=lt(),E=Object(r.useCallback)((function(){var e=o.referenceId,t=d.find((function(t){return t.id===e}));t&&v(t)}),[o,d,v]),C=Object(r.useCallback)((function(e){var t,n=(null===(t=y.find((function(t){return t.value===e})))||void 0===t?void 0:t.label)||"";c.current&&p.current&&f(function(e,t,n,r){return Object(a.a)(e,(function(e){e.nodes[t].referenceId=n,e.nodes[t].referenceLabel=r}))}(p.current,c.current.key,e,n))}),[c,y,p,f]),O=(null===o||void 0===o?void 0:o.key)&&"start"!==o.type;return i.a.createElement(i.a.Fragment,null,O&&i.a.createElement(i.a.Fragment,null,i.a.createElement("div",null,i.a.createElement(ht,{id:"nodeType",label:"Node Type",options:je,onChange:t,value:"Reference"}),i.a.createElement("div",{className:g.referenceDropdown},i.a.createElement(ht,{id:"reference",label:"Pathway Reference",options:y,onChange:C,value:o.referenceId}),i.a.createElement("div",{className:g.referenceChevron},i.a.createElement(s.a,{icon:m.f,onClick:function(){E(),Re(o.referenceId,"",h)}}))))))})),Dt=n(1535),Bt=n(1548),Lt=n(1551),Mt=Object(r.createContext)({}),At=Object(r.memo)((function(e){var t=e.children,n=Object(r.useState)(""),a=Object(d.a)(n,2),o=a[0],c=a[1],l=Object(r.useState)(""),u=Object(d.a)(l,2),s=u[0],m=u[1],f=Object(r.useState)(""),b=Object(d.a)(f,2),p=b[0],v=b[1],h=Object(r.useState)(0),y=Object(d.a)(h,2),g=y[0],E=y[1],C=Object(r.useState)(0),O=Object(d.a)(C,2),j=O[0],k=O[1],x=Object(r.useCallback)((function(){c(""),m(""),v(""),E(0),k(0)}),[c,m,v,E,k]),w=Object(r.useCallback)((function(e){c("Demographics"),"gender"===e.type?(m("Gender"),v(e.gender)):(m("Age Range"),E(e.min),k(e.max))}),[]);return i.a.createElement(Mt.Provider,{value:{selectedElement:o,selectedDemoElement:s,gender:p,minimumAge:g,maximumAge:j,setSelectedElement:c,setSelectedDemoElement:m,setGender:v,setMinimumAge:E,setMaximumAge:k,resetCriteriaBuilder:x,setCriteriaBuilder:w}},t)})),Ft=function(){return Object(r.useContext)(Mt)},qt=Object(r.memo)((function(e){var t,n,o,c,l,u,f,b,p,v,y,g=e.transition,E=ce(),C=E.criteria,O=E.addBuilderCriteria,j=h(),k=j.buildCriteriaSelected,x=j.setBuildCriteriaSelected,w=j.currentCriteriaNodeId,N=j.setCurrentCriteriaNodeId,S=j.currentCriteria,T=j.setCurrentCriteria,R=j.criteriaName,I=j.setCriteriaName,P=j.resetCurrentCriteria,D=Ft(),B=D.resetCriteriaBuilder,L=D.setCriteriaBuilder,M=be(),A=M.pathwayRef,F=M.setCurrentPathway,q=st().currentNodeRef,z=Object(r.useMemo)((function(){return C.map((function(e){return{value:e.id,label:e.label}}))}),[C]),_=z.length>0,W=lt(),H=Object(r.useState)(!1),G=Object(d.a)(H,2),U=G[0],K=G[1],J=null===(t=g.condition)||void 0===t?void 0:t.description,V=null!=J,$=J&&""!==J,Y=(null===(n=g.condition)||void 0===n?void 0:n.cql)||(null===(o=g.condition)||void 0===o?void 0:o.description),Q=Y?"DELETE":"CANCEL",X=Y?i.a.createElement(s.a,{icon:m.A}):null,Z=_&&(U||(null===(c=g.condition)||void 0===c?void 0:c.cql)||(null===(l=g.condition)||void 0===l?void 0:l.description)),ee=Object(r.useRef)(g),te=k&&w===g.id,ne=null;g.condition&&((null===(y=v=C.find((function(e){var t;return e.id===(null===(t=g.condition)||void 0===t?void 0:t.criteriaSource)})))||void 0===y?void 0:y.builder)&&(ne=v.builder));var ae=!te&&ne,re=Object(r.useCallback)((function(){var e,t,n;Y&&q.current&&A.current?(F((e=A.current,t=q.current.key,n=g.id,Object(a.a)(e,(function(e){var a=e.nodes[t].transitions.find((function(e){return e.id===n}));a&&delete a.condition})))),K(!1)):K(!U)}),[U,q,A,Y,g.id,F]),ie=Object(r.useCallback)((function(e){var t;if(q.current&&A.current){var n=C.find((function(t){return t.id===e}));if(n){var a=rt(A.current,q.current.key,ee.current.id,(null===(t=ee.current.condition)||void 0===t?void 0:t.description)||"",n);F(a)}}}),[q,F,A,ee,C]),oe=Object(r.useCallback)((function(e){if(q.current&&A.current){var t,n,r,i,o=(null===e||void 0===e?void 0:e.target.value)||"";F((t=A.current,n=q.current.key,r=g.id,i=o,Object(a.a)(t,(function(e){var t,a,o=null===(t=e.nodes[n])||void 0===t||null===(a=t.transitions)||void 0===a?void 0:a.find((function(e){return e.id===r}));(null===o||void 0===o?void 0:o.condition)?o.condition.description=i:o&&(o.condition={description:i,criteriaSource:"",cql:""})}))))}}),[q,g.id,F,A]),le=Object(r.useCallback)((function(e){I((null===e||void 0===e?void 0:e.target.value)||"")}),[I]),ue=Object(r.useCallback)((function(){N(g.id),T(null),I(""),k||x(!0),B()}),[k,N,g,x,T,B,I]),de=Object(r.useCallback)((function(){var e,t;N(g.id),T(ne),(null===(e=v)||void 0===e?void 0:e.label)&&I(null===(t=v)||void 0===t?void 0:t.label),k||x(!0),ne&&L(ne)}),[k,v,ne,g,N,T,I,x,L]),se=Object(r.useCallback)((function(){P(),B()}),[P,B]),me=Object(r.useCallback)((function(){var e;if(q.current&&A.current&&(null===S||void 0===S?void 0:S.cql)){var t=O(S,R,null===(e=g.condition)||void 0===e?void 0:e.criteriaSource),n=rt(A.current,q.current.key,ee.current.id,R,t[0]);F(n),se()}}),[q,F,A,ee,S,R,g,se,O]);return i.a.createElement(i.a.Fragment,null,!Z&&!te&&i.a.createElement(Tt,{buttonName:"Select Criteria",buttonIcon:m.x,buttonColor:"secondary",buttonText:"Add previously built or imported criteria logic to branch node.",onClick:re,disabled:!_,hasTooltip:!_,tooltipTitle:"No criteria to select. Add criteria to use."}),Z&&!te&&!ae&&i.a.createElement(_t,{label:"Criteria Selector",error:!V||!$},i.a.createElement(i.a.Fragment,null,i.a.createElement(ht,{id:"Criteria",label:"Criteria",options:z,onChange:ie,value:(null===(u=g.condition)||void 0===u?void 0:u.criteriaSource)||void 0}),i.a.createElement(mt.a,{label:"Criteria Display",className:W.criteriaText,value:(null===(f=g.condition)||void 0===f?void 0:f.description)||"",variant:"outlined",onChange:oe,error:!$,helperText:'Use commas "," to separate into multiple lines (up to 3)'})),i.a.createElement(gt.a,{className:W.cancelButton,color:"inherit",size:"small",variant:"outlined",startIcon:X,onClick:re},Q)),ae&&i.a.createElement(_t,{label:"Criteria Builder",error:!1},i.a.createElement(mt.a,{label:"Criteria Name",variant:"outlined",value:null===(b=v)||void 0===b?void 0:b.label,fullWidth:!0,disabled:!0}),i.a.createElement("span",{className:W.buildCriteriaText},null===(p=ne)||void 0===p?void 0:p.text),i.a.createElement("div",{className:W.buildCriteriaContainer},i.a.createElement(gt.a,{className:W.cancelButton,color:"inherit",size:"small",variant:"outlined",startIcon:X,onClick:re},"DELETE CRITERIA"),i.a.createElement(gt.a,{className:W.editButton,color:"inherit",size:"small",variant:"outlined",startIcon:i.a.createElement(s.a,{icon:m.h}),onClick:de},"EDIT CRITERIA"))),!Z&&!te&&i.a.createElement(Tt,{buttonName:"Build Criteria",buttonColor:"secondary",buttonIcon:m.z,buttonText:"Create new criteria logic to add to branch node.",extraMargin:!0,onClick:ue}),te&&i.a.createElement(_t,{label:"Criteria Builder",error:!V||!$},i.a.createElement(mt.a,{error:""===R,label:"Criteria Name",variant:"outlined",onChange:le,value:R,fullWidth:!0}),(null===S||void 0===S?void 0:S.text)&&i.a.createElement("span",{className:W.buildCriteriaText},S.text),i.a.createElement("div",{className:W.buildCriteriaContainer},i.a.createElement(Dt.a,{label:i.a.createElement(Bt.a,{fontStyle:"italic"},"Add to reusable criteria"),control:i.a.createElement(Lt.a,{color:"default"}),checked:!0}),i.a.createElement(gt.a,{color:"inherit",size:"large",variant:"outlined",onClick:se},"Cancel"),i.a.createElement(gt.a,{className:W.saveButton,color:"inherit",size:"large",variant:"outlined",startIcon:i.a.createElement(s.a,{icon:m.u}),disabled:""===R||null===S,onClick:me},"Save"))))})),zt=function(e){var t=e.children;return i.a.createElement(i.a.Fragment,null,t)},_t=function(e){var t=e.children,n=e.label,a=e.error,r=lt();return i.a.createElement(mt.a,{variant:"outlined",label:n,multiline:!0,InputLabelProps:{shrink:!0},InputProps:{inputComponent:zt,classes:{root:Object(wt.a)(r.outlinedDiv,a&&r.outlinedDivError),notchedOutline:Object(wt.a)(a&&r.outlinedDivError)}},inputProps:{children:t},fullWidth:!0})},Wt=n(1553),Ht=n(1536),Gt=n(1537),Ut=n(1538),Kt=Object(r.memo)((function(e){var t=e.open,n=e.nodeLabel,a=e.isTransition,r=e.onClose,o=e.onDelete,c=lt(),l=st().currentNode,u=a?i.a.createElement("span",null,"Delete the transition from ",i.a.createElement("strong",null,null===l||void 0===l?void 0:l.label)," to"," ",i.a.createElement("strong",null,n),"? This will not delete either node, just the transition between them."):i.a.createElement("span",null,"Delete the node ",i.a.createElement("strong",null,n),"? This will also remove any transitions to this node.");return i.a.createElement(i.a.Fragment,null,i.a.createElement(Wt.a,{open:t,onClose:r,"aria-labelledby":"create-pathway",fullWidth:!0,maxWidth:"md"},i.a.createElement(Ht.a,{disableTypography:!0},i.a.createElement(z.a,{"aria-label":"close",onClick:r,className:c.dialogCloseButton},i.a.createElement(s.a,{icon:m.y}))),i.a.createElement(Gt.a,{className:c.dialogContent},i.a.createElement(s.a,{icon:m.j,className:c.alertIcon}),i.a.createElement("p",{className:c.dialogContentText},u)),i.a.createElement(Ut.a,null,i.a.createElement(gt.a,{variant:"text",color:"primary",onClick:r},"Cancel"),i.a.createElement(gt.a,{variant:"contained",color:"secondary",onClick:o},"Delete"))))})),Jt=n(1539),Vt=Object(r.memo)((function(e){var t=e.transition,n=e.children,a=lt(),r=be().pathway,o=(null===t||void 0===t?void 0:t.transition)||"",c=null===r||void 0===r?void 0:r.nodes[o];return i.a.createElement(Jt.a,{raised:!0,className:a.transitionContainer},c&&i.a.createElement(St,{node:c,isTransition:!0}),n)})),$t=n(1554),Yt=n(1561),Qt=n(334),Xt=n.n(Qt),Zt=function(){var e=Object(r.useState)({nodes:{},edges:{}}),t=Object(d.a)(e,2),n=t[0],a=t[1];return{coordinates:n,updateCoordinates:Object(r.useCallback)((function(e){var t,n=e.graph,r=e.graphWidth,i=0-n.node("Start").x+r/2,o=0,c={nodes:{},edges:{}},l=Object(pe.a)(n.nodes());try{for(l.s();!(t=l.n()).done;){var u=t.value,d=n.node(u);c.nodes[u]=Object(g.a)({},d,{x:d.x-d.width/2+i,y:d.y-d.height/2+16}),o=Math.min(0,o,c.nodes[u].x)}}catch(O){l.e(O)}finally{l.f()}if((o=Math.abs(o))>0){var s,m=Object(pe.a)(n.nodes());try{for(m.s();!(s=m.n()).done;){var f=s.value;c.nodes[f].x+=o}}catch(O){m.e(O)}finally{m.f()}}var b,p=Object(pe.a)(n.edges());try{for(p.s();!(b=p.n()).done;){var v=b.value,h=n.edge(v),y="".concat(v.v,", ").concat(v.w),E=h.label?{text:h.label,x:h.x+i,y:h.y+16}:null,C=h.points.map((function(e){return{x:(isNaN(e.x)?0:e.x)+i+o,y:(isNaN(e.y)?0:e.y)+16}}));C.length>0&&(C[C.length-1].y-=17.5),c.edges[y]={label:E,start:v.v,end:v.w,points:C}}}catch(O){p.e(O)}finally{p.f()}a(c)}),[])}},en=Object(r.createContext)({}),tn=Object(r.createContext)((function(){})),nn=Object(r.createContext)({nodes:{},edges:{}}),an=function(){var e=new Xt.a.graphlib.Graph;return e.setGraph({}),e.setDefaultEdgeLabel((function(){return{}})),e},rn=function(e){var t=e.children,n=Object(r.useMemo)(an,[]),a=Zt(),o=a.coordinates,c=a.updateCoordinates,l=Object($t.a)(0),u=Object(d.a)(l,2),s=u[0],m=u[1],f=Object(r.useState)(!0),b=Object(d.a)(f,2),p=b[0],v=b[1],h=Object(r.useCallback)((function(){return v(!0)}),[]),y=Object(r.useMemo)((function(){return{graph:n,reflow:h}}),[n,h]);return Object(r.useEffect)((function(){p&&(Xt.a.layout(n),c({graph:n,graphWidth:s}),v(!1))}),[n,p,v,s,c]),Object(Yt.a)((function(){v(!0)}),[s]),i.a.createElement(en.Provider,{value:y},i.a.createElement(tn.Provider,{value:m},i.a.createElement(nn.Provider,{value:o},t)))},on=function(){return Object(r.useContext)(en)},cn=function(){return Object(r.useContext)(nn)},ln=Object(W.a)((function(e){return{edges:{display:"block",position:"absolute",top:"0",left:"0",overflow:"visible",width:"100%",height:"100%",zIndex:1,"& text":{fontSize:"14px"},"& #arrowhead-inactive polygon":{fill:e.palette.common.blue},"& #arrowhead-active polygon":{fill:e.palette.common.red}},edge:{stroke:function(t){return e.palette.common[(null===t||void 0===t?void 0:t.isActive)?"red":"blue"]}}}}),{name:"DagreGraph-GraphEdges"}),un=function(e){var t=e.labelText,n=e.isEnabled,a=e.children;return n&&t?i.a.createElement(_.a,{title:t,children:a}):i.a.createElement(i.a.Fragment,null,a)},dn=function(e){var t=e.label,n=e.points,a=e.isActive,o=ln({isActive:a}),c=Object(r.useMemo)((function(){return function(e){return e.reduce((function(t,n,a){return a%3===e.length%3?"".concat(t," C ").concat(n.x," ").concat(n.y," ").concat(e[a+1].x," ").concat(e[a+1].y," ").concat(e[a+2].x," ").concat(e[a+2].y):t}),"M ".concat(e[0].x," ").concat(e[0].y," "))}(n)}),[n]),l=null===t||void 0===t?void 0:t.text,u=Object(r.useMemo)((function(){if(null==l)return{lines:[],isTruncated:!1};var e=!1,t=l.split(",");return{lines:(t.length>3?[t[0],t[1],t.slice(2).join(",")]:t).map((function(t){var n=t.trim();return n.length>20?(e=!0,"".concat(n.substring(0,19),"...")):n})),isTruncated:e}}),[l]),d=u.lines,s=u.isTruncated;return i.a.createElement(i.a.Fragment,null,i.a.createElement("path",{d:c,fill:"transparent",className:o.edge,strokeWidth:"2",markerEnd:"url(#arrowhead-".concat(a?"active":"inactive",")")}),t&&i.a.createElement(un,{labelText:l,isEnabled:s},i.a.createElement("text",{x:t.x,y:t.y,dy:"0"},d.map((function(e,n){return i.a.createElement("tspan",{x:t.x,dy:0===n?0:"1.2em",key:e},e)})))))},sn=Object(r.memo)((function(){var e=ln(),t=cn().edges,n=st().currentNode;return i.a.createElement("svg",{className:e.edges},i.a.createElement("defs",null,i.a.createElement("marker",{id:"arrowhead-inactive",markerWidth:"10",markerHeight:"7",refX:"0",refY:"3.5",orient:"auto"},i.a.createElement("polygon",{points:"0 0, 10 3.5, 0 7"})),i.a.createElement("marker",{id:"arrowhead-active",markerWidth:"10",markerHeight:"7",refX:"0",refY:"3.5",orient:"auto"},i.a.createElement("polygon",{points:"0 0, 10 3.5, 0 7"}))),Object.entries(t).map((function(e){var t=Object(d.a)(e,2),a=t[0],r=t[1];return i.a.createElement(dn,{key:a,label:r.label,points:r.points,isActive:r.start===(null===n||void 0===n?void 0:n.key)})})))})),mn=n(1540),fn=Object(W.a)((function(e){return{table:{"& tr":{verticalAlign:"top"}},title:{fontWeight:"bold",textAlign:"right",minWidth:"80px"},description:{paddingLeft:e.spacing(2),fontStyle:"italic",overflowWrap:"break-word"},externalLink:{color:e.palette.common.blue,marginLeft:e.spacing(1),"&:hover, &:focus":{color:e.palette.common.grayDark}}}}),{name:"NodeDetails"}),bn=function(e){var t=e.title,n=e.description,a=fn();return n?i.a.createElement("tr",null,i.a.createElement("td",{className:a.title},t),i.a.createElement("td",{className:a.description},n)):null},pn=function(){return i.a.createElement(bn,{title:"Type",description:"Observation"})},vn=function(e){var t,n,a,r,o,c=e.actionNode,l=fn();if(null===c.action)return null;var u=c.action.resource,d=void 0!==u.medicationCodeableConcept?null===u||void 0===u||null===(t=u.medicationCodeableConcept)||void 0===t?void 0:t.coding:null===u||void 0===u||null===(n=u.code)||void 0===n?void 0:n.coding,f=Oe[u.resourceType]?Oe[u.resourceType]:u.resourceType;return i.a.createElement(i.a.Fragment,null,i.a.createElement(bn,{title:"Description",description:c.action.description}),i.a.createElement(bn,{key:"Type",title:"Type",description:f}),i.a.createElement(bn,{key:"System",title:"System",description:(null===d||void 0===d||null===(a=d[0])||void 0===a?void 0:a.system)&&i.a.createElement(i.a.Fragment,null,d[0].system,i.a.createElement("a",{href:d[0].system,target:"_blank",rel:"noopener noreferrer"},i.a.createElement(s.a,{icon:m.k,className:l.externalLink})))}),i.a.createElement(bn,{key:"Code",title:"Code",description:null===d||void 0===d||null===(r=d[0])||void 0===r?void 0:r.code}),i.a.createElement(bn,{key:"Display",title:"Display",description:null===d||void 0===d||null===(o=d[0])||void 0===o?void 0:o.display}),i.a.createElement(bn,{key:"Title",title:"Title",description:u.title}))},hn=function(e){var t=e.referenceNode;return i.a.createElement(i.a.Fragment,null,i.a.createElement(bn,{title:"Type",description:"Reference"}),i.a.createElement(bn,{title:"Pathway",description:t.referenceLabel}))},yn=Object(r.memo)((function(e){var t=e.pathwayNode,n=fn(),a=ge(t);return null==a?null:i.a.createElement("table",{className:n.table},i.a.createElement("tbody",null,"branch"===a&&i.a.createElement(pn,null),"reference"===a&&i.a.createElement(hn,{referenceNode:t}),"action"===a&&i.a.createElement(vn,{actionNode:t})))})),gn=Object(W.a)((function(e){return{icon:{marginRight:e.spacing(1),fontSize:"0.9rem"}}}),{name:"DagreGraph-NodeIcon"}),En=Object(r.memo)((function(e){var t,n=e.isStartNode,a=e.nodeType,r=e.resourceType,o=gn();return n?t=m.p:"action"===a&&r?"MedicationRequest"===r?t=m.r:"ServiceRequest"===r?t=m.w:"CarePlan"===r&&(t=m.a):"branch"===a?t=m.o:"reference"===a&&(t=m.n),t?i.a.createElement(s.a,{icon:t,className:o.icon}):null})),Cn=Object(W.a)((function(e){return{node:{position:"absolute",width:"auto",minWidth:function(e){return e.isExpanded?"400px":"100px"},maxWidth:"600px",minHeight:"50px",display:"flex",alignItems:"stretch",flexDirection:"column",border:function(t){var n=t.isActionable;return"1px solid ".concat(e.palette.common[n?"red":"blue"])},backgroundColor:e.palette.common.white,zIndex:2,overflow:"hidden"},nodeTitle:{padding:e.spacing(2),flex:"1",display:"flex",alignItems:"center",justifyContent:"center",color:e.palette.common.white,backgroundColor:function(t){var n=t.isActionable;return e.palette.common[n?"red":"blue"]}},nodeContent:{padding:e.spacing(2)},clickable:{cursor:"pointer"}}}),{name:"DagreGraph-Node"}),On=function(e){var t=e.condition;return t?{label:t.description,width:25,height:20}:{}},jn=function(e){var t,n=null!==(t=null===e||void 0===e?void 0:e.getBoundingClientRect())&&void 0!==t?t:{width:0,height:0};return{width:Math.ceil(n.width),height:Math.ceil(n.height)}},kn=Object(r.memo)((function(e){var t,n=e.nodeKey,a=e.pathwayNode,o=e.isActionable,c=e.isExpanded,l=e.onClick,u=e.xCoordinate,d=e.yCoordinate,s=e.openNode,m=Cn({isExpanded:c,isActionable:o}),f=Object(r.useCallback)((function(){l&&l(n)}),[l,n]),b=Object(r.useRef)(null),p=on(),v=p.graph,h=p.reflow,y=Object(r.useMemo)((function(){return{top:"".concat(d,"px"),left:"".concat(u,"px")}}),[u,d]),E=ge(a),C=a.action,O=a.label,j=a.transitions;return Object(mn.a)((function(){var e=jn(b.current),t=e.width,a=e.height;v.setNode(n,{width:t,height:a}),j.forEach((function(e){v.setEdge(n,e.transition,On(e))}))}),(function(){v.removeNode(n)})),Object(Yt.a)((function(){if(b.current){var e=jn(b.current),t=e.width,a=e.height,r=v.node(n);r.width===t&&r.height===a||(v.setNode(n,Object(g.a)({},r,{width:t,height:a})),h())}})),Object(Yt.a)((function(){var e,t=new Set(j.map((function(e){return e.transition})));null===(e=v.outEdges(n))||void 0===e||e.forEach((function(e){var a=e.w;t.has(a)||v.removeEdge(n,a)})),j.forEach((function(e){v.setEdge(n,e.transition,On(e))})),h()}),[n,j]),Object(Yt.a)((function(){C&&s(n)}),[C,n]),i.a.createElement("div",{className:m.node,style:y,ref:b},i.a.createElement("div",{className:Object(wt.a)(m.nodeTitle,l&&m.clickable),onClick:f},i.a.createElement(En,{resourceType:C?null===(t=C.resource)||void 0===t?void 0:t.resourceType:void 0,nodeType:E,isStartNode:"start"===a.type}),O),c&&i.a.createElement("div",{className:m.nodeContent},i.a.createElement(yn,{pathwayNode:a})))})),xn=n(152),wn=function(){var e=Object(r.useState)({lastSelectedNode:null}),t=Object(d.a)(e,2),n=t[0],a=t[1];return{expanded:n,toggleExpanded:Object(r.useCallback)((function(e){a("Start"===e?function(t){return Object(g.a)({},t,{lastSelectedNode:e})}:function(t){var n;return Object(g.a)({},t,(n={},Object(xn.a)(n,e,t[e]&&t.lastSelectedNode!==e?t[e]:!t[e]),Object(xn.a)(n,"lastSelectedNode",e),n))})}),[]),openNode:Object(r.useCallback)((function(e){a((function(t){var n;return t[e]&&t.lastSelectedNode===e?t:Object(g.a)({},t,(n={},Object(xn.a)(n,e,!0),Object(xn.a)(n,"lastSelectedNode",e),n))}))}),[]),closeNode:Object(r.useCallback)((function(e){a((function(t){return t[e]?Object(g.a)({},t,Object(xn.a)({},e,!1)):t}))}),[])}},Nn=function(){var e=Object(u.h)().id,t=Object(u.g)();return Object(r.useCallback)((function(n){var a="/builder/".concat(encodeURIComponent(e),"/node/").concat(encodeURIComponent(n));a!==t.location.pathname&&t.push(a)}),[t,e])},Sn=Object(r.memo)((function(e){var t,n=e.interactive,a=be().pathway,o=wn(),c=o.expanded,l=o.toggleExpanded,u=o.openNode,s=on().reflow,m=cn().nodes,f=st().currentNode,b=Nn(),p=h().resetCurrentCriteria,v=Object(r.useCallback)((function(e){b(e),l(e),p()}),[b,l,p]),y=Object.entries(null!==(t=null===a||void 0===a?void 0:a.nodes)&&void 0!==t?t:{});return Object(Yt.a)((function(){s()}),[y.length]),i.a.createElement(i.a.Fragment,null,y.map((function(e){var t,a=Object(d.a)(e,2),r=a[0],o=a[1],l=null!==(t=m[r])&&void 0!==t?t:{x:-999,y:-999};return i.a.createElement(kn,{key:r,nodeKey:r,pathwayNode:o,isActionable:o.key===(null===f||void 0===f?void 0:f.key),isExpanded:Boolean(c[r]),onClick:n?v:void 0,xCoordinate:l.x,yCoordinate:l.y,openNode:u})})))})),Tn=n(1060),Rn=n.n(Tn),In=Object(W.a)({root:{position:"relative",minWidth:"100%",minHeight:"100%"}},{name:"DagreGraph-GraphRoot"}),Pn=function(e){var t=e.children,n=In(),a=Object(r.useRef)(null),o=Object(r.useContext)(tn),c=cn().nodes,l=Object(r.useMemo)((function(){return Math.ceil(150+(void 0!==c?Object.values(c).map((function(e){return e.x+e.width})).reduce((function(e,t){return Math.max(e,t)}),0):0))}),[c]),u=Object(r.useMemo)((function(){return Math.ceil(150+(void 0!==c?Object.values(c).map((function(e){return e.y+e.height})).reduce((function(e,t){return Math.max(e,t)}),0):0))}),[c]),d=Object(r.useMemo)((function(){return{width:"".concat(l,"px"),height:"".concat(u,"px")}}),[l,u]);return Object(r.useEffect)((function(){var e=a.current;if(null===e||void 0===e?void 0:e.parentElement){var t=e.parentElement.getBoundingClientRect().width;o(Math.ceil(t));var n=new Rn.a(e.parentElement,(function(){var t,n,a=(null!==(t=null===e||void 0===e||null===(n=e.parentElement)||void 0===n?void 0:n.getBoundingClientRect())&&void 0!==t?t:{width:0}).width;o(Math.ceil(a))}));return function(){n.detach()}}}),[a,o]),i.a.createElement("div",{ref:a,className:n.root,style:d},t)},Dn=Object(r.memo)((function(e){var t=e.interactive,n=void 0===t||t;return i.a.createElement(rn,null,i.a.createElement(Pn,null,i.a.createElement(Sn,{interactive:n}),i.a.createElement(sn,null)))})),Bn=Object(W.a)((function(e){return{root:{display:"flex",flexDirection:"column",padding:e.variables.spacing.globalPadding},elementContainer:{padding:"1em",marginRight:"10px",border:"0.1em solid",borderRadius:"0.2em",fontWeight:500,width:"auto",backgroundColor:e.palette.common.grayLighter},elementSelect:{display:"flex",alignItems:"center"},addElementLabel:{marginLeft:"1em",minWidth:"120px"},headerText:{marginRight:"10px",fontStyle:"italic",fontSize:"0.8em"},elementField:{display:"flex",alignItems:"center"},elementFieldLabel:{fontWeight:"bold",marginRight:"1em"}}}),{name:"CriteriaBuilder"}),Ln=Object(r.memo)((function(){var e=Ft(),t=e.selectedElement,n=e.selectedDemoElement,a=e.gender,o=e.minimumAge,c=e.maximumAge,l=e.setSelectedElement,u=e.setSelectedDemoElement,d=e.setGender,f=e.setMinimumAge,b=e.setMaximumAge,p=e.resetCriteriaBuilder,v=Bn(),y=h().setCurrentCriteria,g=Object(r.useCallback)((function(e){f(parseInt(null===e||void 0===e?void 0:e.target.value)||0)}),[f]),E=Object(r.useCallback)((function(e){b(parseInt(null===e||void 0===e?void 0:e.target.value)||0)}),[b]),C=Object(r.useCallback)((function(){p(),y(null)}),[p,y]),O="The patient's gender is ".concat(a),j="The patient's age is between ".concat(o," years and ").concat(c," years");return Object(r.useEffect)((function(){var e="AgeInYears() >= ".concat(o," and AgeInYears() < ").concat(c);"Age Range"===n&&y(o>=0&&c>0&&o<c?{cql:e,text:j,type:"age",min:o,max:c}:null)}),[n,o,c,j,y]),Object(r.useEffect)((function(){var e="Patient.gender.value ~ '".concat(a,"'");"Gender"===n&&y(""!==a?{cql:e,text:O,type:"gender",gender:a}:null)}),[n,a,O,y]),i.a.createElement(i.a.Fragment,null,i.a.createElement("div",{className:v.headerText},"Specify criteria to identify a target population that should receive a recommendation from this artifact. Examples might include an age range, gender, presence of a certain condition, or lab results within a specific range."),i.a.createElement("div",{className:v.elementContainer},(""===t||""===n)&&i.a.createElement("div",{className:v.elementSelect},i.a.createElement("div",{className:v.addElementLabel},i.a.createElement(s.a,{icon:m.q})," Add element"),i.a.createElement(ht,{id:"Choose Element Type",label:"Choose Element Type",options:[{value:"Demographics",label:"Demographics"}],onChange:l,value:t}),t&&i.a.createElement(ht,{id:"Select ".concat(t," element"),label:"Select ".concat(t," element"),options:[{value:"Age Range",label:"Age Range"},{value:"Gender",label:"Gender"}],onChange:u,value:n})),!(""===t||""===n)&&i.a.createElement(i.a.Fragment,null,i.a.createElement("span",null,n),i.a.createElement(z.a,{onClick:C},i.a.createElement(s.a,{icon:m.y})),i.a.createElement("hr",null),"Gender"===n&&i.a.createElement(i.a.Fragment,null,i.a.createElement("span",null,O),i.a.createElement(ht,{id:"Select Gender",label:"Gender",options:[{label:"Male",value:"Male"},{label:"Female",value:"Female"},{label:"Other",value:"Other"},{label:"Unknown",value:"Unknown"}],onChange:d,value:a})),"Age Range"===n&&i.a.createElement(i.a.Fragment,null,i.a.createElement("span",null,j),i.a.createElement("div",{className:v.elementField},i.a.createElement("span",{className:v.elementFieldLabel},"Minimum Age:"),i.a.createElement(mt.a,{type:"number",value:o,onChange:g})),i.a.createElement("div",{className:v.elementField},i.a.createElement("span",{className:v.elementFieldLabel},"Maximum Age:"),i.a.createElement(mt.a,{type:"number",value:c,onChange:E}))))))})),Mn=n(32),An={borderRadius:"0%",marginLeft:"1px",width:"50px",height:"50px"},Fn=Object(W.a)((function(e){return{root:{display:"flex",flexDirection:"column",height:"100vh"},main:{flex:"1",display:"flex",alignItems:"stretch",overflowY:"auto"},graph:{"overflow-y":"auto",flex:"1"},graphHeader:{display:"flex",height:"50px",backgroundColor:e.palette.common.white,marginLeft:"1px"},graphHeaderText:{height:"50px",display:"flex",width:"100%",backgroundColor:e.palette.primary.main,alignItems:"center",color:e.palette.common.white,fontSize:"1.4em",paddingLeft:"1.5em"},toggleButton:{"&-on":Object(g.a)({},An,{backgroundColor:e.palette.primary.main,"&:hover":{backgroundColor:Object(Mn.a)(e.palette.primary.main,.1)}}),"&-off":Object(g.a)({},An,{backgroundColor:e.palette.text.primary,"&:hover":{backgroundColor:Object(Mn.a)(e.palette.text.primary,.1)}})},toggleIcon:{transform:"rotate(90deg) scaleY(-1)",color:e.palette.common.white}}}),{name:"Builder",index:1}),qn=Object(r.memo)((function(){var e=Fn(),t=be().pathway,n=h().currentCriteriaNodeId,a=function(e){var t=Object(r.useContext)(D).useProjector;return P({theme:e,useProjector:t})}("dark"),o=Object(r.useState)(!0),c=Object(d.a)(o,2),l=c[0],u=c[1],f=Object(r.useCallback)((function(){u(!l)}),[l]);return Object(r.useEffect)((function(){l||""!==n||u(!0)}),[n,l]),i.a.createElement("div",{className:e.root},i.a.createElement("div",null,i.a.createElement(q,null),i.a.createElement(ct,null)),t&&i.a.createElement("div",{className:e.main},i.a.createElement(y.a,{theme:a},i.a.createElement(xt,null)),i.a.createElement("div",{className:e.graph},""!==n&&i.a.createElement("div",{className:e.graphHeader},i.a.createElement("div",{className:e.graphHeaderText},i.a.createElement("span",null,"Criteria Builder")),i.a.createElement(z.a,{className:"".concat(e.toggleButton,"-").concat(l?"on":"off"),onClick:f},i.a.createElement(s.a,{className:e.toggleIcon,icon:m.s}))),""!==n&&l?i.a.createElement(Ln,null):i.a.createElement(Dn,null))))})),zn=Object(r.memo)((function(){var e=Object(u.h)(),t=e.id,n=e.nodeId,a=de().pathways,o=be(),c=o.pathwayRef,l=o.setCurrentPathway,d=o.resetCurrentPathway,s=st().setCurrentNode,m=decodeURIComponent(t),f=Object(r.useMemo)((function(){return a.findIndex((function(e){return e.id===m}))}),[m,a]),b=a[f],p=decodeURIComponent(n);return Object(r.useEffect)((function(){var e;b&&(null===c||void 0===c||null===(e=c.current)||void 0===e?void 0:e.id)===b.id?l(b):b&&d(b)}),[b,c,s,l,d]),Object(r.useEffect)((function(){var e;(null===(e=c.current)||void 0===e?void 0:e.nodes[p])?s(c.current.nodes[p]):(null===b||void 0===b?void 0:b.nodes[p])?s(b.nodes[p]):b&&s(b.nodes.Start)}),[b,c,p,s]),null==b?null:p?i.a.createElement(qn,null):i.a.createElement(u.a,{to:"/builder/".concat(t,"/node/Start")})})),_n=Object(r.createContext)({}),Wn=function(e){var t=e.children,n=Object(r.useState)(null),a=Object(d.a)(n,2),o=a[0],c=a[1];return i.a.createElement(_n.Provider,{value:{user:o,setUser:c}},t)},Hn=n(210),Gn=Object(W.a)((function(e){return{root:{display:"flex",flexDirection:"column"},label:{padding:"0.2em 2em",textTransform:"none",fontSize:"1.2em",fontWeight:100}}}),{name:"Tabs",index:1}),Un=Object(r.memo)((function(e){var t=e.tabs,n=Gn();return i.a.createElement("div",{className:n.root},i.a.createElement(Hn.d,null,i.a.createElement(Hn.b,null,t.map((function(e){return i.a.createElement(Hn.a,{key:Z.a.generate()},i.a.createElement(gt.a,{classes:{label:n.label}},e.label))}))),t.map((function(e){return i.a.createElement(Hn.c,{key:Z.a.generate()},e.component)}))))})),Kn=n(335),Jn=n.n(Kn),Vn=Object(r.memo)((function(){return i.a.createElement("div",{className:Jn.a.root},i.a.createElement(s.a,{icon:m.v,className:Jn.a.root,size:"4x",spin:!0}))})),$n=n(1541),Yn=n(1542),Qn=n(1543),Xn=n(1544),Zn=n(1545),ea=n(1546),ta=n(1547),na=Object(W.a)((function(e){return{root:{display:"flex",flexDirection:"column",padding:e.variables.spacing.globalPadding},createPathwayButton:{alignSelf:"flex-end",marginLeft:"20px"},pathwayList:{marginTop:"2em"},pathwaysListButton:{marginRight:"1em"},dialogCloseButton:{float:"right",width:"45px"},buttonRow:{display:"flex",justifyContent:"flex-end"}}}),{name:"PathwaysList",index:1}),aa=Object(r.memo)((function(e){var t,n,o=e.open,c=e.onClose,l=e.editPathway,d=!l,f=na(),b=Object(u.g)(),p=Object(r.useRef)(null),v=Object(r.useRef)(null),h=de(),y=h.addPathway,g=h.updatePathway,E=Object(r.useCallback)((function(e){b.push("/builder/".concat(encodeURIComponent(e),"/node/Start")),c()}),[b,c]),C=Object(r.useCallback)((function(e){var t,n,a,r;e.preventDefault();var i=Z.a.generate(),o=null!==(t=null===(n=p.current)||void 0===n?void 0:n.value)&&void 0!==t?t:"",c=null!==(a=null===(r=v.current)||void 0===r?void 0:r.value)&&void 0!==a?a:"";y(function(e,t,n){return{id:null!==n&&void 0!==n?n:Z.a.generate(),name:e,description:t,library:[""],preconditions:[],nodes:{Start:{key:"Start",label:"Start",transitions:[],type:"start"}}}}(o,c,i)),E(i)}),[y,E]),O=Object(r.useCallback)((function(e){var t,n;if(e.preventDefault(),l&&((null===(t=p.current)||void 0===t?void 0:t.value)!==l.name||(null===(n=v.current)||void 0===n?void 0:n.value)!==l.description)){var r=Object(a.a)(l,(function(e){var t,n;(null===(t=p.current)||void 0===t?void 0:t.value)&&(e.name=p.current.value),(null===(n=v.current)||void 0===n?void 0:n.value)&&(e.description=v.current.value)}));g(r)}c()}),[g,l,c]);if(l){t=l.name;var j=l.description;j&&""!==j&&(n=j)}return i.a.createElement(Wt.a,{open:o,onClose:c,"aria-labelledby":"create-pathway",fullWidth:!0,maxWidth:"md"},i.a.createElement(Ht.a,{disableTypography:!0},i.a.createElement(z.a,{"aria-label":"close",onClick:c,className:f.dialogCloseButton},i.a.createElement(s.a,{icon:m.y}))),i.a.createElement("form",{onSubmit:d?C:O},i.a.createElement(Gt.a,null,i.a.createElement(mt.a,{variant:"outlined",autoFocus:!0,label:"Pathway Name",fullWidth:!0,required:d,inputRef:p,defaultValue:d?void 0:t}),i.a.createElement(mt.a,{variant:"outlined",label:"Pathway Description",fullWidth:!0,inputRef:v,defaultValue:d?void 0:n,multiline:!0})),i.a.createElement(Ut.a,null,i.a.createElement(gt.a,{variant:"contained",color:"primary",startIcon:d&&i.a.createElement(s.a,{icon:m.q}),type:"submit"},d?"Create":"Save"))))})),ra=n(1524),ia=n(1533),oa=Object(W.a)((function(e){return{container:{display:"inline-block"},paper:{display:"flex",flexDirection:"row",alignItems:"center",borderRadius:"10px",border:"5px solid rgba(74, 74, 74, 0.5)",backgroundColor:e.palette.common.gray,color:e.palette.common.white,padding:"0.5em",mozBackgroundClip:"padding",webkitBackgroundVlip:"padding",backgroundClip:"padding-box"},displayText:{marginRight:"4em",whiteSpace:"nowrap"},buttons:{display:"flex",alignItems:"center",justifyContent:"center",minWidth:"2.5em",minHeight:"2em",cursor:"pointer",borderRadius:"15%",marginRight:"0.5em"}}}),{name:"ConfirmedDeletionButton"}),ca=n(132),la=n.n(ca),ua=function(e){var t=e.type,n=e.onClick;return i.a.createElement("button",{className:"".concat(la.a.largeActionButton," button ").concat("decline"===t&&la.a.largeDecline),type:"button",onClick:n},t[0].toUpperCase()+t.slice(1))},da=function(e){var t=e.type,n=e.onClick;return i.a.createElement("div",{className:"".concat("accept"===t?la.a.accept:la.a.decline," ").concat(la.a.smallActionButton),onClick:n,"data-testid":t},i.a.createElement(s.a,{icon:"accept"===t?m.c:m.y}))},sa=function(e){var t=e.type,n=e.onClick;return i.a.createElement("div",{className:"".concat("accept"===t?la.a.accept:la.a.decline," ").concat(la.a.mediumActionButton),onClick:n,"data-testid":t},i.a.createElement(s.a,{icon:"accept"===t?m.c:m.y}),{accept:"Submit",decline:"Cancel"}[t])},ma=Object(r.memo)((function(e){var t=e.type,n=e.size,a=e.onClick;switch(n){case"small":return i.a.createElement(da,{type:t,onClick:a});case"large":return i.a.createElement(ua,{type:t,onClick:a});case"medium":return i.a.createElement(sa,{type:t,onClick:a})}})),fa=Object(r.memo)((function(e){var t=e.deleteId,n=e.deleteMethod,a=e.deleteType,o=e.deleteName,c=oa(),l=Object(r.useState)(!1),u=Object(d.a)(l,2),f=u[0],b=u[1],p=Object(r.useState)(null),v=Object(d.a)(p,2),h=v[0],y=v[1],g="Are you sure"+(a&&n?" that you would like to delete the "+o+" "+a+" ?":"?"),E=Object(r.useCallback)((function(e){y(e.currentTarget),b(!0)}),[]),C=Object(r.useCallback)((function(){n(t),b(!1),y(null)}),[t,n]),O=Object(r.useCallback)((function(){b(!1),y(null)}),[]);return i.a.createElement("div",{className:c.container},i.a.createElement(ia.a,{onClickAway:O},i.a.createElement(gt.a,{color:"secondary",size:"small",startIcon:i.a.createElement(s.a,{icon:m.A}),onClick:E},"Delete")),i.a.createElement(ra.a,{classes:{paper:c.paper},open:f,anchorEl:h,anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"center"}},i.a.createElement("div",{className:c.displayText}," ",g," "),i.a.createElement("div",{className:c.buttons},i.a.createElement(ma,{size:"small",type:"accept",onClick:C}),i.a.createElement(ma,{size:"small",type:"decline",onClick:O}))))})),ba=Object(r.memo)((function(){var e=na(),t=de(),n=t.pathways,a=t.deletePathway,o=be().setCurrentPathway,c=Object(r.useState)(!1),u=Object(d.a)(c,2),f=u[0],b=u[1],p=Object(r.useState)(),v=Object(d.a)(p,2),h=v[0],y=v[1],g=Object(r.useState)(null),E=Object(d.a)(g,2),C=E[0],O=E[1],j=Object(r.useCallback)((function(e){b(!0),y(e)}),[]),k=Object(r.useCallback)((function(){b(!1)}),[]),x=Object(r.useCallback)((function(e){O(e.currentTarget);var t=n.filter((function(t){return t.id===e.currentTarget.id}));t.length&&o(t[0])}),[n,o]),w=Object(r.useCallback)((function(){O(null)}),[]),N=Object(r.useCallback)((function(e){a(e)}),[a]);return i.a.createElement("div",null,i.a.createElement($n.a,{className:e.pathwayList},i.a.createElement(Yn.a,{"aria-label":"pathway list"},i.a.createElement(Qn.a,null,i.a.createElement(Xn.a,null,i.a.createElement(Zn.a,null,"Pathway Name"),i.a.createElement(Zn.a,null,"Status"),i.a.createElement(Zn.a,null,"Last Updated"),i.a.createElement(Zn.a,null))),i.a.createElement(ea.a,null,n.map((function(t){return i.a.createElement(Xn.a,{key:t.id},i.a.createElement(Zn.a,{component:"th",scope:"row"},i.a.createElement(ta.a,{component:l.b,to:"/builder/".concat(encodeURIComponent(t.id)),color:"primary",underline:"none"},t.name)),i.a.createElement(Zn.a,null,"draft"),i.a.createElement(Zn.a,null,"2 days ago"),i.a.createElement(Zn.a,{align:"right"},i.a.createElement(gt.a,{className:e.pathwaysListButton,color:"primary",size:"small",startIcon:i.a.createElement(s.a,{icon:m.h}),onClick:function(){return j(t)}},"Edit Info"),i.a.createElement(gt.a,{id:t.id,className:e.pathwaysListButton,color:"primary",size:"small",startIcon:i.a.createElement(s.a,{icon:m.l}),onClick:x},"Export"),i.a.createElement(fa,{deleteType:"pathway",deleteName:t.name,deleteId:t.id,deleteMethod:N})))}))))),i.a.createElement(ot,{anchorEl:C,closeMenu:w}),i.a.createElement(aa,{open:f,onClose:k,editPathway:h}))})),pa=Object(W.a)((function(e){return{dialogCloseButton:{float:"right",width:"45px"},input:{display:"none"},chooseFileInput:{display:"flex",alignItems:"center"},inputButton:{whiteSpace:"nowrap",marginRight:"1em"},fileName:{fontStyle:"italic"}}}),{name:"FileImportModal",index:1}),va=Object(r.memo)((function(e){var t=e.open,n=e.onClose,a=e.onSelectFile,o=e.allowedFileType,c=pa(),l=Object(r.useState)(""),u=Object(d.a)(l,2),f=u[0],b=u[1],p=Object(r.useRef)(null),v=Object(r.useCallback)((function(e){var t;e.preventDefault();var r=null===p||void 0===p||null===(t=p.current)||void 0===t?void 0:t.files;a(r),n(),b("")}),[n,a]),h=Object(r.useCallback)((function(){var e,t;(null===p||void 0===p||null===(e=p.current)||void 0===e||null===(t=e.files)||void 0===t?void 0:t[0])&&b(p.current.files[0].name)}),[p]);return i.a.createElement(Wt.a,{open:t,onClose:n,"aria-labelledby":"import-pathway",fullWidth:!0,maxWidth:"sm"},i.a.createElement(Ht.a,{disableTypography:!0},i.a.createElement(z.a,{"aria-label":"close",onClick:n,className:c.dialogCloseButton},i.a.createElement(s.a,{icon:m.y}))),i.a.createElement("form",{onSubmit:v},i.a.createElement(Gt.a,null,i.a.createElement("div",{className:c.chooseFileInput},i.a.createElement(Nt.a,{id:"choose-file-input",className:c.input,inputRef:p,type:"file",inputProps:{accept:o},onChange:h}),i.a.createElement("label",{htmlFor:"choose-file-input"},i.a.createElement(gt.a,{className:c.inputButton,variant:"contained",color:"primary",component:"span"},"Choose File")),i.a.createElement("div",{className:c.fileName},f?i.a.createElement("span",null,f):i.a.createElement("span",null,"Choose file to import.")))),i.a.createElement(Ut.a,null,i.a.createElement(gt.a,{variant:"contained",color:"primary",startIcon:i.a.createElement(s.a,{icon:m.m}),type:"submit"},"Import"))))})),ha=Object(r.memo)((function(){var e=na(),t=Object(r.useState)(!1),n=Object(d.a)(t,2),a=n[0],o=n[1],c=de().status,l=Object(r.useState)(!1),u=Object(d.a)(l,2),f=u[0],b=u[1],p=de().addPathwayFromFile,v=Object(r.useCallback)((function(){o(!0)}),[]),h=Object(r.useCallback)((function(){o(!1)}),[]),y=Object(r.useCallback)((function(e){(null===e||void 0===e?void 0:e.length)&&p(e[0])}),[p]),g=Object(r.useCallback)((function(){return b(!0)}),[]),E=Object(r.useCallback)((function(){return b(!1)}),[]);return i.a.createElement("div",{className:e.root},i.a.createElement("div",{className:e.buttonRow},i.a.createElement(gt.a,{className:e.createPathwayButton,variant:"contained",color:"primary",startIcon:i.a.createElement(s.a,{icon:m.m}),onClick:g},"Import Pathway"),i.a.createElement(gt.a,{className:e.createPathwayButton,variant:"contained",color:"primary",startIcon:i.a.createElement(s.a,{icon:m.q}),onClick:v},"Create Pathway")),i.a.createElement(va,{open:f,onClose:E,onSelectFile:y,allowedFileType:".json"}),i.a.createElement(aa,{open:a,onClose:h}),"loading"===c?i.a.createElement(Vn,null):i.a.createElement(ba,null))})),ya=n(1061),ga=n.n(ya),Ea=Object(W.a)((function(e){return{root:{display:"flex",flexDirection:"column",padding:e.variables.spacing.globalPadding},buttonRow:{display:"flex",justifyContent:"flex-end"},buildCriteriaButton:{alignSelf:"flex-end",marginLeft:"20px"},criteriaList:{marginTop:"2em"},editButton:{marginRight:"1em"},dialogCloseButton:{float:"right",width:"45px"},input:{display:"none"},chooseFileInput:{display:"flex",alignItems:"center"},inputButton:{whiteSpace:"nowrap",marginRight:"1em"},fileName:{fontStyle:"italic"}}}),{name:"CriteriaList",index:1}),Ca=Object(r.memo)((function(){var e=Ea(),t=ce(),n=t.criteria,a=t.deleteCriteria,o=Object(r.useCallback)((function(e){a(e)}),[a]);return i.a.createElement($n.a,{className:e.criteriaList},i.a.createElement(Yn.a,{"aria-label":"criteria list"},i.a.createElement(Qn.a,null,i.a.createElement(Xn.a,null,i.a.createElement(Zn.a,null,"Criteria Name"),i.a.createElement(Zn.a,null,"Version"),i.a.createElement(Zn.a,null,"Added"),i.a.createElement(Zn.a,null))),i.a.createElement(ea.a,null,n.map((function(t){return i.a.createElement(Xn.a,{key:t.id},i.a.createElement(Zn.a,{component:"th",scope:"row"},t.label),i.a.createElement(Zn.a,null,t.version),i.a.createElement(Zn.a,null,(n=t.modified,ga()(n).fromNow())),i.a.createElement(Zn.a,{align:"right"},i.a.createElement(gt.a,{className:e.editButton,color:"primary",size:"small",startIcon:i.a.createElement(s.a,{icon:m.h})},"Edit"),i.a.createElement(fa,{deleteType:"criterion",deleteName:t.label,deleteId:t.id,deleteMethod:o})));var n})))))})),Oa=Object(r.memo)((function(){var e=Ea(),t=de().status,n=ce().addCriteria,a=Object(r.useState)(!1),o=Object(d.a)(a,2),c=o[0],l=o[1],u=Object(r.useCallback)((function(){l(!0)}),[]),f=Object(r.useCallback)((function(){l(!1)}),[]),b=Object(r.useCallback)((function(e){(null===e||void 0===e?void 0:e.length)&&n(e[0])}),[n]);return i.a.createElement("div",{className:e.root},i.a.createElement("div",{className:e.buttonRow},i.a.createElement(gt.a,{className:e.buildCriteriaButton,variant:"contained",color:"primary",startIcon:i.a.createElement(s.a,{icon:m.m}),onClick:u},"Import Library"),i.a.createElement(gt.a,{className:e.buildCriteriaButton,variant:"contained",color:"primary",startIcon:i.a.createElement(s.a,{icon:m.z})},"Build Criteria")),i.a.createElement(va,{open:c,onClose:f,onSelectFile:b,allowedFileType:".cql"}),"loading"===t?i.a.createElement(Vn,null):i.a.createElement(Ca,null))})),ja=Object(r.memo)((function(){return i.a.createElement(B,{theme:"light"},i.a.createElement(Wn,null,i.a.createElement(oe,null,i.a.createElement(ue,null,i.a.createElement(dt,null,i.a.createElement(fe,null,i.a.createElement(Ct,null,i.a.createElement(v,null,i.a.createElement(At,null,i.a.createElement(l.a,null,i.a.createElement(u.d,null,i.a.createElement(u.b,{path:"/builder/:id/node/:nodeId"},i.a.createElement(zn,null)),i.a.createElement(u.b,{path:"/builder/:id"},i.a.createElement(zn,null)),i.a.createElement(u.b,{path:"/"},i.a.createElement(q,null),i.a.createElement(Un,{tabs:[{label:"Pathway",component:i.a.createElement(ha,null)},{label:"Criteria",component:i.a.createElement(Oa,null)}]})))))))))))))}));n(1490);c.a.render(i.a.createElement(ja,null),document.getElementById("root"))},181:function(e,t,n){"use strict";(function(e){var a=n(57),r=n(182),i=n(183),o=new(function(){function t(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(r.a)(this,t),this.config=e.CONFIG?Object(a.a)({},e.CONFIG,{},n):Object(a.a)({},n)}return Object(i.a)(t,[{key:"get",value:function(e,t){var n=e.split("."),a=this.config,r=null;for(var i in n){a=r=a[n[i]]}return r||t}},{key:"add",value:function(e){e&&(this.config=Object(a.a)({},this.config,{},e))}}]),t}());t.a=o}).call(this,n(125))},262:function(e,t,n){e.exports={logo:"Header_logo__3T0lc",homeLink:"Header_homeLink__2ew4r"}},335:function(e,t,n){e.exports={root:"Loading_root__3b6qy"}}},[[1083,1,2]]]);
//# sourceMappingURL=main.418cd63e.chunk.js.map