{"version":3,"sources":["camino-logo-dark.png","components/ActionButton/ActionButton.module.scss","immer.js","components/CurrentCriteriaProvider.tsx","styles/theme.tsx","components/ThemeProvider.tsx","components/Header/Header.tsx","components/Navigation/styles.tsx","utils/useRefUndoState.ts","components/Services/Services.tsx","utils/useRefState.ts","engine/cql-to-elm.ts","components/CriteriaProvider/CriteriaProvider.tsx","components/PathwaysProvider.tsx","components/CurrentPathwayProvider.tsx","utils/nodeUtils.ts","utils/export.ts","utils/cpg.ts","utils/CaminoExporter.ts","utils/builder.ts","components/elements/ExportMenu/ExportMenu.tsx","components/Navigation/Navigation.tsx","components/Sidebar/styles.tsx","components/CurrentNodeProvider.tsx","components/elements/DropDown/DropDown.tsx","components/SnackbarProvider.tsx","components/Sidebar/DeleteSnackbar.tsx","components/Sidebar/ConnectNodeButton.tsx","components/Sidebar/Sidebar.tsx","components/Sidebar/SidebarHeader.tsx","components/Sidebar/SidebarButton.tsx","components/Sidebar/ActionNodeEditor.tsx","components/Sidebar/ReferenceNodeEditor.tsx","components/CriteriaBuilderProvider.tsx","components/Sidebar/BranchTransition.tsx","components/Sidebar/OutlinedDiv.tsx","components/Sidebar/DeleteModal.tsx","components/Sidebar/TransitionEditor.tsx","components/DagreGraph/useCoordinatesCalculator.ts","components/DagreGraph/GraphProvider.tsx","components/DagreGraph/GraphEdges.styles.ts","components/DagreGraph/GraphEdges.tsx","components/DagreGraph/NodeDetails.styles.ts","components/DagreGraph/NodeDetails.tsx","components/DagreGraph/NodeIcon.styles.ts","components/DagreGraph/NodeIcon.tsx","components/DagreGraph/Node.styles.ts","components/DagreGraph/Node.tsx","components/DagreGraph/useExpandedState.ts","components/DagreGraph/useRedirectToNode.ts","components/DagreGraph/GraphNodes.tsx","components/DagreGraph/GraphRoot.styles.ts","components/DagreGraph/GraphRoot.tsx","components/DagreGraph/DagreGraph.tsx","components/CriteriaBuilder/styles.tsx","components/CriteriaBuilder/CriteriaBuilder.tsx","components/Builder/styles.tsx","components/Builder/Builder.tsx","components/BuilderRoute.tsx","components/UserProvider.tsx","components/Tabs/styles.tsx","components/Tabs/Tabs.tsx","components/elements/Loading/Loading.tsx","components/PathwaysList/styles.tsx","components/PathwaysList/PathwayModal.tsx","components/ConfirmedDeletionButton/styles.tsx","components/ActionButton/ActionButton.tsx","components/ConfirmedDeletionButton/ConfirmedDeletionButton.tsx","components/PathwaysList/PathwaysTable.tsx","components/FileImportModal/styles.tsx","components/FileImportModal/FileImportModal.tsx","components/PathwaysList/PathwaysList.tsx","components/CriteriaList/styles.tsx","components/CriteriaList/CriteriaTable.tsx","components/CriteriaList/CriteriaList.tsx","components/App.tsx","index.js","utils/ConfigManager.js","components/Header/Header.module.scss","components/elements/Loading/Loading.module.scss"],"names":["module","exports","enableAllPlugins","CurrentCriteriaContext","createContext","CurrentCriteriaProvider","memo","children","useState","currentCriteriaNodeId","setCurrentCriteriaNodeId","currentCriteria","setCurrentCriteria","buildCriteriaSelected","setBuildCriteriaSelected","criteriaName","setCriteriaName","resetCurrentCriteria","useCallback","Provider","value","useCurrentCriteriaContext","useContext","variables","spacing","globalPadding","colors","white","black","red","blue","blueLighter","gray","grayMedium","grayBlue","grayLight","grayLighter","grayDark","grayVeryDark","green","typography","fontFamily","join","materialUiOverridesBase","MuiButton","root","borderRadius","height","backgroundColor","color","contained","label","fontWeight","iconSizeMedium","fontSize","iconSizeSmall","MuiTableHead","MuiTableCell","head","padding","borderBottom","MuiFormControl","margin","MuiFormLabel","fontStyle","MuiInputBase","input","transitionDelay","transitionProperty","MuiTooltip","tooltip","arrow","MuiOutlinedInput","MuiSelect","icon","MuiPaper","rounded","MuiDialogTitle","MuiDialogContent","MuiDialogActions","MuiCard","overflow","MuiIconButton","materialUiOverridesDark","borderColor","notchedOutline","MuiMenuItem","paletteBase","primary","main","secondary","error","common","background","default","text","grey","800","lightTheme","createMuiTheme","palette","overrides","darkTheme","deepmerge","projectorTheme","getTheme","theme","useProjector","ThemeContext","ThemeProvider","setUseProjector","muiTheme","toggleTheme","currentUseProjector","anchorEl","setAnchorEl","openMenu","event","currentTarget","closeMenu","handleToggleTheme","className","styles","header","to","homeLink","onClick","src","logo","alt","aria-controls","aria-haspopup","faCog","Menu","id","keepMounted","open","Boolean","onClose","MenuItem","makeStyles","display","alignItems","justifyContent","backButton","width","navigationIcons","cursor","pathwayName","marginLeft","name","index","useRefUndoState","initialValue","useUndo","state","setState","set","resetState","reset","undoState","undo","redoState","redo","canUndo","canRedo","stateRef","useRef","present","useEffect","current","getObject","url","fetch","headers","Accept","typedFetch","raw","options","then","response","json","useGetService","status","result","setResult","listOfFiles","map","f","listOfPromises","Promise","all","list","payload","catch","useRefState","config","get","convertBasicCQL","cql","method","body","elm","CriteriaContext","DEFAULT_ELM_STATEMENTS","elmLibraryToCriteria","undefined","custom","allElmStatements","library","statements","def","elmStatements","filter","includes","includesTypes","find","s","resultTypeName","alert","labelTitle","identifier","substring","statement","shortid","generate","version","modified","Date","now","cqlToCriteria","rawCql","CriteriaProvider","criteria","setCriteria","listOfLists","flat","newCriteria","addCqlCriteria","length","crit","addCriteria","file","reader","FileReader","onload","target","rawContent","endsWith","rawElm","JSON","parse","jsonToCriteria","readAsText","deleteCriteria","addElmCriteria","addBuilderCriteria","buildCriteria","criteriaSource","builder","builderModelToCriteria","matchingCriteria","c","useCriteriaContext","PathwaysContext","PathwaysProvider","pathways","pathwaysRef","setPathways","service","servicePayload","addPathway","pathway","currentPathways","loadPathwayLibraries","forEach","lib","addPathwayFromFile","path","deletePathway","updatePathway","newPathway","findIndex","slice","criteriaIds","pathwayIndex","Object","entries","nodes","nodeIndex","transitions","transitionIndex","condition","split","produce","draftPathways","draftCondition","usePathwaysContext","CurrentPathwayContext","CurrentPathwayProvider","pathwayRef","canUndoPathway","canRedoPathway","_undoPathway","_redoPathway","_resetPathway","_setPathway","undoPathway","redoPathway","resetCurrentPathway","setCurrentPathway","keyName","onKeyDown","useCurrentPathwayContext","getNodeType","node","type","isActionNode","isBranchNode","resourceNameConversion","MedicationRequest","ServiceRequest","CarePlan","nodeTypeOptions","findParent","childNodeKey","parents","findParents","keys","parentNodeKey","transition","push","deepCopyPathway","stringify","copyNode","newKey","newNode","deepCopyPathwayNode","key","willOrphanChild","transitionCount","nodeKey","canDeleteNode","canDeleteAllTransitions","redirect","pathwayId","history","encodeURIComponent","location","pathname","getCodeableConceptFromAction","action","codeableConcept","resource","resourceType","medicationCodeableConcept","code","coding","system","title","constructCqlLibrary","libraryName","includedCqlLibraries","referencedDefines","builderDefines","details","definesList","srcLibrary","defines","LIBRARY_DRAFT","R4","LibraryStatusKind","_draft","PLANDEFINITION_DRAFT","PlanDefinitionStatusKind","ACTIVITYDEFINITION_DRAFT","ActivityDefinitionStatusKind","BUNDLE_TRANSACTION","BundleTypeKind","_transaction","BUNDLE_PUT","Bundle_RequestMethodKind","_put","CONDITION_APPLICABILITY","PlanDefinition_ConditionKindKind","_applicability","EXPRESSION_CQL","ExpressionLanguageKind","_textCql","CHILD_RELATIONSHIP","PlanDefinition_RelatedActionRelationshipKind","_beforeStart","PARENT_RELATIONSHIP","_afterEnd","CPGExporter","bundle","nestedBranch","libraries","activityDefinitions","pathwayCopy","cleanPathway","this","entry","strategyDefinition","createPlanDefinition","uuidv4","_export","createBundleEntry","referencedFrom","pathwayAction","createAction","addRelatedAction","createLibraries","cpgRecommendation","description","queue","visited","shift","parentKey","n","unshift","convertNode","definitionCanonical","formatUrl","l","data","content","activityId","kind","activityDefinition","meta","profile","extension","valueCode","experimental","date","toISOString","publisher","productCodeableConcept","setActivityDefinitionId","libraryId","planDefinition","mainLibrary","nodeId","libraryIdentifier","additionalLibraries","newId","contentType","btoa","libraryCql","navigational","preconditions","parent","descriptionDetails","createActivityDefinition","cpgAction","getActivityDefinitionId","createCondition","parentAction","tempParentKey","findAllChildActionNodes","childActionNodes","t","childKey","addActionToPlanDefinition","isReferenceNode","referencedPathway","referenceId","msg","console","getTransition","expression","language","findAction","actions","foundAction","relatedId","relationship","relatedAction","actionId","fullUrl","request","definition","newNodes","allTransitions","findAllTransitions","subPathway","rootKey","oldKeyToNewKey","currentKey","currentNewKey","findSubPathway","CaminoExporter","startsWith","addtlLibraries","values","downloadPathway","cpg","pathwayString","exportPathway","pathwayBlob","Blob","window","URL","createObjectURL","a","document","createElement","href","download","click","revokeObjectURL","pathwayWithElm","draftPathway","setNavigationalElm","schemaIdentifier","usings","localIdentifier","uri","localId","locator","context","operand","dataType","valueSets","codes","codeSystems","mergeElm","elmStatement","getElmStatement","draftElmStatement","generateNavigationalElm","pathwayToExport","export","additionalElm","using","include","valueSet","codesystem","defaultStatementNames","setNodeType","nodeType","setNodeAction","makeNodeAction","makeNodeBranch","referenceLabel","makeNodeReference","addTransition","startNodeKey","endNodeKey","setTransitionCondition","transitionId","foundTransition","getContentAnchorEl","anchorOrigin","vertical","horizontal","Navigation","useStyles","useHistory","handleGoBack","IconButton","aria-label","faChevronLeft","Tooltip","placement","disabled","faUndo","faRedo","faEllipsisH","flexDirection","minWidth","overflowY","formControl","referenceDropdown","referenceChevron","lineHeight","divider","headerLabelStart","displayText","sidebarHeader","sidebarHeaderGroup","sidebarHeaderButton","headerLabelGroup","headerLabel","headerLabelText","marginBottom","editIcon","sidebarButtonGroup","sidebarButtonGroupExtraMargin","sidebarButton","marginRight","sidebarButtonText","outlinedDiv","outlinedDivError","toggleSidebar","float","cancelButton","alignSelf","marginTop","editButton","buildCriteriaContainer","buildCriteriaText","saveButton","transitionContainer","dividerHeader","textTransform","paddingLeft","dialogCloseButton","dialogContent","dialogContentText","alertIcon","connectDropdown","flexWrap","alignContent","connectText","cancelButtonDropdown","border","criteriaText","CurrentNodeContext","CurrentNodeProvider","currentNode","currentNodeRef","_setCurrentNode","setCurrentNode","useCurrentNodeContext","onChange","autocomplete","handleSetSelected","handleAutoSelected","getValue","option","Autocomplete","fullWidth","popupIcon","faCaretDown","style","getOptionLabel","renderOption","renderInput","params","TextField","variant","FormControl","InputLabel","htmlFor","Select","MenuProps","transformOrigin","displayEmpty","SnackbarContext","SnackbarProvider","openSnackbar","setOpenSnackbar","snackbarText","setSnackbarText","handleCloseSnackbar","useSnackbarContext","Snackbar","autoHideDuration","message","Fragment","Button","size","faTimes","setOpen","rootNode","connectableNodes","ancestorNodes","getAncestorNodes","rootNodeKey","currNodeKey","ancestors","previousNodes","currNode","some","concat","rootNodeConnectsToNode","nodeIsAncestor","getConnectableNodes","optionsAvailable","connectToNode","showDropdown","buttonName","buttonIcon","faLevelDownAlt","buttonText","hasTooltip","tooltipTitle","isExpanded","setIsExpanded","sidebarContainerElement","changeNodeType","addPathwayNode","addNode","ref","isTransition","faPlus","faChevronRight","displayTransitions","showInput","setShowInput","openTooltip","setOpenTooltip","openDelete","setOpenDelete","inputRef","nodeLabel","goToParentNode","redirectToNode","changeNodeLabel","setNodeLabel","handleShowInput","deleteNode","filterTransition","removeNode","deleteTransition","removeTransition","openDeleteModal","closeDeleteModal","handleOpenTooltip","handleCloseTooltip","handleKeyPress","deleteNodeDisabled","deleteTransitionDisabled","deleteDisabled","titleText","Input","onBlur","onKeyPress","defaultValue","autoFocus","onFocus","select","clsx","faEdit","onOpen","faTrashAlt","onDelete","extraMargin","buttonColor","ConditionalTooltip","startIcon","codeSystemOptions","addActionCQL","currentNodeKey","cqlId","replace","codesystemStatement","returnStatement","retrieveStatement","defineStatement","escape","createCQL","setActionNodeElm","changeCode","draftAction","setActionCode","resetDisplay","changeDescription","draftaction","setActionDescription","changeTitle","setActionTitle","selectCodeSystem","codeSystem","setActionCodeSystem","validateFunction","setActionResourceDisplay","onEnter","e","changeNodeTypeEnabled","inputProps","faCheckCircle","pathwayOptions","showReference","pathwayReferenceId","selectPathwayReference","setNodeReference","CriteriaBuilderContext","CriteriaBuilderProvider","selectedElement","setSelectedElement","selectedDemoElement","setSelectedDemoElement","gender","setGender","minimumAge","setMinimumAge","maximumAge","setMaximumAge","resetCriteriaBuilder","setCriteriaBuilder","min","max","useCriteriaBuilderContext","builderCriteria","criteriaOptions","useMemo","criteriaAvailable","useCriteriaSelected","setUseCriteriaSelected","criteriaDescription","criteriaIsValid","criteriaDisplayIsValid","hasCriteria","displayCriteria","transitionRef","transitionSelected","builderElements","dislayEditCriteria","handleUseCriteria","selectCriteriaSource","criteriaId","selectedCriteria","setCriteriaDisplay","criteriaDisplay","handleCriteriaName","handleBuildCriteria","handleEditCriteria","handleBuildCriteriaCancel","handleBuildCriteriaSave","faThList","helperText","faTools","FormControlLabel","Box","control","Checkbox","checked","faSave","InputComponent","OutlinedDiv","multiline","InputLabelProps","shrink","InputProps","inputComponent","classes","Dialog","aria-labelledby","maxWidth","DialogTitle","disableTypography","DialogContent","faExclamationCircle","DialogActions","transitionKey","transitionNode","Card","raised","useCoordinatesCalculator","edges","coordinates","setCoordinates","updateCoordinates","graph","graphWidth","xOffset","x","xOffsetCorrection","newCoordinates","y","Math","abs","edgeKey","edge","edgeName","v","w","points","point","isNaN","start","end","GraphContext","SetGraphWidthContext","GraphCoordinatesContext","createGraph","g","dagre","graphlib","Graph","setGraph","setDefaultEdgeLabel","GraphProvider","useRafState","setWidth","reflowRequired","setReflowRequired","reflow","graphValue","layout","useUpdateEffect","useGraphProvider","useGraphCoordinates","position","top","left","zIndex","fill","stroke","props","isActive","LabelTooltip","labelText","isEnabled","Edge","reduce","i","generatePathString","lines","isTruncated","truncated","allLines","line","trimmedLine","trim","TRUNCATION_SIZE","d","strokeWidth","markerEnd","dy","edgeCoordinates","markerWidth","markerHeight","refX","refY","orient","edgeId","table","verticalAlign","textAlign","overflowWrap","externalLink","Field","BranchNodeContents","ActionNodeFields","actionNode","rel","faExternalLinkAlt","ReferenceNodeFields","referenceNode","pathwayNode","isStartNode","faPlay","faPrescriptionBottleAlt","faSyringe","faBookMedical","faMicroscope","minHeight","isActionable","nodeTitle","flex","nodeContent","clickable","createTransitionLabel","getBoundingClientRect","element","dimensions","ceil","xCoordinate","yCoordinate","openNode","onClickHandler","nodeRef","nodeStyle","useLifecycles","setNode","setEdge","transitionNodes","Set","outEdges","has","removeEdge","useExpandedState","lastSelectedNode","expanded","setExpanded","toggleExpanded","nodeName","prevState","closeNode","useRedirectToNode","useParams","interactive","expandedNodes","nodeCoordinates","GraphRoot","graphRef","setGraphWidth","b","graphHeight","rootStyles","graphElement","parentElement","sensor","ResizeSensor","detach","elementContainer","elementSelect","addElementLabel","headerText","elementField","elementFieldLabel","onMinimumAgeChange","parseInt","onMaximumAgeChange","handleClose","genderString","ageRangeString","toggleButtonCss","graphHeader","graphHeaderText","toggleButton","darken","toggleIcon","transform","useTheme","showCriteriaBuilder","setShowCriteriaBuilder","toggleShowCriteria","faProjectDiagram","decodeURIComponent","currentNodeId","UserContext","UserProvider","user","setUser","tabs","tab","component","faSpinner","spin","createPathwayButton","pathwayList","pathwaysListButton","buttonRow","editPathway","createNewPathwayMeta","pathwayNameRef","pathwayDescRef","closeModal","handleCreateNewPathway","preventDefault","Start","createNewPathway","handleUpdatePathway","newEditPathway","draftEditPathway","metaDescription","onSubmit","required","container","paper","mozBackgroundClip","webkitBackgroundVlip","backgroundClip","whiteSpace","buttons","LargeActionButton","largeActionButton","largeDecline","toUpperCase","SmallActionButton","accept","decline","smallActionButton","data-testid","faCheck","MediumActionButton","mediumActionButton","deleteId","deleteMethod","deleteType","deleteName","onAcceptHandler","onDeclineHandler","ClickAwayListener","onClickAway","Popover","editablePathway","setEditablePathway","openEditPathwayModal","closeEditPathwayModal","deletion","TableContainer","Table","TableHead","TableRow","TableCell","TableBody","scope","Link","RouterLink","underline","align","faFileDownload","chooseFileInput","inputButton","fileName","onSelectFile","allowedFileType","setFileName","importFileRef","selectFile","files","handleChooseFile","faFileImport","importPathwayOpen","_setImportPathwayOpen","openNewPathwayModal","closeNewPathwayModal","openImportPathwayModal","closeImportPathwayModal","buildCriteriaButton","criteriaList","datetime","moment","fromNow","openImportModal","closeImportModal","ReactDOM","render","getElementById","global","CONFIG","parts","conf"],"mappings":"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","file":"static/js/main.418cd63e.chunk.js","sourcesContent":["module.exports = __webpack_public_path__ + \"static/media/camino-logo-dark.c8fc712a.png\";","// extracted by mini-css-extract-plugin\nmodule.exports = {\"selectButton\":\"ActionButton_selectButton___qB5R\",\"accept\":\"ActionButton_accept__28b2D\",\"decline\":\"ActionButton_decline__zz-vG\",\"smallActionButton\":\"ActionButton_smallActionButton__1bPWu\",\"largeActionButton\":\"ActionButton_largeActionButton__blRdA\",\"largeDecline\":\"ActionButton_largeDecline__wz9Zw\",\"mediumActionButton\":\"ActionButton_mediumActionButton__3EpOp\"};","import { enableAllPlugins } from 'immer';\n\n// enables immer to run in IE11\nenableAllPlugins();\n","import React, {\n  createContext,\n  FC,\n  ReactNode,\n  memo,\n  useState,\n  useContext,\n  useCallback\n} from 'react';\n\nimport { BuilderModel } from 'criteria-model';\n\ninterface CurrentCriteriaContextInterface {\n  buildCriteriaSelected: boolean;\n  currentCriteriaNodeId: string;\n  currentCriteria: BuilderModel | null;\n  criteriaName: string;\n  setBuildCriteriaSelected: (buildCriteriaSelect: boolean) => void;\n  setCurrentCriteriaNodeId: (id: string) => void;\n  setCurrentCriteria: (currentCriteria: BuilderModel | null) => void;\n  setCriteriaName: (criteriaName: string) => void;\n  resetCurrentCriteria: () => void;\n}\n\nexport const CurrentCriteriaContext = createContext<CurrentCriteriaContextInterface>(\n  {} as CurrentCriteriaContextInterface\n);\n\ninterface CurrentCriteriaProviderProps {\n  children: ReactNode;\n}\n\nexport const CurrentCriteriaProvider: FC<CurrentCriteriaProviderProps> = memo(({ children }) => {\n  const [currentCriteriaNodeId, setCurrentCriteriaNodeId] = useState<string>('');\n  const [currentCriteria, setCurrentCriteria] = useState<BuilderModel | null>(null);\n  const [buildCriteriaSelected, setBuildCriteriaSelected] = useState<boolean>(false);\n  const [criteriaName, setCriteriaName] = useState<string>('');\n\n  const resetCurrentCriteria = useCallback(() => {\n    setCurrentCriteriaNodeId('');\n    setCurrentCriteria(null);\n    setBuildCriteriaSelected(false);\n    setCriteriaName('');\n  }, [setCurrentCriteriaNodeId, setCurrentCriteria, setBuildCriteriaSelected, setCriteriaName]);\n\n  return (\n    <CurrentCriteriaContext.Provider\n      value={{\n        buildCriteriaSelected,\n        setBuildCriteriaSelected,\n        currentCriteriaNodeId,\n        setCurrentCriteriaNodeId,\n        currentCriteria: currentCriteria,\n        setCurrentCriteria: setCurrentCriteria,\n        criteriaName,\n        setCriteriaName,\n        resetCurrentCriteria\n      }}\n    >\n      {children}\n    </CurrentCriteriaContext.Provider>\n  );\n});\n\nexport const useCurrentCriteriaContext = (): CurrentCriteriaContextInterface =>\n  useContext(CurrentCriteriaContext);\n","import { createMuiTheme } from '@material-ui/core/styles';\nimport deepmerge from 'deepmerge';\n\ndeclare module '@material-ui/core/styles/createMuiTheme' {\n  interface Theme {\n    variables: {\n      spacing: {\n        globalPadding: string;\n      };\n    };\n  }\n  // allow configuration using `createMuiTheme`\n  interface ThemeOptions {\n    variables?: {\n      spacing?: {\n        globalPadding?: string;\n      };\n    };\n  }\n}\n\ndeclare module '@material-ui/core/styles/createPalette' {\n  interface CommonColors {\n    blue: string;\n    blueLighter: string;\n    red: string;\n    gray: string;\n    grayMedium: string;\n    grayBlue: string;\n    grayLighter: string;\n    grayDark: string;\n    grayVeryDark: string;\n    green: string;\n  }\n}\n\nconst variables = {\n  spacing: {\n    globalPadding: '2em'\n  }\n};\n\nconst colors = {\n  white: '#fff',\n  black: '#222',\n  red: '#d95d77',\n  blue: '#5d89a1',\n  blueLighter: '#9ad2f0',\n  gray: '#4a4a4a',\n  grayMedium: '#bbbdc0',\n  grayBlue: '#cbd5df',\n  grayLight: '#6c6c6c',\n  grayLighter: '#eaeef2',\n  grayDark: '#444',\n  grayVeryDark: '#3a3a3a',\n  green: '#2fa874'\n};\n\nconst typography = {\n  fontFamily: [\n    'Open Sans',\n    '-apple-system',\n    'BlinkMacSystemFont',\n    'Segoe UI',\n    'Roboto',\n    'Oxygen',\n    'Ubuntu',\n    'Cantarell',\n    'Fira Sans',\n    'Droid Sans',\n    'Helvetica Neue',\n    'sans-serif'\n  ].join(',')\n};\n\nconst materialUiOverridesBase = {\n  MuiButton: {\n    root: {\n      borderRadius: 0,\n      height: '38px',\n      '&$disabled': {\n        backgroundColor: colors.grayMedium,\n        color: colors.white\n      }\n    },\n    contained: {\n      '&$disabled': {\n        backgroundColor: colors.grayMedium,\n        color: colors.white\n      }\n    },\n    label: {\n      fontWeight: 600\n    },\n    iconSizeMedium: {\n      '& > *:first-child': {\n        fontSize: 14\n      }\n    },\n    iconSizeSmall: {\n      '& > *:first-child': {\n        fontSize: 14\n      }\n    }\n  },\n  MuiTableHead: {\n    root: {\n      backgroundColor: colors.grayLighter\n    }\n  },\n  MuiTableCell: {\n    root: {\n      fontSize: '1em'\n    },\n    head: {\n      padding: '5px 16px',\n      borderBottom: 'none'\n    }\n  },\n  MuiFormControl: {\n    root: {\n      margin: '10px 0'\n    }\n  },\n  MuiFormLabel: {\n    root: {\n      fontStyle: 'italic',\n      '&.Mui-error': {\n        color: colors.white\n      },\n      '&.Mui-disabled': {\n        color: colors.white\n      }\n    }\n  },\n  MuiInputBase: {\n    root: {\n      fontWeight: 600\n    },\n    input: {\n      '&::selection': {\n        color: colors.white,\n        backgroundColor: colors.grayDark\n      },\n      '&:-webkit-autofill': {\n        transitionDelay: '9999s',\n        transitionProperty: 'background-color, color'\n      },\n      '&$disabled': {\n        color: colors.white,\n        backgroundColor: colors.grayDark\n      }\n    }\n  },\n  MuiTooltip: {\n    tooltip: {\n      fontSize: 14,\n      backgroundColor: colors.black\n    },\n    arrow: {\n      color: colors.black\n    }\n  },\n  MuiOutlinedInput: {\n    root: {\n      borderRadius: '0'\n    }\n  },\n  MuiSelect: {\n    icon: {\n      fontSize: '2em'\n    }\n  },\n  MuiPaper: {\n    rounded: {\n      borderRadius: '0'\n    }\n  },\n  MuiDialogTitle: {\n    root: {\n      padding: '1em'\n    }\n  },\n  MuiDialogContent: {\n    root: {\n      padding: '0 4em'\n    }\n  },\n  MuiDialogActions: {\n    root: {\n      padding: '2em 4em'\n    }\n  },\n  MuiCard: {\n    root: {\n      overflow: 'visible'\n    }\n  },\n  MuiIconButton: {\n    root: {\n      color: colors.gray,\n      '&:disabled': {\n        color: colors.grayMedium\n      }\n    }\n  }\n};\n\nconst materialUiOverridesDark = {\n  MuiFormControl: {\n    root: {\n      '&:hover': {\n        borderColor: colors.white\n      }\n    }\n  },\n  MuiFormLabel: {\n    root: {\n      color: colors.white,\n      '&$focused': {\n        color: colors.white\n      }\n    }\n  },\n  MuiInputBase: {\n    root: {\n      color: colors.white,\n      '&:hover': {\n        borderColor: colors.white,\n        backgroundColor: colors.grayDark\n      }\n    }\n  },\n  MuiTooltip: {\n    tooltip: {\n      fontSize: 14\n    }\n  },\n  MuiOutlinedInput: {\n    root: {\n      '&:hover': {\n        borderColor: colors.white\n      },\n      '&:hover $notchedOutline': {\n        borderColor: colors.white\n      },\n      '&$focused $notchedOutline': {\n        borderColor: colors.white\n      },\n      '&$disabled $notchedOutline': {\n        borderColor: colors.white\n      }\n    },\n    notchedOutline: {\n      borderColor: colors.white\n    }\n  },\n  MuiSelect: {\n    icon: {\n      color: colors.white\n    }\n  },\n  MuiMenuItem: {\n    root: {\n      color: colors.grayDark\n    }\n  },\n  MuiIconButton: {\n    root: {\n      color: colors.white,\n      '&:disabled': {\n        color: colors.grayLight\n      }\n    }\n  }\n};\n\nconst paletteBase = {\n  primary: {\n    main: colors.blue\n  },\n  secondary: {\n    main: colors.red\n  },\n  error: {\n    main: colors.red\n  },\n  common: colors,\n  background: {\n    default: colors.grayLighter\n  },\n  text: {\n    primary: colors.gray,\n    secondary: colors.gray\n  },\n  grey: {\n    800: colors.gray\n  }\n};\n\nconst lightTheme = createMuiTheme({\n  typography: { ...typography },\n  palette: { ...paletteBase },\n  overrides: { ...materialUiOverridesBase },\n  variables: { ...variables }\n});\n\nconst darkTheme = createMuiTheme({\n  typography: { ...typography },\n  palette: deepmerge(paletteBase, {\n    text: {\n      primary: colors.white,\n      secondary: colors.white\n    }\n  }),\n  overrides: deepmerge(materialUiOverridesBase, materialUiOverridesDark),\n  variables: { ...variables }\n});\n\nconst projectorTheme = createMuiTheme({\n  typography: { ...typography },\n  palette: deepmerge(paletteBase, {\n    background: {\n      default: colors.grayBlue\n    },\n    text: {\n      primary: colors.black,\n      secondary: colors.black\n    }\n  }),\n  overrides: { ...materialUiOverridesBase },\n  variables: { ...variables }\n});\n\nexport default lightTheme;\nexport { lightTheme, darkTheme, projectorTheme };\n","import React, {\n  FC,\n  memo,\n  createContext,\n  useState,\n  useCallback,\n  useContext,\n  ReactNode\n} from 'react';\nimport { ThemeProvider as MuiThemeProvider, Theme } from '@material-ui/core/styles';\nimport { lightTheme, darkTheme, projectorTheme } from '../styles/theme';\n\ninterface ThemeProviderProps {\n  theme: string;\n  children: ReactNode;\n}\n\ninterface ThemeContextInterface {\n  toggleTheme: () => void;\n  useProjector: boolean;\n}\n\nconst getTheme = ({ theme, useProjector }: { theme: string; useProjector: boolean }): Theme => {\n  if (useProjector) {\n    switch (theme) {\n      case 'dark':\n        // TODO: replace with dark projector theme\n        return darkTheme;\n\n      default:\n        return projectorTheme;\n    }\n  }\n\n  switch (theme) {\n    case 'dark':\n      return darkTheme;\n\n    default:\n      return lightTheme;\n  }\n};\n\nexport const ThemeContext = createContext({} as ThemeContextInterface);\nexport const useThemeToggle = (): (() => void) => {\n  const { toggleTheme } = useContext(ThemeContext);\n  return toggleTheme;\n};\nexport const useTheme = (theme: string): Theme => {\n  const { useProjector } = useContext(ThemeContext);\n  return getTheme({ theme, useProjector });\n};\n\nconst ThemeProvider: FC<ThemeProviderProps> = memo(({ theme = 'light', children }) => {\n  const [useProjector, setUseProjector] = useState(false);\n  const muiTheme = getTheme({ theme, useProjector });\n\n  const toggleTheme = useCallback(() => {\n    setUseProjector(currentUseProjector => !currentUseProjector);\n  }, []);\n\n  return (\n    <MuiThemeProvider theme={muiTheme}>\n      <ThemeContext.Provider value={{ useProjector, toggleTheme }}>\n        {children}\n      </ThemeContext.Provider>\n    </MuiThemeProvider>\n  );\n});\n\nexport default ThemeProvider;\n","import React, { FC, memo, useCallback, useState, MouseEvent } from 'react';\nimport { Link } from 'react-router-dom';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport { faCog } from '@fortawesome/free-solid-svg-icons';\nimport Menu from '@material-ui/core/Menu';\nimport MenuItem from '@material-ui/core/MenuItem';\n\nimport { useCurrentCriteriaContext } from 'components/CurrentCriteriaProvider';\nimport { useThemeToggle } from '../ThemeProvider';\n\nimport logo from 'camino-logo-dark.png';\nimport styles from './Header.module.scss';\n\nconst Header: FC = () => {\n  const { resetCurrentCriteria } = useCurrentCriteriaContext();\n  const [anchorEl, setAnchorEl] = useState<null | HTMLElement>(null);\n  const toggleTheme = useThemeToggle();\n\n  const openMenu = useCallback((event: MouseEvent<HTMLButtonElement>): void => {\n    setAnchorEl(event.currentTarget);\n  }, []);\n\n  const closeMenu = useCallback((): void => {\n    setAnchorEl(null);\n  }, []);\n\n  const handleToggleTheme = useCallback((): void => {\n    toggleTheme();\n    closeMenu();\n  }, [toggleTheme, closeMenu]);\n\n  return (\n    <header className={styles.header}>\n      <Link to=\"/\" className={styles.homeLink} onClick={(): void => resetCurrentCriteria()}>\n        <img src={logo} alt=\"logo\" className={styles.logo} />\n      </Link>\n\n      <button onClick={openMenu} aria-controls=\"options-menu\" aria-haspopup=\"true\">\n        <FontAwesomeIcon icon={faCog} />\n      </button>\n\n      <Menu\n        id=\"options-menu\"\n        anchorEl={anchorEl}\n        keepMounted\n        open={Boolean(anchorEl)}\n        onClose={closeMenu}\n      >\n        <MenuItem onClick={handleToggleTheme}>Toggle Theme</MenuItem>\n      </Menu>\n    </header>\n  );\n};\n\nexport default memo(Header);\n","import { makeStyles, Theme as AugmentedTheme } from '@material-ui/core/styles';\n\nexport default makeStyles(\n  (theme: AugmentedTheme) => ({\n    root: {\n      display: 'flex',\n      alignItems: 'center',\n      padding: '2em',\n      backgroundColor: theme.palette.background.default,\n      color: theme.palette.text.primary,\n      height: '6em',\n      justifyContent: 'space-between'\n    },\n    backButton: {\n      height: '45px',\n      width: '45px'\n    },\n    navigationIcons: {\n      fontSize: '20px',\n      cursor: 'pointer'\n    },\n    pathwayName: {\n      fontSize: '1.4em',\n      marginLeft: '1.5em'\n    }\n  }),\n  { name: 'Navigation', index: 1 }\n);\n","import { useEffect, useRef, MutableRefObject } from 'react';\nimport useUndo from 'use-undo';\n\nfunction useRefUndoState<T>(\n  initialValue: T\n): [T, MutableRefObject<T>, boolean, boolean, Function, Function, Function, Function] {\n  const [\n    state,\n    { set: setState, reset: resetState, undo: undoState, redo: redoState, canUndo, canRedo }\n  ] = useUndo<T>(initialValue);\n  const stateRef = useRef(state.present);\n\n  useEffect(() => {\n    stateRef.current = state.present;\n  }, [state]);\n\n  return [state.present, stateRef, canUndo, canRedo, undoState, redoState, resetState, setState];\n}\n\nexport default useRefUndoState;\n","import { useState, useEffect } from 'react';\nimport { Service } from 'pathways-objects';\n\nfunction getObject(url: string): Promise<Response> {\n  return fetch(url, {\n    headers: {\n      Accept: 'application/json'\n    }\n  });\n}\n\nfunction typedFetch<T>(url: string, raw: boolean, options?: object): Promise<T> {\n  return fetch(url, options).then(\n    response => (raw ? response.text() : response.json()) as Promise<T>\n  );\n}\n\nfunction useGetService<T>(url: string, raw = false): Service<Array<T>> {\n  const [result, setResult] = useState<Service<Array<T>>>({\n    status: 'loading'\n  });\n\n  useEffect(() => {\n    getObject(url)\n      .then(response => response.json() as Promise<string[]>)\n      .then(listOfFiles => listOfFiles.map(f => typedFetch<T>(url + '/' + f, raw)))\n      .then(listOfPromises => Promise.all(listOfPromises))\n      .then(list => setResult({ status: 'loaded', payload: list }))\n      .catch(error => setResult({ status: 'error', error }));\n  }, [url, raw]);\n\n  return result;\n}\n\nexport default useGetService;\n","import { useEffect, useRef, useState, MutableRefObject } from 'react';\n\nfunction useRefState<T>(initialValue: T): [T, MutableRefObject<T>, Function] {\n  const [state, setState] = useState<T>(initialValue);\n  const stateRef = useRef(state);\n  useEffect(() => {\n    stateRef.current = state;\n  }, [state]);\n  return [state, stateRef, setState];\n}\n\nexport default useRefState;\n","// External CQL -> ELM service\nimport config from 'utils/ConfigManager';\nimport { ElmLibrary } from 'elm-model';\n\nconst url = config.get('cqlToElmWebserviceUrl');\n\nexport function convertBasicCQL(cql: string): Promise<ElmLibrary> {\n  // Connect to web service\n\n  return fetch(url, {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/cql',\n      Accept: 'application/elm+json'\n    },\n    body: cql\n  }).then(elm => elm.json());\n}\n","import React, {\n  createContext,\n  ReactNode,\n  FC,\n  useState,\n  memo,\n  useContext,\n  useCallback,\n  useEffect\n} from 'react';\nimport shortid from 'shortid';\nimport { ElmStatement, ElmLibrary } from 'elm-model';\nimport config from 'utils/ConfigManager';\nimport useGetService from 'components/Services';\nimport { ServiceLoaded } from 'pathways-objects';\nimport { Criteria, BuilderModel } from 'criteria-model';\nimport { convertBasicCQL } from 'engine/cql-to-elm';\n\ninterface CriteriaContextInterface {\n  criteria: Criteria[];\n  addCriteria: (file: File) => void;\n  addCqlCriteria: (cql: string) => void;\n  deleteCriteria: (id: string) => void;\n  addElmCriteria: (elm: ElmLibrary) => Criteria[];\n  addBuilderCriteria: (\n    criteria: BuilderModel,\n    label: string,\n    criteriaSource: string | undefined\n  ) => Criteria[];\n}\n\nexport const CriteriaContext = createContext<CriteriaContextInterface>(\n  {} as CriteriaContextInterface\n);\n\ninterface CriteriaProviderProps {\n  children: ReactNode;\n}\n\nconst DEFAULT_ELM_STATEMENTS = [\n  'Patient',\n  'MeetsInclusionCriteria',\n  'InPopulation',\n  'Recommendation',\n  'Rationale',\n  'Errors'\n];\n\nfunction builderModelToCriteria(criteria: BuilderModel, label: string): Criteria {\n  return {\n    id: shortid.generate(),\n    label,\n    modified: Date.now(),\n    builder: criteria,\n    statement: label\n  };\n}\nfunction elmLibraryToCriteria(\n  elm: ElmLibrary,\n  cql: string | undefined = undefined,\n  custom = false\n): Criteria[] {\n  const allElmStatements: ElmStatement[] = elm.library.statements.def;\n  let elmStatements = allElmStatements.filter(def => !DEFAULT_ELM_STATEMENTS.includes(def.name));\n  const includesTypes = !!allElmStatements.find(s => s.resultTypeName);\n  if (includesTypes) {\n    // if we have types, filter down to just booleans\n    elmStatements = elmStatements.filter(\n      s => s.resultTypeName === '{urn:hl7-org:elm-types:r1}Boolean'\n    );\n  }\n  if (!elmStatements) {\n    alert('No elm statement found in that file');\n    return [];\n  }\n  const labelTitle = custom\n    ? `Criteria Builder (${elm.library.identifier.id.substring(0, 5)})`\n    : elm.library.identifier.id;\n  return elmStatements.map(statement => {\n    return {\n      id: shortid.generate(),\n      label: `${labelTitle}: ${statement.name}`,\n      version: elm.library.identifier.version,\n      modified: Date.now(),\n      elm: elm,\n      cql: cql,\n      statement: statement.name\n    };\n  });\n}\n\nfunction jsonToCriteria(rawElm: string): Criteria[] | undefined {\n  const elm = JSON.parse(rawElm);\n  if (!elm.library?.identifier) {\n    alert('Please upload ELM file');\n    return;\n  }\n  return elmLibraryToCriteria(elm);\n}\n\nfunction cqlToCriteria(rawCql: string): Promise<Criteria[]> {\n  return convertBasicCQL(rawCql).then(elm => {\n    // the cql-to-elm webservice always responds with ELM\n    // even if the CQL was complete garbage\n    // TODO: consider showing the error messages from the annotations?\n    if (!elm.library?.identifier?.id) {\n      // we're async right now so don't show an error here\n      // just return empty\n      return [];\n    }\n    return elmLibraryToCriteria(elm, rawCql);\n  });\n}\n\nexport const CriteriaProvider: FC<CriteriaProviderProps> = memo(({ children }) => {\n  const [criteria, setCriteria] = useState<Criteria[]>([]);\n  const service = useGetService<string>(config.get('demoCriteria'), true);\n  const payload = (service as ServiceLoaded<string[]>).payload;\n\n  useEffect(() => {\n    if (payload) {\n      const listOfPromises = payload.map(rawCql => cqlToCriteria(rawCql));\n      Promise.all(listOfPromises)\n        .then(listOfLists => listOfLists.flat())\n        .then(newCriteria => setCriteria(newCriteria));\n    }\n  }, [payload]);\n\n  const addCqlCriteria = useCallback((cql: string) => {\n    cqlToCriteria(cql).then(newCriteria => {\n      if (newCriteria.length > 0) {\n        setCriteria(currentCriteria => {\n          // Do not add CQL Criteria that already exists\n          return currentCriteria.find(crit => crit.cql === cql)\n            ? currentCriteria\n            : [...currentCriteria, ...newCriteria];\n        });\n      } else {\n        alert('No valid criteria were found in the provided file');\n      }\n    });\n  }, []);\n\n  const addCriteria = useCallback(\n    (file: File) => {\n      // figure out incoming file type\n      const reader = new FileReader();\n      reader.onload = (event: ProgressEvent<FileReader>): void => {\n        if (event.target?.result) {\n          const rawContent = event.target.result as string;\n          // TODO: more robust file type identification?\n          if (file.name.endsWith('.json')) {\n            const newCriteria = jsonToCriteria(rawContent);\n            if (newCriteria) setCriteria(currentCriteria => [...currentCriteria, ...newCriteria]);\n          } else if (file.name.endsWith('.cql')) {\n            addCqlCriteria(rawContent);\n          }\n        } else alert('Unable to read that file');\n      };\n      reader.readAsText(file);\n    },\n    [addCqlCriteria]\n  );\n\n  const deleteCriteria = useCallback((id: string) => {\n    setCriteria(currentCriteria => currentCriteria.filter(criteria => criteria.id !== id));\n  }, []);\n\n  const addElmCriteria = useCallback((elm: ElmLibrary): Criteria[] => {\n    const newCriteria = elmLibraryToCriteria(elm, undefined, true);\n    setCriteria(currentCriteria => [...currentCriteria, ...newCriteria]);\n\n    return newCriteria;\n  }, []);\n\n  const addBuilderCriteria = useCallback(\n    (\n      buildCriteria: BuilderModel,\n      label: string,\n      criteriaSource: string | undefined\n    ): Criteria[] => {\n      const newCriteria = builderModelToCriteria(buildCriteria, label);\n      if (criteriaSource) {\n        // Find criteria that is being edited\n        const matchingCriteria = criteria.find(c => c.id === criteriaSource);\n        if (matchingCriteria) {\n          newCriteria.id = matchingCriteria.id;\n          setCriteria(currentCriteria => [\n            ...currentCriteria.filter(c => c.id !== matchingCriteria.id),\n            newCriteria\n          ]);\n        }\n      } else {\n        setCriteria(currentCriteria => [...currentCriteria, newCriteria]);\n      }\n\n      return [newCriteria];\n    },\n    [criteria]\n  );\n\n  return (\n    <CriteriaContext.Provider\n      value={{\n        criteria,\n        addCriteria,\n        addCqlCriteria,\n        deleteCriteria,\n        addElmCriteria,\n        addBuilderCriteria\n      }}\n    >\n      {children}\n    </CriteriaContext.Provider>\n  );\n});\n\nexport const useCriteriaContext = (): CriteriaContextInterface => useContext(CriteriaContext);\n","import React, {\n  FC,\n  memo,\n  createContext,\n  useCallback,\n  useContext,\n  useEffect,\n  ReactNode\n} from 'react';\nimport { Pathway } from 'pathways-model';\nimport { ServiceLoaded } from 'pathways-objects';\nimport config from 'utils/ConfigManager';\nimport useGetService from './Services';\nimport useRefState from 'utils/useRefState';\nimport { useCriteriaContext } from './CriteriaProvider';\nimport produce from 'immer';\n\ninterface PathwaysContextInterface {\n  pathways: Pathway[];\n  status: string;\n  addPathway: (pathway: Pathway) => void;\n  addPathwayFromFile: (file: File) => void;\n  deletePathway: (id: string) => void;\n  updatePathway: (pathway: Pathway) => void;\n}\n\nexport const PathwaysContext = createContext<PathwaysContextInterface>(\n  {} as PathwaysContextInterface\n);\n\ninterface PathwaysProviderProps {\n  children: ReactNode;\n}\n\nexport const PathwaysProvider: FC<PathwaysProviderProps> = memo(function PathwaysProvider({\n  children\n}) {\n  const [pathways, pathwaysRef, setPathways] = useRefState<Pathway[]>([]);\n  const service = useGetService<Pathway>(config.get('demoPathwaysService'));\n  const servicePayload = (service as ServiceLoaded<Pathway[]>).payload;\n  const { addCqlCriteria, criteria } = useCriteriaContext();\n\n  const addPathway = useCallback(\n    (pathway: Pathway) => {\n      setPathways((currentPathways: Pathway[]) => [...currentPathways, pathway]);\n    },\n    [setPathways]\n  );\n\n  const loadPathwayLibraries = useCallback(\n    (pathway: Pathway): void => {\n      pathway.library.forEach(lib => addCqlCriteria(lib));\n    },\n    [addCqlCriteria]\n  );\n\n  const addPathwayFromFile = useCallback(\n    (file: File) => {\n      const reader = new FileReader();\n      reader.onload = (event: ProgressEvent<FileReader>): void => {\n        if (event.target?.result) {\n          const rawContent = event.target.result as string;\n          const pathway = JSON.parse(rawContent);\n          setPathways((currentPathways: Pathway[]) => {\n            if (!currentPathways.map(path => path.id).includes(pathway.id)) {\n              loadPathwayLibraries(pathway);\n              return [...currentPathways, pathway];\n            } else {\n              alert('Pathway with that id already exists!');\n              return currentPathways;\n            }\n          });\n        } else alert('Unable to read that file');\n      };\n      reader.readAsText(file);\n    },\n    [loadPathwayLibraries, setPathways]\n  );\n\n  const deletePathway = useCallback(\n    (id: string) => {\n      setPathways((currentPathways: Pathway[]) =>\n        currentPathways.filter(pathway => pathway.id !== id)\n      );\n    },\n    [setPathways]\n  );\n\n  const updatePathway = useCallback(\n    (newPathway: Pathway) => {\n      const index = pathwaysRef.current.findIndex(pathway => pathway.id === newPathway.id);\n      setPathways((currentPathways: Pathway[]) => [\n        ...currentPathways.slice(0, index),\n        newPathway,\n        ...currentPathways.slice(index + 1)\n      ]);\n    },\n    [pathwaysRef, setPathways]\n  );\n\n  // Load the pathways present at the configured service\n  useEffect(() => {\n    if (servicePayload) setPathways(servicePayload);\n  }, [servicePayload, setPathways]);\n\n  // Update criteriaSource if criteria change\n  useEffect(() => {\n    const criteriaIds = criteria.map(crit => crit.id);\n    pathways.forEach((pathway, pathwayIndex) =>\n      Object.entries(pathway.nodes).forEach(([nodeIndex, node]) => {\n        node.transitions.forEach(({ condition }, transitionIndex) => {\n          // If a matching criteria does not already exist, try and find one\n          if (condition && !criteriaIds.includes(condition.criteriaSource as string)) {\n            const [library, statement] = condition.cql.split('.');\n            const criteriaSource = criteria.find(\n              crit => crit.elm?.library.identifier.id === library && crit.statement === statement\n            )?.id;\n            // Only update if a criteria source is actually found.\n            if (criteriaSource) {\n              setPathways((currentPathways: Pathway[]) => {\n                return produce(currentPathways, draftPathways => {\n                  const draftCondition =\n                    draftPathways[pathwayIndex].nodes[nodeIndex].transitions[transitionIndex]\n                      .condition;\n                  if (draftCondition) draftCondition.criteriaSource = criteriaSource;\n                });\n              });\n            }\n          }\n        });\n      })\n    );\n  }, [criteria, pathways, setPathways]);\n\n  switch (service.status) {\n    case 'error':\n      return <div>Error loading pathways</div>;\n\n    default:\n      return (\n        <PathwaysContext.Provider\n          value={{\n            pathways,\n            addPathway,\n            addPathwayFromFile,\n            deletePathway,\n            updatePathway,\n            status: service.status\n          }}\n        >\n          {children}\n        </PathwaysContext.Provider>\n      );\n  }\n});\n\nexport const usePathwaysContext = (): PathwaysContextInterface => useContext(PathwaysContext);\n","import React, {\n  ReactNode,\n  createContext,\n  useContext,\n  FC,\n  memo,\n  useCallback,\n  MutableRefObject,\n  useEffect\n} from 'react';\nimport { Pathway } from 'pathways-model';\nimport useRefUndoState from 'utils/useRefUndoState';\nimport { usePathwaysContext } from './PathwaysProvider';\nimport HotKeys from 'react-hot-keys';\n\ninterface CurrentPathwayContextInterface {\n  pathway: Pathway | null;\n  pathwayRef: MutableRefObject<Pathway | null>;\n  canUndoPathway: boolean;\n  canRedoPathway: boolean;\n  undoPathway: () => void;\n  redoPathway: () => void;\n  resetCurrentPathway: (value: Pathway) => void;\n  setCurrentPathway: (value: Pathway) => void;\n}\n\nexport const CurrentPathwayContext = createContext<CurrentPathwayContextInterface>(\n  {} as CurrentPathwayContextInterface\n);\n\ninterface CurrentPathwayProviderProps {\n  children: ReactNode;\n}\n\nexport const CurrentPathwayProvider: FC<CurrentPathwayProviderProps> = memo(({ children }) => {\n  const [\n    pathway,\n    pathwayRef,\n    canUndoPathway,\n    canRedoPathway,\n    _undoPathway,\n    _redoPathway,\n    _resetPathway,\n    _setPathway\n  ] = useRefUndoState<Pathway | null>(null);\n  const { updatePathway } = usePathwaysContext();\n\n  const undoPathway = useCallback(() => {\n    _undoPathway();\n  }, [_undoPathway]);\n\n  const redoPathway = useCallback(() => {\n    _redoPathway();\n  }, [_redoPathway]);\n\n  const resetCurrentPathway = useCallback(\n    (value: Pathway) => {\n      _resetPathway(value);\n    },\n    [_resetPathway]\n  );\n\n  const setCurrentPathway = useCallback(\n    (value: Pathway) => {\n      _setPathway(value);\n    },\n    [_setPathway]\n  );\n\n  useEffect(() => {\n    if (pathway) updatePathway(pathway);\n  }, [pathway, updatePathway]);\n\n  return (\n    <CurrentPathwayContext.Provider\n      value={{\n        pathway,\n        pathwayRef,\n        canUndoPathway,\n        canRedoPathway,\n        undoPathway,\n        redoPathway,\n        resetCurrentPathway,\n        setCurrentPathway\n      }}\n    >\n      <HotKeys keyName=\"control+z,command+z\" onKeyDown={undoPathway}>\n        <HotKeys keyName=\"control+y,command+y\" onKeyDown={redoPathway}>\n          {children}\n        </HotKeys>\n      </HotKeys>\n    </CurrentPathwayContext.Provider>\n  );\n});\n\nexport const useCurrentPathwayContext = (): CurrentPathwayContextInterface =>\n  useContext(CurrentPathwayContext);\n","import {\n  PathwayNode,\n  ActionNode,\n  Pathway,\n  Transition,\n  NodeObj,\n  Action,\n  BranchNode,\n  ReferenceNode\n} from 'pathways-model';\nimport { History } from 'history';\nimport shortid from 'shortid';\nimport { CodeableConcept } from 'fhir-objects';\n\nexport function getNodeType(\n  node?: ActionNode | BranchNode | ReferenceNode | PathwayNode | null\n): string {\n  if (!node || node.type === 'null') {\n    return 'null';\n  } else {\n    return node.type;\n  }\n}\n\nexport function isActionNode(node: PathwayNode): node is ActionNode {\n  return node.type === 'action';\n}\n\nexport function isBranchNode(node: PathwayNode): node is BranchNode {\n  return node.type === 'branch';\n}\n\nexport function isReferenceNode(node: PathwayNode): node is ReferenceNode {\n  return node.type === 'reference';\n}\ntype ConversionResource = {\n  [key: string]: string;\n};\nexport const resourceNameConversion: ConversionResource = {\n  MedicationRequest: 'Medication',\n  ServiceRequest: 'Procedure',\n  CarePlan: 'Regimen'\n};\n\nexport const nodeTypeOptions = [\n  { label: 'Medication', value: 'MedicationRequest' },\n  { label: 'Procedure', value: 'ServiceRequest' },\n  { label: 'Regimen', value: 'CarePlan' },\n  { label: 'Observation', value: 'Observation' },\n  { label: 'Pathway Reference', value: 'Reference' }\n];\n\nexport function findParent(nodes: NodeObj, childNodeKey: string): string | null {\n  const parents = findParents(nodes, childNodeKey);\n  if (parents.length === 1) return parents[0];\n  else return null;\n}\n\nexport function findParents(nodes: NodeObj, childNodeKey: string): string[] {\n  const parents: string[] = [];\n  Object.keys(nodes).forEach(parentNodeKey => {\n    for (const transition of nodes[parentNodeKey].transitions) {\n      if (transition.transition === childNodeKey) {\n        parents.push(parentNodeKey);\n        break;\n      }\n    }\n  });\n  return parents;\n}\n\nexport function findAllTransitions(nodes: NodeObj, key: string): Transition[] {\n  const transitions: Transition[] = [];\n  const parents = findParents(nodes, key);\n  parents.forEach(parentKey => {\n    const parent = nodes[parentKey];\n    parent.transitions.forEach(transition => {\n      if (transition.transition === key) transitions.push(transition);\n    });\n  });\n  return transitions;\n}\n\nexport function findAllChildActionNodes(nodes: NodeObj, key: string): string[] {\n  const childActionNodes: string[] = [];\n\n  const childKeys = nodes[key].transitions.map(t => t.transition);\n  childKeys.forEach(childKey => {\n    const child = nodes[childKey];\n    if (isActionNode(child)) childActionNodes.push(childKey);\n    else childActionNodes.push(...findAllChildActionNodes(nodes, childKey));\n  });\n\n  return childActionNodes;\n}\n\nexport function deepCopyPathway(pathway: Pathway): Pathway {\n  return JSON.parse(JSON.stringify(pathway)) as Pathway;\n}\n\nexport function deepCopyPathwayNode(node: PathwayNode): PathwayNode {\n  return JSON.parse(JSON.stringify(node)) as PathwayNode;\n}\n\nfunction copyNode(node: PathwayNode, newKey: string): PathwayNode {\n  const newNode = deepCopyPathwayNode(node);\n  newNode.key = newKey;\n  return newNode;\n}\n\nexport function findSubPathway(nodes: NodeObj, rootKey: string): NodeObj {\n  const subPathway: NodeObj = {};\n  const oldKeyToNewKey: { [key: string]: string } = {};\n\n  const transitions = (node: PathwayNode): string[] => node.transitions.map(t => t.transition);\n\n  // Copy the nodes over to the new sub pathway\n  let currentKey = rootKey;\n  let currentNewKey = shortid.generate();\n  oldKeyToNewKey[currentKey] = currentNewKey;\n  subPathway[currentNewKey] = copyNode(nodes[currentKey], currentNewKey);\n  const queue = transitions(nodes[currentKey]);\n  const visited = [currentKey];\n  while (queue.length) {\n    // currentKey is always defined because queue.length > 0\n    currentKey = queue.shift()!; // eslint-disable-line\n    if (!visited.includes(currentKey)) {\n      currentNewKey = shortid.generate();\n      oldKeyToNewKey[currentKey] = currentNewKey;\n      subPathway[currentNewKey] = copyNode(nodes[currentKey], currentNewKey);\n      queue.push(...transitions(nodes[currentKey]));\n      visited.push(currentKey);\n    }\n  }\n\n  // Update the transitions to use the new keys\n  Object.keys(subPathway).forEach(key => {\n    const node = subPathway[key];\n    node.transitions.forEach(\n      transition => (transition.transition = oldKeyToNewKey[transition.transition])\n    );\n  });\n\n  return subPathway;\n}\n\nexport function willOrphanChild(pathway: Pathway, childNodeKey: string): boolean {\n  // Count the number of transitions into the node\n  let transitionCount = 0;\n  Object.keys(pathway.nodes).forEach(nodeKey => {\n    pathway.nodes[nodeKey].transitions.forEach(transition => {\n      if (transition.transition === childNodeKey) transitionCount += 1;\n    });\n  });\n\n  return transitionCount >= 2 ? false : true;\n}\n\nexport function canDeleteNode(pathway: Pathway, transitions: Transition[]): boolean {\n  let canDeleteAllTransitions = true;\n  transitions.forEach(transition => {\n    if (willOrphanChild(pathway, transition.transition)) canDeleteAllTransitions = false;\n  });\n  return canDeleteAllTransitions;\n}\n\nexport function redirect(\n  pathwayId: string,\n  nodeKey: string,\n  history: History<History.PoorMansUnknown>\n): void {\n  const url = `/builder/${encodeURIComponent(pathwayId)}/node/${encodeURIComponent(nodeKey)}`;\n  if (url !== history.location.pathname) {\n    history.push(url);\n  }\n}\n\nconst getAncestorNodes = (\n  pathway: Pathway,\n  rootNodeKey: string,\n  currNodeKey: string\n): Array<PathwayNode> => {\n  let ancestors: Array<PathwayNode> = [];\n  let previousNodes: Array<PathwayNode> = [];\n  const currNode = pathway.nodes[currNodeKey];\n\n  currNode.transitions.forEach(transition => {\n    if (transition.transition === rootNodeKey) ancestors.push(currNode);\n    else {\n      previousNodes = getAncestorNodes(pathway, rootNodeKey, transition.transition);\n      if (previousNodes?.length) {\n        if (!ancestors.some(node => node.key === currNode.key)) ancestors.push(currNode);\n        ancestors = ancestors.concat(previousNodes);\n      }\n    }\n  });\n\n  return ancestors;\n};\n\nexport const getConnectableNodes = (\n  pathway: Pathway,\n  rootNode: PathwayNode\n): Array<{ label: string; value: string }> => {\n  const connectableNodes: Array<{ label: string; value: string }> = [];\n  const ancestorNodes = getAncestorNodes(pathway, rootNode.key ?? '', 'Start');\n  ancestorNodes.push(rootNode);\n\n  Object.keys(pathway.nodes).forEach(nodeKey => {\n    const node = pathway.nodes[nodeKey];\n    const rootNodeConnectsToNode = rootNode.transitions.some(\n      transition => transition.transition === nodeKey\n    );\n    const nodeIsAncestor = ancestorNodes.some(node => node.key === nodeKey);\n    if (!rootNodeConnectsToNode && !nodeIsAncestor && node.key)\n      connectableNodes.push({ label: node.label, value: node.key });\n  });\n\n  return connectableNodes;\n};\n\nexport const getTransition = (parent: PathwayNode, childKey: string): Transition | undefined => {\n  return parent.transitions.find(transition => transition.transition === childKey);\n};\n\nexport const getCodeableConceptFromAction = (action: Action): CodeableConcept => {\n  let codeableConcept;\n  switch (action.resource.resourceType) {\n    case 'MedicationRequest':\n      codeableConcept = action.resource.medicationCodeableConcept;\n      break;\n    case 'ServiceRequest':\n      codeableConcept = action.resource.code;\n      break;\n    case 'CarePlan':\n      // For now mock the CarePlan as a codeableconcept\n      codeableConcept = {\n        coding: [\n          {\n            system: 'FakeCarePlanSystem',\n            code: action.resource.title,\n            display: 'Fake CodeableConcept for CarePlan'\n          }\n        ],\n        text: 'Fake CodeableConcept for CarePlan'\n      };\n      break;\n    default:\n      // do nothing\n      break;\n  }\n  return codeableConcept;\n};\n","/**\n * Common interfaces and functions for exporting pathways\n */\n\n// interface purely for intermediate working objects\nexport interface IncludedCqlLibraries {\n  [id: string]: {\n    cql: string;\n    version: string;\n  };\n}\n\n/**\n * Constructs a CQL Library based on the provided CQL\n *\n * @param libraryName - The name to be used in the library\n * @param includedCqlLibraries - Libraries that should be included\n * @param referencedDefines - Definitions that should be defined in the constructed library\n *                            based on a definition in an included library\n * @param builderDefines - Definitions from the CQL builder that should be included\n */\nexport function constructCqlLibrary(\n  libraryName: string,\n  includedCqlLibraries: IncludedCqlLibraries,\n  referencedDefines: Record<string, string>,\n  builderDefines: Record<string, string>\n): string {\n  const includes = Object.entries(includedCqlLibraries)\n    .map(([name, details]) => `include \"${name}\" version '${details.version}' called ${name}\\n\\n`)\n    .join('');\n  const definesList = Object.entries(referencedDefines).map(\n    ([name, srcLibrary]) => `define \"${name}\": ${srcLibrary}.${name}\\n\\n`\n  );\n\n  Object.entries(builderDefines).forEach(([statement, cql]) =>\n    definesList.push(`define \"${statement}\": ${cql}\\n\\n`)\n  );\n\n  const defines = definesList.join('');\n\n  // NOTE: this library should use the same FHIR version as all referenced libraries\n  // and if we want to run it in cqf-ruler, as of today that needs to be FHIR 4.0.1 (NOT 4.0.0)\n  return `\nlibrary ${libraryName} version '1.0'\n\nusing FHIR version '4.0.1'\n\n${includes}\n\ncontext Patient\n\n${defines}\n`;\n}\n","import { Action, NodeObj, Pathway, PathwayNode } from 'pathways-model';\nimport {\n  ActivityDefinition,\n  Bundle,\n  BundleEntry,\n  Coding,\n  Library,\n  PlanDefinition,\n  PlanDefinitionAction,\n  PlanDefinitionCondition\n} from 'fhir-objects';\nimport { Criteria } from 'criteria-model';\nimport { v4 as uuidv4 } from 'uuid';\nimport {\n  isActionNode,\n  isBranchNode,\n  isReferenceNode,\n  getTransition,\n  findSubPathway,\n  findParent,\n  findAllTransitions,\n  deepCopyPathway,\n  findAllChildActionNodes,\n  getCodeableConceptFromAction\n} from './nodeUtils';\nimport { R4 } from '@ahryman40k/ts-fhir-types';\nimport { PlanDefinition_RelatedActionRelationshipKind } from '@ahryman40k/ts-fhir-types/lib/R4/Resource/RTTI_PlanDefinition_RelatedAction'; // eslint-disable-line\nimport { constructCqlLibrary, IncludedCqlLibraries } from './export';\n\nconst LIBRARY_DRAFT = R4.LibraryStatusKind._draft;\nconst PLANDEFINITION_DRAFT = R4.PlanDefinitionStatusKind._draft;\nconst ACTIVITYDEFINITION_DRAFT = R4.ActivityDefinitionStatusKind._draft;\nconst BUNDLE_TRANSACTION = R4.BundleTypeKind._transaction;\nconst BUNDLE_PUT = R4.Bundle_RequestMethodKind._put;\nconst CONDITION_APPLICABILITY = R4.PlanDefinition_ConditionKindKind._applicability; // eslint-disable-line\nconst EXPRESSION_CQL = R4.ExpressionLanguageKind._textCql;\nconst CHILD_RELATIONSHIP = PlanDefinition_RelatedActionRelationshipKind._beforeStart; // eslint-disable-line\nconst PARENT_RELATIONSHIP = PlanDefinition_RelatedActionRelationshipKind._afterEnd; // eslint-disable-line\n\ninterface ActivityDefinitionMap {\n  // Code System or FakeCarePlanSystem\n  [key: string]: {\n    // Code or CarePlan title\n    [key: string]: string; // Resource ID\n  };\n}\n\nexport class CPGExporter {\n  pathway: Pathway;\n  pathways: Pathway[];\n  bundle: Bundle;\n  criteria: Criteria[];\n  nestedBranch: string[];\n  libraries: string[];\n  activityDefinitions: ActivityDefinitionMap;\n\n  // TODO: figure out if elm works correctly here\n  constructor(pathway: Pathway, pathways: Pathway[], criteria: Criteria[]) {\n    // Ensure each node only has one parent\n    const pathwayCopy = deepCopyPathway(pathway);\n    pathwayCopy.nodes = cleanPathway(pathwayCopy.nodes);\n    this.pathway = pathwayCopy;\n    this.bundle = {\n      id: this.pathway.id,\n      resourceType: 'Bundle',\n      type: BUNDLE_TRANSACTION,\n      entry: []\n    };\n    this.criteria = criteria;\n    this.nestedBranch = [];\n    this.activityDefinitions = {};\n    this.libraries = [];\n    this.pathways = pathways;\n  }\n\n  export(): Bundle {\n    const strategyDefinition = this.createPlanDefinition(\n      uuidv4(),\n      `Strategy${this.pathway.name}`,\n      `Strategy for ${this.pathway.name}`,\n      'strategy'\n    );\n\n    this._export(strategyDefinition, this.pathway);\n    this.bundle.entry.push(createBundleEntry(strategyDefinition));\n    return this.bundle;\n  }\n\n  _export(\n    strategyDefinition: PlanDefinition,\n    pathway: Pathway,\n    referencedFrom?: PlanDefinitionAction,\n    condition?: PlanDefinitionCondition[]\n  ): void {\n    // the action for the strategy definition\n    const pathwayAction = createAction(pathway.name, `Action for ${pathway.name}`);\n    if (referencedFrom?.id && pathwayAction.id) {\n      addRelatedAction(pathwayAction, referencedFrom.id, PARENT_RELATIONSHIP);\n      addRelatedAction(referencedFrom, pathwayAction.id, CHILD_RELATIONSHIP);\n      if (condition) {\n        pathwayAction.condition = condition;\n      }\n    }\n\n    const isInDefinition = strategyDefinition.action.find(action => {\n      return action.id === pathway.name;\n    });\n\n    if (!isInDefinition) {\n      const libraries = this.createLibraries(pathway);\n      const library = libraries[0];\n      const id = uuidv4();\n      const cpgRecommendation = this.createPlanDefinition(\n        id,\n        pathway.name,\n        pathway.description,\n        'recommendation',\n        library.id\n      );\n      /*\n      Use (modified) BFS to search the Pathway\n\n      Note: BFS is used as the basis here because it could be easily modified to ensure\n        the parent node is always visited before its children. This assumption is required\n        for the PlanDefinition.action creation algorithm to work correctly.\n    */\n      const queue = ['Start'];\n      const visited: string[] = [];\n      while (queue.length !== 0) {\n        // Key is always defined since queue.length > 0\n      const key = queue.shift()!; // eslint-disable-line\n        const node = pathway.nodes[key];\n        const parentKey = findParent(pathway.nodes, key);\n\n        /*\n        Check parent has been visited - if not:\n          Remove parent from queue if in it\n          Add parent to start of the queue\n          Reinsert key to the end of the list\n          Break (do not convert current node)\n      */\n        if (parentKey && !visited.includes(parentKey)) {\n          queue.filter(n => n !== parentKey);\n          queue.unshift(parentKey);\n          queue.push(key);\n          continue;\n        }\n\n        // Visit this node and convert it\n        if (parentKey)\n          this.convertNode(\n            key,\n            parentKey,\n            cpgRecommendation,\n            strategyDefinition,\n            pathway,\n            pathwayAction,\n            libraries\n          );\n        visited.push(key);\n\n        // Add all unvisited and unqueued node transitions to the queue\n        node.transitions.forEach(transition => {\n          if (!visited.includes(transition.transition) && !queue.includes(transition.transition)) {\n            queue.push(transition.transition);\n          }\n        });\n      }\n      if (cpgRecommendation.action.length) {\n        pathwayAction.definitionCanonical = formatUrl('PlanDefinition', id);\n        this.bundle.entry.push(createBundleEntry(cpgRecommendation));\n      }\n      strategyDefinition.action.push(pathwayAction);\n      libraries.forEach(l => {\n        const data = l.content[0].data;\n        const libraryExists = this.libraries.find(entry => {\n          return entry === data;\n        });\n        if (!libraryExists && data) {\n          this.bundle.entry.push(createBundleEntry(l));\n          this.libraries.push(data);\n        }\n      });\n    }\n  }\n\n  createActivityDefinition(action: Action): ActivityDefinition | null {\n    const activityId = uuidv4();\n    const kind = action.resource.resourceType;\n\n    const codeableConcept = getCodeableConceptFromAction(action);\n    const coding = codeableConcept.coding[0];\n\n    // Do not create a new resource if it already exists\n    if (\n      this.activityDefinitions[coding.system] &&\n      this.activityDefinitions[coding.system][coding.code]\n    )\n      return null;\n\n    const activityDefinition: ActivityDefinition = {\n      id: activityId,\n      resourceType: 'ActivityDefinition',\n      meta: {\n        profile: ['http://hl7.org/fhir/uv/cpg/StructureDefinition/cpg-publishableactivity']\n      },\n      extension: [\n        {\n          url: 'http://hl7.org/fhir/uv/cpg/StructureDefinition/cpg-knowledgeCapability',\n          valueCode: 'publishable'\n        }\n      ],\n      url: `urn:uuid:${activityId}`,\n      version: '1.0',\n      name: `AD${activityId.substring(0, 7)}`,\n      title: `ActivityDefinition: ${activityId}`,\n      status: ACTIVITYDEFINITION_DRAFT,\n      experimental: true,\n      date: new Date().toISOString(),\n      publisher: 'Logged in user',\n      description: action.description,\n      kind: kind\n    };\n\n    switch (kind) {\n      case 'MedicationRequest':\n        activityDefinition.productCodeableConcept = codeableConcept;\n        break;\n      case 'ServiceRequest':\n      case 'CarePlan':\n        activityDefinition.code = codeableConcept;\n        break;\n      default:\n        // do nothing\n        break;\n    }\n\n    this.setActivityDefinitionId(coding, activityId);\n\n    return activityDefinition;\n  }\n\n  createPlanDefinition(\n    id: string,\n    title: string,\n    description: string,\n    type: 'strategy' | 'recommendation',\n    libraryId?: string\n  ): PlanDefinition {\n    const planDefinition: PlanDefinition = {\n      id: id,\n      resourceType: 'PlanDefinition',\n      meta: {\n        profile: [`http://hl7.org/fhir/uv/cpg/StructureDefinition/cpg-${type}definition`]\n      },\n      extension: [\n        {\n          url: 'http://hl7.org/fhir/uv/cpg/StructureDefinition/cpg-knowledgeCapability',\n          valueCode: 'executable'\n        }\n      ],\n      url: `urn:uuid:${id}`,\n      version: '1.0',\n      name: `PD${id.substring(0, 7)}`,\n      title: title,\n      type: {\n        coding: [\n          {\n            system: 'http://terminology.hl7.org/CodeSystem/plan-definition-type',\n            code: type === 'strategy' ? 'workflow-definition' : 'eca-rule',\n            display: type === 'strategy' ? 'Workflow Definition' : 'ECA Rule'\n          }\n        ]\n      },\n      status: PLANDEFINITION_DRAFT,\n      experimental: true,\n      publisher: 'Logged in user',\n      description: description,\n      action: []\n    };\n\n    if (libraryId) planDefinition.library = [libraryId];\n\n    return planDefinition;\n  }\n\n  createLibraries(pathway: Pathway): Library[] {\n    const libraryId = uuidv4();\n    const libraryName = `LIB${libraryId.substring(0, 7)}`;\n\n    const mainLibrary: Library = {\n      id: libraryId,\n      resourceType: 'Library',\n      meta: {\n        profile: ['http://hl7.org/fhir/uv/cpg/StructureDefinition/cpg-executablelibrary']\n      },\n      extension: [\n        {\n          url: 'http://hl7.org/fhir/uv/cpg/StructureDefinition/cpg-knowledgeCapability',\n          valueCode: 'executable'\n        }\n      ],\n      url: `urn:uuid:${libraryId}`,\n      version: '1.0',\n      name: libraryName,\n      title: `Library for ${pathway.name}`,\n      status: LIBRARY_DRAFT,\n      experimental: true,\n      type: {\n        coding: [\n          {\n            system: 'http://terminology.hl7.org/CodeSystem/library-type',\n            code: 'logic-library',\n            display: 'Logic Library'\n          }\n        ]\n      },\n      publisher: 'Logged in user',\n      description: `CQL/ELM library for pathway: ${pathway.name}`,\n      content: []\n    };\n\n    const includedCqlLibraries: IncludedCqlLibraries = {};\n    const referencedDefines: Record<string, string> = {};\n\n    const builderDefines: Record<string, string> = {};\n\n    // iterate through the nodes and find all criteria that are actually used.\n    // for each one, add the criteria CQL to our appropriate map\n    //  - if it's an included library, keep track of the library name and version\n    //    as well as the specific definition we're referencing\n    //  - if it was constructed in the builder, track the name and raw CQL\n    for (const nodeId in pathway.nodes) {\n      const node = pathway.nodes[nodeId];\n      for (const transition of node.transitions) {\n        if (transition.condition?.criteriaSource) {\n          const criteriaSource = this.criteria.find(\n            c => c.id === transition.condition?.criteriaSource\n          );\n          if (criteriaSource?.elm && criteriaSource?.cql) {\n            const libraryIdentifier = criteriaSource.elm.library.identifier;\n            includedCqlLibraries[libraryIdentifier.id] = {\n              cql: criteriaSource.cql,\n              version: libraryIdentifier.version\n            };\n\n            referencedDefines[transition.condition.cql] = libraryIdentifier.id;\n          } else if (criteriaSource?.builder) {\n            builderDefines[criteriaSource.statement] = criteriaSource.builder.cql;\n          }\n        }\n      }\n    }\n\n    const additionalLibraries: Library[] = Object.entries(includedCqlLibraries).map(\n      ([name, details]) => {\n        const newId = uuidv4();\n        return {\n          id: newId,\n          resourceType: 'Library',\n          url: `urn:uuid:${newId}`,\n          version: details.version,\n          name: name,\n          title: name,\n          status: LIBRARY_DRAFT,\n          experimental: true,\n          type: {\n            coding: [\n              {\n                system: 'http://terminology.hl7.org/CodeSystem/library-type',\n                code: 'logic-library',\n                display: 'Logic Library'\n              }\n            ]\n          },\n          publisher: 'Logged in user',\n          description: `CQL/ELM library for pathway: ${pathway.name} / sublibrary ${name}`,\n          content: [\n            {\n              id: name,\n              contentType: 'text/cql',\n              data: btoa(details.cql),\n              title: `CQL for library ${name}`\n            }\n          ]\n        };\n      }\n    );\n\n    const libraryCql = constructCqlLibrary(\n      libraryName,\n      includedCqlLibraries,\n      referencedDefines,\n      builderDefines\n    );\n\n    mainLibrary.content.push({\n      id: 'navigational-cql',\n      contentType: 'text/cql',\n      data: btoa(libraryCql),\n      title: 'CQL for navigating the pathway'\n    });\n\n    if (pathway.elm) {\n      mainLibrary.content.push(\n        {\n          id: 'navigational-elm',\n          contentType: 'application/elm+json',\n          data: btoa(JSON.stringify(pathway.elm.navigational)),\n          title: 'ELM for navigating the pathway'\n        },\n        {\n          id: 'precondition',\n          contentType: 'application/elm+json',\n          data: btoa(JSON.stringify(pathway.elm.preconditions)),\n          title: 'ELM for pathway preconditions'\n        }\n      );\n    }\n\n    return [mainLibrary, ...additionalLibraries];\n  }\n\n  private convertNode(\n    key: string,\n    parentKey: string,\n    cpgRecommendation: PlanDefinition,\n    strategyDefinition: PlanDefinition,\n    pathway: Pathway,\n    pathwayAction: PlanDefinitionAction,\n    libraries: Library[]\n  ): void {\n    const node = pathway.nodes[key];\n    const parent = pathway.nodes[parentKey];\n    const descriptionDetails = `${node.label} (Key: ${key}) - Parent Node Key: ${parentKey}`;\n\n    if (isActionNode(node)) {\n      const activityDefinition = this.createActivityDefinition(node.action);\n      const description = `Action for ${descriptionDetails}`;\n      const activityDefinitionId = activityDefinition\n        ? activityDefinition.id\n        : this.getActivityDefinitionId(node.action);\n      const cpgAction = createAction(key, description, activityDefinitionId);\n\n      if (isBranchNode(parent)) cpgAction.condition = this.createCondition(parent, key, libraries);\n\n      // Traverse up to find closest action and add as related action\n      let parentAction = parent;\n      while (isBranchNode(parentAction)) {\n        const tempParentKey = findParent(pathway.nodes, parentAction.key);\n        if (tempParentKey) parentAction = pathway.nodes[tempParentKey];\n        else break;\n      }\n      if (parentAction.key !== 'Start')\n        addRelatedAction(cpgAction, parentAction.key, PARENT_RELATIONSHIP);\n\n      // Add a related action for each action child\n      const childActionNodeKeys = findAllChildActionNodes(pathway.nodes, key);\n      childActionNodeKeys.forEach(childKey =>\n        addRelatedAction(cpgAction, childKey, CHILD_RELATIONSHIP)\n      );\n\n      this.addActionToPlanDefinition(cpgAction, cpgRecommendation, parent.key);\n\n      if (activityDefinition) this.bundle.entry.push(createBundleEntry(activityDefinition));\n    } else if (isBranchNode(node)) {\n      const description = `Branch based on ${descriptionDetails}`;\n\n      // Add an action for the branch node if it nested\n      if (isBranchNode(parent)) {\n        const cpgAction = createAction(key, description);\n        cpgAction.condition = this.createCondition(parent, key, libraries);\n        this.nestedBranch.push(key);\n        this.addActionToPlanDefinition(cpgAction, cpgRecommendation, parent.key);\n      }\n    } else if (isReferenceNode(node)) {\n      const referencedPathway = this.pathways.find((pathway: Pathway) => {\n        return pathway.id === node.referenceId;\n      });\n      if (referencedPathway) {\n        const pathwayCopy = deepCopyPathway(referencedPathway);\n        pathwayCopy.nodes = cleanPathway(pathwayCopy.nodes);\n        if (isBranchNode(parent)) {\n          const condition = this.createCondition(parent, key, libraries);\n          this._export(strategyDefinition, pathwayCopy, pathwayAction, condition);\n        } else {\n          this._export(strategyDefinition, pathwayCopy, pathwayAction);\n        }\n      }\n    } else if (node.type !== 'start') {\n      const msg = `Error Exporting at Node ${node.label}\\n${node.label} Node does not have a node type. Please edit the node to have a node type and add applicable details and try again.`; // eslint-disable-line\n      alert(msg);\n      console.error(`${msg}\\n${JSON.stringify(node, undefined, 2)}`);\n      throw msg; // Prevent the export from continuing\n    }\n  }\n\n  private createCondition(\n    parent: PathwayNode,\n    key: string,\n    libraries: Library[]\n  ): PlanDefinitionCondition[] {\n    const library = libraries[0];\n    const transition = getTransition(parent, key);\n    if (transition) {\n      const criteriaSource = this.criteria.find(c => c.id === transition.condition?.criteriaSource);\n      return [\n        {\n          kind: CONDITION_APPLICABILITY,\n          expression: {\n            // TODO: this would be cleaner if it was \"text/cql.name\" instead of \"text/cql\"\n            // however the typescript type doesn't allow that.\n            // if we do eventually change it to cql.name,\n            // change expression below to just be criteriaSource.statement\n            language: EXPRESSION_CQL,\n            expression: `${library.name}.${criteriaSource?.statement}`\n          }\n        }\n      ];\n    } else return [];\n  }\n\n  private getActivityDefinitionId(action: Action): string {\n    const codeableConcept = getCodeableConceptFromAction(action);\n    const coding = codeableConcept.coding[0];\n    return this.activityDefinitions[coding.system][coding.code];\n  }\n\n  private setActivityDefinitionId(coding: Coding, id: string): void {\n    if (!this.activityDefinitions[coding.system]) this.activityDefinitions[coding.system] = {};\n    this.activityDefinitions[coding.system][coding.code] = id;\n  }\n\n  private addActionToPlanDefinition(\n    action: PlanDefinitionAction,\n    planDefinition: PlanDefinition,\n    parentKey: string\n  ): void {\n    if (this.nestedBranch.includes(parentKey)) {\n      const parentAction = findAction(planDefinition.action, parentKey);\n      if (!parentAction) return;\n      else if (parentAction.action?.length) parentAction.action.push(action);\n      else parentAction.action = [action];\n    } else planDefinition.action.push(action);\n  }\n}\n\nfunction formatUrl(resourceType: string, id: string): string {\n  return `http://example.com/${resourceType}/${id}`;\n}\n\nfunction addRelatedAction(\n  cpgAction: PlanDefinitionAction,\n  relatedId: string,\n  relationship: PlanDefinition_RelatedActionRelationshipKind // eslint-disable-line\n): void {\n  const relatedAction = {\n    actionId: relatedId,\n    relationship: relationship\n  };\n  if (cpgAction.relatedAction?.length) cpgAction.relatedAction.push(relatedAction);\n  else cpgAction.relatedAction = [relatedAction];\n}\n\nfunction findAction(actions: PlanDefinitionAction[], id: string): PlanDefinitionAction | undefined {\n  for (const action of actions) {\n    if (action.id === id) return action;\n    else if (action.action) {\n      const foundAction = findAction(action.action, id);\n      if (foundAction) return foundAction;\n    }\n  }\n  return;\n}\n\nfunction createBundleEntry(resource: PlanDefinition | ActivityDefinition | Library): BundleEntry {\n  return {\n    fullUrl: formatUrl(resource.resourceType, resource.id),\n    resource: resource,\n    request: {\n      method: BUNDLE_PUT,\n      url: `/${resource.resourceType}/${resource.id}`\n    }\n  };\n}\n\nfunction createAction(id: string, description: string, definition?: string): PlanDefinitionAction {\n  const cpgAction: PlanDefinitionAction = {\n    id: id,\n    title: `Action: ${id}`,\n    description: description,\n    code: [\n      {\n        coding: [\n          {\n            system: 'http://hl7.org/fhir/uv/cpg/CodeSystem/cpg-common-process',\n            code: 'guideline-based-care',\n            display: 'Guideline-based Care'\n          }\n        ]\n      }\n    ]\n  };\n  if (definition) cpgAction.definitionCanonical = formatUrl('ActivityDefinition', definition);\n  return cpgAction;\n}\n\nexport function cleanPathway(nodes: NodeObj): NodeObj {\n  const newNodes = nodes;\n  Object.keys(nodes).forEach(key => {\n    const allTransitions = findAllTransitions(nodes, key);\n\n    // Remove multiple transitions to node by copying subpathway\n    if (allTransitions.length > 1) {\n      allTransitions.shift(); // Remove one transition to maintain the original subpathway\n      allTransitions.forEach(transition => {\n        // Get the sub pathway rooted at current node\n        let subPathway = findSubPathway(nodes, key);\n        subPathway = cleanPathway(subPathway);\n\n        // Replace the transition with the copy\n        if (transition) {\n          transition.transition = subPathway[Object.keys(subPathway)[0]].key;\n          Object.keys(subPathway).forEach(nodeKey => (newNodes[nodeKey] = subPathway[nodeKey]));\n        }\n      });\n    }\n  });\n\n  return newNodes;\n}\n","import { Pathway } from 'pathways-model';\nimport { Criteria } from 'criteria-model';\nimport { v4 as uuidv4 } from 'uuid';\nimport { deepCopyPathway } from './nodeUtils';\nimport { constructCqlLibrary, IncludedCqlLibraries } from './export';\n\nexport class CaminoExporter {\n  pathway: Pathway;\n  criteria: Criteria[];\n\n  constructor(pathway: Pathway, criteria: Criteria[]) {\n    this.pathway = deepCopyPathway(pathway);\n    this.criteria = criteria;\n  }\n\n  export(): Pathway {\n    // goal here is to iterate through the pathway,\n    // find all referenced libraries,\n    // and update the CQL in the transition to point to them appropriately\n    const libraryId = uuidv4();\n    const libraryName = `LIB${libraryId.substring(0, 7)}`;\n\n    const includedCqlLibraries: IncludedCqlLibraries = {};\n    const referencedDefines: Record<string, string> = {};\n\n    const builderDefines: Record<string, string> = {};\n\n    // iterate through the nodes and find all criteria that are actually used.\n    // for each one, add the criteria CQL to our appropriate map\n    //  - if it's an included library, keep track of the library name and version\n    //    as well as the specific definition we're referencing\n    //  - if it was constructed in the builder, track the name and raw CQL\n    for (const nodeId in this.pathway.nodes) {\n      const node = this.pathway.nodes[nodeId];\n      for (const transition of node.transitions) {\n        if (transition.condition?.criteriaSource) {\n          const criteriaSource = this.criteria.find(\n            c => c.id === transition.condition?.criteriaSource\n          );\n          if (criteriaSource?.elm && criteriaSource?.cql) {\n            const libraryIdentifier = criteriaSource.elm.library.identifier;\n            includedCqlLibraries[libraryIdentifier.id] = {\n              cql: criteriaSource.cql,\n              version: libraryIdentifier.version\n            };\n\n            referencedDefines[transition.condition.cql] = libraryIdentifier.id;\n\n            // prepend the library name if not already done\n            if (!transition.condition.cql.startsWith(libraryIdentifier.id)) {\n              transition.condition.cql = `${libraryIdentifier.id}.${transition.condition.cql}`;\n            }\n          } else if (criteriaSource?.builder) {\n            builderDefines[criteriaSource.statement] = criteriaSource.builder.cql;\n\n            // prepend the library name\n            transition.condition.cql = `${libraryName}.${transition.condition.cql}`;\n          }\n        }\n      }\n    }\n\n    const libraries: string[] = [];\n\n    if (Object.keys(builderDefines).length > 0) {\n      // intentionally do not include any extra libraries here\n      const mainLibrary = constructCqlLibrary(libraryName, {}, {}, builderDefines);\n      libraries.push(mainLibrary);\n    }\n\n    // add any other libraries\n    if (Object.keys(includedCqlLibraries).length > 0) {\n      const addtlLibraries = Object.values(includedCqlLibraries).map(l => l.cql);\n      libraries.push(...addtlLibraries);\n    }\n\n    this.pathway.library = libraries;\n\n    return this.pathway;\n  }\n}\n","import {\n  Pathway,\n  Precondition,\n  PathwayNode,\n  Transition,\n  Action,\n  ActionNode,\n  BranchNode,\n  ReferenceNode\n} from 'pathways-model';\nimport { ElmLibrary, ElmStatement } from 'elm-model';\nimport shortid from 'shortid';\nimport produce from 'immer';\nimport { CPGExporter } from './cpg';\nimport { CaminoExporter } from './CaminoExporter';\nimport { Criteria } from 'criteria-model';\nimport { Bundle } from 'fhir-objects';\n\nexport function createNewPathway(name: string, description: string, pathwayId?: string): Pathway {\n  return {\n    id: pathwayId ?? shortid.generate(),\n    name: name,\n    description: description,\n    library: [''],\n    preconditions: [],\n    nodes: {\n      Start: {\n        key: 'Start',\n        label: 'Start',\n        transitions: [],\n        type: 'start'\n      }\n    }\n  };\n}\n\nexport function downloadPathway(\n  pathway: Pathway,\n  pathways: Pathway[],\n  criteria: Criteria[],\n  cpg = false\n): void {\n  const pathwayString = exportPathway(pathway, pathways, criteria, cpg);\n  // Create blob from pathwayString to save to file system\n  const pathwayBlob = new Blob([pathwayString], {\n    type: 'application/json'\n  });\n  // Temporarily create hidden <a> tag to download pathwayBlob\n  // File name is set to <pathway-name>.json\n  const url = window.URL.createObjectURL(pathwayBlob);\n  const a = document.createElement('a');\n  a.href = url;\n  a.download = `${pathway.name}.json`;\n  a.click();\n  window.URL.revokeObjectURL(url);\n}\n\nexport function exportPathway(\n  pathway: Pathway,\n  pathways: Pathway[],\n  criteria: Criteria[],\n  cpg: boolean\n): string {\n  const elm = generateNavigationalElm(pathway);\n  const pathwayWithElm = setNavigationalElm(pathway, elm);\n  let pathwayToExport: Pathway | Bundle = pathwayWithElm;\n  if (cpg) {\n    const exporter = new CPGExporter(pathwayWithElm, pathways, criteria);\n    pathwayToExport = exporter.export();\n  } else {\n    const exporter = new CaminoExporter(pathwayWithElm, criteria);\n    pathwayToExport = exporter.export();\n  }\n  return JSON.stringify(pathwayToExport, undefined, 2);\n}\n\nfunction generateNavigationalElm(pathway: Pathway): ElmLibrary {\n  const elm: ElmLibrary = {\n    library: {\n      identifier: {\n        id: pathway.id,\n        version: '1.0.0'\n      },\n      schemaIdentifier: {\n        id: 'urn:hl7-org:elm',\n        version: 'r1'\n      },\n      usings: {\n        def: [\n          {\n            localIdentifier: 'System',\n            uri: 'urn:hl7-org:elm-types:r1'\n          },\n          {\n            localId: '1',\n            locator: '3:1-3:26',\n            localIdentifier: 'FHIR',\n            uri: 'http://hl7.org/fhir',\n            version: '4.0.0'\n          }\n        ]\n      },\n      statements: {\n        def: [\n          {\n            locator: '13:1-13:15',\n            name: 'Patient',\n            context: 'Patient',\n            expression: {\n              type: 'SingletonFrom',\n              operand: {\n                locator: '13:1-13:15',\n                dataType: '{http://hl7.org/fhir}Patient',\n                type: 'Retrieve'\n              }\n            }\n          }\n        ]\n      },\n      includes: { def: [] },\n      valueSets: { def: [] },\n      codes: { def: [] },\n      codeSystems: { def: [] }\n    }\n  };\n\n  Object.keys(pathway.nodes).forEach((nodeKey: string) => {\n    const node = pathway.nodes[nodeKey];\n    if ('elm' in node && node.elm) {\n      mergeElm(elm, node.elm);\n      const elmStatement = produce(getElmStatement(node.elm), (draftElmStatement: ElmStatement) => {\n        draftElmStatement.name = node.key;\n      });\n      elm.library.statements.def.push(elmStatement);\n    }\n\n    node.transitions.forEach((transition: Transition) => {\n      if (transition.condition?.elm) {\n        // Add tranistion.condition.elm to elm\n        mergeElm(elm, transition.condition.elm);\n        const elmStatement = produce(\n          getElmStatement(transition.condition.elm),\n          (draftElmStatement: ElmStatement) => {\n            draftElmStatement.name = transition.condition?.description ?? 'Unknown';\n          }\n        );\n        elm.library.statements.def.push(elmStatement);\n      }\n    });\n  });\n\n  return elm;\n}\n\nfunction mergeElm(elm: ElmLibrary, additionalElm: ElmLibrary): void {\n  // Merge usings\n  additionalElm.library.usings?.def.forEach(using => {\n    // Check if it is in ELM\n    if (!elm.library.usings?.def.find(def => def.uri === using.uri))\n      elm.library.usings?.def.push(using);\n  });\n\n  // Merge includes\n  additionalElm.library.includes?.def.forEach(include => {\n    if (!elm.library.includes?.def.find(def => def.path === include.path))\n      elm.library.includes?.def.push(include);\n  });\n\n  // Merge valueSets\n  additionalElm.library.valueSets?.def.forEach(valueSet => {\n    if (!elm.library.valueSets?.def.find(def => def.id === valueSet.id))\n      elm.library.valueSets?.def.push(valueSet);\n  });\n  // Merge codes\n  additionalElm.library.codes?.def.forEach(code => {\n    if (!elm.library.codes?.def.find(def => def.name === code.name))\n      elm.library.codes?.def.push(code);\n  });\n  // Merge codesystems\n  additionalElm.library.codeSystems?.def.forEach(codesystem => {\n    if (!elm.library.codeSystems?.def.find(def => def.name === codesystem.name))\n      elm.library.codeSystems?.def.push(codesystem);\n  });\n\n  // TODO: merge concepts\n}\n\nfunction getElmStatement(elm: ElmLibrary): ElmStatement {\n  const defaultStatementNames = [\n    'Patient',\n    'MeetsInclusionCriteria',\n    'InPopulation',\n    'Recommendation',\n    'Rationale',\n    'Errors'\n  ];\n  const elmStatement = elm.library.statements.def.find(\n    def => !defaultStatementNames.includes(def.name)\n  );\n\n  // elmStatement type is ElmStatement | undefined but criteria\n  // provider validates such a statement exists in the elm\n  return elmStatement as ElmStatement;\n}\n\n// TODO: possibly add more precondition methods\nexport function addPrecondition(\n  pathway: Pathway,\n  id: string,\n  elementName: string,\n  expected: string,\n  cql: string\n): Pathway {\n  const precondition: Precondition = {\n    id: id,\n    elementName: elementName,\n    expected: expected,\n    cql: cql\n  };\n  return produce(pathway, (draftPathway: Pathway) => {\n    draftPathway.preconditions.push(precondition);\n  });\n}\n\nexport function setNavigationalElm(pathway: Pathway, elm: object): Pathway {\n  return produce(pathway, (draftPathway: Pathway) => {\n    if (!draftPathway.elm) draftPathway.elm = {};\n    draftPathway.elm.navigational = elm;\n  });\n}\n\nexport function setPreconditionElm(pathway: Pathway, elm: object): Pathway {\n  return produce(pathway, (draftPathway: Pathway) => {\n    if (!draftPathway.elm) draftPathway.elm = {};\n    draftPathway.elm.preconditions = elm;\n  });\n}\n\nexport function createNode(key?: string): PathwayNode {\n  if (!key) key = shortid.generate();\n  const node: PathwayNode = {\n    key,\n    label: 'New Node',\n    transitions: [],\n    type: 'null'\n  };\n\n  return node;\n}\n\nexport function addNode(pathway: Pathway, node: PathwayNode): Pathway {\n  return produce(pathway, (draftPathway: Pathway) => {\n    draftPathway.nodes[node.key] = node;\n  });\n}\n\nexport function setNodeLabel(pathway: Pathway, key: string, label: string): Pathway {\n  return produce(pathway, (draftPathway: Pathway) => {\n    draftPathway.nodes[key].label = label;\n  });\n}\nexport function setNodeReference(\n  pathway: Pathway,\n  key: string,\n  referenceId: string,\n  referenceLabel: string\n): Pathway {\n  return produce(pathway, (draftPathway: Pathway) => {\n    (draftPathway.nodes[key] as ReferenceNode).referenceId = referenceId;\n    (draftPathway.nodes[key] as ReferenceNode).referenceLabel = referenceLabel;\n  });\n}\nexport function setNodeType(pathway: Pathway, nodeKey: string, nodeType: string): Pathway {\n  let action: Action;\n  let newPathway: Pathway;\n  switch (nodeType) {\n    case 'MedicationRequest':\n      newPathway = makeNodeAction(pathway, nodeKey);\n      action = {\n        type: 'create',\n        description: '',\n        id: shortid.generate(),\n        resource: {\n          resourceType: nodeType,\n          medicationCodeableConcept: {\n            coding: [\n              {\n                system: '',\n                code: '',\n                display: ''\n              }\n            ]\n          }\n        }\n      };\n      return setNodeAction(newPathway, nodeKey, action);\n    case 'ServiceRequest':\n      newPathway = makeNodeAction(pathway, nodeKey);\n      action = {\n        type: 'create',\n        description: '',\n        id: shortid.generate(),\n        resource: {\n          resourceType: nodeType,\n          code: {\n            coding: [\n              {\n                system: '',\n                code: '',\n                display: ''\n              }\n            ]\n          }\n        }\n      };\n      return setNodeAction(newPathway, nodeKey, action);\n    case 'CarePlan':\n      newPathway = makeNodeAction(pathway, nodeKey);\n      action = {\n        type: 'create',\n        description: '',\n        id: shortid.generate(),\n        resource: {\n          resourceType: nodeType,\n          title: ''\n        }\n      };\n      return setNodeAction(newPathway, nodeKey, action);\n    case 'Observation':\n      return makeNodeBranch(pathway, nodeKey);\n    case 'Reference':\n      return makeNodeReference(pathway, nodeKey);\n    default:\n      console.error('Unknown nodeType: ' + nodeType);\n      return pathway;\n  }\n}\n\nexport function setNodeAction(pathway: Pathway, key: string, action: Action): Pathway {\n  return produce(pathway, (draftPathway: Pathway) => {\n    (draftPathway.nodes[key] as ActionNode).action = action;\n  });\n}\n\nexport function setNodeMcodeCriteria(\n  pathway: Pathway,\n  key: string,\n  mcodeCriteria: string\n): Pathway {\n  return produce(pathway, (draftPathway: Pathway) => {\n    (draftPathway.nodes[key] as BranchNode).mcodeCriteria = mcodeCriteria;\n  });\n}\n\nexport function setNodeOtherCriteria(\n  pathway: Pathway,\n  key: string,\n  otherCriteria: string\n): Pathway {\n  return produce(pathway, (draftPathway: Pathway) => {\n    (draftPathway.nodes[key] as BranchNode).otherCriteria = otherCriteria;\n  });\n}\n\nexport function addTransition(pathway: Pathway, startNodeKey: string, endNodeKey: string): Pathway {\n  return produce(pathway, (draftPathway: Pathway) => {\n    const transition: Transition = {\n      id: shortid.generate(),\n      transition: endNodeKey\n    };\n\n    draftPathway.nodes[startNodeKey].transitions.push(transition);\n  });\n}\n\nexport function setTransitionCondition(\n  pathway: Pathway,\n  startNodeKey: string,\n  transitionId: string,\n  description: string,\n  criteria: Criteria\n): Pathway {\n  return produce(pathway, (draftPathway: Pathway) => {\n    const foundTransition = draftPathway.nodes[startNodeKey]?.transitions?.find(\n      (transition: Transition) => transition.id === transitionId\n    );\n\n    if (foundTransition) {\n      foundTransition.condition = {\n        description: description,\n        cql: criteria.statement,\n        elm: criteria.elm,\n        criteriaSource: criteria.id\n      };\n    }\n  });\n}\n\nexport function setActionNodeElm(pathway: Pathway, nodeKey: string, elm: ElmLibrary): Pathway {\n  return produce(pathway, (draftPathway: Pathway) => {\n    (draftPathway.nodes[nodeKey] as ActionNode).elm = elm;\n    (draftPathway.nodes[nodeKey] as ActionNode).cql = getElmStatement(elm).name;\n  });\n}\n\n/*\nSet Element Functions\n*/\nexport function setPathwayName(pathway: Pathway, name: string): Pathway {\n  return produce(pathway, (draftPathway: Pathway) => {\n    draftPathway.name = name;\n  });\n}\n\nexport function setPathwayDescription(pathway: Pathway, description: string): Pathway {\n  return produce(pathway, (draftPathway: Pathway) => {\n    draftPathway.description = description;\n  });\n}\n\nexport function setLibrary(pathway: Pathway, library: string): Pathway {\n  return produce(pathway, (draftPathway: Pathway) => {\n    draftPathway.library = [library];\n  });\n}\n\nexport function setTransition(\n  pathway: Pathway,\n  startNodeKey: string,\n  endNodeKey: string,\n  transitionId: string\n): Pathway {\n  return produce(pathway, (draftPathway: Pathway) => {\n    const transition = draftPathway.nodes[startNodeKey]?.transitions?.find(\n      (transition: Transition) => transition.id === transitionId\n    );\n    if (transition) transition.transition = endNodeKey;\n  });\n}\n\nexport function setTransitionConditionDescription(\n  pathway: Pathway,\n  startNodeKey: string,\n  transitionId: string,\n  description: string\n): Pathway {\n  return produce(pathway, (draftPathway: Pathway) => {\n    const foundTransition = draftPathway.nodes[startNodeKey]?.transitions?.find(\n      (transition: Transition) => transition.id === transitionId\n    );\n\n    if (foundTransition?.condition) {\n      foundTransition.condition.description = description;\n    } else if (foundTransition) {\n      foundTransition.condition = {\n        description: description,\n        criteriaSource: '',\n        cql: ''\n      };\n    }\n  });\n}\n\nexport function setTransitionConditionElm(\n  pathway: Pathway,\n  startNodeKey: string,\n  transitionId: string,\n  criteria: Criteria\n): Pathway {\n  return produce(pathway, (draftPathway: Pathway) => {\n    const foundTransition = draftPathway.nodes[startNodeKey]?.transitions?.find(\n      (transition: Transition) => transition.id === transitionId\n    );\n\n    if (foundTransition?.condition) {\n      foundTransition.condition.elm = criteria.elm;\n      foundTransition.condition.cql = criteria.statement;\n    }\n  });\n}\n\nexport function setActionCode(action: Action, code: string): Action {\n  return produce(action, (draftAction: Action) => {\n    if (draftAction.resource.medicationCodeableConcept) {\n      draftAction.resource.medicationCodeableConcept.coding[0].code = code;\n    } else {\n      draftAction.resource.code.coding[0].code = code;\n    }\n  });\n}\n\nexport function setActionCodeSystem(action: Action, codeSystem: string): Action {\n  return produce(action, (draftAction: Action) => {\n    if (draftAction.resource.medicationCodeableConcept) {\n      draftAction.resource.medicationCodeableConcept.coding[0].system = codeSystem;\n    } else {\n      draftAction.resource.code.coding[0].system = codeSystem;\n    }\n  });\n}\n\nexport function setActionDescription(action: Action, description: string): Action {\n  return produce(action, (draftaction: Action) => {\n    draftaction.description = description;\n  });\n}\n\nexport function setActionTitle(action: Action, title: string): Action {\n  return produce(action, (draftaction: Action) => {\n    draftaction.resource.title = title;\n  });\n}\n\nexport function setActionResourceDisplay(action: Action, display: string): Action {\n  return produce(action, (draftAction: Action) => {\n    if (draftAction.resource.medicationCodeableConcept) {\n      draftAction.resource.medicationCodeableConcept.coding[0].display = display;\n    } else if (draftAction.resource.title) {\n      draftAction.resource.description = display;\n    } else {\n      draftAction.resource.code.coding[0].display = display;\n    }\n  });\n}\n\nexport function makeNodeAction(pathway: Pathway, nodeKey: string): Pathway {\n  return produce(pathway, (draftPathway: Pathway) => {\n    const node = draftPathway.nodes[nodeKey] as ActionNode;\n    node.type = 'action';\n    if (node.cql === undefined && node.action === undefined) {\n      node.cql = '';\n    }\n\n    node.transitions.forEach(transition => {\n      delete transition.condition;\n    });\n  });\n}\n\nexport function makeNodeBranch(pathway: Pathway, nodeKey: string): Pathway {\n  return produce(pathway, (draftPathway: Pathway) => {\n    const node = draftPathway.nodes[nodeKey];\n    const newNode: PathwayNode = {\n      key: node.key,\n      label: node.label,\n      transitions: node.transitions,\n      type: 'branch'\n    };\n\n    draftPathway.nodes[nodeKey] = newNode;\n  });\n}\n\nexport function makeNodeReference(pathway: Pathway, nodeKey: string): Pathway {\n  return produce(pathway, (draftPathway: Pathway) => {\n    const node = draftPathway.nodes[nodeKey] as ActionNode;\n    const newNode: ReferenceNode = {\n      key: node.key,\n      label: node.label,\n      transitions: node.transitions,\n      referenceId: '',\n      referenceLabel: '',\n      type: 'reference'\n    };\n    draftPathway.nodes[nodeKey] = newNode;\n  });\n}\nexport function createCQL(action: Action, nodeKey: string): string {\n  const resource = action.resource;\n  // CQl identifier cannot start with a number or contain '-'\n  const cqlId = `cql${shortid.generate().replace(/-/g, 'a')}`;\n  let cql = `library ${cqlId} version '1'\\nusing FHIR version '4.0.0'\\n`;\n\n  const codesystemStatement = (system: string): string => `codesystem \"${system}\": '${system}'\\n`;\n\n  const returnStatement = (resourceType: string): string =>\n    `return Tuple{ resourceType: '${resourceType}', id: R.id.value, status: R.status.value}`;\n\n  const retrieveStatement = (resourceType: string): string => `[${resourceType}: \"${cqlId} code\"]`;\n\n  const defineStatement = (): string => `define \"${nodeKey}\":`;\n\n  if (resource.resourceType === 'MedicationRequest') {\n    const coding = resource.medicationCodeableConcept.coding[0];\n\n    cql += codesystemStatement(coding.system);\n\n    // eslint-disable-next-line\n    cql += `code \"${cqlId} code\": '${escape(coding.code)}' from \"${coding.system}\" display '${\n      coding.display\n    }'\\n`;\n    cql += `${defineStatement()}\n      ${retrieveStatement('MedicationRequest')} R ${returnStatement('MedicationRequest')}`;\n  } else if (resource.resourceType === 'ServiceRequest') {\n    const coding = resource.code.coding[0];\n\n    cql += codesystemStatement(coding.system);\n\n    // eslint-disable-next-line\n    cql += `code \"${cqlId} code\": '${escape(coding.code)}' from \"${coding.system}\" display '${\n      coding.display\n    }'\\n`;\n    cql += `${defineStatement()}\n      if exists ${retrieveStatement('Procedure')}\n      then ${retrieveStatement('Procedure')} R ${returnStatement('Procedure')}\n      else ${retrieveStatement('ServiceRequest')} R ${returnStatement('ServiceRequest')}`;\n  } else if (resource.resourceType === 'CarePlan') {\n    cql += `${defineStatement()}\n      [CarePlan] R where R.title.value = '${escape(resource.title)}' ${returnStatement(\n      'CarePlan'\n    )}`;\n  } else {\n    console.error(\n      'Auto generating CQL for action - unsupported resource type: ' + resource.resourceType\n    );\n  }\n\n  return cql;\n}\n\n/*\nRemove Element Function\n*/\nexport function removePrecondition(pathway: Pathway, id: string): Pathway {\n  return produce(pathway, (draftPathway: Pathway) => {\n    const preconditions = draftPathway.preconditions.filter(\n      (precondition: Precondition) => precondition.id !== id\n    );\n    draftPathway.preconditions = preconditions;\n  });\n}\n\nexport function removeNavigationalElm(pathway: Pathway): Pathway {\n  return produce(pathway, (draftPathway: Pathway) => {\n    delete draftPathway.elm?.navigational;\n  });\n}\n\nexport function removePreconditionElm(pathway: Pathway): Pathway {\n  return produce(pathway, (draftPathway: Pathway) => {\n    delete draftPathway.elm?.preconditions;\n  });\n}\n\nexport function removeNode(pathway: Pathway, key: string): Pathway {\n  return produce(pathway, (draftPathway: Pathway) => {\n    delete draftPathway.nodes[key];\n\n    Object.keys(draftPathway.nodes).forEach((nodeKey: string) => {\n      const node = draftPathway.nodes[nodeKey];\n      node.transitions.forEach((transition: Transition) => {\n        if (transition.transition === key)\n          draftPathway.nodes[nodeKey].transitions = draftPathway.nodes[nodeKey].transitions.filter(\n            (filterTransition: Transition) => transition.id !== filterTransition.id\n          );\n      });\n    });\n  });\n}\n\nexport function removeTransitionCondition(\n  pathway: Pathway,\n  nodeKey: string,\n  transitionId: string\n): Pathway {\n  return produce(pathway, (draftPathway: Pathway) => {\n    const transition = draftPathway.nodes[nodeKey].transitions.find(\n      (transition: Transition) => transition.id === transitionId\n    );\n    if (transition) delete transition.condition;\n  });\n}\n\nexport function removeTransition(\n  pathway: Pathway,\n  parentNodeKey: string,\n  childNodeKey: string\n): Pathway {\n  return produce(pathway, (draftPathway: Pathway) => {\n    const transitions = draftPathway.nodes[parentNodeKey].transitions.filter(\n      (transition: Transition) => transition.transition !== childNodeKey\n    );\n    draftPathway.nodes[parentNodeKey].transitions = transitions;\n  });\n}\n","import React, { FC, memo } from 'react';\nimport { Menu, MenuItem } from '@material-ui/core';\nimport { useCurrentPathwayContext } from 'components/CurrentPathwayProvider';\nimport { useCriteriaContext } from 'components/CriteriaProvider';\nimport { downloadPathway } from 'utils/builder';\nimport { usePathwaysContext } from 'components/PathwaysProvider';\n\ninterface ExportMenuPropsInterface {\n  anchorEl: HTMLElement | null;\n  closeMenu: () => void;\n}\n\nconst ExportMenu: FC<ExportMenuPropsInterface> = ({ anchorEl, closeMenu }) => {\n  const { pathway } = useCurrentPathwayContext();\n  const { pathways } = usePathwaysContext();\n\n  const { criteria } = useCriteriaContext();\n\n  return (\n    <Menu\n      id=\"pathway-options-menu\"\n      anchorEl={anchorEl}\n      getContentAnchorEl={null}\n      anchorOrigin={{ vertical: 'bottom', horizontal: 'left' }}\n      keepMounted\n      open={Boolean(anchorEl)}\n      onClose={closeMenu}\n    >\n      <MenuItem\n        onClick={(): void => {\n          if (pathway) downloadPathway(pathway, pathways, criteria);\n          else alert('No pathway to download!');\n          closeMenu();\n        }}\n      >\n        Export Pathway\n      </MenuItem>\n      <MenuItem\n        onClick={(): void => {\n          if (pathway) downloadPathway(pathway, pathways, criteria, true);\n          else alert('No pathway to download!');\n          closeMenu();\n        }}\n      >\n        Export to CPG\n      </MenuItem>\n    </Menu>\n  );\n};\n\nexport default memo(ExportMenu);\n","import React, { FC, useCallback, useState, MouseEvent } from 'react';\nimport { useHistory } from 'react-router-dom';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport { faChevronLeft, faEllipsisH, faRedo, faUndo } from '@fortawesome/free-solid-svg-icons';\nimport { IconButton, Tooltip } from '@material-ui/core';\n\nimport { useCurrentCriteriaContext } from 'components/CurrentCriteriaProvider';\nimport useStyles from './styles';\nimport { useCurrentPathwayContext } from 'components/CurrentPathwayProvider';\nimport ExportMenu from 'components/elements/ExportMenu';\n\nconst Navigation: FC = () => {\n  const { resetCurrentCriteria } = useCurrentCriteriaContext();\n  const [anchorEl, setAnchorEl] = useState<null | HTMLElement>(null);\n  const {\n    pathway,\n    canUndoPathway,\n    canRedoPathway,\n    undoPathway,\n    redoPathway\n  } = useCurrentPathwayContext();\n  const styles = useStyles();\n  const history = useHistory();\n\n  const openMenu = useCallback((event: MouseEvent<HTMLButtonElement>): void => {\n    setAnchorEl(event.currentTarget);\n  }, []);\n\n  const closeMenu = useCallback((): void => {\n    setAnchorEl(null);\n  }, []);\n\n  const handleGoBack = useCallback((): void => {\n    resetCurrentCriteria();\n    history.push('/');\n  }, [history, resetCurrentCriteria]);\n\n  return (\n    <nav className={styles.root}>\n      <div>\n        <IconButton className={styles.backButton} onClick={handleGoBack} aria-label=\"go back\">\n          <FontAwesomeIcon icon={faChevronLeft} className={styles.navigationIcons} />\n        </IconButton>\n\n        <span className={styles.pathwayName}>{pathway?.name}</span>\n      </div>\n      <div>\n        <Tooltip placement=\"top\" title=\"Undo\" arrow>\n          <span>\n            <IconButton onClick={undoPathway} disabled={!canUndoPathway} aria-label=\"undo\">\n              <FontAwesomeIcon icon={faUndo} className={styles.navigationIcons} />\n            </IconButton>\n          </span>\n        </Tooltip>\n        <Tooltip placement=\"top\" title=\"Redo\" arrow>\n          <span>\n            <IconButton onClick={redoPathway} disabled={!canRedoPathway} aria-label=\"redo\">\n              <FontAwesomeIcon icon={faRedo} className={styles.navigationIcons} />\n            </IconButton>\n          </span>\n        </Tooltip>\n        <IconButton onClick={openMenu} aria-controls=\"pathway-options-menu\" aria-haspopup=\"true\">\n          <FontAwesomeIcon icon={faEllipsisH} className={styles.navigationIcons} />\n        </IconButton>\n        <ExportMenu anchorEl={anchorEl} closeMenu={closeMenu} />\n      </div>\n    </nav>\n  );\n};\n\nexport default Navigation;\n","import { makeStyles, Theme as AugmentedTheme } from '@material-ui/core/styles';\n\nexport default makeStyles(\n  (theme: AugmentedTheme) => ({\n    root: {\n      display: 'flex',\n      flexDirection: 'column',\n      padding: theme.variables.spacing.globalPadding,\n      color: theme.palette.text.primary,\n      backgroundColor: theme.palette.common.gray,\n      width: '33%',\n      minWidth: '550px',\n      overflowY: 'scroll'\n    },\n    formControl: {\n      margin: theme.spacing(1, 0),\n      minWidth: 375\n    },\n    referenceDropdown: {\n      display: 'flex'\n    },\n    referenceChevron: {\n      fontSize: '2em',\n      marginLeft: '1em',\n      lineHeight: '2.5em',\n      cursor: 'pointer',\n      '&:hover': {\n        color: theme.palette.common.grayLighter\n      }\n    },\n    divider: {\n      width: '100%'\n    },\n    headerLabelStart: {\n      cursor: 'default'\n    },\n    displayText: {\n      margin: '0 0 5px 0',\n      fontWeight: 900,\n      fontSize: '1em'\n    },\n    sidebarHeader: {\n      display: 'flex',\n      justifyContent: 'space-between'\n    },\n    sidebarHeaderGroup: {\n      display: 'flex',\n      alignItems: 'center'\n    },\n    sidebarHeaderButton: {\n      height: '45px',\n      width: '45px',\n      color: theme.palette.text.primary\n    },\n    headerLabelGroup: {\n      display: 'flex',\n      cursor: 'pointer',\n      height: '60px'\n    },\n    headerLabel: {\n      display: 'flex',\n      alignItems: 'center',\n      fontSize: '1.6em',\n      fontWeight: 700,\n      margin: '0 5px'\n    },\n    headerLabelText: {\n      marginBottom: '5px'\n    },\n    editIcon: {\n      fontSize: '0.6em',\n      marginLeft: '10px'\n    },\n    sidebarButtonGroup: {\n      display: 'flex',\n      margin: '10px 0'\n    },\n    sidebarButtonGroupExtraMargin: {\n      display: 'flex',\n      margin: '20px 0 10px 0'\n    },\n    sidebarButton: {\n      minWidth: 180,\n      marginRight: '20px'\n    },\n    sidebarButtonText: {\n      fontStyle: 'italic'\n    },\n    outlinedDiv: {\n      display: 'flex',\n      flexDirection: 'column',\n      alignItems: 'flex-start'\n    },\n    outlinedDivError: {\n      borderColor: `${theme.palette.error.main} !important`,\n      '&:hover': {\n        borderColor: `${theme.palette.error.main} !important`\n      }\n    },\n    toggleSidebar: {\n      display: 'inline-flex',\n      alignItems: 'center',\n      justifyContent: 'center',\n      float: 'left',\n      width: '50px',\n      minWidth: '50px',\n      height: '50px',\n      fontSize: '2em',\n      backgroundColor: theme.palette.primary.main,\n      color: theme.palette.text.primary,\n      '&:hover': {\n        cursor: 'pointer'\n      }\n    },\n    cancelButton: {\n      alignSelf: 'flex-end',\n      marginTop: '5px',\n      padding: '5px 15px',\n      fontSize: '1em'\n    },\n    editButton: {\n      marginLeft: '1em',\n      alignSelf: 'flex-end',\n      marginTop: '5px',\n      padding: '5px 15px',\n      fontSize: '1em',\n      backgroundColor: theme.palette.primary.main,\n      borderColor: theme.palette.primary.main,\n      '&:hover': {\n        backgroundColor: theme.palette.primary.main,\n        borderColor: theme.palette.primary.main\n      }\n    },\n    buildCriteriaContainer: {\n      display: 'flex',\n      justifyContent: 'flex-end'\n    },\n    buildCriteriaText: {\n      marginTop: '0.5em',\n      marginBottom: '1em'\n    },\n    saveButton: {\n      marginLeft: '1em',\n      backgroundColor: theme.palette.error.main,\n      borderColor: theme.palette.error.main,\n      '&:hover': {\n        backgroundColor: theme.palette.error.main\n      }\n    },\n    transitionContainer: {\n      backgroundColor: theme.palette.common.grayVeryDark,\n      padding: '5px 15px',\n      margin: '15px 0'\n    },\n    dividerHeader: {\n      width: '100%',\n      textTransform: 'uppercase',\n      borderBottom: '1px solid ' + theme.palette.common.blueLighter,\n      color: theme.palette.common.blueLighter,\n      lineHeight: '0.1em',\n      margin: '10px 0 20px',\n      fontWeight: 800,\n      paddingLeft: '15px',\n      '& span': {\n        background: theme.palette.common.gray,\n        padding: '0 10px'\n      }\n    },\n    dialogCloseButton: {\n      float: 'right',\n      width: '45px'\n    },\n    dialogContent: {\n      color: theme.palette.common.black,\n      fontSize: '16px',\n      display: 'flex',\n      marginTop: '-25px'\n    },\n    dialogContentText: {\n      paddingLeft: '10px',\n      lineHeight: '40px'\n    },\n    alertIcon: {\n      color: theme.palette.common.red,\n      fontSize: '40px'\n    },\n    connectDropdown: {\n      margin: 'auto',\n      display: 'flex',\n      flexDirection: 'column',\n      flexWrap: 'nowrap',\n      alignContent: 'center'\n    },\n    connectText: {\n      display: 'flex',\n      flexDirection: 'row',\n      alignItems: 'center',\n      fontSize: '0.95em',\n      fontStyle: 'italic'\n    },\n    cancelButtonDropdown: {\n      marginLeft: 'auto',\n      border: 'none',\n      alignSelf: 'center',\n      color: theme.palette.common.blueLighter,\n      fontSize: '1em',\n      fontStyle: 'italic',\n      textTransform: 'none'\n    },\n    criteriaText: {\n      width: '100%'\n    }\n  }),\n  { name: 'Sidebar', index: 1 }\n);\n","import React, {\n  MutableRefObject,\n  createContext,\n  useCallback,\n  memo,\n  ReactNode,\n  FC,\n  useContext\n} from 'react';\nimport { PathwayNode } from 'pathways-model';\nimport useRefState from 'utils/useRefState';\n\ninterface CurrentNodeContextInterface {\n  currentNode: PathwayNode | null;\n  currentNodeRef: MutableRefObject<PathwayNode | null>;\n  setCurrentNode: (value: PathwayNode) => void;\n}\n\nexport const CurrentNodeContext = createContext<CurrentNodeContextInterface>(\n  {} as CurrentNodeContextInterface\n);\n\ninterface CurrentNodeProviderProps {\n  children: ReactNode;\n}\n\nexport const CurrentNodeProvider: FC<CurrentNodeProviderProps> = memo(({ children }) => {\n  const [currentNode, currentNodeRef, _setCurrentNode] = useRefState<PathwayNode | null>(null);\n\n  const setCurrentNode = useCallback(\n    (value: PathwayNode) => {\n      _setCurrentNode(value);\n    },\n    [_setCurrentNode]\n  );\n\n  return (\n    <CurrentNodeContext.Provider value={{ currentNode, currentNodeRef, setCurrentNode }}>\n      {children}\n    </CurrentNodeContext.Provider>\n  );\n});\n\nexport const useCurrentNodeContext = (): CurrentNodeContextInterface =>\n  useContext(CurrentNodeContext);\n","import React, { FC, memo, useCallback, ChangeEvent, ReactElement } from 'react';\nimport { InputLabel, FormControl, TextField, Select, MenuItem } from '@material-ui/core';\nimport { faCaretDown } from '@fortawesome/free-solid-svg-icons';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport { Autocomplete } from '@material-ui/lab';\n\ninterface Option {\n  label: string;\n  value: string;\n}\n\ninterface DropDownProps {\n  id: string;\n  label: string;\n  options: Array<Option>;\n  value?: string;\n  onChange: Function | null;\n  autocomplete?: boolean;\n}\n\nconst DropDown: FC<DropDownProps> = ({\n  id,\n  label,\n  options,\n  value,\n  onChange,\n  autocomplete = true\n}: DropDownProps) => {\n  const handleSetSelected = useCallback(\n    (event: ChangeEvent<{ value: unknown }>): void => {\n      if (onChange) onChange(event.target.value || '');\n    },\n    [onChange]\n  );\n\n  const handleAutoSelected = useCallback(\n    (event: ChangeEvent<{}>, value: Option | null): void => {\n      if (onChange && value) onChange(value.value);\n    },\n    [onChange]\n  );\n\n  const getValue = (value: string | undefined): Option | undefined => {\n    return options.find(option => {\n      return option.value === value;\n    });\n  };\n\n  const renderAuto = (): ReactElement => {\n    return (\n      <Autocomplete\n        fullWidth\n        onChange={handleAutoSelected}\n        value={getValue(value) || null}\n        popupIcon={<FontAwesomeIcon icon={faCaretDown} style={{ color: 'white' }} />}\n        options={options}\n        getOptionLabel={(option): string => option.label}\n        renderOption={(option: Option): ReactElement => (\n          <div key={option.value} style={{ color: 'black' }}>\n            {option.label}\n          </div>\n        )}\n        renderInput={(params): ReactElement => (\n          <TextField\n            error={value == null || value === ''}\n            {...params}\n            variant=\"outlined\"\n            label={label}\n          />\n        )}\n      />\n    );\n  };\n\n  const renderManual = (): ReactElement => {\n    return (\n      <FormControl variant=\"outlined\" fullWidth>\n        <InputLabel id={id} htmlFor={`${id}-select`}>\n          {label}\n        </InputLabel>\n\n        <Select\n          id={`${id}-select`}\n          value={value || ''}\n          onChange={handleSetSelected}\n          label={label}\n          error={value == null || value === ''}\n          MenuProps={{\n            getContentAnchorEl: null,\n            anchorOrigin: {\n              vertical: 'bottom',\n              horizontal: 'center'\n            },\n            transformOrigin: {\n              vertical: 'top',\n              horizontal: 'center'\n            }\n          }}\n          displayEmpty\n        >\n          {options.map(option => (\n            <MenuItem key={option.value} value={option.value}>\n              {option.label}\n            </MenuItem>\n          ))}\n        </Select>\n      </FormControl>\n    );\n  };\n\n  return <>{autocomplete ? renderAuto() : renderManual()}</>;\n};\n\nexport default memo(DropDown);\n","import React, {\n  FC,\n  createContext,\n  useState,\n  memo,\n  ReactNode,\n  useContext,\n  useCallback\n} from 'react';\n\ninterface SnackbarContextInterface {\n  snackbarText: string;\n  openSnackbar: boolean;\n  handleCloseSnackbar: () => void;\n  setSnackbarText: (value: string) => void;\n  setOpenSnackbar: (value: boolean) => void;\n}\n\nexport const SnackbarContext = createContext<SnackbarContextInterface>(\n  {} as SnackbarContextInterface\n);\n\ninterface SnackbarProviderProps {\n  children: ReactNode;\n}\n\nexport const SnackbarProvider: FC<SnackbarProviderProps> = memo(({ children }) => {\n  const [openSnackbar, setOpenSnackbar] = useState<boolean>(false);\n  const [snackbarText, setSnackbarText] = useState<string>('Deleted Successfully');\n\n  const handleCloseSnackbar = useCallback(() => {\n    setOpenSnackbar(false);\n  }, [setOpenSnackbar]);\n\n  return (\n    <SnackbarContext.Provider\n      value={{ snackbarText, openSnackbar, handleCloseSnackbar, setSnackbarText, setOpenSnackbar }}\n    >\n      {children}\n    </SnackbarContext.Provider>\n  );\n});\n\nexport const useSnackbarContext = (): SnackbarContextInterface => useContext(SnackbarContext);\n","import React, { FC, memo, useCallback } from 'react';\nimport { Snackbar, Button, IconButton } from '@material-ui/core';\nimport { useSnackbarContext } from 'components/SnackbarProvider';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport { faTimes } from '@fortawesome/free-solid-svg-icons';\nimport { useCurrentPathwayContext } from 'components/CurrentPathwayProvider';\n\nconst DeleteSnackbar: FC = () => {\n  const { undoPathway } = useCurrentPathwayContext();\n  const { snackbarText, openSnackbar, handleCloseSnackbar } = useSnackbarContext();\n\n  const undo = useCallback(() => {\n    undoPathway();\n    handleCloseSnackbar();\n  }, [undoPathway, handleCloseSnackbar]);\n\n  return (\n    <Snackbar\n      anchorOrigin={{\n        vertical: 'bottom',\n        horizontal: 'right'\n      }}\n      open={openSnackbar}\n      autoHideDuration={10000}\n      onClose={handleCloseSnackbar}\n      message={snackbarText}\n      action={\n        <React.Fragment>\n          <Button color=\"secondary\" size=\"small\" onClick={undo}>\n            UNDO\n          </Button>\n          <IconButton size=\"small\" aria-label=\"close\" color=\"inherit\" onClick={handleCloseSnackbar}>\n            <FontAwesomeIcon icon={faTimes} />\n          </IconButton>\n        </React.Fragment>\n      }\n    />\n  );\n};\n\nexport default memo(DeleteSnackbar);\n","import React, { useState, memo, useCallback, FC } from 'react';\nimport { SidebarButton } from 'components/Sidebar';\nimport DropDown from 'components/elements/DropDown';\nimport useStyles from './styles';\nimport { addTransition } from 'utils/builder';\nimport { getConnectableNodes } from 'utils/nodeUtils';\nimport { useCurrentPathwayContext } from 'components/CurrentPathwayProvider';\nimport { useCurrentNodeContext } from 'components/CurrentNodeProvider';\n\nimport { faLevelDownAlt } from '@fortawesome/free-solid-svg-icons';\nimport { Button } from '@material-ui/core';\n\nconst ConnectNodeButton: FC = () => {\n  const { pathway, pathwayRef, setCurrentPathway } = useCurrentPathwayContext();\n  const { currentNode, currentNodeRef } = useCurrentNodeContext();\n\n  const styles = useStyles();\n  const [open, setOpen] = useState(false);\n\n  const options: Array<{ label: string; value: string }> =\n    currentNode && pathway ? getConnectableNodes(pathway, currentNode) : [];\n  const optionsAvailable = options.length > 0;\n\n  const connectToNode = useCallback(\n    (nodeKey: string): void => {\n      if (pathwayRef.current && currentNodeRef.current)\n        setCurrentPathway(addTransition(pathwayRef.current, currentNodeRef.current.key, nodeKey));\n      setOpen(false);\n    },\n    [setCurrentPathway, currentNodeRef, pathwayRef]\n  );\n\n  const showDropdown = useCallback(() => {\n    setOpen(!open);\n  }, [open]);\n\n  return (\n    <div>\n      {!open && (\n        <SidebarButton\n          buttonName=\"Connect Node\"\n          buttonIcon={faLevelDownAlt}\n          buttonText=\"Create a transition to an existing node in the pathway.\"\n          onClick={showDropdown}\n          disabled={!optionsAvailable}\n          hasTooltip={!optionsAvailable}\n          tooltipTitle=\"There are no possible nodes to connect to.\"\n        />\n      )}\n      {open && optionsAvailable && (\n        <div className={styles.connectDropdown}>\n          <DropDown\n            id=\"transitions\"\n            label=\"Node To Connect To\"\n            options={options}\n            onChange={connectToNode}\n          />\n          <div className={styles.connectText}>\n            Select node from list to add transition.\n            <Button\n              className={styles.cancelButtonDropdown}\n              size=\"small\"\n              variant=\"text\"\n              onClick={showDropdown}\n            >\n              Cancel\n            </Button>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default memo(ConnectNodeButton);\n","import React, { FC, memo, useCallback, useState, useRef } from 'react';\nimport { useHistory } from 'react-router-dom';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport { faChevronLeft, faChevronRight, faPlus } from '@fortawesome/free-solid-svg-icons';\nimport {\n  SidebarHeader,\n  ActionNodeEditor,\n  SidebarButton,\n  TransitionEditor,\n  BranchTransition,\n  ReferenceNodeEditor\n} from 'components/Sidebar';\nimport { setNodeType, addTransition, createNode, addNode } from 'utils/builder';\nimport useStyles from './styles';\nimport { useCurrentPathwayContext } from 'components/CurrentPathwayProvider';\nimport { useCurrentNodeContext } from 'components/CurrentNodeProvider';\nimport { isBranchNode, redirect, getNodeType } from 'utils/nodeUtils';\nimport { nodeTypeOptions } from 'utils/nodeUtils';\nimport DropDown from 'components/elements/DropDown';\nimport DeleteSnackbar from './DeleteSnackbar';\nimport ConnectNodeButton from 'components/Sidebar/ConnectNodeButton';\n\nconst Sidebar: FC = () => {\n  const { pathway, pathwayRef, setCurrentPathway } = useCurrentPathwayContext();\n  const { currentNode, currentNodeRef } = useCurrentNodeContext();\n  const [isExpanded, setIsExpanded] = useState<boolean>(true);\n  const styles = useStyles();\n  const history = useHistory();\n  const sidebarContainerElement = useRef<HTMLDivElement>(null);\n\n  const toggleSidebar = useCallback((): void => {\n    setIsExpanded(!isExpanded);\n  }, [isExpanded]);\n\n  const changeNodeType = useCallback(\n    (nodeType: string): void => {\n      if (currentNodeRef.current && pathwayRef.current)\n        setCurrentPathway(setNodeType(pathwayRef.current, currentNodeRef.current.key, nodeType));\n    },\n    [pathwayRef, setCurrentPathway, currentNodeRef]\n  );\n\n  const addPathwayNode = useCallback((): void => {\n    if (!currentNodeRef.current || !pathwayRef.current) return;\n\n    const newNode = createNode();\n    let newPathway = addNode(pathwayRef.current, newNode);\n    newPathway = addTransition(newPathway, currentNodeRef.current.key, newNode.key);\n    setCurrentPathway(newPathway);\n    if (!isBranchNode(currentNodeRef.current))\n      redirect(pathwayRef.current.id, newNode.key, history);\n  }, [pathwayRef, setCurrentPathway, currentNodeRef, history]);\n\n  if (!pathway) return <div>Error: No pathway</div>;\n  if (!currentNode) return <div>Error: No current node</div>;\n\n  if (currentNode.type === 'start') {\n    return (\n      <>\n        {isExpanded && (\n          <div className={styles.root} ref={sidebarContainerElement}>\n            <SidebarHeader node={currentNode} isTransition={false} />\n            <h5 className={styles.dividerHeader}>\n              <></>{' '}\n            </h5>\n            <SidebarButton\n              buttonName=\"Add Node\"\n              buttonIcon={faPlus}\n              buttonText=\"Add a new transition to a new node in the pathway.\"\n              onClick={addPathwayNode}\n            />\n          </div>\n        )}\n\n        <div className={styles.toggleSidebar} onClick={toggleSidebar}>\n          <FontAwesomeIcon icon={isExpanded ? faChevronLeft : faChevronRight} />\n        </div>\n        <DeleteSnackbar />\n      </>\n    );\n  } else {\n    const nodeType = getNodeType(currentNode);\n    const displayTransitions = nodeType !== 'start' || currentNode.transitions.length === 0;\n\n    return (\n      <>\n        {isExpanded && (\n          <div className={styles.root} ref={sidebarContainerElement}>\n            <SidebarHeader node={currentNode} isTransition={false} />\n\n            <h5 className={styles.dividerHeader}>\n              <span>Details</span>\n            </h5>\n\n            {nodeType === 'null' && (\n              <DropDown\n                id=\"nodeType\"\n                label=\"Node Type\"\n                options={nodeTypeOptions}\n                onChange={changeNodeType}\n                value=\"\"\n              />\n            )}\n            {nodeType === 'reference' && <ReferenceNodeEditor changeNodeType={changeNodeType} />}\n            {nodeType === 'action' && <ActionNodeEditor changeNodeType={changeNodeType} />}\n\n            {nodeType === 'branch' && (\n              <DropDown\n                id=\"nodeType\"\n                label=\"Node Type\"\n                options={nodeTypeOptions}\n                onChange={changeNodeType}\n                value=\"Observation\"\n              />\n            )}\n\n            <h5 className={styles.dividerHeader}>\n              <span>Transitions</span>\n            </h5>\n\n            {currentNode?.transitions.map(transition => {\n              return (\n                <TransitionEditor key={transition.id} transition={transition}>\n                  {nodeType === 'branch' && (\n                    <BranchTransition key={transition.id} transition={transition} />\n                  )}\n                </TransitionEditor>\n              );\n            })}\n\n            {displayTransitions && (\n              <>\n                <SidebarButton\n                  buttonName=\"Add New Node\"\n                  buttonIcon={faPlus}\n                  buttonText=\"Add a new transition to a new node in the pathway.\"\n                  onClick={addPathwayNode}\n                />\n                <ConnectNodeButton />\n              </>\n            )}\n          </div>\n        )}\n        <div className={styles.toggleSidebar} onClick={toggleSidebar}>\n          <FontAwesomeIcon icon={isExpanded ? faChevronLeft : faChevronRight} />\n        </div>\n        <DeleteSnackbar />\n      </>\n    );\n  }\n};\n\nexport default memo(Sidebar);\n","import React, { FC, memo, useCallback, useRef, useState, KeyboardEvent, FocusEvent } from 'react';\nimport clsx from 'clsx';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport {\n  faEdit,\n  faChevronLeft,\n  faChevronRight,\n  faTrashAlt\n} from '@fortawesome/free-solid-svg-icons';\nimport { IconButton, FormControl, Input, Tooltip } from '@material-ui/core';\n\nimport { PathwayNode } from 'pathways-model';\nimport { setNodeLabel, removeNode, removeTransition } from 'utils/builder';\nimport useStyles from './styles';\nimport { useCurrentPathwayContext } from 'components/CurrentPathwayProvider';\nimport { useHistory } from 'react-router-dom';\nimport { canDeleteNode, redirect, findParents, willOrphanChild } from 'utils/nodeUtils';\nimport { DeleteModal } from '.';\nimport { useCurrentNodeContext } from 'components/CurrentNodeProvider';\nimport { useSnackbarContext } from 'components/SnackbarProvider';\n\ninterface SidebarHeaderProps {\n  node: PathwayNode;\n  isTransition?: boolean;\n}\n\nconst SidebarHeader: FC<SidebarHeaderProps> = ({ node, isTransition = false }) => {\n  const [showInput, setShowInput] = useState<boolean>(false);\n  const [openTooltip, setOpenTooltip] = useState<boolean>(false);\n  const [openDelete, setOpenDelete] = useState<boolean>(false);\n  const { currentNodeRef } = useCurrentNodeContext();\n  const { setSnackbarText, setOpenSnackbar } = useSnackbarContext();\n  const { pathway, pathwayRef, setCurrentPathway } = useCurrentPathwayContext();\n  const inputRef = useRef<HTMLInputElement>(null);\n  const nodeLabel = node?.label || '';\n  const styles = useStyles();\n  const history = useHistory();\n\n  const goToParentNode = useCallback(() => {\n    if (!pathwayRef.current) return;\n    const parents = findParents(pathwayRef.current.nodes, node.key);\n    redirect(pathwayRef.current.id, parents[0], history);\n  }, [history, pathwayRef, node.key]);\n\n  const redirectToNode = useCallback(() => {\n    if (!pathwayRef.current) return;\n    redirect(pathwayRef.current.id, node.key, history);\n  }, [history, pathwayRef, node.key]);\n\n  const changeNodeLabel = useCallback(() => {\n    const label = inputRef.current?.value ?? '';\n    if (pathwayRef.current) setCurrentPathway(setNodeLabel(pathwayRef.current, node.key, label));\n    setShowInput(false);\n  }, [pathwayRef, setCurrentPathway, node.key]);\n\n  const handleShowInput = useCallback(() => {\n    setShowInput(true);\n  }, []);\n\n  const deleteNode = useCallback(() => {\n    if (pathwayRef.current && canDeleteNode(pathwayRef.current, node.transitions)) {\n      const parents = findParents(pathwayRef.current.nodes, node.key);\n      setCurrentPathway(removeNode(pathwayRef.current, node.key));\n      redirect(pathwayRef.current.id, parents[0], history);\n      setOpenDelete(false);\n      setSnackbarText(`${node.label} node deleted successfully`);\n      setOpenSnackbar(true);\n    }\n  }, [\n    pathwayRef,\n    setCurrentPathway,\n    setSnackbarText,\n    setOpenSnackbar,\n    node.key,\n    node.label,\n    node.transitions,\n    history\n  ]);\n\n  const deleteTransition = useCallback(() => {\n    if (\n      currentNodeRef.current &&\n      pathwayRef.current &&\n      !willOrphanChild(pathwayRef.current, node.key)\n    ) {\n      setCurrentPathway(removeTransition(pathwayRef.current, currentNodeRef.current.key, node.key));\n      setOpenDelete(false);\n      setSnackbarText(\n        `Transition from ${currentNodeRef.current.label} to ${node.label} deleted successfully`\n      );\n      setOpenSnackbar(true);\n    }\n  }, [pathwayRef, currentNodeRef, setCurrentPathway, setSnackbarText, setOpenSnackbar, node]);\n\n  const openDeleteModal = useCallback((): void => {\n    setOpenDelete(true);\n  }, []);\n\n  const closeDeleteModal = useCallback((): void => {\n    setOpenDelete(false);\n  }, []);\n\n  const handleOpenTooltip = useCallback((): void => {\n    setOpenTooltip(true);\n  }, []);\n\n  const handleCloseTooltip = useCallback((): void => {\n    setOpenTooltip(false);\n  }, []);\n\n  const handleKeyPress = useCallback(\n    (event: KeyboardEvent<HTMLDivElement>): void => {\n      if (event.key === 'Enter') changeNodeLabel();\n    },\n    [changeNodeLabel]\n  );\n\n  const deleteNodeDisabled = pathway ? !canDeleteNode(pathway, node.transitions) : true;\n  const deleteTransitionDisabled = pathway ? willOrphanChild(pathway, node.key) : true;\n  const deleteDisabled = isTransition ? deleteTransitionDisabled : deleteNodeDisabled;\n  const titleText = isTransition\n    ? 'Deleting this transition would result in an orphaned node. To delete, first add the child node as a transition to another node, or delete it directly.'\n    : 'Deleting this node would result in an orphaned descendent node. To delete, first add another transition to the would-be orphaned node from another node, or delete it directly.';\n\n  return (\n    <div className={styles.sidebarHeader}>\n      <div className={styles.sidebarHeaderGroup}>\n        {node.type !== 'start' && !isTransition && (\n          <IconButton\n            className={styles.sidebarHeaderButton}\n            onClick={goToParentNode}\n            aria-label=\"go to parent node\"\n          >\n            <FontAwesomeIcon icon={faChevronLeft} />\n          </IconButton>\n        )}\n\n        <div className={styles.headerLabelGroup} onClick={handleShowInput}>\n          {showInput && node.type !== 'start' ? (\n            <FormControl className={styles.formControl} fullWidth>\n              <Input\n                className={styles.headerLabel}\n                type=\"text\"\n                inputRef={inputRef}\n                onBlur={changeNodeLabel}\n                onKeyPress={handleKeyPress}\n                defaultValue={nodeLabel}\n                autoFocus\n                onFocus={(event: FocusEvent<HTMLInputElement>): void => event.target.select()}\n              />\n            </FormControl>\n          ) : (\n            <div\n              className={clsx(\n                styles.headerLabel,\n                styles.headerLabelText,\n                node.type === 'start' && styles.headerLabelStart\n              )}\n            >\n              {nodeLabel}\n              {node.key !== 'Start' && (\n                <FontAwesomeIcon className={styles.editIcon} icon={faEdit} />\n              )}\n            </div>\n          )}\n        </div>\n      </div>\n\n      <div className={styles.sidebarHeaderGroup}>\n        {node.type !== 'start' && (\n          <Tooltip\n            placement=\"top\"\n            open={deleteDisabled ? openTooltip : false}\n            onClose={handleCloseTooltip}\n            onOpen={handleOpenTooltip}\n            title={titleText}\n            arrow\n          >\n            <span>\n              <IconButton\n                className={styles.sidebarHeaderButton}\n                onClick={openDeleteModal}\n                aria-label={isTransition ? 'delete transition' : 'delete node'}\n                disabled={deleteDisabled}\n              >\n                <FontAwesomeIcon icon={faTrashAlt} />\n              </IconButton>\n            </span>\n          </Tooltip>\n        )}\n\n        {isTransition && (\n          <IconButton\n            className={styles.sidebarHeaderButton}\n            onClick={redirectToNode}\n            aria-label={'go to transition node'}\n          >\n            <FontAwesomeIcon icon={faChevronRight} />\n          </IconButton>\n        )}\n      </div>\n\n      <DeleteModal\n        nodeLabel={node.label}\n        isTransition={isTransition}\n        open={openDelete}\n        onDelete={isTransition ? deleteTransition : deleteNode}\n        onClose={closeDeleteModal}\n      />\n    </div>\n  );\n};\n\nexport default memo(SidebarHeader);\n","import React, { FC, memo } from 'react';\nimport { Button, Tooltip, PropTypes } from '@material-ui/core';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport { IconDefinition } from '@fortawesome/fontawesome-svg-core';\n\nimport useStyles from './styles';\n\ninterface SidebarButtonProps {\n  buttonName: string;\n  buttonIcon: IconDefinition;\n  buttonText: string;\n  extraMargin?: boolean;\n  onClick?: () => void;\n  hasTooltip?: boolean;\n  tooltipTitle?: string;\n  disabled?: boolean;\n  buttonColor?: PropTypes.Color;\n}\n\nconst SidebarButton: FC<SidebarButtonProps> = ({\n  buttonName,\n  buttonIcon,\n  buttonText,\n  extraMargin = false,\n  onClick,\n  hasTooltip = false,\n  tooltipTitle = '',\n  disabled = false,\n  buttonColor = 'primary'\n}) => {\n  const styles = useStyles();\n\n  const ConditionalTooltip: FC = ({ children }) =>\n    hasTooltip ? (\n      <Tooltip title={tooltipTitle} placement=\"top\">\n        <span>{children}</span>\n      </Tooltip>\n    ) : (\n      <>{children}</>\n    );\n\n  return (\n    <div className={extraMargin ? styles.sidebarButtonGroupExtraMargin : styles.sidebarButtonGroup}>\n      <ConditionalTooltip>\n        <Button\n          className={styles.sidebarButton}\n          variant=\"contained\"\n          color={buttonColor}\n          startIcon={<FontAwesomeIcon icon={buttonIcon} />}\n          onClick={onClick}\n          disabled={disabled}\n        >\n          {buttonName}\n        </Button>\n      </ConditionalTooltip>\n      <div className={styles.sidebarButtonText}>{buttonText}</div>\n    </div>\n  );\n};\n\nexport default memo(SidebarButton);\n","import React, { FC, memo, useCallback, ChangeEvent } from 'react';\nimport { SidebarButton } from '.';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport { faCheckCircle } from '@fortawesome/free-solid-svg-icons';\nimport {\n  setNodeAction,\n  createCQL,\n  setActionNodeElm,\n  setActionResourceDisplay,\n  setActionCode,\n  setActionDescription,\n  setActionTitle,\n  setActionCodeSystem\n} from 'utils/builder';\nimport DropDown from 'components/elements/DropDown';\nimport { ActionNode, Action } from 'pathways-model';\nimport useStyles from './styles';\nimport { TextField } from '@material-ui/core';\nimport { convertBasicCQL } from 'engine/cql-to-elm';\nimport { useCurrentPathwayContext } from 'components/CurrentPathwayProvider';\nimport produce from 'immer';\nimport { useCurrentNodeContext } from 'components/CurrentNodeProvider';\nimport { nodeTypeOptions } from 'utils/nodeUtils';\n\nconst codeSystemOptions = [\n  { label: 'ICD-9-CM', value: 'http://hl7.org/fhir/sid/icd-9-cm' },\n  { label: 'ICD-10-CM', value: 'http://hl7.org/fhir/sid/icd-10-cm' },\n  { label: 'LOINC', value: 'http://loinc.org' },\n  { label: 'NCI', value: 'http://ncimeta.nci.nih.gov' },\n  { label: 'RXNORM', value: 'http://www.nlm.nih.gov/research/umls/rxnorm' },\n  { label: 'SNOMED', value: 'http://snomed.info/sct' }\n];\n\ninterface ActionNodeEditorProps {\n  changeNodeType: (event: string) => void;\n}\n\nconst ActionNodeEditor: FC<ActionNodeEditorProps> = ({ changeNodeType }) => {\n  const { pathwayRef, setCurrentPathway } = useCurrentPathwayContext();\n  const { currentNode, currentNodeRef } = useCurrentNodeContext();\n  const styles = useStyles();\n\n  const addActionCQL = useCallback(\n    (action: Action, currentNodeKey: string): void => {\n      if (!pathwayRef.current) return;\n\n      const cql = createCQL(action, currentNodeKey);\n      convertBasicCQL(cql).then(elm => {\n        // Disable lint for no-null assertion since it is already checked above\n        // eslint-disable-next-line\n        setCurrentPathway(setActionNodeElm(pathwayRef.current!, currentNodeKey, elm));\n      });\n    },\n    [pathwayRef, setCurrentPathway]\n  );\n\n  const changeCode = useCallback(\n    (event: ChangeEvent<{ value: string }>): void => {\n      const currentNode = currentNodeRef.current as ActionNode;\n      if (!currentNode.action || !pathwayRef.current) return;\n\n      const code = event?.target.value || '';\n      const action = setActionCode(currentNode.action, code);\n      setCurrentPathway(setNodeAction(pathwayRef.current, currentNode.key, resetDisplay(action)));\n    },\n    [currentNodeRef, pathwayRef, setCurrentPathway]\n  );\n\n  const changeDescription = useCallback(\n    (event: ChangeEvent<{ value: string }>): void => {\n      const currentNode = currentNodeRef.current as ActionNode;\n      if (!currentNode.action || !pathwayRef.current) return;\n\n      const description = event?.target.value || '';\n      const action = setActionDescription(currentNode.action, description);\n      setCurrentPathway(setNodeAction(pathwayRef.current, currentNode.key, action));\n    },\n    [currentNodeRef, pathwayRef, setCurrentPathway]\n  );\n\n  const changeTitle = useCallback(\n    (event: ChangeEvent<{ value: string }>): void => {\n      const currentNode = currentNodeRef.current as ActionNode;\n      if (!currentNode.action || !pathwayRef.current) return;\n\n      const title = event?.target.value || '';\n      const action = setActionTitle(currentNode.action, title);\n      setCurrentPathway(setNodeAction(pathwayRef.current, currentNode.key, resetDisplay(action)));\n\n      addActionCQL(action, currentNode.key);\n    },\n    [currentNodeRef, pathwayRef, setCurrentPathway, addActionCQL]\n  );\n\n  const selectCodeSystem = useCallback(\n    (codeSystem: string): void => {\n      const currentNode = currentNodeRef.current as ActionNode;\n      if (!currentNode.action || !pathwayRef.current) return;\n      const action = setActionCodeSystem(currentNode.action, codeSystem);\n      setCurrentPathway(setNodeAction(pathwayRef.current, currentNode.key, resetDisplay(action)));\n    },\n    [currentNodeRef, pathwayRef, setCurrentPathway]\n  );\n\n  const validateFunction = useCallback((): void => {\n    const currentNode = currentNodeRef.current as ActionNode;\n    if (!currentNode.action || !pathwayRef.current) {\n      console.error('No Actions -- Cannot Validate');\n      return;\n    }\n\n    const action = setActionResourceDisplay(currentNode.action, 'Example Text');\n    setCurrentPathway(setNodeAction(pathwayRef.current, currentNode.key, action));\n\n    // TODO: move addActionCQL to builder.ts\n    addActionCQL(action, currentNode.key);\n  }, [currentNodeRef, pathwayRef, setCurrentPathway, addActionCQL]);\n\n  const resetDisplay = (action: Action): Action => {\n    return produce(action, (draftAction: Action) => {\n      if (draftAction.resource.medicationCodeableConcept) {\n        draftAction.resource.medicationCodeableConcept.coding[0].display = '';\n      } else if (draftAction.resource.resourceType === 'CarePlan') {\n        draftAction.resource.description = '';\n      } else {\n        draftAction.resource.code.coding[0].display = ''; // TODO: actually validate\n      }\n    });\n  };\n\n  const onEnter = (e: React.KeyboardEvent<HTMLInputElement>): void => {\n    if (e.key === 'Enter') {\n      validateFunction();\n    }\n  };\n\n  // The node has a key and is not the start node\n  const action = (currentNode as ActionNode).action;\n  if (!action) return <></>;\n\n  const changeNodeTypeEnabled = currentNode?.key && currentNode.type !== 'start';\n  const resource = action.resource;\n  let system = '';\n  let code = '';\n  let display = '';\n  if (resource.resourceType === 'MedicationRequest' || resource.resourceType === 'ServiceRequest') {\n    system = resource.code\n      ? resource.code.coding[0].system\n      : resource.medicationCodeableConcept.coding[0].system;\n    code = resource.code\n      ? resource.code.coding[0].code\n      : resource.medicationCodeableConcept.coding[0].code;\n    display = resource.code\n      ? resource.code.coding[0].display\n      : resource.medicationCodeableConcept.coding[0].display;\n  } else {\n    display = resource.description;\n  }\n\n  return (\n    <>\n      {changeNodeTypeEnabled && (\n        <>\n          <DropDown\n            id=\"nodeType\"\n            label=\"Node Type\"\n            options={nodeTypeOptions}\n            onChange={changeNodeType}\n            value={resource.resourceType}\n          />\n\n          {(resource.resourceType === 'MedicationRequest' ||\n            resource.resourceType === 'ServiceRequest') && (\n            <>\n              <DropDown\n                id=\"codeSystem\"\n                label=\"Code System\"\n                options={codeSystemOptions}\n                onChange={selectCodeSystem}\n                value={system}\n              />\n              {system && (\n                <TextField\n                  id=\"code-input\"\n                  label=\"Code\"\n                  value={code}\n                  onChange={changeCode}\n                  variant=\"outlined\"\n                  error={code === ''}\n                  inputProps={{ onKeyPress: onEnter }}\n                />\n              )}\n              {code && (\n                <>\n                  {display ? (\n                    <div className={styles.displayText}>\n                      <FontAwesomeIcon icon={faCheckCircle} /> {display}\n                    </div>\n                  ) : (\n                    <SidebarButton\n                      buttonName=\"Validate\"\n                      buttonIcon={faCheckCircle}\n                      buttonText={display || 'Check validation of the input system and code'}\n                      onClick={validateFunction}\n                    />\n                  )}\n\n                  <TextField\n                    id=\"description-input\"\n                    label=\"Description\"\n                    value={action.description || ''}\n                    onChange={changeDescription}\n                    variant=\"outlined\"\n                    error={action.description === ''}\n                  />\n                </>\n              )}\n            </>\n          )}\n\n          {resource.resourceType === 'CarePlan' && (\n            <>\n              <TextField\n                id=\"title-input\"\n                label=\"Title\"\n                value={resource.title || ''}\n                onChange={changeTitle}\n                variant=\"outlined\"\n                error={resource.title == null}\n                inputProps={{ onKeyPress: onEnter }}\n              />\n              {resource.title && (\n                <TextField\n                  id=\"description-input\"\n                  label=\"Description\"\n                  value={action.description || ''}\n                  onChange={changeDescription}\n                  variant=\"outlined\"\n                  error={action.description === ''}\n                />\n              )}\n            </>\n          )}\n        </>\n      )}\n    </>\n  );\n};\n\nexport default memo(ActionNodeEditor);\n","import React, { FC, memo, useCallback } from 'react';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport DropDown from 'components/elements/DropDown';\nimport useStyles from './styles';\nimport { usePathwaysContext } from 'components/PathwaysProvider';\nimport { useCurrentPathwayContext } from 'components/CurrentPathwayProvider';\nimport { useCurrentNodeContext } from 'components/CurrentNodeProvider';\nimport { nodeTypeOptions, redirect } from 'utils/nodeUtils';\nimport { Pathway, ReferenceNode } from 'pathways-model';\nimport { useHistory } from 'react-router-dom';\nimport { setNodeReference } from 'utils/builder';\nimport { faChevronRight } from '@fortawesome/free-solid-svg-icons';\n\ninterface ReferenceNodeEditorProps {\n  changeNodeType: (event: string) => void;\n}\n\nconst ReferenceNodeEditor: FC<ReferenceNodeEditorProps> = ({ changeNodeType }) => {\n  const { currentNode, currentNodeRef } = useCurrentNodeContext();\n  const { pathways, updatePathway } = usePathwaysContext();\n  const { pathwayRef, setCurrentPathway } = useCurrentPathwayContext();\n  const history = useHistory();\n\n  const pathwayOptions = pathways.map((pathway: Pathway) => {\n    return {\n      label: pathway.name,\n      value: pathway.id\n    };\n  });\n  const styles = useStyles();\n\n  const showReference = useCallback((): void => {\n    const pathwayReferenceId = (currentNode as ReferenceNode).referenceId;\n    const referencedPathway = pathways.find(pathway => {\n      return pathway.id === pathwayReferenceId;\n    });\n    if (referencedPathway) {\n      setCurrentPathway(referencedPathway);\n    }\n  }, [currentNode, pathways, setCurrentPathway]);\n\n  const selectPathwayReference = useCallback(\n    (referenceId: string): void => {\n      const referenceLabel =\n        pathwayOptions.find(option => {\n          return option.value === referenceId;\n        })?.label || '';\n      if (currentNodeRef.current && pathwayRef.current)\n        updatePathway(\n          setNodeReference(\n            pathwayRef.current,\n            currentNodeRef.current.key,\n            referenceId,\n            referenceLabel\n          )\n        );\n    },\n    [currentNodeRef, pathwayOptions, pathwayRef, updatePathway]\n  );\n\n  const changeNodeTypeEnabled = currentNode?.key && currentNode.type !== 'start';\n\n  return (\n    <>\n      {changeNodeTypeEnabled && (\n        <>\n          <div>\n            <DropDown\n              id=\"nodeType\"\n              label=\"Node Type\"\n              options={nodeTypeOptions}\n              onChange={changeNodeType}\n              value=\"Reference\"\n            />\n            <div className={styles.referenceDropdown}>\n              <DropDown\n                id=\"reference\"\n                label=\"Pathway Reference\"\n                options={pathwayOptions}\n                onChange={selectPathwayReference}\n                value={(currentNode as ReferenceNode).referenceId}\n              />\n              <div className={styles.referenceChevron}>\n                <FontAwesomeIcon\n                  icon={faChevronRight}\n                  onClick={(): void => {\n                    showReference();\n                    redirect((currentNode as ReferenceNode).referenceId, '', history);\n                  }}\n                />\n              </div>\n            </div>\n          </div>\n        </>\n      )}\n    </>\n  );\n};\n\nexport default memo(ReferenceNodeEditor);\n","import React, {\n  createContext,\n  useCallback,\n  useState,\n  memo,\n  ReactNode,\n  FC,\n  useContext\n} from 'react';\nimport { BuilderModel } from 'criteria-model';\n\ninterface CriteriaBuilderContextInterface {\n  selectedElement: string;\n  selectedDemoElement: string;\n  gender: string;\n  minimumAge: number;\n  maximumAge: number;\n  setSelectedElement: (selectedElement: string) => void;\n  setSelectedDemoElement: (selectedDemoElement: string) => void;\n  setGender: (gender: string) => void;\n  setMinimumAge: (age: number) => void;\n  setMaximumAge: (age: number) => void;\n  resetCriteriaBuilder: () => void;\n  setCriteriaBuilder: (buildCriteria: BuilderModel) => void;\n}\n\nexport const CriteriaBuilderContext = createContext<CriteriaBuilderContextInterface>(\n  {} as CriteriaBuilderContextInterface\n);\n\ninterface CriteriaBuilderProviderProps {\n  children: ReactNode;\n}\n\nexport const CriteriaBuilderProvider: FC<CriteriaBuilderProviderProps> = memo(({ children }) => {\n  const [selectedElement, setSelectedElement] = useState<string>('');\n  const [selectedDemoElement, setSelectedDemoElement] = useState<string>('');\n  const [gender, setGender] = useState<string>('');\n  const [minimumAge, setMinimumAge] = useState<number>(0);\n  const [maximumAge, setMaximumAge] = useState<number>(0);\n\n  const resetCriteriaBuilder = useCallback(() => {\n    setSelectedElement('');\n    setSelectedDemoElement('');\n    setGender('');\n    setMinimumAge(0);\n    setMaximumAge(0);\n  }, [setSelectedElement, setSelectedDemoElement, setGender, setMinimumAge, setMaximumAge]);\n\n  const setCriteriaBuilder = useCallback((buildCriteria: BuilderModel) => {\n    setSelectedElement('Demographics');\n    if (buildCriteria.type === 'gender') {\n      setSelectedDemoElement('Gender');\n      setGender(buildCriteria.gender);\n    } else {\n      setSelectedDemoElement('Age Range');\n      setMinimumAge(buildCriteria.min);\n      setMaximumAge(buildCriteria.max);\n    }\n  }, []);\n\n  return (\n    <CriteriaBuilderContext.Provider\n      value={{\n        selectedElement,\n        selectedDemoElement,\n        gender,\n        minimumAge,\n        maximumAge,\n        setSelectedElement,\n        setSelectedDemoElement,\n        setGender,\n        setMinimumAge,\n        setMaximumAge,\n        resetCriteriaBuilder,\n        setCriteriaBuilder\n      }}\n    >\n      {children}\n    </CriteriaBuilderContext.Provider>\n  );\n});\n\nexport const useCriteriaBuilderContext = (): CriteriaBuilderContextInterface =>\n  useContext(CriteriaBuilderContext);\n","import React, { FC, memo, useState, useCallback, ChangeEvent, useMemo, useRef } from 'react';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport { faSave, faTools, faTrashAlt, faThList, faEdit } from '@fortawesome/free-solid-svg-icons';\nimport DropDown from 'components/elements/DropDown';\nimport { Button, Checkbox, FormControlLabel, TextField, Box } from '@material-ui/core';\nimport {\n  removeTransitionCondition,\n  setTransitionCondition,\n  setTransitionConditionDescription\n} from 'utils/builder';\nimport { OutlinedDiv, SidebarButton } from '.';\nimport { Transition } from 'pathways-model';\nimport { useCriteriaContext } from 'components/CriteriaProvider';\nimport useStyles from './styles';\nimport { useCurrentPathwayContext } from 'components/CurrentPathwayProvider';\nimport { useCurrentNodeContext } from 'components/CurrentNodeProvider';\nimport { useCurrentCriteriaContext } from 'components/CurrentCriteriaProvider';\nimport { useCriteriaBuilderContext } from 'components/CriteriaBuilderProvider';\nimport { BuilderModel, Criteria } from 'criteria-model';\n\ninterface BranchTransitionProps {\n  transition: Transition;\n}\n\nconst BranchTransition: FC<BranchTransitionProps> = ({ transition }) => {\n  const { criteria, addBuilderCriteria } = useCriteriaContext();\n  const {\n    buildCriteriaSelected,\n    setBuildCriteriaSelected,\n    currentCriteriaNodeId,\n    setCurrentCriteriaNodeId,\n    currentCriteria,\n    setCurrentCriteria,\n    criteriaName,\n    setCriteriaName,\n    resetCurrentCriteria\n  } = useCurrentCriteriaContext();\n  const { resetCriteriaBuilder, setCriteriaBuilder } = useCriteriaBuilderContext();\n  const { pathwayRef, setCurrentPathway } = useCurrentPathwayContext();\n  const { currentNodeRef } = useCurrentNodeContext();\n  const criteriaOptions = useMemo(() => criteria.map(c => ({ value: c.id, label: c.label })), [\n    criteria\n  ]);\n  const criteriaAvailable = criteriaOptions.length > 0;\n  const styles = useStyles();\n  const [useCriteriaSelected, setUseCriteriaSelected] = useState<boolean>(false);\n  const criteriaDescription = transition.condition?.description;\n  const criteriaIsValid = criteriaDescription != null;\n  const criteriaDisplayIsValid = criteriaDescription && criteriaDescription !== '';\n  const hasCriteria = transition.condition?.cql || transition.condition?.description;\n  const buttonText = hasCriteria ? 'DELETE' : 'CANCEL';\n  const icon = hasCriteria ? <FontAwesomeIcon icon={faTrashAlt} /> : null;\n  const displayCriteria =\n    criteriaAvailable &&\n    (useCriteriaSelected || transition.condition?.cql || transition.condition?.description);\n  const transitionRef = useRef(transition);\n  const transitionSelected = buildCriteriaSelected && currentCriteriaNodeId === transition.id;\n  // Check if criteria was built by criteria builder\n  let builderElements: BuilderModel | null = null;\n  let builderCriteria: Criteria | undefined;\n  if (transition.condition) {\n    builderCriteria = criteria.find(c => c.id === transition.condition?.criteriaSource);\n    if (builderCriteria?.builder) builderElements = builderCriteria.builder;\n  }\n  const dislayEditCriteria = !transitionSelected && builderElements;\n\n  const handleUseCriteria = useCallback((): void => {\n    if (hasCriteria && currentNodeRef.current && pathwayRef.current) {\n      // delete the transition criteria\n      setCurrentPathway(\n        removeTransitionCondition(pathwayRef.current, currentNodeRef.current.key, transition.id)\n      );\n      setUseCriteriaSelected(false);\n    } else {\n      setUseCriteriaSelected(!useCriteriaSelected);\n    }\n  }, [\n    useCriteriaSelected,\n    currentNodeRef,\n    pathwayRef,\n    hasCriteria,\n    transition.id,\n    setCurrentPathway\n  ]);\n\n  const selectCriteriaSource = useCallback(\n    (criteriaId: string): void => {\n      if (!currentNodeRef.current || !pathwayRef.current) return;\n\n      const selectedCriteria = criteria.find(c => c.id === criteriaId);\n      if (!selectedCriteria) return;\n      const newPathway = setTransitionCondition(\n        pathwayRef.current,\n        currentNodeRef.current.key,\n        transitionRef.current.id,\n        transitionRef.current.condition?.description || '',\n        selectedCriteria\n      );\n\n      setCurrentPathway(newPathway);\n    },\n    [currentNodeRef, setCurrentPathway, pathwayRef, transitionRef, criteria]\n  );\n\n  const setCriteriaDisplay = useCallback(\n    (event: ChangeEvent<{ value: string }>): void => {\n      if (!currentNodeRef.current || !pathwayRef.current) return;\n\n      const criteriaDisplay = event?.target.value || '';\n      setCurrentPathway(\n        setTransitionConditionDescription(\n          pathwayRef.current,\n          currentNodeRef.current.key,\n          transition.id,\n          criteriaDisplay\n        )\n      );\n    },\n    [currentNodeRef, transition.id, setCurrentPathway, pathwayRef]\n  );\n\n  const handleCriteriaName = useCallback(\n    (event: ChangeEvent<{ value: string }>): void => {\n      setCriteriaName(event?.target.value || '');\n    },\n    [setCriteriaName]\n  );\n\n  const handleBuildCriteria = useCallback((): void => {\n    setCurrentCriteriaNodeId(transition.id);\n    setCurrentCriteria(null);\n    setCriteriaName('');\n    if (!buildCriteriaSelected) setBuildCriteriaSelected(true);\n    resetCriteriaBuilder();\n  }, [\n    buildCriteriaSelected,\n    setCurrentCriteriaNodeId,\n    transition,\n    setBuildCriteriaSelected,\n    setCurrentCriteria,\n    resetCriteriaBuilder,\n    setCriteriaName\n  ]);\n\n  const handleEditCriteria = useCallback((): void => {\n    setCurrentCriteriaNodeId(transition.id);\n    setCurrentCriteria(builderElements as BuilderModel);\n    if (builderCriteria?.label) setCriteriaName(builderCriteria?.label);\n    if (!buildCriteriaSelected) setBuildCriteriaSelected(true);\n    if (builderElements) setCriteriaBuilder(builderElements);\n  }, [\n    buildCriteriaSelected,\n    builderCriteria,\n    builderElements,\n    transition,\n    setCurrentCriteriaNodeId,\n    setCurrentCriteria,\n    setCriteriaName,\n    setBuildCriteriaSelected,\n    setCriteriaBuilder\n  ]);\n\n  const handleBuildCriteriaCancel = useCallback((): void => {\n    resetCurrentCriteria();\n    resetCriteriaBuilder();\n  }, [resetCurrentCriteria, resetCriteriaBuilder]);\n\n  const handleBuildCriteriaSave = useCallback(() => {\n    if (!currentNodeRef.current || !pathwayRef.current || !currentCriteria?.cql) return;\n\n    const criteria = addBuilderCriteria(\n      currentCriteria,\n      criteriaName,\n      transition.condition?.criteriaSource\n    );\n    const newPathway = setTransitionCondition(\n      pathwayRef.current,\n      currentNodeRef.current.key,\n      transitionRef.current.id,\n      criteriaName,\n      criteria[0]\n    );\n\n    setCurrentPathway(newPathway);\n    handleBuildCriteriaCancel();\n  }, [\n    currentNodeRef,\n    setCurrentPathway,\n    pathwayRef,\n    transitionRef,\n    currentCriteria,\n    criteriaName,\n    transition,\n    handleBuildCriteriaCancel,\n    addBuilderCriteria\n  ]);\n\n  return (\n    <>\n      {!displayCriteria && !transitionSelected && (\n        <SidebarButton\n          buttonName=\"Select Criteria\"\n          buttonIcon={faThList}\n          buttonColor=\"secondary\"\n          buttonText=\"Add previously built or imported criteria logic to branch node.\"\n          onClick={handleUseCriteria}\n          disabled={!criteriaAvailable}\n          hasTooltip={!criteriaAvailable}\n          tooltipTitle=\"No criteria to select. Add criteria to use.\"\n        />\n      )}\n\n      {displayCriteria && !transitionSelected && !dislayEditCriteria && (\n        <OutlinedDiv label=\"Criteria Selector\" error={!criteriaIsValid || !criteriaDisplayIsValid}>\n          <>\n            <DropDown\n              id=\"Criteria\"\n              label=\"Criteria\"\n              options={criteriaOptions}\n              onChange={selectCriteriaSource}\n              value={transition.condition?.criteriaSource || undefined}\n            />\n\n            <TextField\n              label=\"Criteria Display\"\n              className={styles.criteriaText}\n              value={transition.condition?.description || ''}\n              variant=\"outlined\"\n              onChange={setCriteriaDisplay}\n              error={!criteriaDisplayIsValid}\n              helperText='Use commas \",\" to separate into multiple lines (up to 3)'\n            />\n          </>\n\n          <Button\n            className={styles.cancelButton}\n            color=\"inherit\"\n            size=\"small\"\n            variant=\"outlined\"\n            startIcon={icon}\n            onClick={handleUseCriteria}\n          >\n            {buttonText}\n          </Button>\n        </OutlinedDiv>\n      )}\n\n      {dislayEditCriteria && (\n        <OutlinedDiv label=\"Criteria Builder\" error={false}>\n          <TextField\n            label=\"Criteria Name\"\n            variant=\"outlined\"\n            value={builderCriteria?.label}\n            fullWidth\n            disabled\n          />\n          <span className={styles.buildCriteriaText}>{builderElements?.text}</span>\n          <div className={styles.buildCriteriaContainer}>\n            <Button\n              className={styles.cancelButton}\n              color=\"inherit\"\n              size=\"small\"\n              variant=\"outlined\"\n              startIcon={icon}\n              onClick={handleUseCriteria}\n            >\n              DELETE CRITERIA\n            </Button>\n            <Button\n              className={styles.editButton}\n              color=\"inherit\"\n              size=\"small\"\n              variant=\"outlined\"\n              startIcon={<FontAwesomeIcon icon={faEdit} />}\n              onClick={handleEditCriteria}\n            >\n              EDIT CRITERIA\n            </Button>\n          </div>\n        </OutlinedDiv>\n      )}\n\n      {!displayCriteria && !transitionSelected && (\n        <SidebarButton\n          buttonName=\"Build Criteria\"\n          buttonColor=\"secondary\"\n          buttonIcon={faTools}\n          buttonText=\"Create new criteria logic to add to branch node.\"\n          extraMargin\n          onClick={handleBuildCriteria}\n        />\n      )}\n\n      {transitionSelected && (\n        <OutlinedDiv label=\"Criteria Builder\" error={!criteriaIsValid || !criteriaDisplayIsValid}>\n          <TextField\n            error={criteriaName === ''}\n            label=\"Criteria Name\"\n            variant=\"outlined\"\n            onChange={handleCriteriaName}\n            value={criteriaName}\n            fullWidth\n          />\n          {currentCriteria?.text && (\n            <span className={styles.buildCriteriaText}>{currentCriteria.text}</span>\n          )}\n          <div className={styles.buildCriteriaContainer}>\n            <FormControlLabel\n              label={<Box fontStyle=\"italic\">Add to reusable criteria</Box>}\n              control={<Checkbox color=\"default\" />}\n              checked\n            />\n            <Button\n              color=\"inherit\"\n              size=\"large\"\n              variant=\"outlined\"\n              onClick={handleBuildCriteriaCancel}\n            >\n              Cancel\n            </Button>\n            <Button\n              className={styles.saveButton}\n              color=\"inherit\"\n              size=\"large\"\n              variant=\"outlined\"\n              startIcon={<FontAwesomeIcon icon={faSave} />}\n              disabled={criteriaName === '' || currentCriteria === null}\n              onClick={handleBuildCriteriaSave}\n            >\n              Save\n            </Button>\n          </div>\n        </OutlinedDiv>\n      )}\n    </>\n  );\n};\n\nexport default memo(BranchTransition);\n","import React, { FC, ReactNode } from 'react';\nimport clsx from 'clsx';\n\nimport TextField from '@material-ui/core/TextField';\nimport useStyles from './styles';\n\ninterface InputComponentProps {\n  children?: ReactNode;\n}\n\nconst InputComponent: FC<InputComponentProps> = ({ children }) => {\n  return <>{children}</>;\n};\n\ninterface OutlinedDivProps {\n  children: ReactNode;\n  label: string;\n  error: boolean;\n}\n\nconst OutlinedDiv: FC<OutlinedDivProps> = ({ children, label, error }) => {\n  const styles = useStyles();\n\n  return (\n    <TextField\n      variant=\"outlined\"\n      label={label}\n      multiline\n      InputLabelProps={{ shrink: true }}\n      InputProps={{\n        inputComponent: InputComponent,\n        classes: {\n          root: clsx(styles.outlinedDiv, error && styles.outlinedDivError),\n          notchedOutline: clsx(error && styles.outlinedDivError)\n        }\n      }}\n      inputProps={{ children }}\n      fullWidth\n    />\n  );\n};\n\n// This is not memoized since one of its props is children\nexport default OutlinedDiv;\n","import React, { FC, memo } from 'react';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport { faTimes, faExclamationCircle } from '@fortawesome/free-solid-svg-icons';\nimport {\n  Button,\n  Dialog,\n  DialogTitle,\n  DialogContent,\n  DialogActions,\n  IconButton\n} from '@material-ui/core';\n\nimport useStyles from './styles';\nimport { useCurrentNodeContext } from 'components/CurrentNodeProvider';\n\ninterface DeleteModalProps {\n  open: boolean;\n  nodeLabel: string;\n  isTransition: boolean;\n  onClose: () => void;\n  onDelete: () => void;\n}\n\nconst DeleteModal: FC<DeleteModalProps> = ({\n  open,\n  nodeLabel,\n  isTransition,\n  onClose,\n  onDelete\n}) => {\n  const styles = useStyles();\n  const { currentNode } = useCurrentNodeContext();\n\n  const text = isTransition ? (\n    <span>\n      Delete the transition from <strong>{currentNode?.label}</strong> to{' '}\n      <strong>{nodeLabel}</strong>? This will not delete either node, just the transition between\n      them.\n    </span>\n  ) : (\n    <span>\n      Delete the node <strong>{nodeLabel}</strong>? This will also remove any transitions to this\n      node.\n    </span>\n  );\n\n  return (\n    <>\n      <Dialog\n        open={open}\n        onClose={onClose}\n        aria-labelledby=\"create-pathway\"\n        fullWidth\n        maxWidth=\"md\"\n      >\n        <DialogTitle disableTypography>\n          <IconButton aria-label=\"close\" onClick={onClose} className={styles.dialogCloseButton}>\n            <FontAwesomeIcon icon={faTimes} />\n          </IconButton>\n        </DialogTitle>\n\n        <DialogContent className={styles.dialogContent}>\n          <FontAwesomeIcon icon={faExclamationCircle} className={styles.alertIcon} />\n          <p className={styles.dialogContentText}>{text}</p>\n        </DialogContent>\n\n        <DialogActions>\n          <Button variant=\"text\" color=\"primary\" onClick={onClose}>\n            Cancel\n          </Button>\n          <Button variant=\"contained\" color=\"secondary\" onClick={onDelete}>\n            Delete\n          </Button>\n        </DialogActions>\n      </Dialog>\n    </>\n  );\n};\n\nexport default memo(DeleteModal);\n","import React, { FC, ReactNode, memo } from 'react';\nimport SidebarHeader from './SidebarHeader';\nimport useStyles from './styles';\nimport { Card } from '@material-ui/core';\nimport { Transition } from 'pathways-model';\nimport { useCurrentPathwayContext } from 'components/CurrentPathwayProvider';\n\ninterface TransitionEditorProps {\n  transition: Transition;\n  children?: ReactNode;\n}\n\nconst TransitionEditor: FC<TransitionEditorProps> = ({ transition, children }) => {\n  const styles = useStyles();\n  const { pathway } = useCurrentPathwayContext();\n  const transitionKey = transition?.transition || '';\n  const transitionNode = pathway?.nodes[transitionKey];\n\n  return (\n    <Card raised className={styles.transitionContainer}>\n      {transitionNode && <SidebarHeader node={transitionNode} isTransition />}\n\n      {children}\n    </Card>\n  );\n};\n\nexport default memo(TransitionEditor);\n","import { useCallback, useState } from 'react';\nimport { graphlib, Node } from 'dagre';\nimport { Edges } from 'graph-model';\n\nexport interface GraphCoordinates {\n  nodes: NodeCoordinates;\n  edges: Edges;\n}\n\nexport interface NodeCoordinates {\n  [nodeName: string]: Node;\n}\n\nexport interface UpdateCoordinatesInterface {\n  graph: graphlib.Graph;\n  graphWidth: number;\n}\n\nexport interface CoordinatesCalculator {\n  coordinates: GraphCoordinates;\n  updateCoordinates: (graph: UpdateCoordinatesInterface) => void;\n}\n\n// number of pixels to add as a buffer to the top of the graph\nconst OFFSET_TOP = 16;\n\nconst useCoordinatesCalculator = (): CoordinatesCalculator => {\n  const [coordinates, setCoordinates] = useState<GraphCoordinates>({\n    nodes: {},\n    edges: {}\n  } as GraphCoordinates);\n\n  const updateCoordinates = useCallback(\n    ({ graph, graphWidth }: UpdateCoordinatesInterface): void => {\n      const startNodeShift = graph.node('Start').x;\n\n      const xOffset = 0 - startNodeShift + graphWidth / 2;\n      let xOffsetCorrection = 0;\n      const yOffset = OFFSET_TOP;\n\n      const newCoordinates: GraphCoordinates = { nodes: {}, edges: {} };\n\n      for (const nodeKey of graph.nodes()) {\n        const node = graph.node(nodeKey);\n\n        // dagre returns coordinates for the center of the node,\n        // our renderer expects coordinates for the corner of the node.\n        // further, our renderer expects the Start node to be centered at x: 0\n        newCoordinates.nodes[nodeKey] = {\n          ...node,\n          x: node.x - node.width / 2 + xOffset,\n          y: node.y - node.height / 2 + yOffset\n        };\n\n        xOffsetCorrection = Math.min(0, xOffsetCorrection, newCoordinates.nodes[nodeKey].x);\n      }\n      xOffsetCorrection = Math.abs(xOffsetCorrection);\n\n      if (xOffsetCorrection > 0) {\n        for (const nodeKey of graph.nodes()) {\n          newCoordinates.nodes[nodeKey].x += xOffsetCorrection;\n        }\n      }\n\n      for (const edgeKey of graph.edges()) {\n        const edge = graph.edge(edgeKey);\n        const edgeName = `${edgeKey.v}, ${edgeKey.w}`;\n        const label = edge.label\n          ? { text: edge.label, x: edge.x + xOffset, y: edge.y + yOffset }\n          : null;\n\n        const points = edge.points.map(point => ({\n          x: (isNaN(point.x) ? 0 : point.x) + xOffset + xOffsetCorrection,\n          y: (isNaN(point.y) ? 0 : point.y) + yOffset\n        }));\n\n        // move the last point up to make room for the arrowhead\n        if (points.length > 0) points[points.length - 1].y -= 17.5;\n\n        newCoordinates.edges[edgeName] = {\n          label,\n          start: edgeKey.v,\n          end: edgeKey.w,\n          points\n        };\n      }\n\n      setCoordinates(newCoordinates);\n    },\n    []\n  );\n\n  return { coordinates, updateCoordinates };\n};\n\nexport default useCoordinatesCalculator;\n","import React, {\n  createContext,\n  FC,\n  ReactNode,\n  useCallback,\n  useContext,\n  useEffect,\n  useMemo,\n  useState\n} from 'react';\nimport { useRafState, useUpdateEffect } from 'react-use';\nimport dagre, { graphlib } from 'dagre';\n\nimport useCoordinatesCalculator, { GraphCoordinates } from './useCoordinatesCalculator';\n\ninterface GraphContextInterface {\n  graph: graphlib.Graph;\n  reflow: () => void;\n}\n\ntype SetGraphWidthInterface = (width: number) => void;\n\nexport const GraphContext = createContext<GraphContextInterface>({} as GraphContextInterface);\nexport const SetGraphWidthContext = createContext<SetGraphWidthInterface>(() => undefined);\nexport const GraphCoordinatesContext = createContext<GraphCoordinates>({\n  nodes: {},\n  edges: {}\n} as GraphCoordinates);\n\ninterface GraphProviderProps {\n  children: ReactNode;\n}\n\nconst createGraph = (): graphlib.Graph => {\n  const g = new dagre.graphlib.Graph();\n  g.setGraph({});\n\n  // dagre requires a default edge label, we want it to just be empty\n  g.setDefaultEdgeLabel(() => ({}));\n  return g;\n};\n\nconst GraphProvider: FC<GraphProviderProps> = ({ children }) => {\n  const graph = useMemo(createGraph, []);\n  const { coordinates, updateCoordinates } = useCoordinatesCalculator();\n  const [width, setWidth] = useRafState<number>(0);\n  const [reflowRequired, setReflowRequired] = useState(true);\n  const reflow = useCallback(() => setReflowRequired(true), []);\n  const graphValue = useMemo(() => ({ graph, reflow }), [graph, reflow]);\n\n  useEffect(() => {\n    if (!reflowRequired) return;\n\n    dagre.layout(graph);\n    updateCoordinates({ graph, graphWidth: width });\n\n    setReflowRequired(false);\n  }, [graph, reflowRequired, setReflowRequired, width, updateCoordinates]);\n\n  useUpdateEffect(() => {\n    setReflowRequired(true);\n  }, [width]);\n\n  return (\n    <GraphContext.Provider value={graphValue}>\n      <SetGraphWidthContext.Provider value={setWidth}>\n        <GraphCoordinatesContext.Provider value={coordinates}>\n          {children}\n        </GraphCoordinatesContext.Provider>\n      </SetGraphWidthContext.Provider>\n    </GraphContext.Provider>\n  );\n};\n\nexport default GraphProvider;\nexport const useGraphProvider = (): GraphContextInterface => useContext(GraphContext);\nexport const useSetGraphWidth = (): SetGraphWidthInterface => useContext(SetGraphWidthContext);\nexport const useGraphCoordinates = (): GraphCoordinates => useContext(GraphCoordinatesContext);\n","import { makeStyles, Theme as AugmentedTheme } from '@material-ui/core/styles';\n\ninterface StyleProps {\n  isActive?: boolean;\n}\n\nexport default makeStyles(\n  (theme: AugmentedTheme) => ({\n    edges: {\n      display: 'block',\n      position: 'absolute',\n      top: '0',\n      left: '0',\n      overflow: 'visible',\n      width: '100%',\n      height: '100%',\n      zIndex: 1,\n      '& text': {\n        fontSize: '14px'\n      },\n      '& #arrowhead-inactive polygon': {\n        fill: theme.palette.common.blue\n      },\n      '& #arrowhead-active polygon': {\n        fill: theme.palette.common.red\n      }\n    },\n    edge: {\n      stroke: (props?: StyleProps): string => theme.palette.common[props?.isActive ? 'red' : 'blue']\n    }\n  }),\n  { name: 'DagreGraph-GraphEdges' }\n);\n","import React, { FC, ReactElement, memo, useMemo } from 'react';\nimport { Tooltip } from '@material-ui/core';\n\nimport { Label, Coordinate } from 'graph-model';\nimport { useCurrentNodeContext } from 'components/CurrentNodeProvider';\nimport { useGraphCoordinates } from './GraphProvider';\nimport useStyles from './GraphEdges.styles';\n\ninterface EdgeProps {\n  label: Label | null;\n  points: Coordinate[];\n  isActive: boolean;\n}\n\ninterface LabelTooltipProps {\n  labelText?: string | null;\n  isEnabled: boolean;\n  children: ReactElement;\n}\n\nconst TRUNCATION_SIZE = 20;\n\n/**\n * The points to use in the Cubic command is determined by the length of points array\n * If i % 3 is 0, use all points including the 1st point\n * If i % 3 is 1, use all points except the 1st point\n * If i % 3 is 2, use all points including the 1st point and reuse every 3rd point\n * We need points to be a multiple of 3 because the Cubic command expects 3 points\n */\nconst generatePathString = (points: Coordinate[]): string =>\n  points.reduce(\n    (path, point, i) =>\n      i % 3 === points.length % 3\n        ? `${path} C ${point.x} ${point.y} ${points[i + 1].x} ${points[i + 1].y} ${\n            points[i + 2].x\n          } ${points[i + 2].y}`\n        : path,\n    `M ${points[0].x} ${points[0].y} `\n  );\n\nconst LabelTooltip: FC<LabelTooltipProps> = ({ labelText, isEnabled, children }) => {\n  if (isEnabled && labelText) {\n    return <Tooltip title={labelText} children={children} />;\n  } else {\n    return <>{children}</>;\n  }\n};\n\nconst Edge: FC<EdgeProps> = ({ label, points, isActive }) => {\n  const styles = useStyles({ isActive });\n  const path = useMemo(() => generatePathString(points), [points]);\n\n  const labelText = label?.text;\n  const { lines, isTruncated } = useMemo(() => {\n    if (labelText == null) return { lines: [], isTruncated: false };\n\n    let truncated = false;\n    const allLines = labelText.split(',');\n    const condensedLines =\n      allLines.length > 3 ? [allLines[0], allLines[1], allLines.slice(2).join(',')] : allLines;\n\n    const labelTextLines = condensedLines.map(line => {\n      const trimmedLine = line.trim();\n      if (trimmedLine.length > TRUNCATION_SIZE) {\n        truncated = true;\n        return `${trimmedLine.substring(0, TRUNCATION_SIZE - 1)}...`;\n      }\n      return trimmedLine;\n    });\n\n    return { lines: labelTextLines, isTruncated: truncated };\n  }, [labelText]);\n\n  return (\n    <>\n      <path\n        d={path}\n        fill=\"transparent\"\n        className={styles.edge}\n        strokeWidth=\"2\"\n        markerEnd={`url(#arrowhead-${isActive ? 'active' : 'inactive'})`}\n      />\n      {label && (\n        <LabelTooltip labelText={labelText} isEnabled={isTruncated}>\n          <text x={label.x} y={label.y} dy=\"0\">\n            {lines.map((line, index) => {\n              return (\n                <tspan x={label.x} dy={index === 0 ? 0 : '1.2em'} key={line}>\n                  {line}\n                </tspan>\n              );\n            })}\n          </text>\n        </LabelTooltip>\n      )}\n    </>\n  );\n};\n\nconst GraphEdges: FC = () => {\n  const styles = useStyles();\n  const { edges: edgeCoordinates } = useGraphCoordinates();\n  const { currentNode } = useCurrentNodeContext();\n\n  return (\n    <svg className={styles.edges}>\n      <defs>\n        <marker\n          id=\"arrowhead-inactive\"\n          markerWidth=\"10\"\n          markerHeight=\"7\"\n          refX=\"0\"\n          refY=\"3.5\"\n          orient=\"auto\"\n        >\n          <polygon points=\"0 0, 10 3.5, 0 7\" />\n        </marker>\n\n        <marker\n          id=\"arrowhead-active\"\n          markerWidth=\"10\"\n          markerHeight=\"7\"\n          refX=\"0\"\n          refY=\"3.5\"\n          orient=\"auto\"\n        >\n          <polygon points=\"0 0, 10 3.5, 0 7\" />\n        </marker>\n      </defs>\n\n      {Object.entries(edgeCoordinates).map(([edgeId, edge]) => (\n        <Edge\n          key={edgeId}\n          label={edge.label}\n          points={edge.points}\n          isActive={edge.start === currentNode?.key}\n        />\n      ))}\n    </svg>\n  );\n};\n\nexport default memo(GraphEdges);\n","import { makeStyles, Theme as AugmentedTheme } from '@material-ui/core/styles';\n\nexport default makeStyles(\n  (theme: AugmentedTheme) => ({\n    table: {\n      '& tr': {\n        verticalAlign: 'top'\n      }\n    },\n    title: {\n      fontWeight: 'bold',\n      textAlign: 'right',\n      minWidth: '80px'\n    },\n    description: {\n      paddingLeft: theme.spacing(2),\n      fontStyle: 'italic',\n      overflowWrap: 'break-word'\n    },\n    externalLink: {\n      color: theme.palette.common.blue,\n      marginLeft: theme.spacing(1),\n\n      '&:hover, &:focus': {\n        color: theme.palette.common.grayDark\n      }\n    }\n  }),\n  { name: 'NodeDetails' }\n);\n","import React, { FC, ReactNode, memo } from 'react';\nimport { ActionNode, BranchNode, PathwayNode, ReferenceNode } from 'pathways-model';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport { faExternalLinkAlt } from '@fortawesome/free-solid-svg-icons';\n\nimport { MedicationRequest, ServiceRequest } from 'fhir-objects';\nimport { getNodeType } from 'utils/nodeUtils';\nimport { resourceNameConversion } from 'utils/nodeUtils';\nimport useStyles from './NodeDetails.styles';\n\ninterface NodeDetailsProps {\n  pathwayNode: ActionNode | BranchNode | PathwayNode;\n}\n\ninterface FieldProps {\n  title: string;\n  description: string | ReactNode;\n}\n\ninterface ActionNodeFieldsProps {\n  actionNode: ActionNode;\n}\n\ninterface ReferenceNodeProps {\n  referenceNode: ReferenceNode;\n}\nconst isMedicationRequest = (\n  request: MedicationRequest | ServiceRequest\n): request is MedicationRequest =>\n  (request as MedicationRequest).medicationCodeableConcept !== undefined;\n\nconst Field: FC<FieldProps> = ({ title, description }) => {\n  const styles = useStyles();\n\n  if (!description) return null;\n\n  return (\n    <tr>\n      <td className={styles.title}>{title}</td>\n      <td className={styles.description}>{description}</td>\n    </tr>\n  );\n};\n\nconst BranchNodeContents: FC = () => <Field title=\"Type\" description=\"Observation\" />;\n\nconst ActionNodeFields: FC<ActionNodeFieldsProps> = ({ actionNode }) => {\n  const styles = useStyles();\n\n  if (actionNode.action === null) return null;\n\n  const resource = actionNode.action.resource;\n  const coding = isMedicationRequest(resource)\n    ? resource?.medicationCodeableConcept?.coding\n    : resource?.code?.coding;\n  const resourceType = resourceNameConversion[resource.resourceType]\n    ? resourceNameConversion[resource.resourceType]\n    : resource.resourceType;\n\n  return (\n    <>\n      <Field title=\"Description\" description={actionNode.action.description} />\n      <Field key=\"Type\" title=\"Type\" description={resourceType} />\n      <Field\n        key=\"System\"\n        title=\"System\"\n        description={\n          coding?.[0]?.system && (\n            <>\n              {coding[0].system}\n              <a href={coding[0].system} target=\"_blank\" rel=\"noopener noreferrer\">\n                <FontAwesomeIcon icon={faExternalLinkAlt} className={styles.externalLink} />\n              </a>\n            </>\n          )\n        }\n      />\n      <Field key=\"Code\" title=\"Code\" description={coding?.[0]?.code} />\n      <Field key=\"Display\" title=\"Display\" description={coding?.[0]?.display} />\n      <Field key=\"Title\" title=\"Title\" description={resource.title} />\n    </>\n  );\n};\n\nconst ReferenceNodeFields: FC<ReferenceNodeProps> = ({ referenceNode }) => (\n  <>\n    <Field title=\"Type\" description=\"Reference\" />\n    <Field title=\"Pathway\" description={referenceNode.referenceLabel} />\n  </>\n);\n\nconst NodeDetails: FC<NodeDetailsProps> = ({ pathwayNode }) => {\n  const styles = useStyles();\n  const nodeType = getNodeType(pathwayNode);\n\n  if (nodeType == null) return null;\n\n  return (\n    <table className={styles.table}>\n      <tbody>\n        {nodeType === 'branch' && <BranchNodeContents />}\n        {nodeType === 'reference' && (\n          <ReferenceNodeFields referenceNode={pathwayNode as ReferenceNode} />\n        )}\n        {nodeType === 'action' && <ActionNodeFields actionNode={pathwayNode as ActionNode} />}\n      </tbody>\n    </table>\n  );\n};\n\nexport default memo(NodeDetails);\n","import { makeStyles, Theme as AugmentedTheme } from '@material-ui/core/styles';\n\nexport default makeStyles(\n  (theme: AugmentedTheme) => ({\n    icon: {\n      marginRight: theme.spacing(1),\n      fontSize: '0.9rem'\n    }\n  }),\n  { name: 'DagreGraph-NodeIcon' }\n);\n","import React, { FC, memo } from 'react';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport { IconDefinition } from '@fortawesome/fontawesome-svg-core';\nimport {\n  faMicroscope,\n  faPlay,\n  faPrescriptionBottleAlt,\n  faSyringe,\n  faBookMedical,\n  faLevelDownAlt\n} from '@fortawesome/free-solid-svg-icons';\n\nimport useStyles from './NodeIcon.styles';\n\ninterface NodeIconProps {\n  isStartNode: boolean;\n  nodeType: string;\n  resourceType?: string;\n}\n\nconst NodeIcon: FC<NodeIconProps> = ({ isStartNode, nodeType, resourceType }) => {\n  const styles = useStyles();\n  let icon: IconDefinition | undefined;\n  if (isStartNode) {\n    icon = faPlay;\n  } else if (nodeType === 'action' && resourceType) {\n    if (resourceType === 'MedicationRequest') icon = faPrescriptionBottleAlt;\n    else if (resourceType === 'ServiceRequest') icon = faSyringe;\n    else if (resourceType === 'CarePlan') icon = faBookMedical;\n  } else if (nodeType === 'branch') {\n    icon = faMicroscope;\n  } else if (nodeType === 'reference') {\n    icon = faLevelDownAlt;\n  }\n\n  return icon ? <FontAwesomeIcon icon={icon} className={styles.icon} /> : null;\n};\n\nexport default memo(NodeIcon);\n","import { makeStyles, Theme as AugmentedTheme } from '@material-ui/core/styles';\n\ninterface StyleProps {\n  isActionable: boolean;\n  isExpanded: boolean;\n}\n\nexport default makeStyles(\n  (theme: AugmentedTheme) => ({\n    node: {\n      position: 'absolute',\n      width: 'auto',\n      minWidth: ({ isExpanded }: StyleProps): string => (isExpanded ? '400px' : '100px'),\n      maxWidth: '600px',\n      minHeight: '50px',\n      display: 'flex',\n      alignItems: 'stretch',\n      flexDirection: 'column',\n      border: ({ isActionable }: StyleProps): string =>\n        `1px solid ${theme.palette.common[isActionable ? 'red' : 'blue']}`,\n      backgroundColor: theme.palette.common.white,\n      zIndex: 2,\n      overflow: 'hidden'\n    },\n    nodeTitle: {\n      padding: theme.spacing(2),\n      flex: '1',\n      display: 'flex',\n      alignItems: 'center',\n      justifyContent: 'center',\n      color: theme.palette.common.white,\n      backgroundColor: ({ isActionable }: StyleProps): string =>\n        theme.palette.common[isActionable ? 'red' : 'blue']\n    },\n    nodeContent: {\n      padding: theme.spacing(2)\n    },\n    clickable: {\n      cursor: 'pointer'\n    }\n  }),\n  { name: 'DagreGraph-Node' }\n);\n","import React, { FC, memo, useCallback, useMemo, useRef } from 'react';\nimport clsx from 'clsx';\nimport { useLifecycles, useUpdateEffect } from 'react-use';\n\nimport { ActionNode, BranchNode, PathwayNode, Transition } from 'pathways-model';\nimport { getNodeType } from 'utils/nodeUtils';\nimport NodeDetails from './NodeDetails';\nimport { useGraphProvider } from './GraphProvider';\nimport NodeIcon from './NodeIcon';\nimport useStyles from './Node.styles';\n\ninterface NodeProps {\n  nodeKey: string;\n  pathwayNode: ActionNode | BranchNode | PathwayNode;\n  isActionable: boolean;\n  isExpanded: boolean;\n  onClick?: (nodeName: string) => void;\n  xCoordinate: number;\n  yCoordinate: number;\n  openNode: (nodeName: string) => void;\n}\n\ninterface BoundingClientRectResponse {\n  width: number;\n  height: number;\n}\n\nconst createTransitionLabel = ({ condition }: Transition): { [key: string]: string | number } =>\n  condition\n    ? {\n        label: condition.description,\n        width: 25,\n        height: 20\n      }\n    : {};\n\nconst getBoundingClientRect = (element: HTMLDivElement | null): BoundingClientRectResponse => {\n  const dimensions = element?.getBoundingClientRect() ?? { width: 0, height: 0 };\n  return { width: Math.ceil(dimensions.width), height: Math.ceil(dimensions.height) };\n};\n\nconst Node: FC<NodeProps> = ({\n  nodeKey,\n  pathwayNode,\n  isActionable,\n  isExpanded,\n  onClick,\n  xCoordinate,\n  yCoordinate,\n  openNode\n}) => {\n  const styles = useStyles({ isExpanded, isActionable });\n  const onClickHandler = useCallback(() => {\n    if (onClick) onClick(nodeKey);\n  }, [onClick, nodeKey]);\n  const nodeRef = useRef<HTMLDivElement>(null);\n  const { graph, reflow } = useGraphProvider();\n  const nodeStyle = useMemo(() => ({ top: `${yCoordinate}px`, left: `${xCoordinate}px` }), [\n    xCoordinate,\n    yCoordinate\n  ]);\n  const nodeType = getNodeType(pathwayNode);\n  const action = (pathwayNode as ActionNode).action;\n\n  const { label, transitions } = pathwayNode;\n\n  useLifecycles(\n    (): void => {\n      const { width, height } = getBoundingClientRect(nodeRef.current);\n      graph.setNode(nodeKey, {\n        width,\n        height\n      });\n      transitions.forEach(transition => {\n        graph.setEdge(nodeKey, transition.transition, createTransitionLabel(transition));\n      });\n    },\n    (): void => {\n      graph.removeNode(nodeKey);\n    }\n  );\n\n  useUpdateEffect(() => {\n    if (!nodeRef.current) return undefined;\n\n    const { width, height } = getBoundingClientRect(nodeRef.current);\n    const node = graph.node(nodeKey);\n\n    if (node.width !== width || node.height !== height) {\n      graph.setNode(nodeKey, {\n        ...node,\n        width,\n        height\n      });\n      reflow();\n    }\n  });\n\n  useUpdateEffect(() => {\n    // remove transitions that no longer exist\n    const transitionNodes = new Set(transitions.map(({ transition }) => transition));\n    graph.outEdges(nodeKey)?.forEach(({ w }) => {\n      if (!transitionNodes.has(w)) {\n        graph.removeEdge(nodeKey, w);\n      }\n    });\n\n    transitions.forEach(transition => {\n      graph.setEdge(nodeKey, transition.transition, createTransitionLabel(transition));\n    });\n    reflow();\n  }, [nodeKey, transitions]);\n\n  useUpdateEffect(() => {\n    if (!action) return;\n    openNode(nodeKey);\n  }, [action, nodeKey]);\n\n  return (\n    <div className={styles.node} style={nodeStyle} ref={nodeRef}>\n      <div className={clsx(styles.nodeTitle, onClick && styles.clickable)} onClick={onClickHandler}>\n        <NodeIcon\n          resourceType={action ? action.resource?.resourceType : undefined}\n          nodeType={nodeType}\n          isStartNode={pathwayNode.type === 'start'}\n        />\n        {label}\n      </div>\n\n      {isExpanded && (\n        <div className={styles.nodeContent}>\n          <NodeDetails pathwayNode={pathwayNode} />\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default memo(Node);\n","import { useState, useCallback } from 'react';\n\nexport interface ExpandedState {\n  [key: string]: boolean | string | null;\n}\n\ninterface ExpandedStateToggle {\n  expanded: ExpandedState;\n  toggleExpanded: (nodeName: string) => void;\n  openNode: (nodeName: string) => void;\n  closeNode: (nodeName: string) => void;\n}\n\nconst useExpandedState = (): ExpandedStateToggle => {\n  const [expanded, setExpanded] = useState<ExpandedState>({\n    lastSelectedNode: null\n  } as ExpandedState);\n\n  const toggleExpanded = useCallback((nodeName: string) => {\n    if (nodeName === 'Start') {\n      setExpanded(prevState => ({\n        ...prevState,\n        lastSelectedNode: nodeName\n      }));\n    } else {\n      setExpanded(prevState => ({\n        ...prevState,\n        [nodeName]:\n          !prevState[nodeName] || prevState.lastSelectedNode === nodeName\n            ? !prevState[nodeName]\n            : prevState[nodeName],\n        lastSelectedNode: nodeName\n      }));\n    }\n  }, []);\n\n  const openNode = useCallback((nodeName: string) => {\n    setExpanded(prevState => {\n      if (prevState[nodeName] && prevState.lastSelectedNode === nodeName) return prevState;\n\n      return {\n        ...prevState,\n        [nodeName]: true,\n        lastSelectedNode: nodeName\n      };\n    });\n  }, []);\n\n  const closeNode = useCallback((nodeName: string) => {\n    setExpanded(prevState => {\n      if (!prevState[nodeName]) return prevState;\n\n      return {\n        ...prevState,\n        [nodeName]: false\n      };\n    });\n  }, []);\n\n  return { expanded, toggleExpanded, openNode, closeNode };\n};\n\nexport default useExpandedState;\n","import { useCallback } from 'react';\nimport { useParams, useHistory } from 'react-router-dom';\n\nexport type RedirectToNodeCallback = (nodeId: string) => void;\n\nconst useRedirectToNode = (): RedirectToNodeCallback => {\n  const { id: pathwayId } = useParams();\n  const history = useHistory();\n  const redirectToNode = useCallback(\n    nodeId => {\n      const url = `/builder/${encodeURIComponent(pathwayId)}/node/${encodeURIComponent(nodeId)}`;\n      if (url !== history.location.pathname) {\n        history.push(url);\n      }\n    },\n    [history, pathwayId]\n  );\n\n  return redirectToNode;\n};\n\nexport default useRedirectToNode;\n","import React, { FC, memo, useCallback } from 'react';\nimport { useUpdateEffect } from 'react-use';\n\nimport { useCurrentCriteriaContext } from 'components/CurrentCriteriaProvider';\nimport { useCurrentPathwayContext } from 'components/CurrentPathwayProvider';\nimport { useCurrentNodeContext } from 'components/CurrentNodeProvider';\nimport { useGraphCoordinates, useGraphProvider } from './GraphProvider';\nimport Node from './Node';\nimport useExpandedState from './useExpandedState';\nimport useRedirectToNode from './useRedirectToNode';\n\ninterface GraphNodesProps {\n  interactive: boolean;\n}\n\nconst GraphNodes: FC<GraphNodesProps> = ({ interactive }) => {\n  const { pathway } = useCurrentPathwayContext();\n  const { expanded: expandedNodes, toggleExpanded, openNode } = useExpandedState();\n  const { reflow } = useGraphProvider();\n  const { nodes: nodeCoordinates } = useGraphCoordinates();\n  const { currentNode } = useCurrentNodeContext();\n  const redirectToNode = useRedirectToNode();\n  const { resetCurrentCriteria } = useCurrentCriteriaContext();\n  const onClick = useCallback(\n    (nodeName: string) => {\n      redirectToNode(nodeName);\n      toggleExpanded(nodeName);\n      resetCurrentCriteria();\n    },\n    [redirectToNode, toggleExpanded, resetCurrentCriteria]\n  );\n\n  const nodes = Object.entries(pathway?.nodes ?? {});\n\n  useUpdateEffect(() => {\n    reflow();\n  }, [nodes.length]);\n\n  return (\n    <>\n      {nodes.map(([nodeName, pathwayNode]) => {\n        const coordinates = nodeCoordinates[nodeName] ?? { x: -999, y: -999 };\n\n        return (\n          <Node\n            key={nodeName}\n            nodeKey={nodeName}\n            pathwayNode={pathwayNode}\n            isActionable={pathwayNode.key === currentNode?.key}\n            isExpanded={Boolean(expandedNodes[nodeName])}\n            onClick={interactive ? onClick : undefined}\n            xCoordinate={coordinates.x}\n            yCoordinate={coordinates.y}\n            openNode={openNode}\n          />\n        );\n      })}\n    </>\n  );\n};\n\nexport default memo(GraphNodes);\n","import { makeStyles } from '@material-ui/core/styles';\n\nexport default makeStyles(\n  {\n    root: {\n      position: 'relative',\n      minWidth: '100%',\n      minHeight: '100%'\n    }\n  },\n  { name: 'DagreGraph-GraphRoot' }\n);\n","import React, { FC, ReactNode, useEffect, useMemo, useRef } from 'react';\nimport ResizeSensor from 'css-element-queries/src/ResizeSensor';\n\nimport { useSetGraphWidth, useGraphCoordinates } from './GraphProvider';\nimport useStyles from './GraphRoot.styles';\n\ninterface GraphRootProps {\n  children: ReactNode | ReactNode[];\n}\n\n// padding, in pixels, to add to the width and height of the graph\nconst GRAPH_PADDING = 150;\n\nconst GraphRoot: FC<GraphRootProps> = ({ children }) => {\n  const styles = useStyles();\n  const graphRef = useRef<HTMLDivElement>(null);\n  const setGraphWidth = useSetGraphWidth();\n  const { nodes: nodeCoordinates } = useGraphCoordinates();\n  const graphWidth = useMemo(() => {\n    return Math.ceil(\n      GRAPH_PADDING +\n        (nodeCoordinates !== undefined\n          ? Object.values(nodeCoordinates)\n              .map(({ x, width }) => x + width)\n              .reduce((a, b) => Math.max(a, b), 0)\n          : 0)\n    );\n  }, [nodeCoordinates]);\n  const graphHeight = useMemo(() => {\n    return Math.ceil(\n      GRAPH_PADDING +\n        (nodeCoordinates !== undefined\n          ? Object.values(nodeCoordinates)\n              .map(({ y, height }) => y + height)\n              .reduce((a, b) => Math.max(a, b), 0)\n          : 0)\n    );\n  }, [nodeCoordinates]);\n  const rootStyles = useMemo(() => ({ width: `${graphWidth}px`, height: `${graphHeight}px` }), [\n    graphWidth,\n    graphHeight\n  ]);\n\n  useEffect(() => {\n    const graphElement = graphRef.current;\n    if (graphElement?.parentElement) {\n      const { width } = graphElement.parentElement.getBoundingClientRect();\n      setGraphWidth(Math.ceil(width));\n      const sensor = new ResizeSensor(graphElement.parentElement, () => {\n        const { width } = graphElement?.parentElement?.getBoundingClientRect() ?? { width: 0 };\n        setGraphWidth(Math.ceil(width));\n      });\n      return (): void => {\n        sensor.detach();\n      };\n    }\n  }, [graphRef, setGraphWidth]);\n\n  return (\n    <div ref={graphRef} className={styles.root} style={rootStyles}>\n      {children}\n    </div>\n  );\n};\n\nexport default GraphRoot;\n","import React, { FC, memo } from 'react';\n\nimport GraphEdges from './GraphEdges';\nimport GraphProvider from './GraphProvider';\nimport GraphNodes from './GraphNodes';\nimport GraphRoot from './GraphRoot';\n\ninterface DagreGraphProps {\n  interactive?: boolean;\n}\n\nconst DagreGraph: FC<DagreGraphProps> = ({ interactive = true }) => {\n  return (\n    <GraphProvider>\n      <GraphRoot>\n        <GraphNodes interactive={interactive} />\n        <GraphEdges />\n      </GraphRoot>\n    </GraphProvider>\n  );\n};\n\nexport default memo(DagreGraph);\n","import { makeStyles, Theme as AugmentedTheme } from '@material-ui/core/styles';\n\nexport default makeStyles(\n  (theme: AugmentedTheme) => ({\n    root: {\n      display: 'flex',\n      flexDirection: 'column',\n      padding: theme.variables.spacing.globalPadding\n    },\n    elementContainer: {\n      padding: '1em',\n      marginRight: '10px',\n      border: '0.1em solid',\n      borderRadius: '0.2em',\n      fontWeight: 500,\n      width: 'auto',\n      backgroundColor: theme.palette.common.grayLighter\n    },\n    elementSelect: {\n      display: 'flex',\n      alignItems: 'center'\n    },\n    addElementLabel: {\n      marginLeft: '1em',\n      minWidth: '120px'\n    },\n    headerText: {\n      marginRight: '10px',\n      fontStyle: 'italic',\n      fontSize: '0.8em'\n    },\n    elementField: {\n      display: 'flex',\n      alignItems: 'center'\n    },\n    elementFieldLabel: {\n      fontWeight: 'bold',\n      marginRight: '1em'\n    }\n  }),\n  { name: 'CriteriaBuilder' }\n);\n","import React, { FC, memo, useCallback, useEffect, ChangeEvent } from 'react';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport { faPlus, faTimes } from '@fortawesome/free-solid-svg-icons';\nimport { IconButton, TextField } from '@material-ui/core';\n\nimport DropDown from 'components/elements/DropDown';\nimport { useCurrentCriteriaContext } from 'components/CurrentCriteriaProvider';\nimport useStyles from './styles';\nimport { useCriteriaBuilderContext } from 'components/CriteriaBuilderProvider';\n\nconst CriteriaBuilder: FC = () => {\n  const {\n    selectedElement,\n    selectedDemoElement,\n    gender,\n    minimumAge,\n    maximumAge,\n    setSelectedElement,\n    setSelectedDemoElement,\n    setGender,\n    setMinimumAge,\n    setMaximumAge,\n    resetCriteriaBuilder\n  } = useCriteriaBuilderContext();\n  const styles = useStyles();\n  const { setCurrentCriteria } = useCurrentCriteriaContext();\n  const elementOptions = [{ value: 'Demographics', label: 'Demographics' }];\n  const demoElementOptions = [\n    { value: 'Age Range', label: 'Age Range' },\n    { value: 'Gender', label: 'Gender' }\n  ];\n  const genderOptions = [\n    {\n      label: 'Male',\n      value: 'Male'\n    },\n    {\n      label: 'Female',\n      value: 'Female'\n    },\n    {\n      label: 'Other',\n      value: 'Other'\n    },\n    {\n      label: 'Unknown',\n      value: 'Unknown'\n    }\n  ];\n\n  const onMinimumAgeChange = useCallback(\n    (event: ChangeEvent<{ value: string }>): void => {\n      setMinimumAge(parseInt(event?.target.value) || 0);\n    },\n    [setMinimumAge]\n  );\n\n  const onMaximumAgeChange = useCallback(\n    (event: ChangeEvent<{ value: string }>): void => {\n      setMaximumAge(parseInt(event?.target.value) || 0);\n    },\n    [setMaximumAge]\n  );\n\n  const handleClose = useCallback((): void => {\n    resetCriteriaBuilder();\n    setCurrentCriteria(null);\n  }, [resetCriteriaBuilder, setCurrentCriteria]);\n\n  const genderString = `The patient's gender is ${gender}`;\n  const ageRangeString = `The patient's age is between ${minimumAge} years and ${maximumAge} years`;\n\n  useEffect(() => {\n    const cql = `AgeInYears() >= ${minimumAge} and AgeInYears() < ${maximumAge}`;\n    if (selectedDemoElement === 'Age Range') {\n      if (minimumAge >= 0 && maximumAge > 0 && minimumAge < maximumAge) {\n        setCurrentCriteria({\n          cql,\n          text: ageRangeString,\n          type: 'age',\n          min: minimumAge,\n          max: maximumAge\n        });\n      } else {\n        setCurrentCriteria(null);\n      }\n    }\n  }, [selectedDemoElement, minimumAge, maximumAge, ageRangeString, setCurrentCriteria]);\n\n  useEffect(() => {\n    const cql = `Patient.gender.value ~ '${gender}'`;\n    if (selectedDemoElement === 'Gender') {\n      if (gender !== '') {\n        setCurrentCriteria({ cql, text: genderString, type: 'gender', gender });\n      } else {\n        setCurrentCriteria(null);\n      }\n    }\n  }, [selectedDemoElement, gender, genderString, setCurrentCriteria]);\n\n  return (\n    <>\n      <div className={styles.headerText}>\n        Specify criteria to identify a target population that should receive a recommendation from\n        this artifact. Examples might include an age range, gender, presence of a certain condition,\n        or lab results within a specific range.\n      </div>\n      <div className={styles.elementContainer}>\n        {(selectedElement === '' || selectedDemoElement === '') && (\n          <div className={styles.elementSelect}>\n            <div className={styles.addElementLabel}>\n              <FontAwesomeIcon icon={faPlus} /> Add element\n            </div>\n            <DropDown\n              id=\"Choose Element Type\"\n              label=\"Choose Element Type\"\n              options={elementOptions}\n              onChange={setSelectedElement}\n              value={selectedElement}\n            />\n            {selectedElement && (\n              <DropDown\n                id={`Select ${selectedElement} element`}\n                label={`Select ${selectedElement} element`}\n                options={demoElementOptions}\n                onChange={setSelectedDemoElement}\n                value={selectedDemoElement}\n              />\n            )}\n          </div>\n        )}\n\n        {!(selectedElement === '' || selectedDemoElement === '') && (\n          <>\n            <span>{selectedDemoElement}</span>\n            <IconButton onClick={handleClose}>\n              <FontAwesomeIcon icon={faTimes} />\n            </IconButton>\n            <hr />\n            {selectedDemoElement === 'Gender' && (\n              <>\n                <span>{genderString}</span>\n                <DropDown\n                  id=\"Select Gender\"\n                  label=\"Gender\"\n                  options={genderOptions}\n                  onChange={setGender}\n                  value={gender}\n                />\n              </>\n            )}\n            {selectedDemoElement === 'Age Range' && (\n              <>\n                <span>{ageRangeString}</span>\n                <div className={styles.elementField}>\n                  <span className={styles.elementFieldLabel}>Minimum Age:</span>\n                  <TextField type=\"number\" value={minimumAge} onChange={onMinimumAgeChange} />\n                </div>\n                <div className={styles.elementField}>\n                  <span className={styles.elementFieldLabel}>Maximum Age:</span>\n                  <TextField type=\"number\" value={maximumAge} onChange={onMaximumAgeChange} />\n                </div>\n              </>\n            )}\n          </>\n        )}\n      </div>\n    </>\n  );\n};\n\nexport default memo(CriteriaBuilder);\n","import { makeStyles, Theme as AugmentedTheme, darken } from '@material-ui/core/styles';\n\nconst toggleButtonCss = {\n  borderRadius: '0%',\n  marginLeft: '1px',\n  width: '50px',\n  height: '50px'\n};\n\nexport default makeStyles(\n  (theme: AugmentedTheme) => ({\n    root: {\n      display: 'flex',\n      flexDirection: 'column',\n      height: '100vh'\n    },\n    main: {\n      flex: '1',\n      display: 'flex',\n      alignItems: 'stretch',\n      overflowY: 'auto'\n    },\n    graph: {\n      'overflow-y': 'auto',\n      flex: '1'\n    },\n    graphHeader: {\n      display: 'flex',\n      height: '50px',\n      backgroundColor: theme.palette.common.white,\n      marginLeft: '1px'\n    },\n    graphHeaderText: {\n      height: '50px',\n      display: 'flex',\n      width: '100%',\n      backgroundColor: theme.palette.primary.main,\n      alignItems: 'center',\n      color: theme.palette.common.white,\n      fontSize: '1.4em',\n      paddingLeft: '1.5em'\n    },\n    toggleButton: {\n      '&-on': {\n        ...toggleButtonCss,\n        backgroundColor: theme.palette.primary.main,\n        '&:hover': {\n          backgroundColor: darken(theme.palette.primary.main, 0.1)\n        }\n      },\n      '&-off': {\n        ...toggleButtonCss,\n        backgroundColor: theme.palette.text.primary,\n        '&:hover': {\n          backgroundColor: darken(theme.palette.text.primary, 0.1)\n        }\n      }\n    },\n    toggleIcon: {\n      transform: 'rotate(90deg) scaleY(-1)',\n      color: theme.palette.common.white\n    }\n  }),\n  { name: 'Builder', index: 1 }\n);\n","import React, { FC, useEffect, memo, useState, useCallback } from 'react';\nimport { ThemeProvider as MuiThemeProvider } from '@material-ui/core/styles';\nimport { useCurrentCriteriaContext } from 'components/CurrentCriteriaProvider';\n\nimport Header from 'components/Header';\nimport Navigation from 'components/Navigation';\nimport Sidebar from 'components/Sidebar';\nimport DagreGraph from 'components/DagreGraph';\nimport CriteriaBuilder from 'components/CriteriaBuilder';\nimport { useTheme } from 'components/ThemeProvider';\nimport useStyles from './styles';\nimport { IconButton } from '@material-ui/core';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport { faProjectDiagram } from '@fortawesome/free-solid-svg-icons';\nimport { useCurrentPathwayContext } from 'components/CurrentPathwayProvider';\n\nconst Builder: FC = () => {\n  const styles = useStyles();\n  const { pathway } = useCurrentPathwayContext();\n  const { currentCriteriaNodeId } = useCurrentCriteriaContext();\n  const theme = useTheme('dark');\n  const [showCriteriaBuilder, setShowCriteriaBuilder] = useState<boolean>(true);\n\n  const toggleShowCriteria = useCallback((): void => {\n    setShowCriteriaBuilder(!showCriteriaBuilder);\n  }, [showCriteriaBuilder]);\n\n  // Reset criteriaBuilderToggle to true if not currently building criteria\n  useEffect(() => {\n    if (!showCriteriaBuilder && currentCriteriaNodeId === '') setShowCriteriaBuilder(true);\n  }, [currentCriteriaNodeId, showCriteriaBuilder]);\n\n  return (\n    <div className={styles.root}>\n      <div>\n        <Header />\n        <Navigation />\n      </div>\n\n      {pathway && (\n        <div className={styles.main}>\n          <MuiThemeProvider theme={theme}>\n            <Sidebar />\n          </MuiThemeProvider>\n\n          <div className={styles.graph}>\n            {currentCriteriaNodeId !== '' && (\n              <div className={styles.graphHeader}>\n                <div className={styles.graphHeaderText}>\n                  <span>Criteria Builder</span>\n                </div>\n                <IconButton\n                  className={`${styles.toggleButton}-${showCriteriaBuilder ? 'on' : 'off'}`}\n                  onClick={toggleShowCriteria}\n                >\n                  <FontAwesomeIcon className={styles.toggleIcon} icon={faProjectDiagram} />\n                </IconButton>\n              </div>\n            )}\n            {currentCriteriaNodeId !== '' && showCriteriaBuilder ? (\n              <CriteriaBuilder />\n            ) : (\n              <DagreGraph />\n            )}\n          </div>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default memo(Builder);\n","import React, { FC, memo, useMemo, useEffect } from 'react';\nimport { Redirect, useParams } from 'react-router-dom';\n\nimport Builder from 'components/Builder';\nimport { usePathwaysContext } from 'components/PathwaysProvider';\nimport { useCurrentPathwayContext } from './CurrentPathwayProvider';\nimport { useCurrentNodeContext } from './CurrentNodeProvider';\n\nconst BuilderRoute: FC = () => {\n  const { id, nodeId } = useParams();\n  const { pathways } = usePathwaysContext();\n  const { pathwayRef, setCurrentPathway, resetCurrentPathway } = useCurrentPathwayContext();\n  const { setCurrentNode } = useCurrentNodeContext();\n  const pathwayId = decodeURIComponent(id);\n  const pathwayIndex = useMemo(() => pathways.findIndex(pathway => pathway.id === pathwayId), [\n    pathwayId,\n    pathways\n  ]);\n  const pathway = pathways[pathwayIndex];\n  const currentNodeId = decodeURIComponent(nodeId);\n\n  useEffect(() => {\n    if (pathway && pathwayRef?.current?.id === pathway.id) setCurrentPathway(pathway);\n    else if (pathway) resetCurrentPathway(pathway);\n  }, [pathway, pathwayRef, setCurrentNode, setCurrentPathway, resetCurrentPathway]);\n\n  useEffect(() => {\n    if (pathwayRef.current?.nodes[currentNodeId])\n      setCurrentNode(pathwayRef.current.nodes[currentNodeId]);\n    else if (pathway?.nodes[currentNodeId]) setCurrentNode(pathway.nodes[currentNodeId]);\n    else if (pathway) setCurrentNode(pathway.nodes['Start']);\n  }, [pathway, pathwayRef, currentNodeId, setCurrentNode]);\n\n  if (pathway == null) return null;\n  if (!currentNodeId) return <Redirect to={`/builder/${id}/node/Start`} />;\n\n  return <Builder />;\n};\n\nexport default memo(BuilderRoute);\n","import React, { FC, createContext, useContext, useState, ReactNode } from 'react';\n\ninterface UserContextInterface {\n  user: string | null;\n  setUser: Function;\n}\n\nexport const UserContext = createContext<UserContextInterface>({} as UserContextInterface);\n\ninterface UserProviderProps {\n  children: ReactNode;\n}\n\nexport const UserProvider: FC<UserProviderProps> = ({ children }) => {\n  const [user, setUser] = useState<string | null>(null);\n  return <UserContext.Provider value={{ user, setUser }}>{children}</UserContext.Provider>;\n};\n\nexport const useUser = (): UserContextInterface => useContext(UserContext);\n","import { makeStyles, Theme as AugmentedTheme } from '@material-ui/core/styles';\n\nexport default makeStyles(\n  (theme: AugmentedTheme) => ({\n    root: {\n      display: 'flex',\n      flexDirection: 'column'\n    },\n    label: {\n      padding: `0.2em 2em`,\n      textTransform: 'none',\n      fontSize: '1.2em',\n      fontWeight: 100\n    }\n  }),\n  { name: 'Tabs', index: 1 }\n);\n","import React, { FC, memo, ReactNode } from 'react';\nimport { Tab as ReactTab, TabList, TabPanel, Tabs as ReactTabs } from 'react-tabs';\n\nimport { Button } from '@material-ui/core';\n\nimport useStyles from './styles';\nimport shortid from 'shortid';\n\ninterface Tab {\n  label: string;\n  component: ReactNode;\n}\n\ninterface TabsProp {\n  tabs: Tab[];\n}\n\nconst Tabs: FC<TabsProp> = ({ tabs }) => {\n  const styles = useStyles();\n\n  return (\n    <div className={styles.root}>\n      <ReactTabs>\n        <TabList>\n          {tabs.map(tab => (\n            <ReactTab key={shortid.generate()}>\n              <Button classes={{ label: styles.label }}>{tab.label}</Button>\n            </ReactTab>\n          ))}\n        </TabList>\n\n        {tabs.map(tab => (\n          <TabPanel key={shortid.generate()}>{tab.component}</TabPanel>\n        ))}\n      </ReactTabs>\n    </div>\n  );\n};\n\nexport default memo(Tabs);\n","import React, { FC, memo } from 'react';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport { faSpinner } from '@fortawesome/free-solid-svg-icons';\n\nimport styles from './Loading.module.scss';\n\nconst Loading: FC = () => {\n  return (\n    <div className={styles.root}>\n      <FontAwesomeIcon icon={faSpinner} className={styles.root} size=\"4x\" spin />\n    </div>\n  );\n};\n\nexport default memo(Loading);\n","import { makeStyles, Theme as AugmentedTheme } from '@material-ui/core/styles';\n\nexport default makeStyles(\n  (theme: AugmentedTheme) => ({\n    root: {\n      display: 'flex',\n      flexDirection: 'column',\n      padding: theme.variables.spacing.globalPadding\n    },\n    createPathwayButton: {\n      alignSelf: 'flex-end',\n      marginLeft: '20px'\n    },\n    pathwayList: {\n      marginTop: '2em'\n    },\n    pathwaysListButton: {\n      marginRight: '1em'\n    },\n    dialogCloseButton: {\n      float: 'right',\n      width: '45px'\n    },\n    buttonRow: {\n      display: 'flex',\n      justifyContent: 'flex-end'\n    }\n  }),\n  { name: 'PathwaysList', index: 1 }\n);\n","import React, { FC, useCallback, useRef, memo, FormEvent } from 'react';\nimport { useHistory } from 'react-router-dom';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport { faPlus, faTimes } from '@fortawesome/free-solid-svg-icons';\nimport {\n  Button,\n  Dialog,\n  DialogTitle,\n  DialogContent,\n  DialogActions,\n  TextField,\n  IconButton\n} from '@material-ui/core';\nimport shortid from 'shortid';\nimport produce from 'immer';\n\nimport { usePathwaysContext } from 'components/PathwaysProvider';\nimport useStyles from './styles';\nimport { createNewPathway } from 'utils/builder';\nimport { Pathway } from 'pathways-model';\n\ninterface PathwayModalProps {\n  open: boolean;\n  onClose: () => void;\n  editPathway?: Pathway;\n}\n\nconst PathwayModal: FC<PathwayModalProps> = ({ open, onClose, editPathway }) => {\n  const createNewPathwayMeta = !editPathway;\n  const styles = useStyles();\n  const history = useHistory();\n  const pathwayNameRef = useRef<HTMLInputElement>(null);\n  const pathwayDescRef = useRef<HTMLInputElement>(null);\n  const { addPathway, updatePathway } = usePathwaysContext();\n\n  const closeModal = useCallback(\n    (pathwayId: string): void => {\n      history.push(`/builder/${encodeURIComponent(pathwayId)}/node/Start`);\n      onClose();\n    },\n    [history, onClose]\n  );\n\n  const handleCreateNewPathway = useCallback(\n    (event: FormEvent<HTMLFormElement>): void => {\n      event.preventDefault();\n      const pathwayId = shortid.generate();\n      const name: string = pathwayNameRef.current?.value ?? '';\n      const description: string = pathwayDescRef.current?.value ?? '';\n      addPathway(createNewPathway(name, description, pathwayId));\n      closeModal(pathwayId);\n    },\n    [addPathway, closeModal]\n  );\n\n  const handleUpdatePathway = useCallback(\n    (event: FormEvent<HTMLFormElement>): void => {\n      event.preventDefault();\n      if (\n        editPathway &&\n        (pathwayNameRef.current?.value !== editPathway.name ||\n          pathwayDescRef.current?.value !== editPathway.description)\n      ) {\n        const newEditPathway = produce(editPathway, (draftEditPathway: Pathway) => {\n          if (pathwayNameRef.current?.value) draftEditPathway.name = pathwayNameRef.current.value;\n          if (pathwayDescRef.current?.value)\n            draftEditPathway.description = pathwayDescRef.current.value;\n        });\n        updatePathway(newEditPathway);\n      }\n      onClose();\n    },\n    [updatePathway, editPathway, onClose]\n  );\n\n  let name, description;\n  if (editPathway) {\n    name = editPathway.name;\n    const metaDescription = editPathway.description;\n    if (metaDescription && metaDescription !== '') description = metaDescription;\n  }\n\n  return (\n    <Dialog open={open} onClose={onClose} aria-labelledby=\"create-pathway\" fullWidth maxWidth=\"md\">\n      <DialogTitle disableTypography>\n        <IconButton aria-label=\"close\" onClick={onClose} className={styles.dialogCloseButton}>\n          <FontAwesomeIcon icon={faTimes} />\n        </IconButton>\n      </DialogTitle>\n\n      <form onSubmit={createNewPathwayMeta ? handleCreateNewPathway : handleUpdatePathway}>\n        <DialogContent>\n          <TextField\n            variant=\"outlined\"\n            autoFocus\n            label=\"Pathway Name\"\n            fullWidth\n            required={createNewPathwayMeta}\n            inputRef={pathwayNameRef}\n            defaultValue={createNewPathwayMeta ? undefined : name}\n          />\n\n          <TextField\n            variant=\"outlined\"\n            label=\"Pathway Description\"\n            fullWidth\n            inputRef={pathwayDescRef}\n            defaultValue={createNewPathwayMeta ? undefined : description}\n            multiline\n          />\n        </DialogContent>\n\n        <DialogActions>\n          <Button\n            variant=\"contained\"\n            color=\"primary\"\n            startIcon={createNewPathwayMeta && <FontAwesomeIcon icon={faPlus} />}\n            type=\"submit\"\n          >\n            {createNewPathwayMeta ? 'Create' : 'Save'}\n          </Button>\n        </DialogActions>\n      </form>\n    </Dialog>\n  );\n};\n\nexport default memo(PathwayModal);\n","import { makeStyles, Theme as AugmentedTheme } from '@material-ui/core/styles';\n\nexport default makeStyles(\n  (theme: AugmentedTheme) => ({\n    container: {\n      display: 'inline-block'\n    },\n    paper: {\n      display: 'flex',\n      flexDirection: 'row',\n      alignItems: 'center',\n      borderRadius: '10px',\n      border: '5px solid rgba(74, 74, 74, 0.5)',\n      backgroundColor: theme.palette.common.gray,\n      color: theme.palette.common.white,\n      padding: '0.5em',\n      mozBackgroundClip: 'padding' /* Firefox 3.6 */,\n      webkitBackgroundVlip: 'padding' /* Safari 4? Chrome 6? */,\n      backgroundClip: 'padding-box' /* Firefox 4, Safari 5, Opera 10, IE 9 */\n    },\n    displayText: {\n      marginRight: '4em',\n      whiteSpace: 'nowrap'\n    },\n    buttons: {\n      display: 'flex',\n      alignItems: 'center',\n      justifyContent: 'center',\n      minWidth: '2.5em',\n      minHeight: '2em',\n      cursor: 'pointer',\n      borderRadius: '15%',\n      marginRight: '0.5em'\n    }\n  }),\n  { name: 'ConfirmedDeletionButton' }\n);\n","import React, { FC, memo } from 'react';\nimport styles from './ActionButton.module.scss';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport { faTimes, faCheck } from '@fortawesome/free-solid-svg-icons';\n\ninterface ButtonProps {\n  type: 'accept' | 'decline';\n  onClick?: () => void;\n}\n\ninterface ActionButtonProps extends ButtonProps {\n  size: 'small' | 'large' | 'medium';\n}\n\nconst LargeActionButton: FC<ButtonProps> = ({ type, onClick }) => {\n  return (\n    <button\n      className={`${styles.largeActionButton} button ${type === 'decline' && styles.largeDecline}`}\n      type=\"button\"\n      onClick={onClick}\n    >\n      {type[0].toUpperCase() + type.slice(1)}\n    </button>\n  );\n};\n\nconst SmallActionButton: FC<ButtonProps> = ({ type, onClick }) => {\n  return (\n    <div\n      className={`${type === 'accept' ? styles.accept : styles.decline} ${\n        styles.smallActionButton\n      }`}\n      onClick={onClick}\n      data-testid={type}\n    >\n      <FontAwesomeIcon icon={type === 'accept' ? faCheck : faTimes} />\n    </div>\n  );\n};\n\nconst MediumActionButton: FC<ButtonProps> = ({ type, onClick }) => {\n  const buttonText = {\n    accept: 'Submit',\n    decline: 'Cancel'\n  };\n  return (\n    <div\n      className={`${type === 'accept' ? styles.accept : styles.decline} ${\n        styles.mediumActionButton\n      }`}\n      onClick={onClick}\n      data-testid={type}\n    >\n      <FontAwesomeIcon icon={type === 'accept' ? faCheck : faTimes} />\n      {buttonText[type]}\n    </div>\n  );\n};\n\nconst ActionButton: FC<ActionButtonProps> = ({ type, size, onClick }) => {\n  switch (size) {\n    case 'small':\n      return <SmallActionButton type={type} onClick={onClick} />;\n    case 'large':\n      return <LargeActionButton type={type} onClick={onClick} />;\n    case 'medium':\n      return <MediumActionButton type={type} onClick={onClick} />;\n  }\n};\n\nexport default memo(ActionButton);\n","import React, { FC, memo, useState, MouseEvent, useCallback } from 'react';\n\nimport { Button } from '@material-ui/core';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport { faTrashAlt } from '@fortawesome/free-solid-svg-icons';\nimport Popover from '@material-ui/core/Popover';\nimport ClickAwayListener from '@material-ui/core/ClickAwayListener';\nimport useStyles from './styles';\n\nimport ActionButton from 'components/ActionButton';\n\ninterface ConfirmedDeletionButtonProps {\n  deleteId: string;\n  deleteMethod: (id: string) => void;\n  deleteType?: string;\n  deleteName?: string;\n}\n\nconst ConfirmedDeletionButton: FC<ConfirmedDeletionButtonProps> = ({\n  deleteId,\n  deleteMethod,\n  deleteType,\n  deleteName\n}) => {\n  const styles = useStyles();\n  const [open, setOpen] = useState(false);\n  const [anchorEl, setAnchorEl] = useState<null | HTMLElement>(null);\n\n  const displayText =\n    'Are you sure' +\n    (deleteType && deleteMethod\n      ? ' that you would like to delete the ' + deleteName + ' ' + deleteType + ' ?'\n      : '?');\n\n  const onClickHandler = useCallback((event: MouseEvent<HTMLButtonElement>): void => {\n    setAnchorEl(event.currentTarget);\n    setOpen(true);\n  }, []);\n\n  const onAcceptHandler = useCallback((): void => {\n    deleteMethod(deleteId);\n    setOpen(false);\n    setAnchorEl(null);\n  }, [deleteId, deleteMethod]);\n\n  const onDeclineHandler = useCallback((): void => {\n    setOpen(false);\n    setAnchorEl(null);\n  }, []);\n\n  return (\n    <div className={styles.container}>\n      <ClickAwayListener onClickAway={onDeclineHandler}>\n        <Button\n          color=\"secondary\"\n          size=\"small\"\n          startIcon={<FontAwesomeIcon icon={faTrashAlt} />}\n          onClick={onClickHandler}\n        >\n          Delete\n        </Button>\n      </ClickAwayListener>\n      <Popover\n        classes={{ paper: styles.paper }}\n        open={open}\n        anchorEl={anchorEl}\n        anchorOrigin={{ vertical: 'bottom', horizontal: 'center' }}\n        transformOrigin={{ vertical: 'top', horizontal: 'center' }}\n      >\n        <div className={styles.displayText}> {displayText} </div>\n        <div className={styles.buttons}>\n          <ActionButton size=\"small\" type=\"accept\" onClick={onAcceptHandler} />\n          <ActionButton size=\"small\" type=\"decline\" onClick={onDeclineHandler} />\n        </div>\n      </Popover>\n    </div>\n  );\n};\n\nexport default memo(ConfirmedDeletionButton);\n","import React, { FC, memo, useState, useCallback, MouseEvent } from 'react';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport { faEdit, faFileDownload } from '@fortawesome/free-solid-svg-icons';\nimport {\n  Button,\n  Table,\n  TableBody,\n  TableCell,\n  TableContainer,\n  TableHead,\n  TableRow,\n  Link\n} from '@material-ui/core';\n\nimport { usePathwaysContext } from 'components/PathwaysProvider';\nimport PathwayModal from './PathwayModal';\n\nimport useStyles from './styles';\nimport { Pathway } from 'pathways-model';\nimport { Link as RouterLink } from 'react-router-dom';\nimport ConfirmedDeletionButton from 'components/ConfirmedDeletionButton';\nimport ExportMenu from 'components/elements/ExportMenu';\nimport { useCurrentPathwayContext } from 'components/CurrentPathwayProvider';\n\nconst PathwaysTable: FC = () => {\n  const styles = useStyles();\n  const { pathways, deletePathway } = usePathwaysContext();\n  const { setCurrentPathway } = useCurrentPathwayContext();\n  const [open, setOpen] = useState(false);\n  const [editablePathway, setEditablePathway] = useState<Pathway>();\n  const [anchorEl, setAnchorEl] = useState<null | HTMLElement>(null);\n\n  const openEditPathwayModal = useCallback((pathway: Pathway): void => {\n    setOpen(true);\n    setEditablePathway(pathway);\n  }, []);\n\n  const closeEditPathwayModal = useCallback((): void => {\n    setOpen(false);\n  }, []);\n\n  const openMenu = useCallback(\n    (event: MouseEvent<HTMLButtonElement>): void => {\n      setAnchorEl(event.currentTarget);\n      const pathway = pathways.filter(pathway => pathway.id === event.currentTarget.id);\n      if (pathway.length) setCurrentPathway(pathway[0]);\n    },\n    [pathways, setCurrentPathway]\n  );\n\n  const closeMenu = useCallback((): void => {\n    setAnchorEl(null);\n  }, []);\n\n  const deletion = useCallback(\n    (id: string): void => {\n      deletePathway(id);\n    },\n    [deletePathway]\n  );\n\n  return (\n    <div>\n      <TableContainer className={styles.pathwayList}>\n        <Table aria-label=\"pathway list\">\n          <TableHead>\n            <TableRow>\n              <TableCell>Pathway Name</TableCell>\n              <TableCell>Status</TableCell>\n              <TableCell>Last Updated</TableCell>\n              <TableCell></TableCell>\n            </TableRow>\n          </TableHead>\n\n          <TableBody>\n            {pathways.map(pathway => (\n              <TableRow key={pathway.id}>\n                <TableCell component=\"th\" scope=\"row\">\n                  <Link\n                    component={RouterLink}\n                    to={`/builder/${encodeURIComponent(pathway.id)}`}\n                    color=\"primary\"\n                    underline=\"none\"\n                  >\n                    {pathway.name}\n                  </Link>\n                </TableCell>\n\n                <TableCell>draft</TableCell>\n                <TableCell>2 days ago</TableCell>\n\n                <TableCell align=\"right\">\n                  <Button\n                    className={styles.pathwaysListButton}\n                    color=\"primary\"\n                    size=\"small\"\n                    startIcon={<FontAwesomeIcon icon={faEdit} />}\n                    onClick={(): void => openEditPathwayModal(pathway)}\n                  >\n                    Edit Info\n                  </Button>\n                  <Button\n                    id={pathway.id}\n                    className={styles.pathwaysListButton}\n                    color=\"primary\"\n                    size=\"small\"\n                    startIcon={<FontAwesomeIcon icon={faFileDownload} />}\n                    onClick={openMenu}\n                  >\n                    Export\n                  </Button>\n                  <ConfirmedDeletionButton\n                    deleteType=\"pathway\"\n                    deleteName={pathway.name}\n                    deleteId={pathway.id}\n                    deleteMethod={deletion}\n                  />\n                </TableCell>\n              </TableRow>\n            ))}\n          </TableBody>\n        </Table>\n      </TableContainer>\n      <ExportMenu anchorEl={anchorEl} closeMenu={closeMenu} />\n      <PathwayModal open={open} onClose={closeEditPathwayModal} editPathway={editablePathway} />\n    </div>\n  );\n};\n\nexport default memo(PathwaysTable);\n","import { makeStyles, Theme as AugmentedTheme } from '@material-ui/core/styles';\n\nexport default makeStyles(\n  (theme: AugmentedTheme) => ({\n    dialogCloseButton: {\n      float: 'right',\n      width: '45px'\n    },\n    input: {\n      display: 'none'\n    },\n    chooseFileInput: {\n      display: 'flex',\n      alignItems: 'center'\n    },\n    inputButton: {\n      whiteSpace: 'nowrap',\n      marginRight: '1em'\n    },\n    fileName: {\n      fontStyle: 'italic'\n    }\n  }),\n  { name: 'FileImportModal', index: 1 }\n);\n","import React, { FC, useState, useRef, FormEvent, useCallback, memo } from 'react';\nimport {\n  Button,\n  Dialog,\n  DialogActions,\n  DialogContent,\n  DialogTitle,\n  IconButton,\n  Input\n} from '@material-ui/core';\nimport useStyles from './styles';\nimport { faFileImport, faTimes } from '@fortawesome/free-solid-svg-icons';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\n\ninterface FileImportModalProps {\n  open: boolean;\n  onClose: () => void;\n  onSelectFile: (files: FileList | undefined | null) => void;\n  allowedFileType?: string; // Setting this to undefined will allow any file type to be selected\n}\n\nconst FileImportModal: FC<FileImportModalProps> = ({\n  open,\n  onClose,\n  onSelectFile,\n  allowedFileType\n}) => {\n  const styles = useStyles();\n  const [fileName, setFileName] = useState<string>('');\n  const importFileRef = useRef<HTMLInputElement>(null);\n\n  const selectFile = useCallback(\n    (event: FormEvent<HTMLFormElement>) => {\n      event.preventDefault();\n      const files = importFileRef?.current?.files;\n      onSelectFile(files);\n      onClose();\n      setFileName('');\n    },\n    [onClose, onSelectFile]\n  );\n\n  const handleChooseFile = useCallback(() => {\n    if (importFileRef?.current?.files?.[0]) setFileName(importFileRef.current.files[0].name);\n  }, [importFileRef]);\n\n  return (\n    <Dialog open={open} onClose={onClose} aria-labelledby=\"import-pathway\" fullWidth maxWidth=\"sm\">\n      <DialogTitle disableTypography>\n        <IconButton aria-label=\"close\" onClick={onClose} className={styles.dialogCloseButton}>\n          <FontAwesomeIcon icon={faTimes} />\n        </IconButton>\n      </DialogTitle>\n\n      <form onSubmit={selectFile}>\n        <DialogContent>\n          <div className={styles.chooseFileInput}>\n            <Input\n              id=\"choose-file-input\"\n              className={styles.input}\n              inputRef={importFileRef}\n              type=\"file\"\n              inputProps={{ accept: allowedFileType }} // TODO: how to allow multiple types?\n              onChange={handleChooseFile}\n            />\n            <label htmlFor=\"choose-file-input\">\n              <Button\n                className={styles.inputButton}\n                variant=\"contained\"\n                color=\"primary\"\n                component=\"span\"\n              >\n                Choose File\n              </Button>\n            </label>\n\n            <div className={styles.fileName}>\n              {fileName ? <span>{fileName}</span> : <span>Choose file to import.</span>}\n            </div>\n          </div>\n        </DialogContent>\n        <DialogActions>\n          <Button\n            variant=\"contained\"\n            color=\"primary\"\n            startIcon={<FontAwesomeIcon icon={faFileImport} />}\n            type=\"submit\"\n          >\n            Import\n          </Button>\n        </DialogActions>\n      </form>\n    </Dialog>\n  );\n};\n\nexport default memo(FileImportModal);\n","import React, { FC, useCallback, useState, memo } from 'react';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport { faFileImport, faPlus } from '@fortawesome/free-solid-svg-icons';\nimport { Button } from '@material-ui/core';\n\nimport { usePathwaysContext } from 'components/PathwaysProvider';\nimport Loading from 'components/elements/Loading';\nimport PathwaysTable from './PathwaysTable';\nimport PathwayModal from './PathwayModal';\n\nimport useStyles from './styles';\nimport FileImportModal from 'components/FileImportModal';\n\nconst PathwaysList: FC = () => {\n  const styles = useStyles();\n  const [open, setOpen] = useState(false);\n  const { status } = usePathwaysContext();\n  const [importPathwayOpen, _setImportPathwayOpen] = useState(false);\n\n  const { addPathwayFromFile } = usePathwaysContext();\n\n  const openNewPathwayModal = useCallback((): void => {\n    setOpen(true);\n  }, []);\n\n  const closeNewPathwayModal = useCallback((): void => {\n    setOpen(false);\n  }, []);\n\n  const selectFile = useCallback(\n    (files: FileList | undefined | null) => {\n      if (files?.length) addPathwayFromFile((files[0] as unknown) as File);\n    },\n    [addPathwayFromFile]\n  );\n\n  const openImportPathwayModal = useCallback((): void => _setImportPathwayOpen(true), []);\n\n  const closeImportPathwayModal = useCallback((): void => _setImportPathwayOpen(false), []);\n\n  return (\n    <div className={styles.root}>\n      <div className={styles.buttonRow}>\n        <Button\n          className={styles.createPathwayButton}\n          variant=\"contained\"\n          color=\"primary\"\n          startIcon={<FontAwesomeIcon icon={faFileImport} />}\n          onClick={openImportPathwayModal}\n        >\n          Import Pathway\n        </Button>\n\n        <Button\n          className={styles.createPathwayButton}\n          variant=\"contained\"\n          color=\"primary\"\n          startIcon={<FontAwesomeIcon icon={faPlus} />}\n          onClick={openNewPathwayModal}\n        >\n          Create Pathway\n        </Button>\n      </div>\n\n      <FileImportModal\n        open={importPathwayOpen}\n        onClose={closeImportPathwayModal}\n        onSelectFile={selectFile}\n        allowedFileType=\".json\"\n      />\n\n      <PathwayModal open={open} onClose={closeNewPathwayModal} />\n\n      {status === 'loading' ? <Loading /> : <PathwaysTable />}\n    </div>\n  );\n};\n\nexport default memo(PathwaysList);\n","import { makeStyles, Theme as AugmentedTheme } from '@material-ui/core/styles';\n\nexport default makeStyles(\n  (theme: AugmentedTheme) => ({\n    root: {\n      display: 'flex',\n      flexDirection: 'column',\n      padding: theme.variables.spacing.globalPadding\n    },\n    buttonRow: {\n      display: 'flex',\n      justifyContent: 'flex-end'\n    },\n    buildCriteriaButton: {\n      alignSelf: 'flex-end',\n      marginLeft: '20px'\n    },\n    criteriaList: {\n      marginTop: '2em'\n    },\n    editButton: {\n      marginRight: '1em'\n    },\n    dialogCloseButton: {\n      float: 'right',\n      width: '45px'\n    },\n    input: {\n      display: 'none'\n    },\n    chooseFileInput: {\n      display: 'flex',\n      alignItems: 'center'\n    },\n    inputButton: {\n      whiteSpace: 'nowrap',\n      marginRight: '1em'\n    },\n    fileName: {\n      fontStyle: 'italic'\n    }\n  }),\n  { name: 'CriteriaList', index: 1 }\n);\n","import React, { FC, memo, useCallback } from 'react';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport { faEdit } from '@fortawesome/free-solid-svg-icons';\nimport {\n  Button,\n  Table,\n  TableBody,\n  TableCell,\n  TableContainer,\n  TableHead,\n  TableRow\n} from '@material-ui/core';\nimport moment from 'moment';\n\nimport useStyles from './styles';\nimport { useCriteriaContext } from 'components/CriteriaProvider';\nimport ConfirmedDeletionButton from 'components/ConfirmedDeletionButton';\n\nconst CriteriaTable: FC = () => {\n  const styles = useStyles();\n  const { criteria, deleteCriteria } = useCriteriaContext();\n\n  const renderDate = (datetime: number): string => {\n    return moment(datetime).fromNow();\n  };\n\n  const deletion = useCallback(\n    (id: string): void => {\n      deleteCriteria(id);\n    },\n    [deleteCriteria]\n  );\n\n  return (\n    <TableContainer className={styles.criteriaList}>\n      <Table aria-label=\"criteria list\">\n        <TableHead>\n          <TableRow>\n            <TableCell>Criteria Name</TableCell>\n            <TableCell>Version</TableCell>\n            <TableCell>Added</TableCell>\n            <TableCell></TableCell>\n          </TableRow>\n        </TableHead>\n\n        <TableBody>\n          {criteria.map(c => (\n            <TableRow key={c.id}>\n              <TableCell component=\"th\" scope=\"row\">\n                {c.label}\n              </TableCell>\n              <TableCell>{c.version}</TableCell>\n              <TableCell>{renderDate(c.modified)}</TableCell>\n\n              <TableCell align=\"right\">\n                <Button\n                  className={styles.editButton}\n                  color=\"primary\"\n                  size=\"small\"\n                  startIcon={<FontAwesomeIcon icon={faEdit} />}\n                >\n                  Edit\n                </Button>\n                <ConfirmedDeletionButton\n                  deleteType=\"criterion\"\n                  deleteName={c.label}\n                  deleteId={c.id}\n                  deleteMethod={deletion}\n                />\n              </TableCell>\n            </TableRow>\n          ))}\n        </TableBody>\n      </Table>\n    </TableContainer>\n  );\n};\n\nexport default memo(CriteriaTable);\n","import React, { FC, memo, useState, useCallback } from 'react';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport { faTools, faFileImport } from '@fortawesome/free-solid-svg-icons';\nimport { Button } from '@material-ui/core';\n\nimport { usePathwaysContext } from 'components/PathwaysProvider';\nimport Loading from 'components/elements/Loading';\nimport CriteriaTable from './CriteriaTable';\n\nimport useStyles from './styles';\nimport FileImportModal from 'components/FileImportModal';\nimport { useCriteriaContext } from 'components/CriteriaProvider';\n\nconst CriteriaList: FC = () => {\n  const styles = useStyles();\n  const { status } = usePathwaysContext();\n\n  const { addCriteria } = useCriteriaContext();\n\n  const [open, setOpen] = useState<boolean>(false);\n  const openImportModal = useCallback((): void => {\n    setOpen(true);\n  }, []);\n\n  const closeImportModal = useCallback((): void => {\n    setOpen(false);\n  }, []);\n\n  const selectFile = useCallback(\n    (files: FileList | undefined | null) => {\n      if (files?.length) addCriteria(files[0]);\n    },\n    [addCriteria]\n  );\n\n  return (\n    <div className={styles.root}>\n      <div className={styles.buttonRow}>\n        <Button\n          className={styles.buildCriteriaButton}\n          variant=\"contained\"\n          color=\"primary\"\n          startIcon={<FontAwesomeIcon icon={faFileImport} />}\n          onClick={openImportModal}\n        >\n          Import Library\n        </Button>\n        <Button\n          className={styles.buildCriteriaButton}\n          variant=\"contained\"\n          color=\"primary\"\n          startIcon={<FontAwesomeIcon icon={faTools} />}\n        >\n          Build Criteria\n        </Button>\n      </div>\n\n      <FileImportModal\n        open={open}\n        onClose={closeImportModal}\n        onSelectFile={selectFile}\n        allowedFileType=\".cql\"\n      />\n\n      {status === 'loading' ? <Loading /> : <CriteriaTable />}\n    </div>\n  );\n};\n\nexport default memo(CriteriaList);\n","import React, { FC, memo } from 'react';\nimport { HashRouter as Router, Route, Switch } from 'react-router-dom';\n\nimport Header from 'components/Header';\n\nimport BuilderRoute from './BuilderRoute';\nimport ThemeProvider from './ThemeProvider';\nimport { PathwaysProvider } from './PathwaysProvider';\nimport { UserProvider } from './UserProvider';\nimport { CriteriaProvider } from './CriteriaProvider';\nimport Tabs from './Tabs';\nimport PathwaysList from './PathwaysList';\nimport CriteriaList from './CriteriaList';\nimport { CurrentPathwayProvider } from './CurrentPathwayProvider';\nimport { CurrentNodeProvider } from './CurrentNodeProvider';\nimport { CurrentCriteriaProvider } from './CurrentCriteriaProvider';\nimport { SnackbarProvider } from './SnackbarProvider';\nimport { CriteriaBuilderProvider } from './CriteriaBuilderProvider';\n\nconst App: FC = () => {\n  return (\n    <ThemeProvider theme=\"light\">\n      <UserProvider>\n        <CriteriaProvider>\n          <PathwaysProvider>\n            <CurrentNodeProvider>\n              <CurrentPathwayProvider>\n                <SnackbarProvider>\n                  <CurrentCriteriaProvider>\n                    <CriteriaBuilderProvider>\n                      <Router>\n                        <Switch>\n                          <Route path=\"/builder/:id/node/:nodeId\">\n                            <BuilderRoute />\n                          </Route>\n                          <Route path=\"/builder/:id\">\n                            <BuilderRoute />\n                          </Route>\n                          <Route path=\"/\">\n                            <Header />\n                            <Tabs\n                              tabs={[\n                                { label: 'Pathway', component: <PathwaysList /> },\n                                { label: 'Criteria', component: <CriteriaList /> }\n                              ]}\n                            />\n                          </Route>\n                        </Switch>\n                      </Router>\n                    </CriteriaBuilderProvider>\n                  </CurrentCriteriaProvider>\n                </SnackbarProvider>\n              </CurrentPathwayProvider>\n            </CurrentNodeProvider>\n          </PathwaysProvider>\n        </CriteriaProvider>\n      </UserProvider>\n    </ThemeProvider>\n  );\n};\n\nexport default memo(App);\n","import 'react-app-polyfill/ie11';\nimport 'react-app-polyfill/stable';\nimport './immer';\nimport React from 'react';\nimport ReactDOM from 'react-dom';\n\nimport App from 'components/App';\n\nimport './styles/index.scss';\n\n// Enable why did you render for development mode\n// Will automatically track all memoized components\nif (process.env.NODE_ENV === 'development') {\n  const whyDidYouRender = require('@welldone-software/why-did-you-render');\n  whyDidYouRender(React, {\n    trackAllPureComponents: true\n  });\n}\n\nReactDOM.render(<App />, document.getElementById('root'));\n","export class ConfigManager {\n  constructor(config = {}) {\n    this.config = global.CONFIG ? { ...global.CONFIG, ...config } : { ...config };\n  }\n\n  get(name, defaultValue) {\n    const parts = name.split('.');\n    let context = this.config;\n    let value = null;\n    for (const i in parts) {\n      const part = parts[i];\n      value = context[part];\n      context = value;\n    }\n    return value || defaultValue;\n  }\n\n  add(conf) {\n    if (conf) {\n      this.config = {\n        ...this.config,\n        ...conf\n      };\n    }\n  }\n}\n\nconst config = new ConfigManager();\nexport default config;\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"logo\":\"Header_logo__3T0lc\",\"homeLink\":\"Header_homeLink__2ew4r\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"root\":\"Loading_root__3b6qy\"};"],"sourceRoot":""}