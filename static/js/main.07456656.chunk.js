(this["webpackJsonppathway-builder"]=this["webpackJsonppathway-builder"]||[]).push([[0],{1060:function(e,t,n){e.exports=n.p+"static/media/camino-logo-dark.c8fc712a.png"},1068:function(e,t,n){e.exports=n.p+"static/media/camino-builder-logo-light-bg.a225ed53.png"},1069:function(e,t,n){e.exports=n.p+"static/media/example-pathway.f89d4f23.png"},1071:function(e,t,n){e.exports=n.p+"static/media/mitre.54eb1f7d.png"},1072:function(e,t,n){e.exports=n.p+"static/media/mcode.644320c4.png"},1094:function(e,t,n){e.exports=n(1504)},133:function(e,t,n){e.exports={selectButton:"ActionButton_selectButton___qB5R",accept:"ActionButton_accept__28b2D",decline:"ActionButton_decline__zz-vG",smallActionButton:"ActionButton_smallActionButton__1bPWu",largeActionButton:"ActionButton_largeActionButton__blRdA",largeDecline:"ActionButton_largeDecline__wz9Zw",mediumActionButton:"ActionButton_mediumActionButton__3EpOp"}},1503:function(e,t,n){},1504:function(e,t,n){"use strict";n.r(t);n(1095),n(1104);var a=n(33);Object(a.b)();var r=n(0),o=n.n(r),i=n(58),c=n.n(i),l=n(66),u=n(152),d=n(22),s=n(25),m=n(21),p=n(1075),f=n(1570),b=Object(r.createContext)({}),h=Object(r.memo)((function(e){var t=e.children,n=Object(r.useState)(""),a=Object(d.a)(n,2),i=a[0],c=a[1],l=Object(r.useState)(null),u=Object(d.a)(l,2),s=u[0],m=u[1],p=Object(r.useState)(!1),f=Object(d.a)(p,2),h=f[0],v=f[1],g=Object(r.useState)(""),y=Object(d.a)(g,2),E=y[0],C=y[1],O=Object(r.useCallback)((function(){c(""),m(null),v(!1),C("")}),[c,m,v,C]);return o.a.createElement(b.Provider,{value:{buildCriteriaSelected:h,setBuildCriteriaSelected:v,currentCriteriaNodeId:i,setCurrentCriteriaNodeId:c,currentCriteria:s,setCurrentCriteria:m,criteriaName:E,setCriteriaName:C,resetCurrentCriteria:O}},t)})),v=function(){return Object(r.useContext)(b)},g=n(1537),y=n(49),E=n(1073),C=n(263),O=n.n(C),j={spacing:{globalPadding:"2em"}},k={white:"#fff",black:"#222",red:"#d95d77",redDark:"#bb3551",blue:"#5d89a1",blueDark:"#386883",blueLighter:"#9ad2f0",gray:"#4a4a4a",grayMedium:"#bbbdc0",grayBlue:"#cbd5df",grayBlueDark:"#7d8892",grayLight:"#6c6c6c",grayLighter:"#aaaeb1",grayLightest:"#eaeef2",grayDark:"#444",grayVeryDark:"#3a3a3a",green:"#2fa874"},x={fontFamily:["Open Sans","-apple-system","BlinkMacSystemFont","Segoe UI","Roboto","Oxygen","Ubuntu","Cantarell","Fira Sans","Droid Sans","Helvetica Neue","sans-serif"].join(",")},w={MuiButton:{root:{borderRadius:0,height:"38px","&$disabled":{backgroundColor:k.grayMedium,color:k.white}},contained:{"&$disabled":{backgroundColor:k.grayMedium,color:k.white}},label:{fontWeight:600},iconSizeMedium:{"& > *:first-child":{fontSize:14}},iconSizeSmall:{"& > *:first-child":{fontSize:14}}},MuiTableHead:{root:{backgroundColor:k.grayLightest}},MuiTableCell:{root:{fontSize:"1em"},head:{padding:"5px 16px",borderBottom:"none"}},MuiFormControl:{root:{margin:"10px 0"}},MuiFormLabel:{root:{fontStyle:"italic","&.Mui-error":{color:k.white},"&.Mui-disabled":{color:k.white}}},MuiInputBase:{root:{fontWeight:600},input:{"&::selection":{color:k.white,backgroundColor:k.grayDark},"&:-webkit-autofill":{transitionDelay:"9999s",transitionProperty:"background-color, color"},"&$disabled":{color:k.white,backgroundColor:k.grayDark}}},MuiTooltip:{tooltip:{fontSize:14,backgroundColor:k.black},arrow:{color:k.black}},MuiOutlinedInput:{root:{borderRadius:"0"}},MuiSelect:{icon:{fontSize:"2em"}},MuiPaper:{rounded:{borderRadius:"0"}},MuiDialogTitle:{root:{display:"flex",justifyContent:"flex-end",padding:"1em 2em"}},MuiDialogContent:{root:{display:"flex",flexDirection:"column",padding:"0 4em",lineHeight:"normal",overflowY:"initial",color:k.grayLighter}},MuiDialogActions:{root:{display:"flex",justifyContent:"space-between",padding:"2em 4em",color:k.grayLighter,marginBottom:"2em"}},MuiCard:{root:{overflow:"visible"}},MuiIconButton:{root:{color:k.gray,"&:disabled":{color:k.grayMedium}},sizeSmall:{width:"20px",height:"20px",margin:"9px"}}},S={MuiFormControl:{root:{"&:hover":{borderColor:k.white}}},MuiFormLabel:{root:{color:k.white,"&$focused":{color:k.white}}},MuiInputBase:{root:{color:k.white,"&:hover":{borderColor:k.white,backgroundColor:k.grayDark}}},MuiTooltip:{tooltip:{fontSize:14}},MuiOutlinedInput:{root:{"&:hover":{borderColor:k.white},"&:hover $notchedOutline":{borderColor:k.white},"&$focused $notchedOutline":{borderColor:k.white},"&$disabled $notchedOutline":{borderColor:k.white}},notchedOutline:{borderColor:k.white}},MuiSelect:{icon:{color:k.white}},MuiMenuItem:{root:{color:k.grayDark}},MuiIconButton:{root:{color:k.white,"&:disabled":{color:k.grayLight}}}},N={primary:{main:k.blue},secondary:{main:k.red},error:{main:k.red},common:k,background:{default:k.grayLightest},text:{primary:k.gray,secondary:k.gray},grey:{800:k.gray}},T=Object(E.a)({typography:Object(y.a)({},x),palette:Object(y.a)({},N),overrides:Object(y.a)({},w),variables:Object(y.a)({},j)}),I=Object(E.a)({typography:Object(y.a)({},x),palette:O()(N,{text:{primary:k.white,secondary:k.white}}),overrides:O()(w,S),variables:Object(y.a)({},j)}),R=Object(E.a)({typography:Object(y.a)({},x),palette:O()(N,{background:{default:k.grayBlue},text:{primary:k.black,secondary:k.black}}),overrides:Object(y.a)({},w),variables:Object(y.a)({},j)}),B=function(e){var t=e.theme;if(e.useProjector)switch(t){case"dark":return I;default:return R}switch(t){case"dark":return I;default:return T}},D=Object(r.createContext)({}),P=Object(r.memo)((function(e){var t=e.theme,n=void 0===t?"light":t,a=e.children,i=Object(r.useState)(!1),c=Object(d.a)(i,2),l=c[0],u=c[1],s=B({theme:n,useProjector:l}),m=Object(r.useCallback)((function(){u((function(e){return!e}))}),[]);return o.a.createElement(g.a,{theme:s},o.a.createElement(D.Provider,{value:{useProjector:l,toggleTheme:m}},a))})),L=n(1060),M=n.n(L),A=n(264),F=n.n(A),q=Object(r.memo)((function(){var e=v().resetCurrentCriteria,t=Object(r.useState)(null),n=Object(d.a)(t,2),a=n[0],i=n[1],c=Object(r.useContext)(D).toggleTheme,u=Object(r.useCallback)((function(e){i(e.currentTarget)}),[]),b=Object(r.useCallback)((function(){i(null)}),[]),h=Object(r.useCallback)((function(){c(),b()}),[c,b]);return o.a.createElement("header",{className:F.a.header},o.a.createElement(l.b,{to:"/",className:F.a.homeLink,onClick:function(){return e()}},o.a.createElement("img",{src:M.a,alt:"logo",className:F.a.logo})),o.a.createElement("button",{onClick:u,"aria-controls":"options-menu","aria-haspopup":"true"},o.a.createElement(s.a,{icon:m.h})),o.a.createElement(p.a,{id:"options-menu",anchorEl:a,keepMounted:!0,open:Boolean(a),onClose:b},o.a.createElement(f.a,{onClick:h},"Toggle Theme")))})),z=n(1542),W=n(1543),_=n(1541),H=Object(_.a)((function(e){return{root:{display:"flex",alignItems:"center",padding:"2em",backgroundColor:e.palette.background.default,color:e.palette.text.primary,height:"6em",justifyContent:"space-between"},backButton:{height:"45px",width:"45px"},navigationIcons:{fontSize:"20px",cursor:"pointer"},pathwayName:{fontSize:"1.4em",marginLeft:"1.5em"}}}),{name:"Navigation",index:1}),G=n(1062);var U=function(e){var t=Object(G.a)(e),n=Object(d.a)(t,2),a=n[0],o=n[1],i=o.set,c=o.reset,l=o.undo,u=o.redo,s=o.canUndo,m=o.canRedo,p=Object(r.useRef)(a.present);return Object(r.useEffect)((function(){p.current=a.present}),[a]),[a.present,p,s,m,l,u,c,i]},K=n(67),J=n(181);function V(e){return fetch(e,{headers:{Accept:"application/json"}})}function Y(e,t,n){return fetch(e,n).then((function(e){return t?e.text():e.json()}))}var $=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=Object(r.useState)({status:"loading"}),a=Object(d.a)(n,2),o=a[0],i=a[1];return Object(r.useEffect)((function(){V(e).then((function(e){return e.json()})).then((function(n){return n.map((function(n){return Y(e+"/"+n,t)}))})).then((function(e){return Promise.all(e)})).then((function(e){return i({status:"loaded",payload:e})})).catch((function(e){return i({status:"error",error:e})}))}),[e,t]),o};var Q=function(e){var t=Object(r.useState)(e),n=Object(d.a)(t,2),a=n[0],o=n[1],i=Object(r.useRef)(a);return Object(r.useEffect)((function(){i.current=a}),[a]),[a,i,o]},X=n(338),Z=n.n(X),ee=n(1063),te=n(262),ne=n(1074),ae=n(72),re=n.n(ae),oe=n(260),ie=n.n(oe),ce=/.*;boundary=(Boundary.*);?.*/,le=/Content-Disposition: form-data; name="([^"]+)"/,ue=/(\{[^]*\})/,de=J.a.get("cqlToElmWebserviceUrl");function se(e){return fetch(de,{method:"POST",headers:{"Content-Type":"application/cql",Accept:"application/elm+json"},body:e}).then((function(e){return e.json()}))}var me=Object(r.createContext)({}),pe=["Patient","MeetsInclusionCriteria","InPopulation","Recommendation","Rationale","Errors"];function fe(e){var t,n,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,o=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(!(null===(t=e.library)||void 0===t||null===(n=t.identifier)||void 0===n?void 0:n.id))return[];var i=e.library.statements.def,c=i.filter((function(e){return!pe.includes(e.name)})),l=!!i.find((function(e){return e.resultTypeName}));if(l&&(c=c.filter((function(e){return"{urn:hl7-org:elm-types:r1}Boolean"===e.resultTypeName}))),!c)return alert("No elm statement found in that file"),[];var u=o?"Criteria Builder (".concat(e.library.identifier.id.substring(0,5),")"):e.library.identifier.id;return c.map((function(t){return Object(y.a)({id:re.a.generate(),label:"".concat(u,": ").concat(t.name),version:e.library.identifier.version,modified:Date.now(),elm:e,cql:a,statement:t.name},r&&{cqlLibraries:r})}))}function be(e){var t,n=JSON.parse(e);if(null===(t=n.library)||void 0===t?void 0:t.identifier)return fe(n);alert("Please upload ELM file")}function he(e){return"string"===typeof e?se(e).then((function(t){return fe(t,e)})):function(e){var t=new FormData;return Object.keys(e).forEach((function(n,a){var r=e[n];r.cql&&t.append("".concat(n),r.cql)})),fetch(de,{method:"POST",body:t}).then((function(e){var t=e.headers.get("content-type"),n="";if(t){var a=ce.exec(t);n=a?"--".concat(a[1]):""}var r={};return e.text().then((function(e){return e.split(n).reduce((function(e,t,n){var a=ue.exec(t);if(a){var r=le.exec(t);r&&(e[r[1]]=JSON.parse(a[1]))}return e}),r)}))}))}(e).then((function(t){return Object.keys(t).forEach((function(n){var a=e[n],r=t[n];a&&(a.version=r.library.identifier.version)})),Object.keys(t).map((function(n){e[n];var a=Object(te.a)(e,[n].map(ne.a));return fe(t[n],e[n].cql,a)})).flat(1)}))}var ve=Object(r.memo)((function(e){var t=e.children,n=Object(r.useState)([]),a=Object(d.a)(n,2),i=a[0],c=a[1],l=$(J.a.get("demoCriteria"),!0).payload;Object(r.useEffect)((function(){if(l){var e=l.map((function(e){return he(e)}));Promise.all(e).then((function(e){return e.flat()})).then((function(e){return c(e)}))}}),[l]);var u=Object(r.useCallback)((function(e){he(e).then((function(t){t.length>0?c((function(n){return n.find((function(t){return t.cql===e}))?n:[].concat(Object(K.a)(n),Object(K.a)(t))})):alert("No valid criteria were found in the provided file")}))}),[]),s=Object(r.useCallback)((function(e){var t=new FileReader;t.onload=function(){var t=Object(ee.a)(Z.a.mark((function t(n){var a,r,o,i,l,d,s,m,p;return Z.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(null===(a=n.target)||void 0===a?void 0:a.result)){t.next=32;break}if(r=n.target.result,!e.name.endsWith(".json")){t.next=7;break}(o=be(r))&&c((function(e){return[].concat(Object(K.a)(e),Object(K.a)(o))})),t.next=30;break;case 7:if(!e.name.endsWith(".cql")){t.next=11;break}u(r),t.next=30;break;case 11:if(!e.name.endsWith(".zip")){t.next=30;break}return i={},t.next=15,ie.a.loadAsync(e);case 15:l=t.sent,d=Object.values(l.files),s=0;case 18:if(!(s<d.length)){t.next=29;break}if((m=d[s]).name.endsWith(".cql")){t.next=22;break}return t.abrupt("continue",26);case 22:return t.next=24,m.async("string");case 24:p=t.sent,i[m.name]={cql:p};case 26:s++,t.next=18;break;case 29:u(i);case 30:t.next=33;break;case 32:alert("Unable to read that file");case 33:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),t.readAsText(e)}),[u]),m=Object(r.useCallback)((function(e){c((function(t){return t.filter((function(t){return t.id!==e}))}))}),[]),p=Object(r.useCallback)((function(e){var t=fe(e,void 0,void 0,!0);return c((function(e){return[].concat(Object(K.a)(e),Object(K.a)(t))})),t}),[]),f=Object(r.useCallback)((function(e,t,n){var a=function(e,t){return{id:re.a.generate(),label:t,modified:Date.now(),builder:e,statement:t}}(e,t);if(n){var r=i.find((function(e){return e.id===n}));r&&(a.id=r.id,c((function(e){return[].concat(Object(K.a)(e.filter((function(e){return e.id!==r.id}))),[a])})))}else c((function(e){return[].concat(Object(K.a)(e),[a])}));return[a]}),[i]);return o.a.createElement(me.Provider,{value:{criteria:i,addCriteria:s,addCqlCriteria:u,deleteCriteria:m,addElmCriteria:p,addBuilderCriteria:f}},t)})),ge=function(){return Object(r.useContext)(me)},ye=Object(r.createContext)({}),Ee=Object(r.memo)((function(e){var t=e.children,n=Q([]),a=Object(d.a)(n,3),i=a[0],c=a[1],l=a[2],u=$(J.a.get("demoPathwaysService")),s=u.payload,m=ge().addCqlCriteria,p=Object(r.useCallback)((function(e){l((function(t){return[].concat(Object(K.a)(t),[e])}))}),[l]),f=Object(r.useCallback)((function(e){e.library.forEach((function(e){return m(e)}))}),[m]),b=Object(r.useCallback)((function(e){var t=new FileReader;t.onload=function(e){var t;if(null===(t=e.target)||void 0===t?void 0:t.result){var n=e.target.result,a=JSON.parse(n);l((function(e){return e.map((function(e){return e.id})).includes(a.id)?(alert("Pathway with that id already exists!"),e):(f(a),[].concat(Object(K.a)(e),[a]))}))}else alert("Unable to read that file")},t.readAsText(e)}),[f,l]),h=Object(r.useCallback)((function(e){l((function(t){return t.filter((function(t){return t.id!==e}))}))}),[l]),v=Object(r.useCallback)((function(e){var t=c.current.findIndex((function(t){return t.id===e.id}));l((function(n){return[].concat(Object(K.a)(n.slice(0,t)),[e],Object(K.a)(n.slice(t+1)))}))}),[c,l]);switch(Object(r.useEffect)((function(){s&&l(s)}),[s,l]),u.status){case"error":return o.a.createElement("div",null,"Error loading pathways");default:return o.a.createElement(ye.Provider,{value:{pathways:i,addPathway:p,addPathwayFromFile:b,deletePathway:h,updatePathway:v,status:u.status}},t)}})),Ce=function(){return Object(r.useContext)(ye)},Oe=n(341),je=n(117),ke=n(182),xe=n(183),we=n(1567);function Se(e){return e&&"null"!==e.type?e.type:"null"}function Ne(e){return"action"===e.type}function Te(e){return"branch"===e.type}var Ie={MedicationRequest:"Medication",ServiceRequest:"Procedure",CarePlan:"Regimen"},Re=[{label:"Medication",value:"MedicationRequest"},{label:"Procedure",value:"ServiceRequest"},{label:"Regimen",value:"CarePlan"},{label:"Observation",value:"Observation"},{label:"Pathway Reference",value:"Reference"}];function Be(e,t){var n=De(e,t);return 1===n.length?n[0]:null}function De(e,t){var n=[];return Object.keys(e).forEach((function(a){var r,o=Object(je.a)(e[a].transitions);try{for(o.s();!(r=o.n()).done;){if(r.value.transition===t){n.push(a);break}}}catch(i){o.e(i)}finally{o.f()}})),n}function Pe(e){return JSON.parse(JSON.stringify(e))}function Le(e,t){var n=function(e){return JSON.parse(JSON.stringify(e))}(e);return n.key=t,n}function Me(e,t){var n=0;return Object.keys(e.nodes).forEach((function(a){e.nodes[a].transitions.forEach((function(e){e.transition===t&&(n+=1)}))})),!(n>=2)}function Ae(e,t){var n=!0;return t.forEach((function(t){Me(e,t.transition)&&(n=!1)})),n}function Fe(e,t,n){var a="/demo/builder/".concat(encodeURIComponent(e),"/node/").concat(encodeURIComponent(t));a!==n.location.pathname&&n.push(a)}var qe=function(e){var t;switch(e.resource.resourceType){case"MedicationRequest":t=e.resource.medicationCodeableConcept;break;case"ServiceRequest":t=e.resource.code;break;case"CarePlan":t={coding:[{system:"FakeCarePlanSystem",code:e.resource.title,display:"Fake CodeableConcept for CarePlan"}],text:"Fake CodeableConcept for CarePlan"}}return t},ze=n(155),We=n(207);function _e(e,t,n,a){var r=Object.entries(t).map((function(e){var t=Object(d.a)(e,2),n=t[0],a=t[1];return'include "'.concat(n,"\" version '").concat(a.version,"' called ").concat(n,"\n\n")})).join(""),o=Object.entries(n).map((function(e){var t=Object(d.a)(e,2),n=t[0],a=t[1];return'define "'.concat(n,'": ').concat(a,".").concat(n,"\n\n")}));Object.entries(a).forEach((function(e){var t=Object(d.a)(e,2),n=t[0],a=t[1];return o.push('define "'.concat(n,'": ').concat(a,"\n\n"))}));var i=o.join("");return"\nlibrary ".concat(e," version '1.0'\n\nusing FHIR version '4.0.1'\n\n").concat(r,"\n\ncontext Patient\n\n").concat(i,"\n")}var He=ze.R4.LibraryStatusKind._draft,Ge=ze.R4.PlanDefinitionStatusKind._draft,Ue=ze.R4.ActivityDefinitionStatusKind._draft,Ke=ze.R4.BundleTypeKind._transaction,Je=ze.R4.Bundle_RequestMethodKind._put,Ve=ze.R4.PlanDefinition_ConditionKindKind._applicability,Ye=ze.R4.ExpressionLanguageKind._textCql,$e=We.PlanDefinition_RelatedActionRelationshipKind._beforeStart,Qe=We.PlanDefinition_RelatedActionRelationshipKind._afterEnd,Xe=function(){function e(t,n,a){Object(ke.a)(this,e),this.pathway=void 0,this.pathways=void 0,this.bundle=void 0,this.criteria=void 0,this.nestedBranch=void 0,this.libraries=void 0,this.activityDefinitions=void 0;var r=Pe(t);r.nodes=at(r.nodes),this.pathway=r,this.bundle={id:this.pathway.id,resourceType:"Bundle",type:Ke,entry:[]},this.criteria=a,this.nestedBranch=[],this.activityDefinitions={},this.libraries=[],this.pathways=n}return Object(xe.a)(e,[{key:"export",value:function(){var e=this.createPlanDefinition(Object(we.a)(),"Strategy".concat(this.pathway.name),"Strategy for ".concat(this.pathway.name),"strategy");return this._export(e,this.pathway),this.bundle.entry.push(tt(e)),this.bundle}},{key:"_export",value:function(e,t,n,a){var r=this,o=nt(t.name,"Action for ".concat(t.name));(null===n||void 0===n?void 0:n.id)&&o.id&&(et(o,n.id,Qe),et(n,o.id,$e),a&&(o.condition=a)),e.action.find((function(e){return e.id===t.name}))||function(){for(var n=r.createLibraries(t),a=n[0],i=Object(we.a)(),c=r.createPlanDefinition(i,t.name,t.description,"recommendation",a.id),l=["Start"],u=[],d=function(){var a=l.shift(),i=t.nodes[a],d=Be(t.nodes,a);if(d&&!u.includes(d))return l.filter((function(e){return e!==d})),l.unshift(d),l.push(a),"continue";d&&r.convertNode(a,d,c,e,t,o,n),u.push(a),i.transitions.forEach((function(e){u.includes(e.transition)||l.includes(e.transition)||l.push(e.transition)}))};0!==l.length;)d();c.action.length&&(o.definitionCanonical=Ze("PlanDefinition",i),r.bundle.entry.push(tt(c))),e.action.push(o),n.forEach((function(e){var t=e.content[0].data;!r.libraries.find((function(e){return e===t}))&&t&&(r.bundle.entry.push(tt(e)),r.libraries.push(t))}))}()}},{key:"createActivityDefinition",value:function(e){var t=Object(we.a)(),n=e.resource.resourceType,a=qe(e),r=a.coding[0];if(this.activityDefinitions[r.system]&&this.activityDefinitions[r.system][r.code])return null;var o={id:t,resourceType:"ActivityDefinition",meta:{profile:["http://hl7.org/fhir/uv/cpg/StructureDefinition/cpg-publishableactivity"]},extension:[{url:"http://hl7.org/fhir/uv/cpg/StructureDefinition/cpg-knowledgeCapability",valueCode:"publishable"}],url:"urn:uuid:".concat(t),version:"1.0",name:"AD".concat(t.substring(0,7)),title:"ActivityDefinition: ".concat(t),status:Ue,experimental:!0,date:(new Date).toISOString(),publisher:"Logged in user",description:e.description,kind:n};switch(n){case"MedicationRequest":o.productCodeableConcept=a;break;case"ServiceRequest":case"CarePlan":o.code=a}return this.setActivityDefinitionId(r,t),o}},{key:"createPlanDefinition",value:function(e,t,n,a,r){var o={id:e,resourceType:"PlanDefinition",meta:{profile:["http://hl7.org/fhir/uv/cpg/StructureDefinition/cpg-".concat(a,"definition")]},extension:[{url:"http://hl7.org/fhir/uv/cpg/StructureDefinition/cpg-knowledgeCapability",valueCode:"executable"}],url:"urn:uuid:".concat(e),version:"1.0",name:"PD".concat(e.substring(0,7)),title:t,type:{coding:[{system:"http://terminology.hl7.org/CodeSystem/plan-definition-type",code:"strategy"===a?"workflow-definition":"eca-rule",display:"strategy"===a?"Workflow Definition":"ECA Rule"}]},status:Ge,experimental:!0,publisher:"Logged in user",description:n,action:[]};return r&&(o.library=[r]),o}},{key:"createLibraries",value:function(e){var t=this,n=Object(we.a)(),a="LIB".concat(n.substring(0,7)),r={id:n,resourceType:"Library",meta:{profile:["http://hl7.org/fhir/uv/cpg/StructureDefinition/cpg-executablelibrary"]},extension:[{url:"http://hl7.org/fhir/uv/cpg/StructureDefinition/cpg-knowledgeCapability",valueCode:"executable"}],url:"urn:uuid:".concat(n),version:"1.0",name:a,title:"Library for ".concat(e.name),status:He,experimental:!0,type:{coding:[{system:"http://terminology.hl7.org/CodeSystem/library-type",code:"logic-library",display:"Logic Library"}]},publisher:"Logged in user",description:"CQL/ELM library for pathway: ".concat(e.name),content:[]},o={},i={},c={};for(var l in e.nodes){var u,s=e.nodes[l],m=Object(je.a)(s.transitions);try{var p=function(){var e,n=u.value;if(null===(e=n.condition)||void 0===e?void 0:e.criteriaSource){var a=t.criteria.find((function(e){var t;return e.id===(null===(t=n.condition)||void 0===t?void 0:t.criteriaSource)}));if((null===a||void 0===a?void 0:a.elm)&&(null===a||void 0===a?void 0:a.cql)){var r=a.elm.library.identifier;o[r.id]={cql:a.cql,version:r.version},i[n.condition.cql]=r.id,(null===a||void 0===a?void 0:a.cqlLibraries)&&Object.entries(a.cqlLibraries).forEach((function(e){var t=Object(d.a)(e,2),n=t[0],a=t[1];a.cql&&(o[n]={cql:a.cql,version:(null===a||void 0===a?void 0:a.version)||""},i[a.cql]=n)}))}else(null===a||void 0===a?void 0:a.builder)&&(c[a.statement]=a.builder.cql)}};for(m.s();!(u=m.n()).done;)p()}catch(h){m.e(h)}finally{m.f()}}var f=Object.entries(o).map((function(t){var n=Object(d.a)(t,2),a=n[0],r=n[1],o=Object(we.a)();return{id:o,resourceType:"Library",url:"urn:uuid:".concat(o),version:r.version,name:a,title:a,status:He,experimental:!0,type:{coding:[{system:"http://terminology.hl7.org/CodeSystem/library-type",code:"logic-library",display:"Logic Library"}]},publisher:"Logged in user",description:"CQL/ELM library for pathway: ".concat(e.name," / sublibrary ").concat(a),content:[{id:a,contentType:"text/cql",data:btoa(r.cql),title:"CQL for library ".concat(a)}]}})),b=_e(a,o,i,c);return r.content.push({id:"navigational-cql",contentType:"text/cql",data:btoa(b),title:"CQL for navigating the pathway"}),e.elm&&r.content.push({id:"navigational-elm",contentType:"application/elm+json",data:btoa(JSON.stringify(e.elm.navigational)),title:"ELM for navigating the pathway"},{id:"precondition",contentType:"application/elm+json",data:btoa(JSON.stringify(e.elm.preconditions)),title:"ELM for pathway preconditions"}),[r].concat(Object(K.a)(f))}},{key:"convertNode",value:function(e,t,n,a,r,o,i){var c=r.nodes[e],l=r.nodes[t],u="".concat(c.label," (Key: ").concat(e,") - Parent Node Key: ").concat(t);if(Ne(c)){var d=this.createActivityDefinition(c.action),s=nt(e,"Action for ".concat(u),d?d.id:this.getActivityDefinitionId(c.action));Te(l)&&(s.condition=this.createCondition(l,e,i));for(var m=l;Te(m);){var p=Be(r.nodes,m.key);if(!p)break;m=r.nodes[p]}"Start"!==m.key&&et(s,m.key,Qe),function e(t,n){var a=[];return t[n].transitions.map((function(e){return e.transition})).forEach((function(n){Ne(t[n])?a.push(n):a.push.apply(a,Object(K.a)(e(t,n)))})),a}(r.nodes,e).forEach((function(e){return et(s,e,$e)})),this.addActionToPlanDefinition(s,n,l.key),d&&this.bundle.entry.push(tt(d))}else if(Te(c)){var f="Branch based on ".concat(u);if(Te(l)){var b=nt(e,f);b.condition=this.createCondition(l,e,i),this.nestedBranch.push(e),this.addActionToPlanDefinition(b,n,l.key)}}else if(function(e){return"reference"===e.type}(c)){var h=this.pathways.find((function(e){return e.id===c.referenceId}));if(h){var v=Pe(h);if(v.nodes=at(v.nodes),Te(l)){var g=this.createCondition(l,e,i);this._export(a,v,o,g)}else this._export(a,v,o)}}else if("start"!==c.type){var y="Error Exporting at Node ".concat(c.label,"\n").concat(c.label," Node does not have a node type. Please edit the node to have a node type and add applicable details and try again.");throw alert(y),console.error("".concat(y,"\n").concat(JSON.stringify(c,void 0,2))),y}}},{key:"createCondition",value:function(e,t,n){var a=n[0],r=function(e,t){return e.transitions.find((function(e){return e.transition===t}))}(e,t);if(r){var o=this.criteria.find((function(e){var t;return e.id===(null===(t=r.condition)||void 0===t?void 0:t.criteriaSource)}));return[{kind:Ve,expression:{language:Ye,expression:"".concat(a.name,".").concat(null===o||void 0===o?void 0:o.statement)}}]}return[]}},{key:"getActivityDefinitionId",value:function(e){var t=qe(e).coding[0];return this.activityDefinitions[t.system][t.code]}},{key:"setActivityDefinitionId",value:function(e,t){this.activityDefinitions[e.system]||(this.activityDefinitions[e.system]={}),this.activityDefinitions[e.system][e.code]=t}},{key:"addActionToPlanDefinition",value:function(e,t,n){if(this.nestedBranch.includes(n)){var a,r=function e(t,n){var a,r=Object(je.a)(t);try{for(r.s();!(a=r.n()).done;){var o=a.value;if(o.id===n)return o;if(o.action){var i=e(o.action,n);if(i)return i}}}catch(c){r.e(c)}finally{r.f()}return}(t.action,n);if(!r)return;(null===(a=r.action)||void 0===a?void 0:a.length)?r.action.push(e):r.action=[e]}else t.action.push(e)}}]),e}();function Ze(e,t){return"http://example.com/".concat(e,"/").concat(t)}function et(e,t,n){var a,r={actionId:t,relationship:n};(null===(a=e.relatedAction)||void 0===a?void 0:a.length)?e.relatedAction.push(r):e.relatedAction=[r]}function tt(e){return{fullUrl:Ze(e.resourceType,e.id),resource:e,request:{method:Je,url:"/".concat(e.resourceType,"/").concat(e.id)}}}function nt(e,t,n){var a={id:e,title:"Action: ".concat(e),description:t,code:[{coding:[{system:"http://hl7.org/fhir/uv/cpg/CodeSystem/cpg-common-process",code:"guideline-based-care",display:"Guideline-based Care"}]}]};return n&&(a.definitionCanonical=Ze("ActivityDefinition",n)),a}function at(e){var t=e;return Object.keys(e).forEach((function(n){var a=function(e,t){var n=[];return De(e,t).forEach((function(a){e[a].transitions.forEach((function(e){e.transition===t&&n.push(e)}))})),n}(e,n);a.length>1&&(a.shift(),a.forEach((function(a){var r=function(e,t){var n={},a={},r=function(e){return e.transitions.map((function(e){return e.transition}))},o=t,i=re.a.generate();a[o]=i,n[i]=Le(e[o],i);for(var c=r(e[o]),l=[o];c.length;)o=c.shift(),l.includes(o)||(i=re.a.generate(),a[o]=i,n[i]=Le(e[o],i),c.push.apply(c,Object(K.a)(r(e[o]))),l.push(o));return Object.keys(n).forEach((function(e){n[e].transitions.forEach((function(e){return e.transition=a[e.transition]}))})),n}(e,n);r=at(r),a&&(a.transition=r[Object.keys(r)[0]].key,Object.keys(r).forEach((function(e){return t[e]=r[e]})))})))})),t}var rt=function(){function e(t,n){Object(ke.a)(this,e),this.pathway=void 0,this.criteria=void 0,this.pathway=Pe(t),this.criteria=n}return Object(xe.a)(e,[{key:"export",value:function(){var e=this,t=Object(we.a)(),n="LIB".concat(t.substring(0,7)),a={},r={},o={};for(var i in this.pathway.nodes){var c,l=this.pathway.nodes[i],u=Object(je.a)(l.transitions);try{var s=function(){var t,i=c.value;if(null===(t=i.condition)||void 0===t?void 0:t.criteriaSource){var l=e.criteria.find((function(e){var t;return e.id===(null===(t=i.condition)||void 0===t?void 0:t.criteriaSource)}));if((null===l||void 0===l?void 0:l.elm)&&(null===l||void 0===l?void 0:l.cql)){var u=l.elm.library.identifier;a[u.id]={cql:l.cql,version:u.version},r[i.condition.cql]=u.id,(null===l||void 0===l?void 0:l.cqlLibraries)&&Object.entries(l.cqlLibraries).forEach((function(e){var t=Object(d.a)(e,2),n=t[0],o=t[1];o.cql&&(a[n]={cql:o.cql,version:(null===o||void 0===o?void 0:o.version)||""},r[o.cql]=n)})),i.condition.cql.startsWith(u.id)||(i.condition.cql="".concat(u.id,".").concat(i.condition.cql))}else(null===l||void 0===l?void 0:l.builder)&&(o[l.statement]=l.builder.cql,i.condition.cql="".concat(n,".").concat(i.condition.cql))}};for(u.s();!(c=u.n()).done;)s()}catch(b){u.e(b)}finally{u.f()}}var m=[];if(Object.keys(o).length>0){var p=_e(n,{},{},o);m.push(p)}if(Object.keys(a).length>0){var f=Object.values(a).map((function(e){return e.cql}));m.push.apply(m,Object(K.a)(f))}return this.pathway.library=m,this.pathway}}]),e}();function ot(e,t){var n=!1,r=t.map((function(e){return e.id})),o=Object(a.a)(e,(function(e){Object.entries(e.nodes).forEach((function(a){var o=Object(d.a)(a,2),i=o[0];o[1].transitions.forEach((function(a,o){var c=a.condition;if(c&&!r.includes(c.criteriaSource)){var l,u=c.cql.split("."),s=Object(d.a)(u,2),m=s[0],p=s[1],f=null===(l=t.find((function(e){var t;return(null===(t=e.elm)||void 0===t?void 0:t.library.identifier.id)===m&&e.statement===p})))||void 0===l?void 0:l.id;if(f){var b=e.nodes[i].transitions[o].condition;b&&(n=!0,b.criteriaSource=f)}}}))}))}));return{updated:n,newPathway:o}}function it(e,t){return e.map((function(e){return ot(e,t).newPathway}))}function ct(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if((e=it(e,n)).length>1){var r=new ie.a;return e.forEach((function(e){r.file("".concat(e.name,".json"),ut(e,t,n,a))})),r.generateAsync({type:"blob"}).then((function(e){lt(e,"pathways.zip")}))}var o=ut(e[0],t,n,a),i=new Blob([o],{type:"application/json"});return lt(i,"".concat(e[0].name,".json")),Promise.resolve()}function lt(e,t){var n=window.URL.createObjectURL(e),a=document.createElement("a");a.href=n,a.download=t,a.click(),window.URL.revokeObjectURL(n)}function ut(e,t,n,r){var o=function(e,t){return Object(a.a)(e,(function(e){e.elm||(e.elm={}),e.elm.navigational=t}))}(e,function(e){var t={library:{identifier:{id:e.id,version:"1.0.0"},schemaIdentifier:{id:"urn:hl7-org:elm",version:"r1"},usings:{def:[{localIdentifier:"System",uri:"urn:hl7-org:elm-types:r1"},{localId:"1",locator:"3:1-3:26",localIdentifier:"FHIR",uri:"http://hl7.org/fhir",version:"4.0.0"}]},statements:{def:[{locator:"13:1-13:15",name:"Patient",context:"Patient",expression:{type:"SingletonFrom",operand:{locator:"13:1-13:15",dataType:"{http://hl7.org/fhir}Patient",type:"Retrieve"}}}]},includes:{def:[]},valueSets:{def:[]},codes:{def:[]},codeSystems:{def:[]}}};return Object.keys(e.nodes).forEach((function(n){var r=e.nodes[n];if("elm"in r&&r.elm){dt(t,r.elm);var o=Object(a.a)(st(r.elm),(function(e){e.name=r.key}));t.library.statements.def.push(o)}r.transitions.forEach((function(e){var n;if(null===(n=e.condition)||void 0===n?void 0:n.elm){dt(t,e.condition.elm);var r=Object(a.a)(st(e.condition.elm),(function(t){var n,a;t.name=null!==(n=null===(a=e.condition)||void 0===a?void 0:a.description)&&void 0!==n?n:"Unknown"}));t.library.statements.def.push(r)}}))})),t}(e)),i=o;r?i=new Xe(o,t,n).export():i=new rt(o,n).export();return JSON.stringify(i,void 0,2)}function dt(e,t){var n,a,r,o,i;null===(n=t.library.usings)||void 0===n||n.def.forEach((function(t){var n,a;(null===(n=e.library.usings)||void 0===n?void 0:n.def.find((function(e){return e.uri===t.uri})))||null===(a=e.library.usings)||void 0===a||a.def.push(t)})),null===(a=t.library.includes)||void 0===a||a.def.forEach((function(t){var n,a;(null===(n=e.library.includes)||void 0===n?void 0:n.def.find((function(e){return e.path===t.path})))||null===(a=e.library.includes)||void 0===a||a.def.push(t)})),null===(r=t.library.valueSets)||void 0===r||r.def.forEach((function(t){var n,a;(null===(n=e.library.valueSets)||void 0===n?void 0:n.def.find((function(e){return e.id===t.id})))||null===(a=e.library.valueSets)||void 0===a||a.def.push(t)})),null===(o=t.library.codes)||void 0===o||o.def.forEach((function(t){var n,a;(null===(n=e.library.codes)||void 0===n?void 0:n.def.find((function(e){return e.name===t.name})))||null===(a=e.library.codes)||void 0===a||a.def.push(t)})),null===(i=t.library.codeSystems)||void 0===i||i.def.forEach((function(t){var n,a;(null===(n=e.library.codeSystems)||void 0===n?void 0:n.def.find((function(e){return e.name===t.name})))||null===(a=e.library.codeSystems)||void 0===a||a.def.push(t)}))}function st(e){var t=["Patient","MeetsInclusionCriteria","InPopulation","Recommendation","Rationale","Errors"];return e.library.statements.def.find((function(e){return!t.includes(e.name)}))}function mt(e,t,n){switch(n){case"MedicationRequest":return pt(ht(e,t),t,{type:"create",description:"",id:re.a.generate(),resource:{resourceType:n,medicationCodeableConcept:{coding:[{system:"",code:"",display:""}]}}});case"ServiceRequest":return pt(ht(e,t),t,{type:"create",description:"",id:re.a.generate(),resource:{resourceType:n,code:{coding:[{system:"",code:"",display:""}]}}});case"CarePlan":return pt(ht(e,t),t,{type:"create",description:"",id:re.a.generate(),resource:{resourceType:n,title:""}});case"Observation":return function(e,t){return Object(a.a)(e,(function(e){var n=e.nodes[t],a={key:n.key,label:n.label,transitions:n.transitions,type:"branch"};e.nodes[t]=a}))}(e,t);case"Reference":return function(e,t){return Object(a.a)(e,(function(e){var n=e.nodes[t],a={key:n.key,label:n.label,transitions:n.transitions,referenceId:"",referenceLabel:"",type:"reference"};e.nodes[t]=a}))}(e,t);default:return console.error("Unknown nodeType: "+n),e}}function pt(e,t,n){return Object(a.a)(e,(function(e){e.nodes[t].action=n}))}function ft(e,t,n){return Object(a.a)(e,(function(e){var a={id:re.a.generate(),transition:n};e.nodes[t].transitions.push(a)}))}function bt(e,t,n,r,o){return Object(a.a)(e,(function(e){var a,i,c=null===(a=e.nodes[t])||void 0===a||null===(i=a.transitions)||void 0===i?void 0:i.find((function(e){return e.id===n}));c&&(c.condition={description:r,cql:o.statement,elm:o.elm,criteriaSource:o.id})}))}function ht(e,t){return Object(a.a)(e,(function(e){var n=e.nodes[t];n.type="action",void 0===n.cql&&void 0===n.action&&(n.cql=""),n.transitions.forEach((function(e){delete e.condition}))}))}var vt=Object(r.createContext)({}),gt=Object(r.memo)((function(e){var t=e.children,n=U(null),a=Object(d.a)(n,8),i=a[0],c=a[1],l=a[2],u=a[3],s=a[4],m=a[5],p=a[6],f=a[7],b=ge().criteria,h=Ce().updatePathway,v=Object(r.useCallback)((function(){s()}),[s]),g=Object(r.useCallback)((function(){m()}),[m]),y=Object(r.useCallback)((function(e){p(e)}),[p]),E=Object(r.useCallback)((function(e){f(e)}),[f]);return Object(r.useEffect)((function(){i&&h(i)}),[i,h]),Object(r.useEffect)((function(){if(i){var e=ot(i,b),t=e.updated,n=e.newPathway;t&&y(n)}}),[b,i,y]),o.a.createElement(vt.Provider,{value:{pathway:i,pathwayRef:c,canUndoPathway:l,canRedoPathway:u,undoPathway:v,redoPathway:g,resetCurrentPathway:y,setCurrentPathway:E}},o.a.createElement(Oe.a,{keyName:"control+z,command+z",onKeyDown:v},o.a.createElement(Oe.a,{keyName:"control+y,command+y",onKeyDown:g},t)))})),yt=function(){return Object(r.useContext)(vt)},Et=function(e){var t=e.pathway,n=e.allPathways,a=e.criteria,r=e.anchorEl,i=e.closeMenu;return o.a.createElement(p.a,{id:"pathway-options-menu",anchorEl:r,getContentAnchorEl:null,anchorOrigin:{vertical:"bottom",horizontal:"left"},keepMounted:!0,open:Boolean(r),onClose:i},o.a.createElement(f.a,{onClick:function(){t?ct(t,n,a):alert("No pathway to download!"),i()}},"Export Pathway",(null===t||void 0===t?void 0:t.length)&&t.length>1?"s":""),o.a.createElement(f.a,{onClick:function(){t?ct(t,n,a,!0):alert("No pathway to download!"),i()}},"Export to CPG"))},Ct=function(e){var t=e.anchorEl,n=e.closeMenu,a=yt().pathway,r=Ce().pathways,i=ge().criteria;return o.a.createElement(Et,{pathway:a?[a]:null,allPathways:r,criteria:i,anchorEl:t,closeMenu:n})},Ot=Object(r.memo)(Et),jt=function(){var e=v().resetCurrentCriteria,t=Object(r.useState)(null),n=Object(d.a)(t,2),a=n[0],i=n[1],c=yt(),l=c.pathway,p=c.canUndoPathway,f=c.canRedoPathway,b=c.undoPathway,h=c.redoPathway,g=H(),y=Object(u.g)(),E=Object(r.useCallback)((function(e){i(e.currentTarget)}),[]),C=Object(r.useCallback)((function(){i(null)}),[]),O=Object(r.useCallback)((function(){e(),y.push("/demo/")}),[y,e]);return o.a.createElement("nav",{className:g.root},o.a.createElement("div",null,o.a.createElement(z.a,{className:g.backButton,onClick:O,"aria-label":"go back"},o.a.createElement(s.a,{icon:m.f,className:g.navigationIcons})),o.a.createElement("span",{className:g.pathwayName},null===l||void 0===l?void 0:l.name)),o.a.createElement("div",null,o.a.createElement(W.a,{placement:"top",title:"Undo",arrow:!0},o.a.createElement("span",null,o.a.createElement(z.a,{onClick:b,disabled:!p,"aria-label":"undo"},o.a.createElement(s.a,{icon:m.F,className:g.navigationIcons})))),o.a.createElement(W.a,{placement:"top",title:"Redo",arrow:!0},o.a.createElement("span",null,o.a.createElement(z.a,{onClick:h,disabled:!f,"aria-label":"redo"},o.a.createElement(s.a,{icon:m.x,className:g.navigationIcons})))),o.a.createElement(z.a,{onClick:E,"aria-controls":"pathway-options-menu","aria-haspopup":"true"},o.a.createElement(s.a,{icon:m.j,className:g.navigationIcons})),o.a.createElement(Ct,{anchorEl:a,closeMenu:C})))},kt=Object(_.a)((function(e){return{root:{display:"flex",flexDirection:"column",padding:e.variables.spacing.globalPadding,color:e.palette.text.primary,backgroundColor:e.palette.common.gray,width:"33%",minWidth:"550px",overflowY:"scroll"},formControl:{margin:e.spacing(1,0),minWidth:375},referenceDropdown:{display:"flex"},referenceChevron:{fontSize:"2em",marginLeft:"1em",lineHeight:"2.5em",cursor:"pointer","&:hover":{color:e.palette.common.grayLightest}},divider:{width:"100%"},headerLabelStart:{cursor:"default"},displayText:{margin:"0 0 5px 0",fontWeight:900,fontSize:"1em"},sidebarHeader:{display:"flex",justifyContent:"space-between"},sidebarHeaderGroup:{display:"flex",alignItems:"center"},sidebarHeaderButton:{height:"45px",width:"45px",color:e.palette.text.primary},headerLabelGroup:{display:"flex",cursor:"pointer",height:"60px"},headerLabel:{display:"flex",alignItems:"center",fontSize:"1.6em",fontWeight:700,margin:"0 5px"},headerLabelText:{marginBottom:"5px"},editIcon:{fontSize:"0.6em",marginLeft:"10px"},sidebarButtonGroup:{display:"flex",margin:"10px 0"},sidebarButtonGroupExtraMargin:{display:"flex",margin:"20px 0 10px 0"},sidebarButton:{minWidth:180,marginRight:"20px"},sidebarButtonText:{fontStyle:"italic"},outlinedDiv:{display:"flex",flexDirection:"column",alignItems:"flex-start"},outlinedDivError:{borderColor:"".concat(e.palette.error.main," !important"),"&:hover":{borderColor:"".concat(e.palette.error.main," !important")}},toggleSidebar:{display:"inline-flex",alignItems:"center",justifyContent:"center",float:"left",width:"50px",minWidth:"50px",height:"50px",fontSize:"2em",backgroundColor:e.palette.primary.main,color:e.palette.text.primary,"&:hover":{cursor:"pointer"}},cancelButton:{alignSelf:"flex-end",marginTop:"5px",padding:"5px 15px",fontSize:"1em"},editButton:{marginLeft:"1em",alignSelf:"flex-end",marginTop:"5px",padding:"5px 15px",fontSize:"1em",backgroundColor:e.palette.primary.main,borderColor:e.palette.primary.main,"&:hover":{backgroundColor:e.palette.primary.main,borderColor:e.palette.primary.main}},buildCriteriaContainer:{display:"flex",justifyContent:"flex-end"},buildCriteriaText:{marginTop:"0.5em",marginBottom:"1em"},saveButton:{marginLeft:"1em",backgroundColor:e.palette.error.main,borderColor:e.palette.error.main,"&:hover":{backgroundColor:e.palette.error.main}},transitionContainer:{backgroundColor:e.palette.common.grayVeryDark,padding:"5px 15px",margin:"15px 0"},dividerHeader:{width:"100%",textTransform:"uppercase",borderBottom:"1px solid "+e.palette.common.blueLighter,color:e.palette.common.blueLighter,lineHeight:"0.1em",margin:"10px 0 20px",fontWeight:800,paddingLeft:"15px","& span":{background:e.palette.common.gray,padding:"0 10px"}},dialogCloseButton:{float:"right",width:"45px"},dialogContent:{color:e.palette.common.black,fontSize:"16px",display:"flex",marginTop:"-25px"},dialogContentText:{paddingLeft:"10px",lineHeight:"40px"},alertIcon:{color:e.palette.common.red,fontSize:"40px"},connectDropdown:{margin:"auto",display:"flex",flexDirection:"column",flexWrap:"nowrap",alignContent:"center"},connectText:{display:"flex",flexDirection:"row",alignItems:"center",fontSize:"0.95em",fontStyle:"italic"},cancelButtonDropdown:{marginLeft:"auto",border:"none",alignSelf:"center",color:e.palette.common.blueLighter,fontSize:"1em",fontStyle:"italic",textTransform:"none"},criteriaText:{width:"100%"}}}),{name:"Sidebar",index:1}),xt=n(1571),wt=n(1546),St=n(1573),Nt=n(1565),Tt=n(1564),It=Object(r.memo)((function(e){var t=e.id,n=e.label,a=e.options,i=e.value,c=e.onChange,l=e.autocomplete,u=void 0===l||l,d=Object(r.useCallback)((function(e){c&&c(e.target.value||"")}),[c]),p=Object(r.useCallback)((function(e,t){c&&t&&c(t.value)}),[c]),b=function(e){return a.find((function(t){return t.value===e}))};return o.a.createElement(o.a.Fragment,null,u?o.a.createElement(Tt.a,{fullWidth:!0,onChange:p,value:b(i)||null,popupIcon:o.a.createElement(s.a,{icon:m.c,style:{color:"white"}}),options:a,getOptionLabel:function(e){return e.label},renderOption:function(e){return o.a.createElement("div",{key:e.value,style:{color:"black"}},e.label)},renderInput:function(e){return o.a.createElement(xt.a,Object.assign({error:null==i||""===i},e,{variant:"outlined",label:n}))}}):o.a.createElement(wt.a,{variant:"outlined",fullWidth:!0},o.a.createElement(St.a,{id:t,htmlFor:"".concat(t,"-select")},n),o.a.createElement(Nt.a,{id:"".concat(t,"-select"),value:i||"",onChange:d,label:n,error:null==i||""===i,MenuProps:{getContentAnchorEl:null,anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"center"}},displayEmpty:!0},a.map((function(e){return o.a.createElement(f.a,{key:e.value,value:e.value},e.label)})))))})),Rt=n(1574),Bt=n(1548),Dt=Object(r.createContext)({}),Pt=Object(r.memo)((function(e){var t=e.children,n=Object(r.useState)(!1),a=Object(d.a)(n,2),i=a[0],c=a[1],l=Object(r.useState)("Deleted Successfully"),u=Object(d.a)(l,2),s=u[0],m=u[1],p=Object(r.useCallback)((function(){c(!1)}),[c]);return o.a.createElement(Dt.Provider,{value:{snackbarText:s,openSnackbar:i,handleCloseSnackbar:p,setSnackbarText:m,setOpenSnackbar:c}},t)})),Lt=function(){return Object(r.useContext)(Dt)},Mt=Object(r.memo)((function(){var e=yt().undoPathway,t=Lt(),n=t.snackbarText,a=t.openSnackbar,i=t.handleCloseSnackbar,c=Object(r.useCallback)((function(){e(),i()}),[e,i]);return o.a.createElement(Rt.a,{anchorOrigin:{vertical:"bottom",horizontal:"right"},open:a,autoHideDuration:1e4,onClose:i,message:n,action:o.a.createElement(o.a.Fragment,null,o.a.createElement(Bt.a,{color:"secondary",size:"small",onClick:c},"UNDO"),o.a.createElement(z.a,{size:"small","aria-label":"close",color:"inherit",onClick:i},o.a.createElement(s.a,{icon:m.C})))})})),At=function(e){var t=Object(u.h)().nodeId,n=decodeURIComponent(t);return null===e||void 0===e?void 0:e.nodes[n]},Ft=Object(r.memo)((function(e){var t=e.currentNode,n=yt(),a=n.pathway,i=n.pathwayRef,c=n.setCurrentPathway,l=At(i.current),u=kt(),s=Object(r.useState)(!1),p=Object(d.a)(s,2),f=p[0],b=p[1],h=t&&a?function(e,t){var n,a=[],r=function e(t,n,a){var r=[],o=[],i=t.nodes[a];return i.transitions.forEach((function(a){var c;a.transition===n?r.push(i):(null===(c=o=e(t,n,a.transition))||void 0===c?void 0:c.length)&&(r.some((function(e){return e.key===i.key}))||r.push(i),r=r.concat(o))})),r}(e,null!==(n=t.key)&&void 0!==n?n:"","Start");return r.push(t),Object.keys(e.nodes).forEach((function(n){var o=e.nodes[n],i=t.transitions.some((function(e){return e.transition===n})),c=r.some((function(e){return e.key===n}));i||c||!o.key||a.push({label:o.label,value:o.key})})),a}(a,t):[],v=h.length>0,g=Object(r.useCallback)((function(e){i.current&&l&&c(ft(i.current,l.key,e)),b(!1)}),[c,l,i]),y=Object(r.useCallback)((function(){b(!f)}),[f]);return o.a.createElement("div",null,!f&&o.a.createElement(Ht,{buttonName:"Connect Node",buttonIcon:m.q,buttonText:"Create a transition to an existing node in the pathway.",onClick:y,disabled:!v,hasTooltip:!v,tooltipTitle:"There are no possible nodes to connect to."}),f&&v&&o.a.createElement("div",{className:u.connectDropdown},o.a.createElement(It,{id:"transitions",label:"Node To Connect To",options:h,onChange:g}),o.a.createElement("div",{className:u.connectText},"Select node from list to add transition.",o.a.createElement(Bt.a,{className:u.cancelButtonDropdown,size:"small",variant:"text",onClick:y},"Cancel"))))})),qt=Object(r.memo)((function(e){var t=e.currentNode,n=yt(),i=n.pathway,c=n.pathwayRef,l=n.setCurrentPathway,p=At(i),f=Object(r.useState)(!0),b=Object(d.a)(f,2),h=b[0],v=b[1],g=kt(),y=Object(u.g)(),E=Object(r.useRef)(null),C=Object(r.useCallback)((function(){v(!h)}),[h]),O=Object(r.useCallback)((function(e){p&&c.current&&l(mt(c.current,p.key,e))}),[c,l,p]),j=Object(r.useCallback)((function(){if(p&&c.current){var e,t=(e||(e=re.a.generate()),{key:e,label:"New Node",transitions:[],type:"null"}),n=function(e,t){return Object(a.a)(e,(function(e){e.nodes[t.key]=t}))}(c.current,t);n=ft(n,p.key,t.key),l(n),Te(p)||Fe(c.current.id,t.key,y)}}),[c,l,p,y]);if(!i)return o.a.createElement("div",null,"Error: No pathway");if(!t)return o.a.createElement("div",null,"Error: No current node");if("start"===t.type)return o.a.createElement(o.a.Fragment,null,h&&o.a.createElement("div",{className:g.root,ref:E},o.a.createElement(_t,{node:t,isTransition:!1}),o.a.createElement("h5",{className:g.dividerHeader},o.a.createElement(o.a.Fragment,null)," "),o.a.createElement(Ht,{buttonName:"Add Node",buttonIcon:m.u,buttonText:"Add a new transition to a new node in the pathway.",onClick:j})),o.a.createElement("div",{className:g.toggleSidebar,onClick:C},o.a.createElement(s.a,{icon:h?m.f:m.g})),o.a.createElement(Mt,null));var k=Se(t),x="start"!==k||0===t.transitions.length;return o.a.createElement(o.a.Fragment,null,h&&o.a.createElement("div",{className:g.root,ref:E},o.a.createElement(_t,{node:t,isTransition:!1}),o.a.createElement("h5",{className:g.dividerHeader},o.a.createElement("span",null,"Details")),"null"===k&&o.a.createElement(It,{id:"nodeType",label:"Node Type",options:Re,onChange:O,value:""}),"reference"===k&&o.a.createElement(Kt,{changeNodeType:O,currentNode:t}),"action"===k&&o.a.createElement(Ut,{changeNodeType:O,currentNode:t}),"branch"===k&&o.a.createElement(It,{id:"nodeType",label:"Node Type",options:Re,onChange:O,value:"Observation"}),o.a.createElement("h5",{className:g.dividerHeader},o.a.createElement("span",null,"Transitions")),null===t||void 0===t?void 0:t.transitions.map((function(e){return o.a.createElement(un,{key:e.id,transition:e},"branch"===k&&o.a.createElement(Zt,{key:e.id,transition:e,currentNode:t}))})),x&&o.a.createElement(o.a.Fragment,null,o.a.createElement(Ht,{buttonName:"Add New Node",buttonIcon:m.u,buttonText:"Add a new transition to a new node in the pathway.",onClick:j}),o.a.createElement(Ft,{currentNode:t}))),o.a.createElement("div",{className:g.toggleSidebar,onClick:C},o.a.createElement(s.a,{icon:h?m.f:m.g})),o.a.createElement(Mt,null))})),zt=n(15),Wt=n(1544),_t=Object(r.memo)((function(e){var t=e.node,n=e.isTransition,i=void 0!==n&&n,c=Object(r.useState)(!1),l=Object(d.a)(c,2),p=l[0],f=l[1],b=Object(r.useState)(!1),h=Object(d.a)(b,2),v=h[0],g=h[1],y=Object(r.useState)(!1),E=Object(d.a)(y,2),C=E[0],O=E[1],j=Lt(),k=j.setSnackbarText,x=j.setOpenSnackbar,w=yt(),S=w.pathway,N=w.pathwayRef,T=w.setCurrentPathway,I=At(S),R=Object(r.useRef)(null),B=(null===t||void 0===t?void 0:t.label)||"",D=kt(),P=Object(u.g)(),L=Object(r.useCallback)((function(){if(N.current){var e=De(N.current.nodes,t.key);Fe(N.current.id,e[0],P)}}),[P,N,t.key]),M=Object(r.useCallback)((function(){N.current&&Fe(N.current.id,t.key,P)}),[P,N,t.key]),A=Object(r.useCallback)((function(){var e,n,r=null!==(e=null===(n=R.current)||void 0===n?void 0:n.value)&&void 0!==e?e:"";N.current&&T(function(e,t,n){return Object(a.a)(e,(function(e){e.nodes[t].label=n}))}(N.current,t.key,r)),f(!1)}),[N,T,t.key]),F=Object(r.useCallback)((function(){f(!0)}),[]),q=Object(r.useCallback)((function(){if(N.current&&Ae(N.current,t.transitions)){var e=De(N.current.nodes,t.key);T(function(e,t){return Object(a.a)(e,(function(e){delete e.nodes[t],Object.keys(e.nodes).forEach((function(n){e.nodes[n].transitions.forEach((function(a){a.transition===t&&(e.nodes[n].transitions=e.nodes[n].transitions.filter((function(e){return a.id!==e.id})))}))}))}))}(N.current,t.key)),Fe(N.current.id,e[0],P),O(!1),k("".concat(t.label," node deleted successfully")),x(!0)}}),[N,T,k,x,t.key,t.label,t.transitions,P]),_=Object(r.useCallback)((function(){I&&N.current&&!Me(N.current,t.key)&&(T(function(e,t,n){return Object(a.a)(e,(function(e){var a=e.nodes[t].transitions.filter((function(e){return e.transition!==n}));e.nodes[t].transitions=a}))}(N.current,I.key,t.key)),O(!1),k("Transition from ".concat(I.label," to ").concat(t.label," deleted successfully")),x(!0))}),[N,I,T,k,x,t]),H=Object(r.useCallback)((function(){O(!0)}),[]),G=Object(r.useCallback)((function(){O(!1)}),[]),U=Object(r.useCallback)((function(){g(!0)}),[]),K=Object(r.useCallback)((function(){g(!1)}),[]),J=Object(r.useCallback)((function(e){"Enter"===e.key&&A()}),[A]),V=!S||!Ae(S,t.transitions),Y=!S||Me(S,t.key),$=i?Y:V,Q=i?"Deleting this transition would result in an orphaned node. To delete, first add the child node as a transition to another node, or delete it directly.":"Deleting this node would result in an orphaned descendent node. To delete, first add another transition to the would-be orphaned node from another node, or delete it directly.";return o.a.createElement("div",{className:D.sidebarHeader},o.a.createElement("div",{className:D.sidebarHeaderGroup},"start"!==t.type&&!i&&o.a.createElement(z.a,{className:D.sidebarHeaderButton,onClick:L,"aria-label":"go to parent node"},o.a.createElement(s.a,{icon:m.f})),o.a.createElement("div",{className:D.headerLabelGroup,onClick:F},p&&"start"!==t.type?o.a.createElement(wt.a,{className:D.formControl,fullWidth:!0},o.a.createElement(Wt.a,{className:D.headerLabel,type:"text",inputRef:R,onBlur:A,onKeyPress:J,defaultValue:B,autoFocus:!0,onFocus:function(e){return e.target.select()}})):o.a.createElement("div",{className:Object(zt.a)(D.headerLabel,D.headerLabelText,"start"===t.type&&D.headerLabelStart)},B,"Start"!==t.key&&o.a.createElement(s.a,{className:D.editIcon,icon:m.i})))),o.a.createElement("div",{className:D.sidebarHeaderGroup},"start"!==t.type&&o.a.createElement(W.a,{placement:"top",open:!!$&&v,onClose:K,onOpen:U,title:Q,arrow:!0},o.a.createElement("span",null,o.a.createElement(z.a,{className:D.sidebarHeaderButton,onClick:H,"aria-label":i?"delete transition":"delete node",disabled:$},o.a.createElement(s.a,{icon:m.E})))),i&&o.a.createElement(z.a,{className:D.sidebarHeaderButton,onClick:M,"aria-label":"go to transition node"},o.a.createElement(s.a,{icon:m.g}))),o.a.createElement(cn,{nodeLabel:t.label,isTransition:i,open:C,onDelete:i?_:q,onClose:G}))})),Ht=Object(r.memo)((function(e){var t=e.buttonName,n=e.buttonIcon,a=e.buttonText,r=e.extraMargin,i=void 0!==r&&r,c=e.onClick,l=e.hasTooltip,u=void 0!==l&&l,d=e.tooltipTitle,m=void 0===d?"":d,p=e.disabled,f=void 0!==p&&p,b=e.buttonColor,h=void 0===b?"primary":b,v=kt(),g=function(e){var t=e.children;return u?o.a.createElement(W.a,{title:m,placement:"top"},o.a.createElement("span",null,t)):o.a.createElement(o.a.Fragment,null,t)};return o.a.createElement("div",{className:i?v.sidebarButtonGroupExtraMargin:v.sidebarButtonGroup},o.a.createElement(g,null,o.a.createElement(Bt.a,{className:v.sidebarButton,variant:"contained",color:h,startIcon:o.a.createElement(s.a,{icon:n}),onClick:c,disabled:f},t)),o.a.createElement("div",{className:v.sidebarButtonText},a))})),Gt=[{label:"ICD-9-CM",value:"http://hl7.org/fhir/sid/icd-9-cm"},{label:"ICD-10-CM",value:"http://hl7.org/fhir/sid/icd-10-cm"},{label:"LOINC",value:"http://loinc.org"},{label:"NCI",value:"http://ncimeta.nci.nih.gov"},{label:"RXNORM",value:"http://www.nlm.nih.gov/research/umls/rxnorm"},{label:"SNOMED",value:"http://snomed.info/sct"}],Ut=Object(r.memo)((function(e){var t=e.changeNodeType,n=e.currentNode,i=yt(),c=i.pathwayRef,l=i.setCurrentPathway,u=At(c.current),d=kt(),p=Object(r.useCallback)((function(e,t){c.current&&se(function(e,t){var n=e.resource,a="cql".concat(re.a.generate().replace(/-/g,"a")),r="library ".concat(a," version '1'\nusing FHIR version '4.0.0'\n"),o=function(e){return'codesystem "'.concat(e,"\": '").concat(e,"'\n")},i=function(e){return"return Tuple{ resourceType: '".concat(e,"', id: R.id.value, status: R.status.value}")},c=function(e){return"[".concat(e,': "').concat(a,' code"]')},l=function(){return'define "'.concat(t,'":')};if("MedicationRequest"===n.resourceType){var u=n.medicationCodeableConcept.coding[0];r+=o(u.system),r+='code "'.concat(a," code\": '").concat(escape(u.code),"' from \"").concat(u.system,"\" display '").concat(u.display,"'\n"),r+="".concat(l(),"\n      ").concat(c("MedicationRequest")," R ").concat(i("MedicationRequest"))}else if("ServiceRequest"===n.resourceType){var d=n.code.coding[0];r+=o(d.system),r+='code "'.concat(a," code\": '").concat(escape(d.code),"' from \"").concat(d.system,"\" display '").concat(d.display,"'\n"),r+="".concat(l(),"\n      if exists ").concat(c("Procedure"),"\n      then ").concat(c("Procedure")," R ").concat(i("Procedure"),"\n      else ").concat(c("ServiceRequest")," R ").concat(i("ServiceRequest"))}else"CarePlan"===n.resourceType?r+="".concat(l(),"\n      [CarePlan] R where R.title.value = '").concat(escape(n.title),"' ").concat(i("CarePlan")):console.error("Auto generating CQL for action - unsupported resource type: "+n.resourceType);return r}(e,t)).then((function(e){l(function(e,t,n){return Object(a.a)(e,(function(e){e.nodes[t].elm=n,e.nodes[t].cql=st(n).name}))}(c.current,t,e))}))}),[c,l]),f=Object(r.useCallback)((function(e){if(u.action&&c.current){var t=(null===e||void 0===e?void 0:e.target.value)||"",n=function(e,t){return Object(a.a)(e,(function(e){e.resource.medicationCodeableConcept?e.resource.medicationCodeableConcept.coding[0].code=t:e.resource.code.coding[0].code=t}))}(u.action,t);l(pt(c.current,u.key,y(n)))}}),[u,c,l]),b=Object(r.useCallback)((function(e){if(u.action&&c.current){var t=(null===e||void 0===e?void 0:e.target.value)||"",n=function(e,t){return Object(a.a)(e,(function(e){e.description=t}))}(u.action,t);l(pt(c.current,u.key,n))}}),[u,c,l]),h=Object(r.useCallback)((function(e){if(u.action&&c.current){var t=(null===e||void 0===e?void 0:e.target.value)||"",n=function(e,t){return Object(a.a)(e,(function(e){e.resource.title=t}))}(u.action,t);l(pt(c.current,u.key,y(n))),p(n,u.key)}}),[u,c,l,p]),v=Object(r.useCallback)((function(e){if(u.action&&c.current){var t=function(e,t){return Object(a.a)(e,(function(e){e.resource.medicationCodeableConcept?e.resource.medicationCodeableConcept.coding[0].system=t:e.resource.code.coding[0].system=t}))}(u.action,e);l(pt(c.current,u.key,y(t)))}}),[u,c,l]),g=Object(r.useCallback)((function(){var e=u;if(e.action&&c.current){var t=function(e,t){return Object(a.a)(e,(function(e){e.resource.medicationCodeableConcept?e.resource.medicationCodeableConcept.coding[0].display=t:e.resource.title?e.resource.description=t:e.resource.code.coding[0].display=t}))}(e.action,"Example Text");l(pt(c.current,e.key,t)),p(t,e.key)}else console.error("No Actions -- Cannot Validate")}),[u,c,l,p]),y=function(e){return Object(a.a)(e,(function(e){e.resource.medicationCodeableConcept?e.resource.medicationCodeableConcept.coding[0].display="":"CarePlan"===e.resource.resourceType?e.resource.description="":e.resource.code.coding[0].display=""}))},E=function(e){"Enter"===e.key&&g()},C=n.action;if(!C)return o.a.createElement(o.a.Fragment,null);var O=(null===n||void 0===n?void 0:n.key)&&"start"!==n.type,j=C.resource,k="",x="",w="";return"MedicationRequest"===j.resourceType||"ServiceRequest"===j.resourceType?(k=j.code?j.code.coding[0].system:j.medicationCodeableConcept.coding[0].system,x=j.code?j.code.coding[0].code:j.medicationCodeableConcept.coding[0].code,w=j.code?j.code.coding[0].display:j.medicationCodeableConcept.coding[0].display):w=j.description,o.a.createElement(o.a.Fragment,null,O&&o.a.createElement(o.a.Fragment,null,o.a.createElement(It,{id:"nodeType",label:"Node Type",options:Re,onChange:t,value:j.resourceType}),("MedicationRequest"===j.resourceType||"ServiceRequest"===j.resourceType)&&o.a.createElement(o.a.Fragment,null,o.a.createElement(It,{id:"codeSystem",label:"Code System",options:Gt,onChange:v,value:k}),k&&o.a.createElement(xt.a,{id:"code-input",label:"Code",value:x,onChange:f,variant:"outlined",error:""===x,inputProps:{onKeyPress:E}}),x&&o.a.createElement(o.a.Fragment,null,w?o.a.createElement("div",{className:d.displayText},o.a.createElement(s.a,{icon:m.e})," ",w):o.a.createElement(Ht,{buttonName:"Validate",buttonIcon:m.e,buttonText:w||"Check validation of the input system and code",onClick:g}),o.a.createElement(xt.a,{id:"description-input",label:"Description",value:C.description||"",onChange:b,variant:"outlined",error:""===C.description}))),"CarePlan"===j.resourceType&&o.a.createElement(o.a.Fragment,null,o.a.createElement(xt.a,{id:"title-input",label:"Title",value:j.title||"",onChange:h,variant:"outlined",error:null==j.title,inputProps:{onKeyPress:E}}),j.title&&o.a.createElement(xt.a,{id:"description-input",label:"Description",value:C.description||"",onChange:b,variant:"outlined",error:""===C.description}))))})),Kt=Object(r.memo)((function(e){var t=e.changeNodeType,n=e.currentNode,i=Ce(),c=i.pathways,l=i.updatePathway,d=yt(),p=d.pathway,f=d.pathwayRef,b=d.setCurrentPathway,h=At(p),v=Object(u.g)(),g=c.map((function(e){return{label:e.name,value:e.id}})),y=kt(),E=Object(r.useCallback)((function(){var e=n.referenceId,t=c.find((function(t){return t.id===e}));t&&b(t)}),[n,c,b]),C=Object(r.useCallback)((function(e){var t,n=(null===(t=g.find((function(t){return t.value===e})))||void 0===t?void 0:t.label)||"";h&&f.current&&l(function(e,t,n,r){return Object(a.a)(e,(function(e){e.nodes[t].referenceId=n,e.nodes[t].referenceLabel=r}))}(f.current,h.key,e,n))}),[h,g,f,l]),O=(null===n||void 0===n?void 0:n.key)&&"start"!==n.type;return o.a.createElement(o.a.Fragment,null,O&&o.a.createElement(o.a.Fragment,null,o.a.createElement("div",null,o.a.createElement(It,{id:"nodeType",label:"Node Type",options:Re,onChange:t,value:"Reference"}),o.a.createElement("div",{className:y.referenceDropdown},o.a.createElement(It,{id:"reference",label:"Pathway Reference",options:g,onChange:C,value:n.referenceId}),o.a.createElement("div",{className:y.referenceChevron},o.a.createElement(s.a,{icon:m.g,onClick:function(){E(),Fe(n.referenceId,"",v)}}))))))})),Jt=n(1549),Vt=n(1563),Yt=n(1566),$t=Object(r.createContext)({}),Qt=Object(r.memo)((function(e){var t=e.children,n=Object(r.useState)(""),a=Object(d.a)(n,2),i=a[0],c=a[1],l=Object(r.useState)(""),u=Object(d.a)(l,2),s=u[0],m=u[1],p=Object(r.useState)(""),f=Object(d.a)(p,2),b=f[0],h=f[1],v=Object(r.useState)(0),g=Object(d.a)(v,2),y=g[0],E=g[1],C=Object(r.useState)(0),O=Object(d.a)(C,2),j=O[0],k=O[1],x=Object(r.useCallback)((function(){c(""),m(""),h(""),E(0),k(0)}),[c,m,h,E,k]),w=Object(r.useCallback)((function(e){c("Demographics"),"gender"===e.type?(m("Gender"),h(e.gender)):(m("Age Range"),E(e.min),k(e.max))}),[]);return o.a.createElement($t.Provider,{value:{selectedElement:i,selectedDemoElement:s,gender:b,minimumAge:y,maximumAge:j,setSelectedElement:c,setSelectedDemoElement:m,setGender:h,setMinimumAge:E,setMaximumAge:k,resetCriteriaBuilder:x,setCriteriaBuilder:w}},t)})),Xt=function(){return Object(r.useContext)($t)},Zt=Object(r.memo)((function(e){var t,n,i,c,l,u,p,f,b,h,g,y=e.transition,E=(e.currentNode,ge()),C=E.criteria,O=E.addBuilderCriteria,j=v(),k=j.buildCriteriaSelected,x=j.setBuildCriteriaSelected,w=j.currentCriteriaNodeId,S=j.setCurrentCriteriaNodeId,N=j.currentCriteria,T=j.setCurrentCriteria,I=j.criteriaName,R=j.setCriteriaName,B=j.resetCurrentCriteria,D=Xt(),P=D.resetCriteriaBuilder,L=D.setCriteriaBuilder,M=yt(),A=M.pathwayRef,F=M.setCurrentPathway,q=At(A.current),z=Object(r.useMemo)((function(){return C.map((function(e){return{value:e.id,label:e.label}}))}),[C]),W=z.length>0,_=kt(),H=Object(r.useState)(!1),G=Object(d.a)(H,2),U=G[0],K=G[1],J=null===(t=y.condition)||void 0===t?void 0:t.description,V=null!=J,Y=J&&""!==J,$=(null===(n=y.condition)||void 0===n?void 0:n.cql)||(null===(i=y.condition)||void 0===i?void 0:i.description),Q=$?"DELETE":"CANCEL",X=$?o.a.createElement(s.a,{icon:m.E}):null,Z=W&&(U||(null===(c=y.condition)||void 0===c?void 0:c.cql)||(null===(l=y.condition)||void 0===l?void 0:l.description)),ee=Object(r.useRef)(y),te=k&&w===y.id,ne=null;y.condition&&((null===(g=h=C.find((function(e){var t;return e.id===(null===(t=y.condition)||void 0===t?void 0:t.criteriaSource)})))||void 0===g?void 0:g.builder)&&(ne=h.builder));var ae=!te&&ne,re=Object(r.useCallback)((function(){var e,t,n;$&&q&&A.current?(F((e=A.current,t=q.key,n=y.id,Object(a.a)(e,(function(e){var a=e.nodes[t].transitions.find((function(e){return e.id===n}));a&&delete a.condition})))),K(!1)):K(!U)}),[U,q,A,$,y.id,F]),oe=Object(r.useCallback)((function(e){var t;if(q&&A.current){var n=C.find((function(t){return t.id===e}));if(n){var a=bt(A.current,q.key,ee.current.id,(null===(t=ee.current.condition)||void 0===t?void 0:t.description)||"",n);F(a)}}}),[q,F,A,ee,C]),ie=Object(r.useCallback)((function(e){if(q&&A.current){var t,n,r,o,i=(null===e||void 0===e?void 0:e.target.value)||"";F((t=A.current,n=q.key,r=y.id,o=i,Object(a.a)(t,(function(e){var t,a,i=null===(t=e.nodes[n])||void 0===t||null===(a=t.transitions)||void 0===a?void 0:a.find((function(e){return e.id===r}));(null===i||void 0===i?void 0:i.condition)?i.condition.description=o:i&&(i.condition={description:o,criteriaSource:"",cql:""})}))))}}),[q,y.id,F,A]),ce=Object(r.useCallback)((function(e){R((null===e||void 0===e?void 0:e.target.value)||"")}),[R]),le=Object(r.useCallback)((function(){S(y.id),T(null),R(""),k||x(!0),P()}),[k,S,y,x,T,P,R]),ue=Object(r.useCallback)((function(){var e,t;S(y.id),T(ne),(null===(e=h)||void 0===e?void 0:e.label)&&R(null===(t=h)||void 0===t?void 0:t.label),k||x(!0),ne&&L(ne)}),[k,h,ne,y,S,T,R,x,L]),de=Object(r.useCallback)((function(){B(),P()}),[B,P]),se=Object(r.useCallback)((function(){var e;if(q&&A.current&&(null===N||void 0===N?void 0:N.cql)){var t=O(N,I,null===(e=y.condition)||void 0===e?void 0:e.criteriaSource),n=bt(A.current,q.key,ee.current.id,I,t[0]);F(n),de()}}),[q,F,A,ee,N,I,y,de,O]);return o.a.createElement(o.a.Fragment,null,!Z&&!te&&o.a.createElement(Ht,{buttonName:"Select Criteria",buttonIcon:m.B,buttonColor:"secondary",buttonText:"Add previously built or imported criteria logic to branch node.",onClick:re,disabled:!W,hasTooltip:!W,tooltipTitle:"No criteria to select. Add criteria to use."}),Z&&!te&&!ae&&o.a.createElement(tn,{label:"Criteria Selector",error:!V||!Y},o.a.createElement(o.a.Fragment,null,o.a.createElement(It,{id:"Criteria",label:"Criteria",options:z,onChange:oe,value:(null===(u=y.condition)||void 0===u?void 0:u.criteriaSource)||void 0}),o.a.createElement(xt.a,{label:"Criteria Display",className:_.criteriaText,value:(null===(p=y.condition)||void 0===p?void 0:p.description)||"",variant:"outlined",onChange:ie,error:!Y,helperText:'Use commas "," to separate into multiple lines (up to 3)'})),o.a.createElement(Bt.a,{className:_.cancelButton,color:"inherit",size:"small",variant:"outlined",startIcon:X,onClick:re},Q)),ae&&o.a.createElement(tn,{label:"Criteria Builder",error:!1},o.a.createElement(xt.a,{label:"Criteria Name",variant:"outlined",value:null===(f=h)||void 0===f?void 0:f.label,fullWidth:!0,disabled:!0}),o.a.createElement("span",{className:_.buildCriteriaText},null===(b=ne)||void 0===b?void 0:b.text),o.a.createElement("div",{className:_.buildCriteriaContainer},o.a.createElement(Bt.a,{className:_.cancelButton,color:"inherit",size:"small",variant:"outlined",startIcon:X,onClick:re},"DELETE CRITERIA"),o.a.createElement(Bt.a,{className:_.editButton,color:"inherit",size:"small",variant:"outlined",startIcon:o.a.createElement(s.a,{icon:m.i}),onClick:ue},"EDIT CRITERIA"))),!Z&&!te&&o.a.createElement(Ht,{buttonName:"Build Criteria",buttonColor:"secondary",buttonIcon:m.D,buttonText:"Create new criteria logic to add to branch node.",extraMargin:!0,onClick:le}),te&&o.a.createElement(tn,{label:"Criteria Builder",error:!V||!Y},o.a.createElement(xt.a,{error:""===I,label:"Criteria Name",variant:"outlined",onChange:ce,value:I,fullWidth:!0}),(null===N||void 0===N?void 0:N.text)&&o.a.createElement("span",{className:_.buildCriteriaText},N.text),o.a.createElement("div",{className:_.buildCriteriaContainer},o.a.createElement(Jt.a,{label:o.a.createElement(Vt.a,{fontStyle:"italic"},"Add to reusable criteria"),control:o.a.createElement(Yt.a,{color:"default"}),checked:!0}),o.a.createElement(Bt.a,{color:"inherit",size:"large",variant:"outlined",onClick:de},"Cancel"),o.a.createElement(Bt.a,{className:_.saveButton,color:"inherit",size:"large",variant:"outlined",startIcon:o.a.createElement(s.a,{icon:m.y}),disabled:""===I||null===N,onClick:se},"Save"))))})),en=function(e){var t=e.children;return o.a.createElement(o.a.Fragment,null,t)},tn=function(e){var t=e.children,n=e.label,a=e.error,r=kt();return o.a.createElement(xt.a,{variant:"outlined",label:n,multiline:!0,InputLabelProps:{shrink:!0},InputProps:{inputComponent:en,classes:{root:Object(zt.a)(r.outlinedDiv,a&&r.outlinedDivError),notchedOutline:Object(zt.a)(a&&r.outlinedDivError)}},inputProps:{children:t},fullWidth:!0})},nn=n(1568),an=n(1550),rn=n(1551),on=n(1552),cn=Object(r.memo)((function(e){var t=e.open,n=e.nodeLabel,a=e.isTransition,r=e.onClose,i=e.onDelete,c=kt(),l=yt().pathway,u=At(l),d=a?o.a.createElement("span",null,"Delete the transition from ",o.a.createElement("strong",null,null===u||void 0===u?void 0:u.label)," to"," ",o.a.createElement("strong",null,n),"? This will not delete either node, just the transition between them."):o.a.createElement("span",null,"Delete the node ",o.a.createElement("strong",null,n),"? This will also remove any transitions to this node.");return o.a.createElement(o.a.Fragment,null,o.a.createElement(nn.a,{open:t,onClose:r,"aria-labelledby":"create-pathway",fullWidth:!0,maxWidth:"md"},o.a.createElement(an.a,{disableTypography:!0},o.a.createElement(z.a,{"aria-label":"close",onClick:r,className:c.dialogCloseButton},o.a.createElement(s.a,{icon:m.C}))),o.a.createElement(rn.a,{className:c.dialogContent},o.a.createElement(s.a,{icon:m.l,className:c.alertIcon}),o.a.createElement("p",{className:c.dialogContentText},d)),o.a.createElement(on.a,null,o.a.createElement(Bt.a,{variant:"text",color:"primary",onClick:r},"Cancel"),o.a.createElement(Bt.a,{variant:"contained",color:"secondary",onClick:i},"Delete"))))})),ln=n(1553),un=Object(r.memo)((function(e){var t=e.transition,n=e.children,a=kt(),r=yt().pathway,i=(null===t||void 0===t?void 0:t.transition)||"",c=null===r||void 0===r?void 0:r.nodes[i];return o.a.createElement(ln.a,{raised:!0,className:a.transitionContainer},c&&o.a.createElement(_t,{node:c,isTransition:!0}),n)})),dn=n(1569),sn=n(1576),mn=n(339),pn=n.n(mn),fn=function(){var e=Object(r.useState)({nodes:{},edges:{}}),t=Object(d.a)(e,2),n=t[0],a=t[1];return{coordinates:n,updateCoordinates:Object(r.useCallback)((function(e){var t,n=e.graph,r=e.graphWidth,o=0-n.node("Start").x+r/2,i=0,c={nodes:{},edges:{}},l=Object(je.a)(n.nodes());try{for(l.s();!(t=l.n()).done;){var u=t.value,d=n.node(u);c.nodes[u]=Object(y.a)({},d,{x:d.x-d.width/2+o,y:d.y-d.height/2+16}),i=Math.min(0,i,c.nodes[u].x)}}catch(O){l.e(O)}finally{l.f()}if((i=Math.abs(i))>0){var s,m=Object(je.a)(n.nodes());try{for(m.s();!(s=m.n()).done;){var p=s.value;c.nodes[p].x+=i}}catch(O){m.e(O)}finally{m.f()}}var f,b=Object(je.a)(n.edges());try{for(b.s();!(f=b.n()).done;){var h=f.value,v=n.edge(h),g="".concat(h.v,", ").concat(h.w),E=v.label?{text:v.label,x:v.x+o,y:v.y+16}:null,C=v.points.map((function(e){return{x:(isNaN(e.x)?0:e.x)+o+i,y:(isNaN(e.y)?0:e.y)+16}}));C.length>0&&(C[C.length-1].y-=17.5),c.edges[g]={label:E,start:h.v,end:h.w,points:C}}}catch(O){b.e(O)}finally{b.f()}a(c)}),[])}},bn=Object(r.createContext)({}),hn=Object(r.createContext)((function(){})),vn=Object(r.createContext)({nodes:{},edges:{}}),gn=function(){var e=new pn.a.graphlib.Graph;return e.setGraph({}),e.setDefaultEdgeLabel((function(){return{}})),e},yn=function(e){var t=e.children,n=Object(r.useMemo)(gn,[]),a=fn(),i=a.coordinates,c=a.updateCoordinates,l=Object(dn.a)(0),u=Object(d.a)(l,2),s=u[0],m=u[1],p=Object(r.useState)(!0),f=Object(d.a)(p,2),b=f[0],h=f[1],v=Object(r.useCallback)((function(){return h(!0)}),[]),g=Object(r.useMemo)((function(){return{graph:n,reflow:v}}),[n,v]);return Object(r.useEffect)((function(){b&&(pn.a.layout(n),c({graph:n,graphWidth:s}),h(!1))}),[n,b,h,s,c]),Object(sn.a)((function(){h(!0)}),[s]),o.a.createElement(bn.Provider,{value:g},o.a.createElement(hn.Provider,{value:m},o.a.createElement(vn.Provider,{value:i},t)))},En=function(){return Object(r.useContext)(bn)},Cn=function(){return Object(r.useContext)(vn)},On=Object(_.a)((function(e){return{edges:{display:"block",position:"absolute",top:"0",left:"0",overflow:"visible",width:"100%",height:"100%",zIndex:1,"& text":{fontSize:"14px"},"& #arrowhead-inactive polygon":{fill:e.palette.common.blue},"& #arrowhead-active polygon":{fill:e.palette.common.red}},edge:{stroke:function(t){return e.palette.common[(null===t||void 0===t?void 0:t.isActive)?"red":"blue"]}}}}),{name:"DagreGraph-GraphEdges"}),jn=function(e){var t=e.labelText,n=e.isEnabled,a=e.children;return n&&t?o.a.createElement(W.a,{title:t,children:a}):o.a.createElement(o.a.Fragment,null,a)},kn=function(e){var t=e.label,n=e.points,a=e.isActive,i=On({isActive:a}),c=Object(r.useMemo)((function(){return function(e){return e.reduce((function(t,n,a){return a%3===e.length%3?"".concat(t," C ").concat(n.x," ").concat(n.y," ").concat(e[a+1].x," ").concat(e[a+1].y," ").concat(e[a+2].x," ").concat(e[a+2].y):t}),"M ".concat(e[0].x," ").concat(e[0].y," "))}(n)}),[n]),l=null===t||void 0===t?void 0:t.text,u=Object(r.useMemo)((function(){if(null==l)return{lines:[],isTruncated:!1};var e=!1,t=l.split(",");return{lines:(t.length>3?[t[0],t[1],t.slice(2).join(",")]:t).map((function(t){var n=t.trim();return n.length>20?(e=!0,"".concat(n.substring(0,19),"...")):n})),isTruncated:e}}),[l]),d=u.lines,s=u.isTruncated;return o.a.createElement(o.a.Fragment,null,o.a.createElement("path",{d:c,fill:"transparent",className:i.edge,strokeWidth:"2",markerEnd:"url(#arrowhead-".concat(a?"active":"inactive",")")}),t&&o.a.createElement(jn,{labelText:l,isEnabled:s},o.a.createElement("text",{x:t.x,y:t.y,dy:"0"},d.map((function(e,n){return o.a.createElement("tspan",{x:t.x,dy:0===n?0:"1.2em",key:e},e)})))))},xn=Object(r.memo)((function(e){var t=e.currentNode,n=On(),a=Cn().edges;return o.a.createElement("svg",{className:n.edges},o.a.createElement("defs",null,o.a.createElement("marker",{id:"arrowhead-inactive",markerWidth:"10",markerHeight:"7",refX:"0",refY:"3.5",orient:"auto"},o.a.createElement("polygon",{points:"0 0, 10 3.5, 0 7"})),o.a.createElement("marker",{id:"arrowhead-active",markerWidth:"10",markerHeight:"7",refX:"0",refY:"3.5",orient:"auto"},o.a.createElement("polygon",{points:"0 0, 10 3.5, 0 7"}))),Object.entries(a).map((function(e){var n=Object(d.a)(e,2),a=n[0],r=n[1];return o.a.createElement(kn,{key:a,label:r.label,points:r.points,isActive:r.start===(null===t||void 0===t?void 0:t.key)})})))})),wn=n(1554),Sn=Object(_.a)((function(e){return{table:{"& tr":{verticalAlign:"top"}},title:{fontWeight:"bold",textAlign:"right",minWidth:"80px"},description:{paddingLeft:e.spacing(2),fontStyle:"italic",overflowWrap:"break-word"},externalLink:{color:e.palette.common.blue,marginLeft:e.spacing(1),"&:hover, &:focus":{color:e.palette.common.grayDark}}}}),{name:"NodeDetails"}),Nn=function(e){var t=e.title,n=e.description,a=Sn();return n?o.a.createElement("tr",null,o.a.createElement("td",{className:a.title},t),o.a.createElement("td",{className:a.description},n)):null},Tn=function(){return o.a.createElement(Nn,{title:"Type",description:"Observation"})},In=function(e){var t,n,a,r,i,c=e.actionNode,l=Sn();if(null===c.action)return null;var u=c.action.resource,d=void 0!==u.medicationCodeableConcept?null===u||void 0===u||null===(t=u.medicationCodeableConcept)||void 0===t?void 0:t.coding:null===u||void 0===u||null===(n=u.code)||void 0===n?void 0:n.coding,p=Ie[u.resourceType]?Ie[u.resourceType]:u.resourceType;return o.a.createElement(o.a.Fragment,null,o.a.createElement(Nn,{title:"Description",description:c.action.description}),o.a.createElement(Nn,{key:"Type",title:"Type",description:p}),o.a.createElement(Nn,{key:"System",title:"System",description:(null===d||void 0===d||null===(a=d[0])||void 0===a?void 0:a.system)&&o.a.createElement(o.a.Fragment,null,d[0].system,o.a.createElement("a",{href:d[0].system,target:"_blank",rel:"noopener noreferrer"},o.a.createElement(s.a,{icon:m.m,className:l.externalLink})))}),o.a.createElement(Nn,{key:"Code",title:"Code",description:null===d||void 0===d||null===(r=d[0])||void 0===r?void 0:r.code}),o.a.createElement(Nn,{key:"Display",title:"Display",description:null===d||void 0===d||null===(i=d[0])||void 0===i?void 0:i.display}),o.a.createElement(Nn,{key:"Title",title:"Title",description:u.title}))},Rn=function(e){var t=e.referenceNode;return o.a.createElement(o.a.Fragment,null,o.a.createElement(Nn,{title:"Type",description:"Reference"}),o.a.createElement(Nn,{title:"Pathway",description:t.referenceLabel}))},Bn=Object(r.memo)((function(e){var t=e.pathwayNode,n=Sn(),a=Se(t);return null==a?null:o.a.createElement("table",{className:n.table},o.a.createElement("tbody",null,"branch"===a&&o.a.createElement(Tn,null),"reference"===a&&o.a.createElement(Rn,{referenceNode:t}),"action"===a&&o.a.createElement(In,{actionNode:t})))})),Dn=Object(_.a)((function(e){return{icon:{marginRight:e.spacing(1),fontSize:"0.9rem"}}}),{name:"DagreGraph-NodeIcon"}),Pn=Object(r.memo)((function(e){var t,n=e.isStartNode,a=e.nodeType,r=e.resourceType,i=Dn();return n?t=m.t:"action"===a&&r?"MedicationRequest"===r?t=m.v:"ServiceRequest"===r?t=m.A:"CarePlan"===r&&(t=m.a):"branch"===a?t=m.s:"reference"===a&&(t=m.q),t?o.a.createElement(s.a,{icon:t,className:i.icon}):null})),Ln=Object(_.a)((function(e){return{node:{position:"absolute",width:"auto",minWidth:function(e){return e.isExpanded?"400px":"100px"},maxWidth:"600px",minHeight:"50px",display:"flex",alignItems:"stretch",flexDirection:"column",border:function(t){var n=t.isActionable;return"1px solid ".concat(e.palette.common[n?"red":"blue"])},backgroundColor:e.palette.common.white,zIndex:2,overflow:"hidden"},nodeTitle:{padding:e.spacing(2),flex:"1",display:"flex",alignItems:"center",justifyContent:"center",color:e.palette.common.white,backgroundColor:function(t){var n=t.isActionable;return e.palette.common[n?"red":"blue"]}},nodeContent:{padding:e.spacing(2)},clickable:{cursor:"pointer"}}}),{name:"DagreGraph-Node"}),Mn=function(e){var t=e.condition;return t?{label:t.description,width:25,height:20}:{}},An=function(e){var t,n=null!==(t=null===e||void 0===e?void 0:e.getBoundingClientRect())&&void 0!==t?t:{width:0,height:0};return{width:Math.ceil(n.width),height:Math.ceil(n.height)}},Fn=Object(r.memo)((function(e){var t,n=e.nodeKey,a=e.pathwayNode,i=e.isActionable,c=e.isExpanded,l=e.onClick,u=e.xCoordinate,d=e.yCoordinate,s=e.openNode,m=Ln({isExpanded:c,isActionable:i}),p=Object(r.useCallback)((function(){l&&l(n)}),[l,n]),f=Object(r.useRef)(null),b=En(),h=b.graph,v=b.reflow,g=Object(r.useMemo)((function(){return{top:"".concat(d,"px"),left:"".concat(u,"px")}}),[u,d]),E=Se(a),C=a.action,O=a.label,j=a.transitions;return Object(wn.a)((function(){var e=An(f.current),t=e.width,a=e.height;h.setNode(n,{width:t,height:a}),j.forEach((function(e){h.setEdge(n,e.transition,Mn(e))}))}),(function(){h.removeNode(n)})),Object(sn.a)((function(){if(f.current){var e=An(f.current),t=e.width,a=e.height,r=h.node(n);r.width===t&&r.height===a||(h.setNode(n,Object(y.a)({},r,{width:t,height:a})),v())}})),Object(sn.a)((function(){var e,t=new Set(j.map((function(e){return e.transition})));null===(e=h.outEdges(n))||void 0===e||e.forEach((function(e){var a=e.w;t.has(a)||h.removeEdge(n,a)})),j.forEach((function(e){h.setEdge(n,e.transition,Mn(e))})),v()}),[n,j]),Object(sn.a)((function(){C&&s(n)}),[C,n]),o.a.createElement("div",{className:m.node,style:g,ref:f},o.a.createElement("div",{className:Object(zt.a)(m.nodeTitle,l&&m.clickable),onClick:p},o.a.createElement(Pn,{resourceType:C?null===(t=C.resource)||void 0===t?void 0:t.resourceType:void 0,nodeType:E,isStartNode:"start"===a.type}),O),c&&o.a.createElement("div",{className:m.nodeContent},o.a.createElement(Bn,{pathwayNode:a})))})),qn=n(153),zn=function(){var e=Object(r.useState)({lastSelectedNode:null}),t=Object(d.a)(e,2),n=t[0],a=t[1];return{expanded:n,toggleExpanded:Object(r.useCallback)((function(e){a("Start"===e?function(t){return Object(y.a)({},t,{lastSelectedNode:e})}:function(t){var n;return Object(y.a)({},t,(n={},Object(qn.a)(n,e,t[e]&&t.lastSelectedNode!==e?t[e]:!t[e]),Object(qn.a)(n,"lastSelectedNode",e),n))})}),[]),openNode:Object(r.useCallback)((function(e){a((function(t){var n;return t[e]&&t.lastSelectedNode===e?t:Object(y.a)({},t,(n={},Object(qn.a)(n,e,!0),Object(qn.a)(n,"lastSelectedNode",e),n))}))}),[]),closeNode:Object(r.useCallback)((function(e){a((function(t){return t[e]?Object(y.a)({},t,Object(qn.a)({},e,!1)):t}))}),[])}},Wn=function(){var e=Object(u.h)().id,t=Object(u.g)();return Object(r.useCallback)((function(n){var a="/demo/builder/".concat(encodeURIComponent(e),"/node/").concat(encodeURIComponent(n));a!==t.location.pathname&&t.push(a)}),[t,e])},_n=Object(r.memo)((function(e){var t,n=e.interactive,a=e.currentNode,i=yt().pathway,c=zn(),l=c.expanded,u=c.toggleExpanded,s=c.openNode,m=En().reflow,p=Cn().nodes,f=Wn(),b=v().resetCurrentCriteria,h=Object(r.useCallback)((function(e){f(e),u(e),b()}),[f,u,b]),g=Object.entries(null!==(t=null===i||void 0===i?void 0:i.nodes)&&void 0!==t?t:{});return Object(sn.a)((function(){m()}),[g.length]),o.a.createElement(o.a.Fragment,null,g.map((function(e){var t,r=Object(d.a)(e,2),i=r[0],c=r[1],u=null!==(t=p[i])&&void 0!==t?t:{x:-999,y:-999};return o.a.createElement(Fn,{key:i,nodeKey:i,pathwayNode:c,isActionable:c.key===(null===a||void 0===a?void 0:a.key),isExpanded:Boolean(l[i]),onClick:n?h:void 0,xCoordinate:u.x,yCoordinate:u.y,openNode:s})})))})),Hn=n(1066),Gn=n.n(Hn),Un=Object(_.a)({root:{position:"relative",minWidth:"100%",minHeight:"100%"}},{name:"DagreGraph-GraphRoot"}),Kn=function(e){var t=e.children,n=Un(),a=Object(r.useRef)(null),i=Object(r.useContext)(hn),c=Cn().nodes,l=Object(r.useMemo)((function(){return Math.ceil(150+(void 0!==c?Object.values(c).map((function(e){return e.x+e.width})).reduce((function(e,t){return Math.max(e,t)}),0):0))}),[c]),u=Object(r.useMemo)((function(){return Math.ceil(150+(void 0!==c?Object.values(c).map((function(e){return e.y+e.height})).reduce((function(e,t){return Math.max(e,t)}),0):0))}),[c]),d=Object(r.useMemo)((function(){return{width:"".concat(l,"px"),height:"".concat(u,"px")}}),[l,u]);return Object(r.useEffect)((function(){var e=a.current;if(null===e||void 0===e?void 0:e.parentElement){var t=e.parentElement.getBoundingClientRect().width;i(Math.ceil(t));var n=new Gn.a(e.parentElement,(function(){var t,n,a=(null!==(t=null===e||void 0===e||null===(n=e.parentElement)||void 0===n?void 0:n.getBoundingClientRect())&&void 0!==t?t:{width:0}).width;i(Math.ceil(a))}));return function(){n.detach()}}}),[a,i]),o.a.createElement("div",{ref:a,className:n.root,style:d},t)},Jn=Object(r.memo)((function(e){var t=e.interactive,n=void 0===t||t,a=e.currentNode;return o.a.createElement(yn,null,o.a.createElement(Kn,null,o.a.createElement(_n,{interactive:n,currentNode:a}),o.a.createElement(xn,{currentNode:a})))})),Vn=Object(_.a)((function(e){return{root:{display:"flex",flexDirection:"column",padding:e.variables.spacing.globalPadding},elementContainer:{padding:"1em",marginRight:"10px",border:"0.1em solid",borderRadius:"0.2em",fontWeight:500,width:"auto",backgroundColor:e.palette.common.grayLightest},elementSelect:{display:"flex",alignItems:"center"},addElementLabel:{marginLeft:"1em",minWidth:"120px"},headerText:{marginRight:"10px",fontStyle:"italic",fontSize:"0.8em"},elementField:{display:"flex",alignItems:"center"},elementFieldLabel:{fontWeight:"bold",marginRight:"1em"}}}),{name:"CriteriaBuilder"}),Yn=Object(r.memo)((function(){var e=Xt(),t=e.selectedElement,n=e.selectedDemoElement,a=e.gender,i=e.minimumAge,c=e.maximumAge,l=e.setSelectedElement,u=e.setSelectedDemoElement,d=e.setGender,p=e.setMinimumAge,f=e.setMaximumAge,b=e.resetCriteriaBuilder,h=Vn(),g=v().setCurrentCriteria,y=Object(r.useCallback)((function(e){p(parseInt(null===e||void 0===e?void 0:e.target.value)||0)}),[p]),E=Object(r.useCallback)((function(e){f(parseInt(null===e||void 0===e?void 0:e.target.value)||0)}),[f]),C=Object(r.useCallback)((function(){b(),g(null)}),[b,g]),O="The patient's gender is ".concat(a),j="The patient's age is between ".concat(i," years and ").concat(c," years");return Object(r.useEffect)((function(){var e="AgeInYears() >= ".concat(i," and AgeInYears() < ").concat(c);"Age Range"===n&&g(i>=0&&c>0&&i<c?{cql:e,text:j,type:"age",min:i,max:c}:null)}),[n,i,c,j,g]),Object(r.useEffect)((function(){var e="Patient.gender.value ~ '".concat(a,"'");"Gender"===n&&g(""!==a?{cql:e,text:O,type:"gender",gender:a}:null)}),[n,a,O,g]),o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:h.headerText},"Specify criteria to identify a target population that should receive a recommendation from this artifact. Examples might include an age range, gender, presence of a certain condition, or lab results within a specific range."),o.a.createElement("div",{className:h.elementContainer},(""===t||""===n)&&o.a.createElement("div",{className:h.elementSelect},o.a.createElement("div",{className:h.addElementLabel},o.a.createElement(s.a,{icon:m.u})," Add element"),o.a.createElement(It,{id:"Choose Element Type",label:"Choose Element Type",options:[{value:"Demographics",label:"Demographics"}],onChange:l,value:t}),t&&o.a.createElement(It,{id:"Select ".concat(t," element"),label:"Select ".concat(t," element"),options:[{value:"Age Range",label:"Age Range"},{value:"Gender",label:"Gender"}],onChange:u,value:n})),!(""===t||""===n)&&o.a.createElement(o.a.Fragment,null,o.a.createElement("span",null,n),o.a.createElement(z.a,{onClick:C},o.a.createElement(s.a,{icon:m.C})),o.a.createElement("hr",null),"Gender"===n&&o.a.createElement(o.a.Fragment,null,o.a.createElement("span",null,O),o.a.createElement(It,{id:"Select Gender",label:"Gender",options:[{label:"Male",value:"Male"},{label:"Female",value:"Female"},{label:"Other",value:"Other"},{label:"Unknown",value:"Unknown"}],onChange:d,value:a})),"Age Range"===n&&o.a.createElement(o.a.Fragment,null,o.a.createElement("span",null,j),o.a.createElement("div",{className:h.elementField},o.a.createElement("span",{className:h.elementFieldLabel},"Minimum Age:"),o.a.createElement(xt.a,{type:"number",value:i,onChange:y})),o.a.createElement("div",{className:h.elementField},o.a.createElement("span",{className:h.elementFieldLabel},"Maximum Age:"),o.a.createElement(xt.a,{type:"number",value:c,onChange:E}))))))})),$n=n(32),Qn={borderRadius:"0%",marginLeft:"1px",width:"50px",height:"50px"},Xn=Object(_.a)((function(e){return{root:{display:"flex",flexDirection:"column",height:"100vh"},main:{flex:"1",display:"flex",alignItems:"stretch",overflowY:"auto"},graph:{"overflow-y":"auto",flex:"1"},graphHeader:{display:"flex",height:"50px",backgroundColor:e.palette.common.white,marginLeft:"1px"},graphHeaderText:{height:"50px",display:"flex",width:"100%",backgroundColor:e.palette.primary.main,alignItems:"center",color:e.palette.common.white,fontSize:"1.4em",paddingLeft:"1.5em"},toggleButton:{"&-on":Object(y.a)({},Qn,{backgroundColor:e.palette.primary.main,"&:hover":{backgroundColor:Object($n.a)(e.palette.primary.main,.1)}}),"&-off":Object(y.a)({},Qn,{backgroundColor:e.palette.text.primary,"&:hover":{backgroundColor:Object($n.a)(e.palette.text.primary,.1)}})},toggleIcon:{transform:"rotate(90deg) scaleY(-1)",color:e.palette.common.white}}}),{name:"Builder",index:1}),Zn=function(){var e=Object(u.h)().nodeId;return decodeURIComponent(e)},ea=Object(r.memo)((function(){var e=Xn(),t=Zn(),n=yt().pathway,a=v().currentCriteriaNodeId,i=function(e){var t=Object(r.useContext)(D).useProjector;return B({theme:e,useProjector:t})}("dark"),c=Object(r.useState)(!0),l=Object(d.a)(c,2),u=l[0],p=l[1],f=null;(null===n||void 0===n?void 0:n.nodes[t])?f=n.nodes[t]:n&&(f=n.nodes.Start);var b=Object(r.useCallback)((function(){p(!u)}),[u]);return Object(r.useEffect)((function(){u||""!==a||p(!0)}),[a,u]),o.a.createElement("div",{className:e.root},o.a.createElement("div",null,o.a.createElement(q,null),o.a.createElement(jt,null)),n&&o.a.createElement("div",{className:e.main},o.a.createElement(g.a,{theme:i},o.a.createElement(qt,{currentNode:f})),o.a.createElement("div",{className:e.graph},""!==a&&o.a.createElement("div",{className:e.graphHeader},o.a.createElement("div",{className:e.graphHeaderText},o.a.createElement("span",null,"Criteria Builder")),o.a.createElement(z.a,{className:"".concat(e.toggleButton,"-").concat(u?"on":"off"),onClick:b},o.a.createElement(s.a,{className:e.toggleIcon,icon:m.w}))),""!==a&&u?o.a.createElement(Yn,null):o.a.createElement(Jn,{currentNode:f}))))})),ta=function(){var e=Object(u.h)().id;return decodeURIComponent(e)},na=Object(r.memo)((function(){var e=ta(),t=Zn(),n=Ce().pathways,a=yt(),i=a.pathwayRef,c=a.setCurrentPathway,l=a.resetCurrentPathway,d=Object(r.useMemo)((function(){return n.findIndex((function(t){return t.id===e}))}),[e,n]),s=n[d];return Object(r.useEffect)((function(){var e;s&&(null===i||void 0===i||null===(e=i.current)||void 0===e?void 0:e.id)===s.id?c(s):s&&l(s)}),[s,i,c,l]),null==s?null:t?o.a.createElement(ea,null):o.a.createElement(u.a,{to:"demo/builder/".concat(e,"/node/Start")})})),aa=Object(r.createContext)({}),ra=function(e){var t=e.children,n=Object(r.useState)(null),a=Object(d.a)(n,2),i=a[0],c=a[1];return o.a.createElement(aa.Provider,{value:{user:i,setUser:c}},t)},oa=n(210),ia=Object(_.a)((function(e){return{root:{display:"flex",flexDirection:"column"},label:{padding:"0.2em 2em",textTransform:"none",fontSize:"1.2em",fontWeight:100}}}),{name:"Tabs",index:1}),ca=Object(r.memo)((function(e){var t=e.tabs,n=ia();return o.a.createElement("div",{className:n.root},o.a.createElement(oa.d,null,o.a.createElement(oa.b,null,t.map((function(e){return o.a.createElement(oa.a,{key:re.a.generate()},o.a.createElement(Bt.a,{classes:{label:n.label}},e.label))}))),t.map((function(e){return o.a.createElement(oa.c,{key:re.a.generate()},e.component)}))))})),la=n(340),ua=n.n(la),da=Object(r.memo)((function(){return o.a.createElement("div",{className:ua.a.root},o.a.createElement(s.a,{icon:m.z,className:ua.a.root,size:"4x",spin:!0}))})),sa=n(1555),ma=n(1556),pa=n(1557),fa=n(1558),ba=n(1559),ha=n(1560),va=n(1561),ga=Object(_.a)((function(e){return{root:{display:"flex",flexDirection:"column",padding:e.variables.spacing.globalPadding},createPathwayButton:{alignSelf:"flex-end",marginLeft:"20px"},pathwayList:{marginTop:"1em"},pathwaysListButton:{marginRight:"1em"},dialogCloseButton:{float:"right",width:"45px"},buttonRow:{display:"flex",justifyContent:"flex-end"},tableTop:{display:"flex",justifyContent:"space-between"},selectionOptions:{display:"flex",paddingLeft:"4px",justifyContent:"space-between",alignItems:"flex-end"},selectionIcon:{color:e.palette.primary.main},deleteIcon:{color:e.palette.secondary.main}}}),{name:"PathwaysList",index:1}),ya=Object(r.memo)((function(e){var t,n,i=e.open,c=e.onClose,l=e.editPathway,d=!l,p=ga(),f=Object(u.g)(),b=Object(r.useRef)(null),h=Object(r.useRef)(null),v=Ce(),g=v.addPathway,y=v.updatePathway,E=Object(r.useCallback)((function(e){f.push("/demo/builder/".concat(encodeURIComponent(e),"/node/Start")),c()}),[f,c]),C=Object(r.useCallback)((function(e){var t,n,a,r;e.preventDefault();var o=re.a.generate(),i=null!==(t=null===(n=b.current)||void 0===n?void 0:n.value)&&void 0!==t?t:"",c=null!==(a=null===(r=h.current)||void 0===r?void 0:r.value)&&void 0!==a?a:"";g(function(e,t,n){return{id:null!==n&&void 0!==n?n:re.a.generate(),name:e,description:t,library:[""],preconditions:[],nodes:{Start:{key:"Start",label:"Start",transitions:[],type:"start"}}}}(i,c,o)),E(o)}),[g,E]),O=Object(r.useCallback)((function(e){var t,n;if(e.preventDefault(),l&&((null===(t=b.current)||void 0===t?void 0:t.value)!==l.name||(null===(n=h.current)||void 0===n?void 0:n.value)!==l.description)){var r=Object(a.a)(l,(function(e){var t,n;(null===(t=b.current)||void 0===t?void 0:t.value)&&(e.name=b.current.value),(null===(n=h.current)||void 0===n?void 0:n.value)&&(e.description=h.current.value)}));y(r)}c()}),[y,l,c]);if(l){t=l.name;var j=l.description;j&&""!==j&&(n=j)}return o.a.createElement(nn.a,{open:i,onClose:c,"aria-labelledby":"create-pathway",fullWidth:!0,maxWidth:"md"},o.a.createElement(an.a,{disableTypography:!0},o.a.createElement(z.a,{"aria-label":"close",onClick:c,className:p.dialogCloseButton},o.a.createElement(s.a,{icon:m.C}))),o.a.createElement("form",{onSubmit:d?C:O},o.a.createElement(rn.a,null,o.a.createElement(xt.a,{variant:"outlined",autoFocus:!0,label:"Pathway Name",fullWidth:!0,required:d,inputRef:b,defaultValue:d?void 0:t}),o.a.createElement(xt.a,{variant:"outlined",label:"Pathway Description",fullWidth:!0,inputRef:h,defaultValue:d?void 0:n,multiline:!0})),o.a.createElement(on.a,null,o.a.createElement(Bt.a,{variant:"contained",color:"primary",startIcon:d&&o.a.createElement(s.a,{icon:m.u}),type:"submit"},d?"Create":"Save"))))})),Ea=n(1538),Ca=n(1547),Oa=n(133),ja=n.n(Oa),ka=function(e){var t=e.type,n=e.onClick;return o.a.createElement("button",{className:"".concat(ja.a.largeActionButton," button ").concat("decline"===t&&ja.a.largeDecline),type:"button",onClick:n},t[0].toUpperCase()+t.slice(1))},xa=function(e){var t=e.type,n=e.onClick;return o.a.createElement("div",{className:"".concat("accept"===t?ja.a.accept:ja.a.decline," ").concat(ja.a.smallActionButton),onClick:n,"data-testid":t},o.a.createElement(s.a,{icon:"accept"===t?m.d:m.C}))},wa=function(e){var t=e.type,n=e.onClick;return o.a.createElement("div",{className:"".concat("accept"===t?ja.a.accept:ja.a.decline," ").concat(ja.a.mediumActionButton),onClick:n,"data-testid":t},o.a.createElement(s.a,{icon:"accept"===t?m.d:m.C}),{accept:"Submit",decline:"Cancel"}[t])},Sa=Object(r.memo)((function(e){var t=e.type,n=e.size,a=e.onClick;switch(n){case"small":return o.a.createElement(xa,{type:t,onClick:a});case"large":return o.a.createElement(ka,{type:t,onClick:a});case"medium":return o.a.createElement(wa,{type:t,onClick:a})}})),Na=Object(_.a)((function(e){return{container:{display:"inline-block"},paper:{display:"flex",flexDirection:"row",alignItems:"center",borderRadius:"10px",border:"5px solid rgba(74, 74, 74, 0.5)",backgroundColor:e.palette.common.gray,color:e.palette.common.white,padding:"0.5em",mozBackgroundClip:"padding",webkitBackgroundVlip:"padding",backgroundClip:"padding-box"},displayText:{marginRight:"4em",whiteSpace:"nowrap"},buttons:{display:"flex",alignItems:"center",justifyContent:"center",minWidth:"2.5em",minHeight:"2em",cursor:"pointer",borderRadius:"15%",marginRight:"0.5em"}}}),{name:"ConfirmationPopover"}),Ta=o.a.forwardRef((function(e,t){var n=e.children,a=e.displayText,i=e.onConfirm,c=e.onDecline,l=Object(te.a)(e,["children","displayText","onConfirm","onDecline"]),u=Na(),s=Object(r.useState)(!1),m=Object(d.a)(s,2),p=m[0],f=m[1],b=Object(r.useState)(null),h=Object(d.a)(b,2),v=h[0],g=h[1],E=Object(r.useCallback)((function(e){g(e.currentTarget),f(!0)}),[]),C=Object(r.useCallback)((function(){i&&i(),f(!1),g(null)}),[i]),O=Object(r.useCallback)((function(){c&&c(),f(!1),g(null)}),[c]);return o.a.createElement("div",{className:u.container},o.a.createElement(Ca.a,{onClickAway:O},o.a.Children.only(n)?o.a.createElement("div",{className:u.container,onClick:E},o.a.Children.map(n,(function(e){return o.a.cloneElement(e,Object(y.a)({ref:t},l))}))):o.a.createElement("div",Object.assign({onClick:E,className:u.container},l,{ref:t}),n)),o.a.createElement(Ea.a,{classes:{paper:u.paper},open:p,anchorEl:v,anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"center"}},o.a.createElement("div",{className:u.displayText}," ",a," "),o.a.createElement("div",{className:u.buttons},o.a.createElement(Sa,{size:"small",type:"accept",onClick:C}),o.a.createElement(Sa,{size:"small",type:"decline",onClick:O}))))})),Ia=Object(r.memo)(Ta),Ra=Object(r.memo)((function(e){var t=e.deleteId,n=e.deleteMethod,a=e.deleteType,i=e.deleteName,c="Are you sure"+(a&&n?" that you would like to delete the "+i+" "+a+" ?":"?"),l=Object(r.useCallback)((function(){n(t)}),[t,n]);return o.a.createElement(Ia,{onConfirm:l,displayText:c},o.a.createElement(Bt.a,{color:"secondary",size:"small",startIcon:o.a.createElement(s.a,{icon:m.E})},"Delete"))})),Ba=Object(r.memo)((function(e){var t=e.itemSelected,n=e.handleSelectClick,a=ga(),i=Ce(),c=i.pathways,u=i.deletePathway,p=yt().setCurrentPathway,f=Object(r.useState)(!1),b=Object(d.a)(f,2),h=b[0],v=b[1],g=Object(r.useState)(),y=Object(d.a)(g,2),E=y[0],C=y[1],O=Object(r.useState)(null),j=Object(d.a)(O,2),k=j[0],x=j[1],w=Object(r.useCallback)((function(e){v(!0),C(e)}),[]),S=Object(r.useCallback)((function(){v(!1)}),[]),N=Object(r.useCallback)((function(e){x(e.currentTarget);var t=c.filter((function(t){return t.id===e.currentTarget.id}));t.length&&p(t[0])}),[c,p]),T=Object(r.useCallback)((function(){x(null)}),[]),I=Object(r.useCallback)((function(e){u(e)}),[u]);return o.a.createElement("div",null,o.a.createElement(sa.a,{className:a.pathwayList},o.a.createElement(ma.a,{"aria-label":"pathway list"},o.a.createElement(pa.a,null,o.a.createElement(fa.a,null,o.a.createElement(ba.a,{padding:"checkbox"}),o.a.createElement(ba.a,null,"Pathway Name"),o.a.createElement(ba.a,null,"Status"),o.a.createElement(ba.a,null,"Last Updated"),o.a.createElement(ba.a,null))),o.a.createElement(ha.a,null,c.map((function(e){return o.a.createElement(fa.a,{key:e.id},o.a.createElement(ba.a,{padding:"checkbox"},o.a.createElement(Yt.a,{checked:t(e.id),onChange:n(e.id)})),o.a.createElement(ba.a,{component:"th",scope:"row"},o.a.createElement(va.a,{component:l.b,to:"/demo/builder/".concat(encodeURIComponent(e.id)),color:"primary",underline:"none"},e.name)),o.a.createElement(ba.a,null,"draft"),o.a.createElement(ba.a,null,"2 days ago"),o.a.createElement(ba.a,{align:"right"},o.a.createElement(Bt.a,{className:a.pathwaysListButton,color:"primary",size:"small",startIcon:o.a.createElement(s.a,{icon:m.i}),onClick:function(){return w(e)}},"Edit Info"),o.a.createElement(Bt.a,{id:e.id,className:a.pathwaysListButton,color:"primary",size:"small",startIcon:o.a.createElement(s.a,{icon:m.n}),onClick:N},"Export"),o.a.createElement(Ra,{deleteType:"pathway",deleteName:e.name,deleteId:e.id,deleteMethod:I})))}))))),o.a.createElement(Ct,{anchorEl:k,closeMenu:T}),o.a.createElement(ya,{open:h,onClose:S,editPathway:E}))})),Da=Object(_.a)((function(e){return{dialogCloseButton:{float:"right",width:"45px"},input:{display:"none"},chooseFileInput:{display:"flex",alignItems:"center"},inputButton:{whiteSpace:"nowrap",marginRight:"1em"},fileName:{fontStyle:"italic"}}}),{name:"FileImportModal",index:1}),Pa=Object(r.memo)((function(e){var t=e.open,n=e.onClose,a=e.onSelectFile,i=e.allowedFileType,c=Da(),l=Object(r.useState)(""),u=Object(d.a)(l,2),p=u[0],f=u[1],b=Object(r.useRef)(null),h=Object(r.useCallback)((function(e){var t;e.preventDefault();var r=null===b||void 0===b||null===(t=b.current)||void 0===t?void 0:t.files;a(r),n(),f("")}),[n,a]),v=Object(r.useCallback)((function(){var e,t;(null===b||void 0===b||null===(e=b.current)||void 0===e||null===(t=e.files)||void 0===t?void 0:t[0])&&f(b.current.files[0].name)}),[b]);return o.a.createElement(nn.a,{open:t,onClose:n,"aria-labelledby":"import-pathway",fullWidth:!0,maxWidth:"sm"},o.a.createElement(an.a,{disableTypography:!0},o.a.createElement(z.a,{"aria-label":"close",onClick:n,className:c.dialogCloseButton},o.a.createElement(s.a,{icon:m.C}))),o.a.createElement("form",{onSubmit:h},o.a.createElement(rn.a,null,o.a.createElement("div",{className:c.chooseFileInput},o.a.createElement(Wt.a,{id:"choose-file-input",className:c.input,inputRef:b,type:"file",inputProps:{accept:i},onChange:v}),o.a.createElement("label",{htmlFor:"choose-file-input"},o.a.createElement(Bt.a,{className:c.inputButton,variant:"contained",color:"primary",component:"span"},"Choose File")),o.a.createElement("div",{className:c.fileName},p?o.a.createElement("span",null,p):o.a.createElement("span",null,"Choose file to import.")))),o.a.createElement(on.a,null,o.a.createElement(Bt.a,{variant:"contained",color:"primary",startIcon:o.a.createElement(s.a,{icon:m.p}),type:"submit"},"Import"))))})),La=function(e){var t=Object(r.useState)(new Set),n=Object(d.a)(t,2),o=n[0],i=n[1],c=Object(r.useMemo)((function(){return o.size}),[o.size]),l=Object(r.useMemo)((function(){return e.length}),[e.length]),u=Object(r.useMemo)((function(){return c>0&&c<l}),[c,l]),s=Object(r.useMemo)((function(){return l>0&&c===l}),[c,l]);return Object(r.useEffect)((function(){var t=Array.from(o).filter((function(t){return!e.includes(t)}));t.length>0&&i(Object(a.a)((function(e){t.forEach((function(t){return e.delete(t)}))})))}),[e,o]),{indeterminate:u,checked:s,handleSelectAllClick:Object(r.useCallback)((function(t){t.target.checked?i(new Set(e)):i(new Set)}),[e]),itemSelected:Object(r.useCallback)((function(e){return o.has(e)}),[o]),handleSelectClick:Object(r.useCallback)((function(e){return function(t){t.target.checked?i(Object(a.a)((function(t){t.add(e)}))):i(Object(a.a)((function(t){t.delete(e)})))}}),[]),selected:o,setSelected:i,numSelected:c}},Ma=Object(r.memo)((function(){var e=ga(),t=Object(r.useState)(!1),n=Object(d.a)(t,2),a=n[0],i=n[1],c=Ce(),l=c.status,u=c.pathways,p=c.deletePathway,f=Object(r.useState)(!1),b=Object(d.a)(f,2),h=b[0],v=b[1],g=Object(r.useState)(null),y=Object(d.a)(g,2),E=y[0],C=y[1],O=Object(r.useMemo)((function(){return u.map((function(e){return e.id}))}),[u]),j=La(O),k=j.indeterminate,x=j.checked,w=j.handleSelectAllClick,S=j.itemSelected,N=j.handleSelectClick,T=j.selected,I=j.numSelected,R=ge().criteria,B=Ce().addPathwayFromFile,D=Object(r.useCallback)((function(){i(!0)}),[]),P=Object(r.useCallback)((function(){i(!1)}),[]),L=Object(r.useCallback)((function(e){(null===e||void 0===e?void 0:e.length)&&B(e[0])}),[B]),M=Object(r.useCallback)((function(){C(null)}),[]),A=Object(r.useCallback)((function(){return v(!0)}),[]),F=Object(r.useCallback)((function(){return v(!1)}),[]),q=Object(r.useCallback)((function(){T.forEach((function(e){p(e)}))}),[p,T]),_=Object(r.useState)([]),H=Object(d.a)(_,2),G=H[0],U=H[1],K=Object(r.useCallback)((function(e){U(u.filter((function(e){return T.has(e.id)}))),C(e.currentTarget)}),[u,T]);return o.a.createElement("div",{className:e.root},o.a.createElement("div",{className:e.tableTop},o.a.createElement("div",{className:e.selectionOptions},o.a.createElement(W.a,{placement:"top",title:"Select All",arrow:!0},o.a.createElement(Yt.a,{indeterminate:k,checked:x,onChange:w})),I>0&&o.a.createElement(o.a.Fragment,null,o.a.createElement(W.a,{placement:"top",title:"Export",arrow:!0},o.a.createElement(z.a,{size:"small",onClick:K},o.a.createElement(s.a,{icon:m.n,className:e.selectionIcon}))),o.a.createElement(W.a,{placement:"top",title:"Move to",arrow:!0},o.a.createElement(z.a,{size:"small"},o.a.createElement(s.a,{icon:m.o,className:e.selectionIcon}))),o.a.createElement(W.a,{placement:"top",title:"Delete",arrow:!0},o.a.createElement(Ia,{onConfirm:q,displayText:"Are you sure that you would like to delete the selected pathway".concat(I>1?"s":"","?")},o.a.createElement(z.a,{size:"small"},o.a.createElement(s.a,{icon:m.E,className:e.deleteIcon})))))),o.a.createElement("div",{className:e.buttonRow},o.a.createElement(Bt.a,{className:e.createPathwayButton,variant:"contained",color:"primary",startIcon:o.a.createElement(s.a,{icon:m.p}),onClick:A},"Import Pathway"),o.a.createElement(Bt.a,{className:e.createPathwayButton,variant:"contained",color:"primary",startIcon:o.a.createElement(s.a,{icon:m.u}),onClick:D},"Create Pathway"))),o.a.createElement(Pa,{open:h,onClose:F,onSelectFile:L,allowedFileType:".json"}),o.a.createElement(ya,{open:a,onClose:P}),o.a.createElement(Ot,{pathway:G,allPathways:u,criteria:R,anchorEl:E,closeMenu:M}),"loading"===l?o.a.createElement(da,null):o.a.createElement(Ba,{handleSelectClick:N,itemSelected:S}))})),Aa=n(1067),Fa=n.n(Aa),qa=Object(_.a)((function(e){return{root:{display:"flex",flexDirection:"column",padding:e.variables.spacing.globalPadding},buttonRow:{display:"flex",justifyContent:"flex-end"},buildCriteriaButton:{alignSelf:"flex-end",marginLeft:"20px"},criteriaList:{marginTop:"1em"},editButton:{marginRight:"1em"},dialogCloseButton:{float:"right",width:"45px"},input:{display:"none"},chooseFileInput:{display:"flex",alignItems:"center"},inputButton:{whiteSpace:"nowrap",marginRight:"1em"},fileName:{fontStyle:"italic"},tableTop:{display:"flex",justifyContent:"space-between"},selectionOptions:{display:"flex",paddingLeft:"4px",justifyContent:"space-between",alignItems:"flex-end"},selectionIcon:{color:e.palette.primary.main},deleteIcon:{color:e.palette.secondary.main}}}),{name:"CriteriaList",index:1}),za=Object(r.memo)((function(e){var t=e.itemSelected,n=e.handleSelectClick,a=qa(),i=ge(),c=i.criteria,l=i.deleteCriteria,u=Object(r.useCallback)((function(e){l(e)}),[l]);return o.a.createElement(sa.a,{className:a.criteriaList},o.a.createElement(ma.a,{"aria-label":"criteria list"},o.a.createElement(pa.a,null,o.a.createElement(fa.a,null,o.a.createElement(ba.a,{padding:"checkbox"}),o.a.createElement(ba.a,null,"Criteria Name"),o.a.createElement(ba.a,null,"Version"),o.a.createElement(ba.a,null,"Added"),o.a.createElement(ba.a,null))),o.a.createElement(ha.a,null,c.map((function(e){return o.a.createElement(fa.a,{key:e.id},o.a.createElement(ba.a,{padding:"checkbox"},o.a.createElement(Yt.a,{checked:t(e.id),onChange:n(e.id)})),o.a.createElement(ba.a,{component:"th",scope:"row"},e.label),o.a.createElement(ba.a,null,e.version),o.a.createElement(ba.a,null,(r=e.modified,Fa()(r).fromNow())),o.a.createElement(ba.a,{align:"right"},o.a.createElement(Bt.a,{className:a.editButton,color:"primary",size:"small",startIcon:o.a.createElement(s.a,{icon:m.i})},"Edit"),o.a.createElement(Ra,{deleteType:"criterion",deleteName:e.label,deleteId:e.id,deleteMethod:u})));var r})))))})),Wa=Object(r.memo)((function(){var e=qa(),t=Ce().status,n=ge(),a=n.criteria,i=n.addCriteria,c=n.deleteCriteria,l=Object(r.useState)(!1),u=Object(d.a)(l,2),p=u[0],f=u[1],b=Object(r.useMemo)((function(){return a.map((function(e){return e.id}))}),[a]),h=La(b),v=h.indeterminate,g=h.checked,y=h.handleSelectAllClick,E=h.itemSelected,C=h.handleSelectClick,O=h.selected,j=h.setSelected,k=h.numSelected,x=Object(r.useCallback)((function(){f(!0)}),[]),w=Object(r.useCallback)((function(){f(!1)}),[]),S=Object(r.useCallback)((function(e){(null===e||void 0===e?void 0:e.length)&&i(e[0])}),[i]),N=Object(r.useCallback)((function(){O.forEach((function(e){c(e),j(new Set)}))}),[c,O,j]);return o.a.createElement("div",{className:e.root},o.a.createElement("div",{className:e.tableTop},o.a.createElement("div",{className:e.selectionOptions},o.a.createElement(W.a,{placement:"top",title:"Select All",arrow:!0},o.a.createElement(Yt.a,{indeterminate:v,checked:g,onChange:y})),k>0&&o.a.createElement(o.a.Fragment,null,o.a.createElement(W.a,{placement:"top",title:"Delete",arrow:!0},o.a.createElement(Ia,{onConfirm:N,displayText:"Are you sure that you would like to delete the selected ".concat(k>1?"criteria":"criterion","?")},o.a.createElement(z.a,{size:"small"},o.a.createElement(s.a,{icon:m.E,className:e.deleteIcon})))))),o.a.createElement("div",{className:e.buttonRow},o.a.createElement(Bt.a,{className:e.buildCriteriaButton,variant:"contained",color:"primary",startIcon:o.a.createElement(s.a,{icon:m.p}),onClick:x},"Import Library"),o.a.createElement(Bt.a,{className:e.buildCriteriaButton,variant:"contained",color:"primary",startIcon:o.a.createElement(s.a,{icon:m.D})},"Build Criteria"))),o.a.createElement(Pa,{open:p,onClose:w,onSelectFile:S,allowedFileType:".cql, .zip"}),"loading"===t?o.a.createElement(da,null):o.a.createElement(za,{handleSelectClick:C,itemSelected:E}))})),_a=Object(r.memo)((function(){return o.a.createElement(ra,null,o.a.createElement(ve,null,o.a.createElement(Ee,null,o.a.createElement(gt,null,o.a.createElement(Pt,null,o.a.createElement(h,null,o.a.createElement(Qt,null,o.a.createElement(l.a,null,o.a.createElement(u.d,null,o.a.createElement(u.b,{path:"/demo/builder/:id/node/:nodeId"},o.a.createElement(na,null)),o.a.createElement(u.b,{path:"/demo/builder/:id"},o.a.createElement(na,null)),o.a.createElement(u.b,{path:"/demo"},o.a.createElement(q,null),o.a.createElement(ca,{tabs:[{label:"Pathway",component:o.a.createElement(Ma,null)},{label:"Criteria",component:o.a.createElement(Wa,null)}]})))))))))))})),Ha=Object(_.a)((function(e){return{root:{display:"flex",padding:e.variables.spacing.globalPadding},modalHeader:{fontSize:"4em",fontWeight:600,margin:"-40px 0 10px",color:e.palette.common.blue},closeIcon:{width:"20px",height:"20px",padding:"20px"},modalText:{fontSize:"1.5em",color:e.palette.common.grayLighter,marginBottom:"40px"},submitButton:{fontSize:"1.3em",padding:"25px","& span":{fontFamily:["Roboto Condensed","sans-serif"].join(","),fontWeight:400,lineHeight:"0.2em"}}}}),{name:"Modal",index:1}),Ga=Object(r.memo)((function(e){var t=e.handleShowModal,n=e.handleCloseModal,a=e.handleSaveModal,r=e.headerTitle,i=e.headerSubtitle,c=e.footerText,l=void 0===c?"":c,u=e.hasSecondaryButton,d=void 0!==u&&u,p=e.submitButtonText,f=e.children,b=Ha();return o.a.createElement(nn.a,{open:t,onClose:n,fullWidth:!0,maxWidth:"sm"},o.a.createElement(an.a,{disableTypography:!0},o.a.createElement(z.a,{"aria-label":"close",onClick:n,className:b.closeIcon},o.a.createElement(s.a,{icon:m.C}))),o.a.createElement(rn.a,null,o.a.createElement("div",{className:b.modalHeader},r),o.a.createElement("div",{className:b.modalText},i),f&&f),o.a.createElement(on.a,null,o.a.createElement("div",null,l),d&&o.a.createElement(Bt.a,{variant:"contained",onClick:n},"Cancel"),o.a.createElement(Bt.a,{variant:"contained",color:"secondary",type:"submit",onClick:a,className:b.submitButton},p)))})),Ua=n(1572),Ka=n(1562),Ja=Object(_.a)((function(e){return{textInput:{margin:"10px 0"},input:{width:"100%","& input::placeholder":{color:e.palette.common.grayDark,fontStyle:"italic"}},icon:{color:e.palette.common.grayBlueDark,marginRight:"20px"}}}),{name:"TextInput",index:1}),Va=Object(r.memo)((function(e){var t=e.id,n=e.placeholder,a=void 0===n?"":n,r=e.icon,i=e.type,c=void 0===i?"text":i,l=e.helperText,u=void 0===l?"":l,d=Ja();return o.a.createElement("div",{className:d.textInput},o.a.createElement(Ua.a,{id:t,type:c,placeholder:a||"",className:d.input,startAdornment:o.a.createElement(Ka.a,{position:"start",className:d.icon},o.a.createElement(s.a,{icon:r}))}),u)})),Ya=Object(r.memo)((function(e){var t=e.open,n=e.onClose,a=e.onSignup,i=e.onReset,c=Object(r.useCallback)((function(){}),[]),l=o.a.createElement(o.a.Fragment,null,"Don't have an account?"," ",o.a.createElement(Bt.a,{variant:"text",color:"primary",onClick:a},"Sign up.")),u=o.a.createElement(o.a.Fragment,null,o.a.createElement("label",null,"Forgot your password?"),o.a.createElement(Bt.a,{variant:"text",color:"primary",onClick:i},"Request a reset link."));return o.a.createElement(Ga,{handleShowModal:t,handleCloseModal:n,handleSaveModal:c,headerTitle:"Log in",headerSubtitle:"Log in to access your account and manage your clinical pathways",footerText:l,submitButtonText:"Log in"},o.a.createElement(o.a.Fragment,null,o.a.createElement(Va,{id:"email",placeholder:"Email",type:"email",icon:m.k}),o.a.createElement(Va,{id:"password",placeholder:"Password",type:"password",icon:m.r,helperText:u})))})),$a=Object(r.memo)((function(e){var t=e.open,n=e.onClose,a=e.onLogin,r=e.onLinkSent,i=o.a.createElement(o.a.Fragment,null,"Already know your password?"," ",o.a.createElement(Bt.a,{variant:"text",color:"primary",onClick:a},"Log in."));return o.a.createElement(Ga,{handleShowModal:t,handleCloseModal:n,handleSaveModal:r,headerTitle:"Reset password",headerSubtitle:"Enter your email address you're using for your account below and we'll send you a password reset link",footerText:i,submitButtonText:"Reset"},o.a.createElement(o.a.Fragment,null,o.a.createElement(Va,{id:"email",placeholder:"Email",type:"email",icon:m.k})))})),Qa=Object(r.memo)((function(e){var t=e.open,n=e.onClose;return o.a.createElement(Ga,{handleShowModal:t,handleCloseModal:n,handleSaveModal:n,headerTitle:"Link sent",headerSubtitle:"A password reset link was successfully sent. Please check your email to set your new password.",submitButtonText:"Close"})})),Xa=Object(r.memo)((function(e){var t=e.open,n=e.onClose,a=e.onPasswordReset;return o.a.createElement(Ga,{handleShowModal:t,handleCloseModal:n,handleSaveModal:a,headerTitle:"Reset password",headerSubtitle:"Enter your new password for your account",submitButtonText:"Reset"},o.a.createElement(o.a.Fragment,null,o.a.createElement(Va,{id:"password",placeholder:"Password",type:"password",icon:m.r}),o.a.createElement(Va,{id:"confirm-password",placeholder:"Confirm password",type:"password",icon:m.r})))})),Za=Object(r.memo)((function(e){var t=e.open,n=e.onClose,a=e.onLogin;return o.a.createElement(Ga,{handleShowModal:t,handleCloseModal:n,handleSaveModal:a,headerTitle:"Password reset",headerSubtitle:"Your password was successfully reset! You can now use your new password to log in.",submitButtonText:"Log in"})})),er=Object(r.memo)((function(e){var t=e.open,n=e.onClose,a=e.onLogin,i=Object(r.useCallback)((function(){}),[]),c=o.a.createElement(o.a.Fragment,null,"Already signed up?"," ",o.a.createElement(Bt.a,{variant:"text",color:"primary",onClick:a},"Log in."));return o.a.createElement(Ga,{handleShowModal:t,handleCloseModal:n,handleSaveModal:i,headerTitle:"Sign up",headerSubtitle:"Create an account to start building your own clinical pathways",footerText:c,submitButtonText:"Sign up"},o.a.createElement(o.a.Fragment,null,o.a.createElement(Va,{id:"email",placeholder:"Email",type:"email",icon:m.k}),o.a.createElement(Va,{id:"organization",placeholder:"Organization (optional)",icon:m.b}),o.a.createElement(Va,{id:"password",placeholder:"Password",type:"password",icon:m.r}),o.a.createElement(Va,{id:"confirm-password",placeholder:"Confirm Password",type:"password",icon:m.r})))})),tr=Object(_.a)((function(e){return{landing:{display:"flex",flexDirection:"column",minHeight:"100vh"},header:{display:"flex",justifyContent:"space-between",alignItems:"center",height:"7em",backgroundColor:e.palette.common.grayLightest,padding:"0 4em"},logoLink:{display:"block"},logo:{height:"5em"},headerButtons:{display:"flex",justifyContent:"flex-end"},authButton:{padding:"30px",fontSize:"1.5em","& span":{fontFamily:["Roboto Condensed","sans-serif"].join(","),fontWeight:400,lineHeight:"0.2em"}},signupButton:{backgroundColor:e.palette.common.red,color:e.palette.common.white,marginRight:"20px",marginLeft:"auto","&:hover":{backgroundColor:e.palette.common.redDark}},loginButton:{backgroundColor:e.palette.common.white,border:"1px solid",borderColor:e.palette.common.grayBlueDark,color:e.palette.common.grayBlueDark,"&:hover":{color:e.palette.common.grayVeryDark}},tryItButton:{height:"60px",width:"200px",marginBottom:"1em","& button":{backgroundColor:e.palette.common.red,color:e.palette.common.white,boxShadow:"4px 4px 12px 0 rgba(0,0,0,0.50)",fontSize:"2.5em",height:"100%",width:"100%"},"& button:hover":{backgroundColor:e.palette.common.redDark},"& button span":{fontFamily:["Roboto Condensed","sans-serif"].join(","),fontWeight:400,textTransform:"none",lineHeight:"0.2em"}},landingBody:{display:"flex",alignItems:"center",justifyContent:"space-around",flex:"1",margin:"4em"},landingContent:{display:"flex",flexDirection:"column",marginRight:"10em"},text:{fontFamily:["Roboto Condensed","sans-serif"].join(","),fontWeight:300,lineHeight:"1.2em"},mainText:{fontSize:"4em",color:e.palette.common.grayBlueDark,marginBottom:"0.5em"},subText:{fontSize:"2.5em",color:e.palette.common.grayLighter,marginBottom:"2em",width:"80%"},link:{fontWeight:500,color:e.palette.common.blue,"&:hover":{color:e.palette.common.blueDark}},socialMedia:{display:"flex",color:e.palette.common.grayDark},iconGithub:{fontSize:"3em"},iconEmail:{marginLeft:"5px",color:e.palette.common.white,"& svg":{fontSize:"1.8em",padding:"5px"}},iconEmailCircle:{display:"flex",alignItems:"center",justifyContent:"space-around",backgroundColor:e.palette.common.grayDark,borderRadius:"50%",width:"42px",height:"42px"},exampleImage:{width:"50%",maxWidth:"800px"},footer:{display:"flex",justifyContent:"flex-end",alignItems:"center",backgroundColor:e.palette.common.grayLightest,padding:"0.5em 4em"},footerLogo:{display:"flex"},mitreLogo:{marginRight:"20px",height:"60px"},mcodeLogo:{height:"30px"}}}),{name:"Auth",index:1}),nr=Object(r.memo)((function(){var e=tr(),t=Object(r.useState)(!1),n=Object(d.a)(t,2),a=n[0],i=n[1],c=Object(r.useState)(!1),l=Object(d.a)(c,2),u=l[0],s=l[1],m=Object(r.useState)(!1),p=Object(d.a)(m,2),f=p[0],b=p[1],h=Object(r.useState)(!1),v=Object(d.a)(h,2),g=v[0],y=v[1],E=Object(r.useState)(!1),C=Object(d.a)(E,2),O=C[0],j=C[1],k=Object(r.useState)(!1),x=Object(d.a)(k,2),w=x[0],S=x[1],N=Object(r.useCallback)((function(){s(!1),b(!1),i(!0),S(!1)}),[]),T=Object(r.useCallback)((function(){s(!1),i(!1),b(!0)}),[]),I=Object(r.useCallback)((function(){i(!1),b(!1),s(!0)}),[]),R=Object(r.useCallback)((function(){b(!1),y(!0)}),[]),B=Object(r.useCallback)((function(){S(!0),j(!1)}),[]),D=Object(r.useCallback)((function(){i(!0)}),[]),P=Object(r.useCallback)((function(){i(!1)}),[]),L=Object(r.useCallback)((function(){s(!0)}),[]),M=Object(r.useCallback)((function(){s(!1)}),[]),A=Object(r.useCallback)((function(){b(!1)}),[]),F=Object(r.useCallback)((function(){y(!1)}),[]),q=Object(r.useCallback)((function(){j(!1)}),[]),z=Object(r.useCallback)((function(){S(!1)}),[]);return o.a.createElement("div",{className:e.landing},o.a.createElement(or,{openLogin:D,openSignup:L}),o.a.createElement(ur,null),o.a.createElement(fr,null),o.a.createElement(Ya,{open:a,onClose:P,onSignup:I,onReset:T}),o.a.createElement(er,{open:u,onClose:M,onLogin:N}),o.a.createElement($a,{open:f,onClose:A,onLogin:N,onLinkSent:R}),o.a.createElement(Qa,{open:g,onClose:F}),o.a.createElement(Xa,{open:O,onClose:q,onPasswordReset:B}),o.a.createElement(Za,{open:w,onClose:z,onLogin:N}))})),ar=n(1068),rr=n.n(ar),or=Object(r.memo)((function(e){var t=e.openLogin,n=e.openSignup,a=tr(),r=v().resetCurrentCriteria;return o.a.createElement("header",{className:a.header},o.a.createElement(l.b,{to:"/demo",onClick:r,className:a.logoLink},o.a.createElement("img",{src:rr.a,alt:"logo",className:a.logo})),o.a.createElement("div",{className:a.headerButtons},o.a.createElement(Bt.a,{className:Object(zt.a)(a.authButton,a.signupButton),onClick:n},"SIGN UP"),o.a.createElement(Bt.a,{className:Object(zt.a)(a.authButton,a.loginButton),onClick:t},"LOGIN")))})),ir=n(1070),cr=n(1069),lr=n.n(cr),ur=Object(r.memo)((function(){var e=tr();return o.a.createElement("div",{className:e.landingBody},o.a.createElement("div",{className:e.landingContent},o.a.createElement("div",{className:Object(zt.a)(e.text,e.mainText)},"A simple app to build customized clinical pathways"),o.a.createElement("div",{className:Object(zt.a)(e.text,e.subText)},"using"," ",o.a.createElement("a",{href:"https://mcodeinitiative.org/",className:e.link,target:"_blank",rel:"noopener noreferrer"},"mCODE"),", a standardized data model around cancer"),o.a.createElement(l.b,{to:"/demo",className:e.tryItButton},o.a.createElement(Bt.a,null,"Try It")),o.a.createElement("div",{className:e.socialMedia},o.a.createElement("a",{href:"https://github.com/mcode/pathway-builder",target:"_blank",rel:"noopener noreferrer"},o.a.createElement(z.a,{className:e.iconGithub},o.a.createElement(s.a,{icon:ir.a}))),o.a.createElement(z.a,{className:e.iconEmail},o.a.createElement("div",{className:e.iconEmailCircle},o.a.createElement(s.a,{icon:m.k}))))),o.a.createElement(o.a.Fragment,null,o.a.createElement("img",{src:lr.a,alt:"pathway",className:e.exampleImage})))})),dr=n(1071),sr=n.n(dr),mr=n(1072),pr=n.n(mr),fr=Object(r.memo)((function(){var e=tr();return o.a.createElement("footer",{className:e.footer},o.a.createElement("a",{href:"https://www.mitre.org/",target:"_blank",rel:"noopener noreferrer",className:e.footerLogo},o.a.createElement("img",{src:sr.a,alt:"mitre logo",className:e.mitreLogo})),o.a.createElement("a",{href:"https://mcodeinitiative.org/",target:"_blank",rel:"noopener noreferrer",className:e.footerLogo},o.a.createElement("img",{src:pr.a,alt:"mcode logo",className:e.mcodeLogo})))}));n(1503);c.a.render(o.a.createElement(P,{theme:"light"},o.a.createElement(l.a,null,o.a.createElement(u.d,null,o.a.createElement(u.b,{exact:!0,path:"/",component:nr}),o.a.createElement(u.b,{path:"/demo",component:_a})))),document.getElementById("root"))},181:function(e,t,n){"use strict";(function(e){var a=n(49),r=n(182),o=n(183),i=new(function(){function t(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(r.a)(this,t),this.config=e.CONFIG?Object(a.a)({},e.CONFIG,{},n):Object(a.a)({},n)}return Object(o.a)(t,[{key:"get",value:function(e,t){var n=e.split("."),a=this.config,r=null;for(var o in n){a=r=a[n[o]]}return r||t}},{key:"add",value:function(e){e&&(this.config=Object(a.a)({},this.config,{},e))}}]),t}());t.a=i}).call(this,n(108))},264:function(e,t,n){e.exports={logo:"Header_logo__3T0lc",homeLink:"Header_homeLink__2ew4r"}},340:function(e,t,n){e.exports={root:"Loading_root__3b6qy"}}},[[1094,1,2]]]);
//# sourceMappingURL=main.07456656.chunk.js.map